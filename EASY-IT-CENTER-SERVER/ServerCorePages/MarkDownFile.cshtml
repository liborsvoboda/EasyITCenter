@page "/MarkDownFile"
@{ Layout = "/ServerCorePages/Shared/MarkDownFileLayout.cshtml"; }

@addTagHelper *, WebOptimizer.Core
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Westwind.AspNetCore.Markdown
@using Microsoft.AspNetCore.Html;
@using EasyITCenter.ServerCoreStructure;
@using Westwind.AspNetCore.Markdown;
@model ServerCorePages.MarkDownFileModel
@{ ViewBag.Title = "EIC-MDsolution"; }

@* <markdown> *@ 
@{
    //Standalone Load File From Url Request
    string? requestedUrlPath = ""; HtmlString fileContent = new HtmlString(null); string mdfileContent;
    try {
        try { requestedUrlPath = ((string?)this.HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "FileValidUrl").Value); } catch { }
        string? filePath = System.IO.Path.Combine(ServerRuntimeData.WebRoot_path) + FileOperations.ConvertSystemFilePathFromUrl(requestedUrlPath);
        fileContent = Markdown.ParseHtmlString(System.IO.File.ReadAllText(filePath));
    } catch {
        try { requestedUrlPath = ((string?)HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "FileValidUrl").Value); } catch { }
        string? filePath = System.IO.Path.Combine(ServerRuntimeData.WebRoot_path) + FileOperations.ConvertSystemFilePathFromUrl(requestedUrlPath);
        mdfileContent = System.IO.File.ReadAllText(filePath);
    }

    if (MarkDownFileModel.result != null) {
        @Html.Raw(MarkDownFileModel.result)
    } else if (fileContent != null) {
        @Html.Raw(fileContent)
        ;
    }
} @* </markdown> *@

<!-- Syntax Highlighting code -->
<link href="~/ServerCoreTools/markdown/highlightjs/styles/vs2015.css" rel="stylesheet" />    
<script type="text/javascript" src="~/ServerCoreTools/markdown/js/globalScript.js"></script>
<script type="text/javascript" src="~/ServerCoreTools/markdown/highlightjs/highlight.pack.js"></script>
<script type="text/javascript" src="~/ServerCoreTools/markdown/highlightjs/highlightjs-badge.js"></script>
<script type="text/javascript" src="~/ServerCoreTools/markdown/highlightjs/mermaid.min.cdn.js"></script>

<script>
    async function Mermaid() { try { await mermaid.run({ nodes: document.querySelectorAll('.class-mermaid'), }); } catch (err) { } }

    var pres = document.querySelectorAll("pre>code"); pres = document.querySelectorAll("code");
    for (var i = 0; i < pres.length; i++) { hljs.highlightBlock(pres[i]); }
    window.highlightJsBadge();
    $(document).ready(function () {
        $("#docLoader").hide();
        setTimeout(() => { 
            googleTranslateElementInit(); 
            Mermaid();
        }, 3000);
    });
</script>


