@page "/ServerCoreTools/HtmlEditor"
@{ Layout = "/ServerCorePages/Shared/HtmlFileEditorLayout.cshtml"; }

@addTagHelper *, WebOptimizer.Core
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Westwind.AspNetCore.Markdown

@using ServerCorePages;
@using Microsoft.AspNetCore.Html;
@using EasyITCenter.DBModel;
@using EasyITCenter.ServerCoreWebPages;
@using EasyITCenter.ServerCoreStructure;
@using System.Security.Claims;
@using Westwind.AspNetCore.Markdown
@model ServerCorePages.IndexModel
@{

    // @Html.AntiForgeryToken()

    // var request = HttpContext.Request;
    // var _baseURL = $"{request.Scheme}://{request.Host}";
    // var fullUrl = _baseURL + HttpContext.Request.Path + HttpContext.Request.QueryString;

    string? sourcePath = HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "RequestedModulePath").Value?.ToString();
    ServerModuleAndServiceList? serverModule = ((ServerModuleAndServiceList?)HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "ServerModule").Value);
    ServerWebPagesToken? webpagestoken = ((ServerWebPagesToken?)HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "ServerWebPagesToken").Value);
}

<div id="contentWindow" style="min-width: 1024px !important;width: 100vw !important;max-width: 1024px !important;">
    <markdown>
        @{
            string? requestedUrlPath = ""; HtmlString fileContent = new HtmlString(null); string mdfileContent;
            try {//Standalone Load File From Url Request
                try { requestedUrlPath = ((string?)this.HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "FileValidUrl").Value); } catch { }
                string? filePath = System.IO.Path.Combine(ServerRuntimeData.WebRoot_path) + FileOperations.ConvertSystemFilePathFromUrl(requestedUrlPath);
                //fileContent = System.IO.File.ReadAllText(filePath);
                fileContent = Markdown.ParseHtmlString(System.IO.File.ReadAllText(filePath));
            } catch {
                try { requestedUrlPath = ((string?)HttpContext.Items.FirstOrDefault(a => a.Key.ToString() == "FileValidUrl").Value); } catch { }
                string? filePath = System.IO.Path.Combine(ServerRuntimeData.WebRoot_path) + FileOperations.ConvertSystemFilePathFromUrl(requestedUrlPath);
                mdfileContent = System.IO.File.ReadAllText(filePath);
            }

            if (IndexModel.result != null) {
                @Html.Raw(IndexModel.result)
            }
            else if (fileContent != null) {
                @Html.Raw(fileContent)
                ;
            }

        }
    </markdown>
</div>
