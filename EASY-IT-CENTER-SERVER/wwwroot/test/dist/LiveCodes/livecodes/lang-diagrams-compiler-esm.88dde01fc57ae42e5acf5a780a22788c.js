var pt=typeof atob=="function",dt=typeof btoa=="function",U=typeof Buffer=="function",q=typeof TextDecoder=="function"?new TextDecoder:void 0,R=typeof TextEncoder=="function"?new TextEncoder:void 0,mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=Array.prototype.slice.call(mt),S=(t=>{let e={};return t.forEach((s,r)=>e[s]=r),e})(k),ut=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,p=String.fromCharCode.bind(String),P=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),gt=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),H=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ft=t=>{let e,s,r,n,o="",i=t.length%3;for(let c=0;c<t.length;){if((s=t.charCodeAt(c++))>255||(r=t.charCodeAt(c++))>255||(n=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=s<<16|r<<8|n,o+=k[e>>18&63]+k[e>>12&63]+k[e>>6&63]+k[e&63]}return i?o.slice(0,i-3)+"===".substring(i):o},F=dt?t=>btoa(t):U?t=>Buffer.from(t,"binary").toString("base64"):ft,ht=U?t=>Buffer.from(t).toString("base64"):t=>{let s=[];for(let r=0,n=t.length;r<n;r+=4096)s.push(p.apply(null,t.subarray(r,r+4096)));return F(s.join(""))};var xt=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?p(192|e>>>6)+p(128|e&63):p(224|e>>>12&15)+p(128|e>>>6&63)+p(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return p(240|e>>>18&7)+p(128|e>>>12&63)+p(128|e>>>6&63)+p(128|e&63)}},yt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,bt=t=>t.replace(yt,xt),N=U?t=>Buffer.from(t,"utf8").toString("base64"):R?t=>ht(R.encode(t)):t=>F(bt(t)),_=(t,e=!1)=>e?gt(N(t)):N(t);var vt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wt=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),s=e-65536;return p((s>>>10)+55296)+p((s&1023)+56320);case 3:return p((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return p((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Ut=t=>t.replace(vt,wt),jt=t=>{if(t=t.replace(/\s+/g,""),!ut.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,s="",r,n;for(let o=0;o<t.length;)e=S[t.charAt(o++)]<<18|S[t.charAt(o++)]<<12|(r=S[t.charAt(o++)])<<6|(n=S[t.charAt(o++)]),s+=r===64?p(e>>16&255):n===64?p(e>>16&255,e>>8&255):p(e>>16&255,e>>8&255,e&255);return s},W=pt?t=>atob(H(t)):U?t=>Buffer.from(t,"base64").toString("binary"):jt,Ct=U?t=>P(Buffer.from(t,"base64")):t=>P(W(t).split("").map(e=>e.charCodeAt(0)));var kt=U?t=>Buffer.from(t,"base64").toString("utf8"):q?t=>q.decode(Ct(t)):t=>Ut(W(t)),St=t=>H(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),O=t=>kt(St(t));var z=t=>t.replace(/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g,function(s){return'"'+s.substring(1,s.length-1)+'"'}).replace(/(\w+(?=([^"\\]*(\\.|"([^"\\]*\\.)*[^"\\]*"))*[^"]*$))(\s*:)(?!(\w*)(?:"))/gm,function(s){return'"'+s.substring(0,s.length-1).trimEnd()+'":'}).replace(/,\s*([\]}])/g,"$1");var m=(t,e)=>new Promise((s,r)=>{if(e&&globalThis[e])return s(globalThis[e]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(t),e&&globalThis[e]?s(globalThis[e]):s(globalThis);let n=document.createElement("script");n.src=t,n.async=!0;let o=()=>{n.removeEventListener("load",i),n.removeEventListener("error",c)},i=()=>{if(o(),!e)return s("loaded: "+t);let l=setInterval(()=>{if(window[e])return clearInterval(l),s(window[e])},5)},c=()=>{o(),r("failed to load: "+t)};n.addEventListener("load",i),n.addEventListener("error",c),document.head.appendChild(n)});var I=t=>new Promise((e,s)=>{let r=new FileReader;r.readAsDataURL(t),r.onload=()=>typeof r.result=="string"?e(r.result):s(),r.onerror=n=>s(n)});var A=(t,e="text/javascript")=>`data:${e};charset=UTF-8;base64,`+_(t),B=t=>A(`importScripts("${t}");`);var E=t=>t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");var V=(t,e)=>({...e.customSettings[t]});var J=(t,e)=>async s=>{try{return await t(s)}catch(r){return typeof e=="function"&&e(r),s}};var Z=["esm.sh","skypack","esm.run","jsdelivr.esm","fastly.jsdelivr.esm","gcore.jsdelivr.esm","testingcf.jsdelivr.esm","jsdelivr.b-cdn.esm","jspm"],G=["jsdelivr","fastly.jsdelivr","unpkg","gcore.jsdelivr","testingcf.jsdelivr","jsdelivr.b-cdn","npmcdn"],Q=["jsdelivr.gh","fastly.jsdelivr.gh","statically","gcore.jsdelivr.gh","testingcf.jsdelivr.gh","jsdelivr.b-cdn.gh"],v={getModuleUrl:(t,{isModule:e=!0,defaultCDN:s="esm.sh"}={})=>{t=t.replace(/#nobundle/g,"");let r=K(t,e,s);return r||(e?"https://esm.sh/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,e)=>t.startsWith("http")||t.startsWith("data:")?t:K(t,!1,e||Tt())||t,cdnLists:{npm:G,module:Z,gh:Q},checkCDNs:async(t,e)=>{let s=[e,...v.cdnLists.npm].filter(Boolean);for(let r of s)try{if((await fetch(v.getUrl(t,r),{method:"HEAD"})).ok)return r}catch{}return v.cdnLists.npm[0]}},Tt=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||v.cdnLists.npm[0]}catch{return v.cdnLists.npm[0]}},K=(t,e,s)=>{let r=e&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",Q[0]):t.includes(":")||(t=(s||(e?Z[0]:G[0]))+":"+t);for(let n of Lt){let[o,i]=n;if(o.test(t))return t.replace(o,i)+r}return null},Lt=[[/^(esm\.sh:)(.+)/i,"https://esm.sh/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(jsr:)(.+)/i,"https://esm.sh/jsr/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly\.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(gcore\.jsdelivr:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2"],[/^(testingcf\.jsdelivr:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2"],[/^(jsdelivr\.b-cdn:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2"],[/^(jsdelivr\.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly\.jsdelivr\.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(gcore\.jsdelivr\.gh:)(.+)/i,"https://gcore.jsdelivr.net/gh/$2"],[/^(testingcf\.jsdelivr\.gh:)(.+)/i,"https://testingcf.jsdelivr.net/gh/$2"],[/^(jsdelivr\.b-cdn\.gh:)(.+)/i,"https://jsdelivr.b-cdn.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm\.run:)(.+)/i,"https://esm.run/$2"],[/^(jsdelivr\.esm:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2/+esm"],[/^(fastly\.jsdelivr\.esm:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2/+esm"],[/^(gcore\.jsdelivr\.esm:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2/+esm"],[/^(testingcf\.jsdelivr\.esm:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2/+esm"],[/^(jsdelivr\.b-cdn\.esm:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2/+esm"],[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle\.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(npmcdn:)(.+)/i,"https://npmcdn.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:d,getModuleUrl:Kt}=v,X="5.5.2",T=d("@live-codes/browser-compilers@0.10.0/dist/");var Y=d("cytoscape-svg@0.4.0/cytoscape-svg.js"),tt=d("cytoscape@3.25.0/dist/cytoscape.min.js");var $=d("elkjs@0.8.2/lib/");var et=d("graphre@0.1.3/dist/graphre.js");var st=d("@hpcc-js/wasm@2.13.0/dist/index.js");var At="0.6.64",Zt=d(`malinajs@${At}/malina.js`);var rt=d("mermaid@10.2.2/dist/mermaid.esm.mjs");var Gt=`https://typescript.azureedge.net/cdn/${X}/monaco/min/vs`;var ot=d("nomnoml@1.6.1/dist/nomnoml.js");var nt=d("@pintora/standalone@0.6.2/lib/pintora-standalone.umd.js"),it=d("plotly.js@2.23.2/dist/plotly.js");var at=d("svgbob-wasm@0.4.1-a0/svgbob_wasm_bg.wasm");var Qt=d(`typescript@${X}/lib/typescript.js`);var M=d("vega@5.25.0/build/vega.js"),ct=d("vega-lite@5.9.3/build/vega-lite.js");var D=d("wavedrom@3.2.0/");var lt=!1,Bt=(t,e)=>{t.tagName.toLowerCase()==="img"?t.src=A(e,"image/svg+xml"):t.innerHTML=e},j=t=>z(E(t)),h=async(t,e,s,r,n=!1)=>{if(!t)return"";let o=document.createElement("div");o.innerHTML=t;let i=o.querySelectorAll(`script[type="application/diagram-${e}"]`);if(i.length===0)return o.remove(),t;await s();for(let l of i){if(!l.src&&!l.innerHTML.trim())continue;let u=l.dataset.output;if(!u)continue;let b=l.src?await fetch(l.src).then(a=>a.text()):l.innerHTML,x=await r(b,l),C=o.querySelectorAll(`[data-src="${u}"]`);for(let a of C)a.tagName.toLowerCase()!=="img"&&n&&(lt=!0,x=`<svg-container> ${x} </svg-container>`),Bt(a,x);l.remove()}let c=o.innerHTML;return o.remove(),c},Et=async t=>{let e=document.createElement("div");e.innerHTML=t,document.body.appendChild(e);let s=e.querySelectorAll('script[type="application/diagram-gnuplot"]');if(s.length===0)return e.remove(),t;let r=T+"gnuplot",n=await m(r+"/gnuplot_api.js","Gnuplot"),o=B(r+"/gnuplot.js"),i=window.gnuplot=window.gnuplot||new n(o),c=(a,g)=>new Promise(async y=>{await Promise.all(g.map(w=>new Promise(L=>{i.putFile(w.fileName,w.content,L)}))),i.run(a,y)}),l=a=>new Promise(g=>{i.getFile(a,function(y){if(!y?.content){g("");return}let w=new Uint8Array(y.content),L=new Blob([w],{type:"image/svg+xml"});I(L).then(g)})});await new Promise(a=>i.removeFiles(null,a));let u=[],b=e.querySelectorAll('script[type="application/diagram-gnuplot-file"]');for(let a of b){if(!a.dataset.file&&!a.src)continue;let g=a.src?await fetch(a.src).then(w=>w.text()):a.innerHTML,y=a.dataset.file||a.src?.split("/")[a.src?.split("/").length-1]||"data.txt";u.push({fileName:y,content:g}),a.remove()}for(let a of s){if(!a.src&&!a.innerHTML.trim())continue;let g=a.src?await fetch(a.src).then(y=>y.text()):a.innerHTML;await c(g,u),a.remove()}let x=e.querySelectorAll("[data-src]");for(let a of x){let g=await l(a.dataset.src||"");g&&(a.tagName.toLowerCase()==="img"?a.src=g:a.innerHTML=O(g.split(",")[1]))}let C=e.innerHTML;return e.remove(),C},$t=async t=>{let e,s=async()=>{e=(await import(rt)).default,e.initialize({startOnLoad:!1})},r=0,n=()=>r++;return h(t,"mermaid",s,async i=>{let c=document.createElement("div");c.id="livecodes-mermaid-chart-"+n(),document.body.appendChild(c);let{svg:l}=await e.render(c.id,i.trim());return c.remove(),l})},Mt=async t=>{let e;return h(t,"graphviz",async()=>{e=await(await import(st)).Graphviz.load()},(n,o)=>{let i=o.dataset.layout||"dot";return e.layout(n,"svg",i)})},Dt=async t=>{let e=document.createElement("div");e.innerHTML=t;let s=e.querySelectorAll('script[type="application/diagram-vega-lite"]'),r;if(s.length>0){r=await m(M,"vega");let c=await m(ct,"vegaLite");for(let l of s){if(!l.src&&!l.innerHTML.trim()||!l.dataset.output)continue;let b={};try{let x=l.src?await fetch(l.src).then(C=>C.json()):JSON.parse(j(l.innerHTML));l.innerHTML=JSON.stringify(c.compile(x,b).spec),l.type="application/diagram-vega",l.removeAttribute("src")}catch{throw l.remove(),new Error("failed to parse vegaLite specs.")}}}let n=async()=>{r=r||await m(M,"vega")},o=async(c,l={})=>{let u=document.createElement("div");try{let b=JSON.parse(j(c));return await new r.View(r.parse(b),{...l,renderer:"svg",container:u}).runAsync(),u.querySelector("svg")?.outerHTML||""}catch{throw new Error("failed to parse vega specs.")}finally{u.remove()}},i=await h(e.innerHTML,"vega",n,o);return e.remove(),i},qt=async t=>{let e;return h(t,"plotly",async()=>{e=await m(it,"Plotly")},n=>{let o=document.createElement("div");try{let i=JSON.parse(j(n));return e.newPlot(o,i.data,i.layout,{displayModeBar:!1}),o.querySelector("svg")?.outerHTML||""}catch{throw new Error("failed to parse plotly specs.")}finally{o.remove()}})},Rt=async t=>{let e;return h(t,"svgbob",async()=>{let{svgbobWasm:n}=await import(T+"svgbob-wasm/svgbob-wasm.js");e=await n(at)},n=>e.convert_string(n),!0)},Pt=async t=>{let e;return h(t,"wavedrom",async()=>{await m(D+"skins/default.js","WaveSkin"),e=await m(D+"wavedrom.min.js","WaveDrom")},n=>{let o=document.createElement("div");try{let i=JSON.parse(j(n));return o.id="diagram-id",document.body.appendChild(o),e.RenderWaveForm(o.id,i,""),o.innerHTML||""}catch{throw new Error("failed to parse WaveDrom specs.")}finally{o.remove()}})},Nt=async t=>{let e;return h(t,"nomnoml",async()=>{await m(et,"graphre"),e=await m(ot,"nomnoml")},n=>e.renderSvg(n))},Ht=async t=>{let e,s;return h(t,"elk",async()=>{let o=$+"elk-api.js",i=$+"elk-worker.min.js",c=T+"elkjs-svg/elkjs-svg.js",l=await m(o,"ELK"),u=await m(c,"elksvg");e=new l({workerUrl:B(i)}),s=new u.Renderer},o=>{try{let i=JSON.parse(j(o));return e.layout(i).then(c=>s.toSvg(c))}catch{throw new Error("failed to parse ELK JSON.")}},!0)},Ft=async t=>{let e,s;return h(t,"cytoscape",async()=>{[e,s]=await Promise.all([m(tt,"cytoscape"),m(Y,"cytoscapeSvg")]),e.use(s)},o=>{let i=document.createElement("div");i.style.display="block",i.style.visibility="none",i.style.height="300px",i.style.width="300px",document.body.appendChild(i);try{let c={...JSON.parse(j(E(o))),container:i};return e(c).svg({scale:1,full:!0})}catch{throw new Error("failed to parse Cytoscape options.")}finally{i.remove()}})},_t=async(t,e)=>{let s;return h(t,"pintora",async()=>{s=await m(nt,"pintora")},o=>{let i=document.createElement("div");s.default.renderTo(o,{container:i,config:{...V("pintora",e)}});let c=i.firstElementChild;return c?.setAttribute("xmlns","http://www.w3.org/2000/svg"),c?.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.innerHTML})},Wt=()=>lt?`
<script>
  class SVGContainer extends HTMLElement {
    constructor() {
      super();
      const shadowRoot = this.attachShadow({mode: 'closed'});
      shadowRoot.append(...this.childNodes);
    }
  }
  customElements.define('svg-container', SVGContainer);
<\/script>
`:"",f=t=>J(t,console.error),se=async(t,{config:e})=>await Promise.resolve(t).then(f(Et)).then(f($t)).then(f(Mt)).then(f(Dt)).then(f(qt)).then(f(Rt)).then(f(Pt)).then(f(Nt)).then(f(Ht)).then(f(Ft)).then(f(r=>_t(r,e))).catch(r=>(console.error(r),t))+Wt();export{se as diagramsCompiler};
