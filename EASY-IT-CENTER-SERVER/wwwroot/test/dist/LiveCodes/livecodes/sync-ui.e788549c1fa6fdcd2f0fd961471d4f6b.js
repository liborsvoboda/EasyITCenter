var M='<div id="sync-container" class="modal-container"><div class="modal-title">Sync to GitHub Repo</div><div id="sync-status" class="modal-status"></div><ul id="sync-tabs" class="modal-tabs"><li data-target="new-repo" class="active">Create New Repo</li><li data-target="existing-repo">Existing Repo</li></ul><div id="sync-screens" class="modal-screen-container"><div id="new-repo" class="tab-content active"><div class="modal-screen"><form id="new-repo-form"><div><label for="new-repo-name">Repo Name <span id="new-repo-name-error" class="error"></span></label> <input type="text" id="new-repo-name" placeholder="Required"></div><div class="padded"><input type="checkbox" id="new-repo-autosync" checked> <label for="new-repo-autosync">Auto sync</label></div><button id="new-repo-btn" class="wide-button start-sync-btn" type="submit">Sync</button></form><div class="description">A new <strong>private</strong> repo will be created. Your LiveCodes local data will be synchronized with <span class="code">main</span> branch.</div></div></div><div id="existing-repo" class="tab-content"><div class="modal-screen"><form id="existing-repo-form"><div><label for="existing-repo-name">Repo Name</label> <input type="text" id="existing-repo-name" autocomplete="off" placeholder="Loading..."></div><div class="padded"><input type="checkbox" id="existing-repo-autosync" checked> <label for="existing-repo-autosync">Auto sync</label></div><button id="existing-repo-btn" class="wide-button start-sync-btn" type="submit">sync</button></form><div class="description">Your LiveCodes local data will be synchronized with <span class="code">main</span> branch.</div></div></div></div></div>';var Z=e=>e.replace(/{{APP_VERSION}}/g,"30").replace(/{{SDK_VERSION}}/g,"0.5.0").replace(/{{COMMIT_SHA}}/g,"").replace(/{{REPO_URL}}/g,"").replace(/{{DOCS_BASE_URL}}/g,"/docs/");var w=Z(M);var v=["esm.sh","skypack","esm.run","jsdelivr.esm","fastly.jsdelivr.esm","gcore.jsdelivr.esm","testingcf.jsdelivr.esm","jsdelivr.b-cdn.esm","jspm"],j=["jsdelivr","fastly.jsdelivr","unpkg","gcore.jsdelivr","testingcf.jsdelivr","jsdelivr.b-cdn","npmcdn"],q=["jsdelivr.gh","fastly.jsdelivr.gh","statically","gcore.jsdelivr.gh","testingcf.jsdelivr.gh","jsdelivr.b-cdn.gh"],g={getModuleUrl:(e,{isModule:t=!0,defaultCDN:o="esm.sh"}={})=>{e=e.replace(/#nobundle/g,"");let n=H(e,t,o);return n||(t?"https://esm.sh/"+e:"https://cdn.jsdelivr.net/npm/"+e)},getUrl:(e,t)=>e.startsWith("http")||e.startsWith("data:")?e:H(e,!1,t||Q())||e,cdnLists:{npm:j,module:v,gh:q},checkCDNs:async(e,t)=>{let o=[t,...g.cdnLists.npm].filter(Boolean);for(let n of o)try{if((await fetch(g.getUrl(e,n),{method:"HEAD"})).ok)return n}catch{}return g.cdnLists.npm[0]}},Q=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||g.cdnLists.npm[0]}catch{return g.cdnLists.npm[0]}},H=(e,t,o)=>{let n=t&&e.startsWith("unpkg:")?"?module":"";e.startsWith("gh:")?e=e.replace("gh",q[0]):e.includes(":")||(e=(o||(t?v[0]:j[0]))+":"+e);for(let r of Y){let[c,a]=r;if(c.test(e))return e.replace(c,a)+n}return null},Y=[[/^(esm\.sh:)(.+)/i,"https://esm.sh/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(jsr:)(.+)/i,"https://esm.sh/jsr/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly\.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(gcore\.jsdelivr:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2"],[/^(testingcf\.jsdelivr:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2"],[/^(jsdelivr\.b-cdn:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2"],[/^(jsdelivr\.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly\.jsdelivr\.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(gcore\.jsdelivr\.gh:)(.+)/i,"https://gcore.jsdelivr.net/gh/$2"],[/^(testingcf\.jsdelivr\.gh:)(.+)/i,"https://testingcf.jsdelivr.net/gh/$2"],[/^(jsdelivr\.b-cdn\.gh:)(.+)/i,"https://jsdelivr.b-cdn.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm\.run:)(.+)/i,"https://esm.run/$2"],[/^(jsdelivr\.esm:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2/+esm"],[/^(fastly\.jsdelivr\.esm:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2/+esm"],[/^(gcore\.jsdelivr\.esm:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2/+esm"],[/^(testingcf\.jsdelivr\.esm:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2/+esm"],[/^(jsdelivr\.b-cdn\.esm:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2/+esm"],[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle\.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(npmcdn:)(.+)/i,"https://npmcdn.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:f,getModuleUrl:ae}=g,U="5.5.2";var k=f("@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js");var X="0.6.64",le=f(`malinajs@${X}/malina.js`);var ie=`https://typescript.azureedge.net/cdn/${U}/monaco/min/vs`;var pe=f(`typescript@${U}/lib/typescript.js`);var R=(e,t)=>new Promise((o,n)=>{if(t&&globalThis[t])return o(globalThis[t]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(e),t&&globalThis[t]?o(globalThis[t]):o(globalThis);let r=document.createElement("script");r.src=e,r.async=!0;let c=()=>{r.removeEventListener("load",a),r.removeEventListener("error",s)},a=()=>{if(c(),!t)return o("loaded: "+e);let l=setInterval(()=>{if(window[t])return clearInterval(l),o(window[t])},5)},s=()=>{c(),n("failed to load: "+e)};r.addEventListener("load",a),r.addEventListener("error",s),document.head.appendChild(r)});var A=async e=>{let t=globalThis.define;globalThis.define=void 0;let o=await e();return globalThis.define=t,o};var ee=(e,t)=>({Accept:`application/vnd.github.v3${t?"."+t:""}+json`,"Content-Type":"application/json",Authorization:"token "+e.token});var B=async(e,t="public")=>{let o=1,n=100,r=5,c=[];for(;o<=r;){let a=await fetch(`https://api.github.com/user/repos?type=${t}&per_page=${n}&page=${o}`,{method:"GET",cache:"no-store",headers:ee(e)});if(o+=1,!a.ok)continue;let s=await a.json();c.push(...s.map(l=>l.name)),s.length<n&&(o=r+1)}return c};var b=()=>document.querySelector("#sync-link"),C=()=>document.querySelector("#sync-indicator");var I=e=>e.querySelector("#new-repo-form");var $=e=>e.querySelector("#new-repo-name");var D=e=>e.querySelector("#new-repo-autosync"),P=e=>e.querySelector("#existing-repo-form");var E=e=>e.querySelector("#existing-repo-name");var N=e=>e.querySelector("#existing-repo-autosync");var F=e=>(e||document).querySelector("#sync-status"),O=e=>(e||document).querySelectorAll(".start-sync-btn");var te=(e,t)=>{let o=document.createElement("div");o.innerHTML=w;let n=o.firstChild,r=n.querySelectorAll("#sync-tabs li");return r.forEach(c=>{e.addEventListener(c,"click",()=>{r.forEach(s=>s.classList.remove("active")),c.classList.add("active"),document.querySelectorAll("#sync-screens > div").forEach(s=>{s.classList.remove("active")});let a=n.querySelector("#"+c.dataset.target);a?.classList.add("active"),a?.querySelector("input")?.focus()})}),t&&setTimeout(()=>{r[1].click();let c=E(n);c.value=t}),n},S="Sync in progress...",h=()=>b()?.dataset.hint===S,y=({inProgress:e,lastSync:t,syncContainer:o})=>{let n=b(),r=C(),c=F(o),a=O(o),s=t?`Last sync: ${new Date(t).toLocaleString()}`:"";c&&(c.innerText=s),e??h()?(n&&(n.classList.add("hint--bottom"),n.dataset.hint=S,r?.classList.remove("hidden")),a?.forEach(l=>{l.innerText=S,l.disabled=!0})):(n&&(n.classList.toggle("hint--bottom",!!s),n.dataset.hint=s,r?.classList.add("hidden")),a?.forEach(l=>{l.innerText="Sync",l.disabled=!1}))},Te=async({baseUrl:e,modal:t,notifications:o,eventsManager:n,user:r,deps:c})=>{let a=await c.getSyncData(),s=te(n,a?.repo),l=I(s),T=$(s),W=D(s),z=P(s),x=E(s),_=N(s);y({inProgress:h(),lastSync:a?.lastSync,syncContainer:s});let G=import(e+"sync.46d2ee820d756a900cd0df6e08c5fee1.js").then(p=>(p.init(e),p)),L=(p,i,u)=>(o.info("Sync started..."),t.close(),G.then(async m=>{if(!await m.sync({user:p,repo:i,newRepo:u})){o.error("Sync failed!");return}o.success("Sync complete!")}).catch(()=>{o.error("Sync failed!")}));n.addEventListener(l,"submit",async p=>{if(p.preventDefault(),!r||h())return;let i=T.value,u=W.checked,m=!0;if(!i){o.error("Repo name is required");return}y({inProgress:!0}),await L(r,i,m);let d=Date.now();await c.setSyncData({autosync:u,repo:i,lastSync:d}),y({inProgress:!1,lastSync:d})}),n.addEventListener(z,"submit",async p=>{if(p.preventDefault(),!r||h())return;let i=x.value,u=_.checked,m=!1;if(!i){o.error("Repo name is required");return}y({inProgress:!0}),await L(r,i,m);let d=Date.now();await c.setSyncData({autosync:u,repo:i,lastSync:d}),y({inProgress:!1,lastSync:d})}),t.show(s,{isAsync:!0}),T.focus(),r&&A(()=>R(k,"autoComplete")).then(async p=>{let i=await B(r,"all");n.addEventListener(x,"init",()=>{x.focus()});let u="#"+x.id;if(!document.querySelector(u))return;let m=new p({selector:u,placeHolder:"Search your repos...",data:{src:i},resultItem:{highlight:{render:!0}}});n.addEventListener(m.input,"selection",function(d){let J=d.detail;m.input.blur();let V=J.selection.value;m.input.value=V})})};export{Te as createSyncUI,h as isSyncInProgress,y as updateSyncStatus};
