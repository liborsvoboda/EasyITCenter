<!DOCTYPE html>
<html><head><title>AutoScheduledTasksDefs.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(209);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EasyITcenter-HELP/ServerCore/Interfaces/AutoScheduledTasksDefs.cs" target="_top">ServerCore\Interfaces\AutoScheduledTasksDefs.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EasyITcenter-HELP" target="_top">HelpProjects\EasyITcenter-HELP\EasyITcenter-HELP.csproj</a> (EasyITcenter-HELP)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">Quartz</span>;
<b>using</b> <span class="i n">Quartz</span>.<span class="i n">Spi</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
 
<b>namespace</b> <span class="i n">EasyITCenter</span>.<span class="i n">ServerCoreStructure</span> {
 
 
    <b>public class</b> <a id="19fad0ba3824ad29" href="../../R/19fad0ba3824ad29.html" target="n" data-glyph="0,0" class="t t">AutoSchedulerService</a> : <span class="t t">IHostedService</span> {
        <b>private readonly</b> <span class="t t">ILogger</span> <a id="85a40779a7f9d3ea" href="../../R/85a40779a7f9d3ea.html" target="n" data-glyph="46,1" class="i field">_logger</a>;
 
        <b>public</b> <a id="46df0ef890155b6c" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">AutoSchedulerService</a>(<span class="t t">ILogger</span>&lt;<a href="#19fad0ba3824ad29" class="t t">AutoSchedulerService</a>&gt; <span id="r0 rd" class="r0 r">logger</span>) {
            <a href="#85a40779a7f9d3ea" class="i field">_logger</a> = <span class="r0 r">logger</span>;
            <span class="c">//ServerRuntimeData.ServerAutoSchedulerProvider = scheduler;</span>
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7803592b486f3025" href="../../R/7803592b486f3025.html" target="n" data-glyph="72,1" class="i method">StartAsync</a>(<a href="@1@System.Runtime/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r1 rd" class="r1 r">cancellationToken</span>) {
            <b>await</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i method">Start</span>(<span class="r1 r">cancellationToken</span>);
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7deeae595ef37414" href="../../R/7deeae595ef37414.html" target="n" data-glyph="72,1" class="i method">StopAsync</a>(<a href="@1@System.Runtime/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r2 rd" class="r2 r">cancellationToken</span>) {
            <b>await</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i method">Shutdown</span>(<span class="r2 r">cancellationToken</span>);
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0d383858c999f8eb" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PauseAll</a>(<a href="@1@System.Runtime/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r3 rd" class="r3 r">cancellationToken</span>) {
            <b>await</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i method">PauseAll</span>(<span class="r3 r">cancellationToken</span>);
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8676e255f5d5062a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ResumeAll</a>(<a href="@1@System.Runtime/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r4 rd" class="r4 r">cancellationToken</span>) {
            <b>await</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i method">ResumeAll</span>(<span class="r4 r">cancellationToken</span>);
        }
        <b>public async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>bool</b>&gt; <a id="962826cfa90ed54d" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IsPaused</a>(<a href="@1@System.Runtime/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r5 rd" class="r5 r">cancellationToken</span>) {
           <b>return</b> <b>await</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i method">IsTriggerGroupPaused</span>(<span class="s">&quot;AutoScheduler&quot;</span>,<span class="r5 r">cancellationToken</span>);
        }
        <b>public bool</b> <a id="ee80f8f6dc56466b" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IsShutdown</a>() { <b>return</b> <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>.<span class="i property">IsShutdown</span>; }
    }
 
 
    <b>public class</b> <a id="9d8adea55d7728c7" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">JobFactory</a> : <span class="t t">IJobFactory</span> {
        <b>private readonly</b> <span class="t t">IServiceProvider</span> <a id="9c1e6196c4eceaac" href="../../R/9c1e6196c4eceaac.html" target="n" data-glyph="46,1" class="i field">_serviceProvider</a>;
 
        <b>public</b> <a id="07c4dcdb2f47efb9" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">JobFactory</a>(<span class="t t">IServiceProvider</span> <span id="r6 rd" class="r6 r">serviceProvider</span>) {
            <a href="#9c1e6196c4eceaac" class="i field">_serviceProvider</a> = <span class="r6 r">serviceProvider</span>;
        }
 
        <b>public</b> <span class="t t">IJob</span> <a id="f040def18a794a0a" href="../../R/f040def18a794a0a.html" target="n" data-glyph="72,1" class="i method">NewJob</a>(<span class="t t">TriggerFiredBundle</span> <span id="r7 rd" class="r7 r">bundle</span>, <span class="t t">IScheduler</span> <span id="r8 rd" class="r8 r">scheduler</span>) {
            <a href="#ca20cd14d2de9539" class="k">var</a> <span id="r9 rd" class="r9 r">job</span> = <a href="#9c1e6196c4eceaac" class="i field">_serviceProvider</a>.<span class="i method">GetService</span>(<span class="r7 r">bundle</span>.<span class="i property">JobDetail</span>.<span class="i property">JobType</span>) <b>as</b> <a href="#ca20cd14d2de9539" class="t t">AutoScheduledJob</a>;
            <b>return</b> <span class="r9 r">job</span>;
        }
 
        <b>public void</b> <a id="32cf1d1e53300b65" href="../../R/32cf1d1e53300b65.html" target="n" data-glyph="72,1" class="i method">ReturnJob</a>(<span class="t t">IJob</span> <span id="r10 rd" class="r10 r">job</span>) {
        }
    }
 
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Server AutoSchedule Planner</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public static class</b> <a id="e415f4c00212ad81" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">ServerCoreAutoScheduler</a> {
 
        <b>internal async static</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>bool</b>&gt; <a id="fab7a3d41427358d" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AutoSchedulerPlanner</a>(<b>int</b>? <span id="r11 rd" class="r11 r">rescheduleTaskId</span> = <b>null</b>, <b>bool</b> <span id="r12 rd" class="r12 r">deleteOnly</span> = <b>false</b>) {
            <span class="t t">IScheduler</span>? <span id="r13 rd" class="r13 r">scheduler</span> = <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>; <span class="t t">List</span>&lt;<span class="i">SolutionSchedulerList</span>&gt;? <span id="r14 rd" class="r14 r">data</span> = <b>null</b>;
 
            <b>if</b> (<span class="r11 r">rescheduleTaskId</span> == <b>null</b>) { <span class="r14 r">data</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionSchedulerLists</span>.<span class="i">Where</span>(<span id="r15 rd" class="r15 r">a</span> =&gt; <span class="r15 r">a</span>.<span class="i">Active</span>).<span class="i">Include</span>(<span id="r16 rd" class="r16 r">a</span> =&gt; <span class="r16 r">a</span>.<span class="i">User</span>).<span class="i">ThenInclude</span>(<span id="r17 rd" class="r17 r">a</span> =&gt; <span class="r17 r">a</span>.<span class="i">Role</span>).<span class="i">ToList</span>(); }
            <b>else</b> <b>if</b> (<span class="r11 r">rescheduleTaskId</span> != <b>null</b> &amp;&amp; <span class="r12 r">deleteOnly</span>) { <span class="t t">JobKey</span> <span id="r18 rd" class="r18 r">remoteScheduledTask</span> = <b>new</b> <span class="t constructor">JobKey</span>(<span class="r11 r">rescheduleTaskId</span>.<a href="@1@System.Runtime/A.html#d83d2db767b43db7" class="i method">ToString</a>(), <span class="s">&quot;AutoScheduler&quot;</span>); <b>await</b> <span class="r13 r">scheduler</span>.<span class="i method">DeleteJob</span>(<span class="r18 r">remoteScheduledTask</span>); }
            <b>else</b> {
                <span class="r14 r">data</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionSchedulerLists</span>.<span class="i">Where</span>(<span id="r19 rd" class="r19 r">a</span> =&gt; <span class="r19 r">a</span>.<span class="i">Active</span> &amp;&amp; <span class="r19 r">a</span>.<span class="i">Id</span> == <span class="r11 r">rescheduleTaskId</span>).<span class="i">Include</span>(<span id="r20 rd" class="r20 r">a</span> =&gt; <span class="r20 r">a</span>.<span class="i">User</span>).<span class="i">ThenInclude</span>(<span id="r21 rd" class="r21 r">a</span> =&gt; <span class="r21 r">a</span>.<span class="i">Role</span>).<span class="i">ToList</span>();
                <span class="t t">JobKey</span> <span id="r22 rd" class="r22 r">remoteScheduledTask</span> = <b>new</b> <span class="t constructor">JobKey</span>(<span class="r11 r">rescheduleTaskId</span>.<a href="@1@System.Runtime/A.html#d83d2db767b43db7" class="i method">ToString</a>(), <span class="s">&quot;AutoScheduler&quot;</span>); <b>await</b> <span class="r13 r">scheduler</span>.<span class="i method">DeleteJob</span>(<span class="r22 r">remoteScheduledTask</span>);
            }
            <b>if</b> (<span class="r14 r">data</span> != <b>null</b> &amp;&amp; !<span class="r12 r">deleteOnly</span>) {
                <span class="r14 r">data</span>.<span class="i method">ForEach</span>(<b>async</b> <span id="r23 rd" class="r23 r">scheduledTask</span> =&gt; {
 
                    <span class="t t">JobDataMap</span> <span id="r24 rd" class="r24 r">data</span> = <b>new</b>() { { <span class="s">&quot;id&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Id</span> }, { <span class="s">&quot;name&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Name</span> }, { <span class="s">&quot;type&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">InheritedGroupName</span> },{ <span class="s">&quot;email&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Email</span> }, { <span class="s">&quot;data&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Data</span> },
                        { <span class="s">&quot;runonetime&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">StartNowOnly</span> },{ <span class="s">&quot;startat&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">StartAt</span> },{ <span class="s">&quot;finishat&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">FinishAt</span> },{ <span class="s">&quot;interval&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Interval</span> },{ <span class="s">&quot;intervaltype&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">InheritedIntervalType</span> },
                        { <span class="s">&quot;sequence&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span> },{ <span class="s">&quot;userrole&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">User</span>.<span class="i">Role</span>.<span class="i">SystemName</span> },{ <span class="s">&quot;username&quot;</span>, <span class="r23 r">scheduledTask</span>.<span class="i">User</span>.<span class="i">Name</span> + <span class="s">&quot; &quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">User</span>.<span class="i">SurName</span> } };
 
                    <span class="t t">IJobDetail</span> <span id="r25 rd" class="r25 r">job</span> = <span class="t t">JobBuilder</span>.<span class="i method">Create</span>&lt;<a href="#ca20cd14d2de9539" class="t t">AutoScheduledJob</a>&gt;().<span class="i">WithIdentity</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Id</span>.<span class="i">ToString</span>(), <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">UsingJobData</span>(<span class="r24 r">data</span>).<span class="i method">StoreDurably</span>(<b>true</b>).<span class="i method">RequestRecovery</span>().<span class="i method">Build</span>();
 
                    <span class="t t">ITrigger</span> <span id="r26 rd" class="r26 r">trigger</span> = <b>null</b>;
                    <b>if</b> (<span class="r23 r">scheduledTask</span>.<span class="i">StartNowOnly</span>) {
                        <span class="r26 r">trigger</span> = <span class="t t">TriggerBuilder</span>.<span class="i method">Create</span>().<span class="i method">ForJob</span>(<span class="r25 r">job</span>).<span class="i">WithIdentity</span>(<span class="s">&quot;TR_&quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">Name</span>, <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">WithSimpleSchedule</span>(<span id="r27 rd" class="r27 r">x</span> =&gt; <span class="r27 r">x</span>.<span class="i method">WithIntervalInSeconds</span>(10).<span class="i method">WithRepeatCount</span>(0)).<span class="i method">StartNow</span>().<span class="i">WithPriority</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span>).<span class="i method">Build</span>();
                    }
                    <b>else</b> {
                        <b>if</b> (<span class="r23 r">scheduledTask</span>.<span class="i">InheritedIntervalType</span> == <span class="s">&quot;second&quot;</span>) {
                            <span class="r26 r">trigger</span> = <span class="t t">TriggerBuilder</span>.<span class="i method">Create</span>().<span class="i method">ForJob</span>(<span class="r25 r">job</span>).<span class="i">WithIdentity</span>(<span class="s">&quot;TR_&quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">Name</span>, <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">WithSimpleSchedule</span>(<span id="r28 rd" class="r28 r">x</span> =&gt; <span class="r28 r">x</span>.<span class="i">WithIntervalInSeconds</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Interval</span>).<span class="i method">RepeatForever</span>()).<span class="i">StartAt</span>(<span class="r23 r">scheduledTask</span>.<span class="i">StartAt</span>.<span class="i">Value</span>).<span class="i">WithPriority</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span>).<span class="i method">Build</span>();
                        }
                        <b>else</b> <b>if</b> (<span class="r23 r">scheduledTask</span>.<span class="i">InheritedIntervalType</span> == <span class="s">&quot;minute&quot;</span>) {
                            <span class="r26 r">trigger</span> = <span class="t t">TriggerBuilder</span>.<span class="i method">Create</span>().<span class="i method">ForJob</span>(<span class="r25 r">job</span>).<span class="i">WithIdentity</span>(<span class="s">&quot;TR_&quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">Name</span>, <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">WithSimpleSchedule</span>(<span id="r29 rd" class="r29 r">x</span> =&gt; <span class="r29 r">x</span>.<span class="i">WithIntervalInMinutes</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Interval</span>).<span class="i method">RepeatForever</span>()).<span class="i">StartAt</span>(<span class="r23 r">scheduledTask</span>.<span class="i">StartAt</span>.<span class="i">Value</span>).<span class="i">WithPriority</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span>).<span class="i method">Build</span>();
                        }
                        <b>else</b> <b>if</b> (<span class="r23 r">scheduledTask</span>.<span class="i">InheritedIntervalType</span> == <span class="s">&quot;hour&quot;</span>) {
                            <span class="r26 r">trigger</span> = <span class="t t">TriggerBuilder</span>.<span class="i method">Create</span>().<span class="i method">ForJob</span>(<span class="r25 r">job</span>).<span class="i">WithIdentity</span>(<span class="s">&quot;TR_&quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">Name</span>, <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">WithSimpleSchedule</span>(<span id="r30 rd" class="r30 r">x</span> =&gt; <span class="r30 r">x</span>.<span class="i">WithIntervalInHours</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Interval</span>).<span class="i method">RepeatForever</span>()).<span class="i">StartAt</span>(<span class="r23 r">scheduledTask</span>.<span class="i">StartAt</span>.<span class="i">Value</span>).<span class="i">WithPriority</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span>).<span class="i method">Build</span>();
                        }
                        <b>else</b> <b>if</b> (<span class="r23 r">scheduledTask</span>.<span class="i">InheritedIntervalType</span> == <span class="s">&quot;day&quot;</span>) {
                            <span class="r26 r">trigger</span> = <span class="t t">TriggerBuilder</span>.<span class="i method">Create</span>().<span class="i method">ForJob</span>(<span class="r25 r">job</span>).<span class="i">WithIdentity</span>(<span class="s">&quot;TR_&quot;</span> + <span class="r23 r">scheduledTask</span>.<span class="i">Name</span>, <span class="s">&quot;AutoScheduler&quot;</span>).<span class="i method">WithSimpleSchedule</span>(<span id="r31 rd" class="r31 r">x</span> =&gt; <span class="r31 r">x</span>.<span class="i">WithIntervalInHours</span>(24 * <span class="r23 r">scheduledTask</span>.<span class="i">Interval</span>).<span class="i method">RepeatForever</span>()).<span class="i">StartAt</span>(<span class="r23 r">scheduledTask</span>.<span class="i">StartAt</span>.<span class="i">Value</span>).<span class="i">WithPriority</span>(<span class="r23 r">scheduledTask</span>.<span class="i">Sequence</span>).<span class="i method">Build</span>();
                        }
                    }
 
                    <b>await</b> <span class="r13 r">scheduler</span>.<span class="i method">ScheduleJob</span>(<span class="r25 r">job</span>, <span class="r26 r">trigger</span>, <b>default</b>);
                });
            }
            <b>return</b> <b>true</b>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Autoscheduler Process Scheduled Task </span>
    <span class="c">///</span><span class="c"> definitions </span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
    <b>public class</b> <a id="ca20cd14d2de9539" href="../../R/ca20cd14d2de9539.html" target="n" data-glyph="0,0" class="t t"><span id="976996349d544b01">AutoScheduledJob</span></a> : <span class="t t">IJob</span> {
 
        <b>public</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="1d98164459c376a3" href="../../R/1d98164459c376a3.html" target="n" data-glyph="72,1" class="i method">Execute</a>(<span class="t t">IJobExecutionContext</span> <span id="r32 rd" class="r32 r">context</span>) {
            <span class="i">SolutionSchedulerProcessList</span> <span id="r33 rd" class="r33 r">taskResult</span> = <b>new</b> <span class="i">SolutionSchedulerProcessList</span>();
 
            <b>try</b> {
                <b>var</b> <span id="r34 rd" class="r34 r">jobData</span> = <span class="r32 r">context</span>.<span class="i property">JobDetail</span>.<span class="i property">JobDataMap</span>;
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r35 rd" class="r35 r">data</span> = (!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r34 r">jobData</span>?.<span class="i method">First</span>(<span id="r36 rd" class="r36 r">a</span> =&gt; <span class="r36 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;data&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>())) ? <span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r37 rd" class="r37 r">a</span> =&gt; <span class="r37 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;data&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>() : <b>null</b>;
                <b>if</b> (!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r35 r">data</span>)) {
 
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r38 rd" class="r38 r">jobType</span> = <span class="r34 r">jobData</span>?.<span class="i method">First</span>(<span id="r39 rd" class="r39 r">a</span> =&gt; <span class="r39 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;type&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()?.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                    <span class="r33 r">taskResult</span>.<span class="i">ScheduledTaskId</span> = <b>int</b>.<a href="@1@System.Runtime/A.html#a438016f815a35c3" class="i method">Parse</a>(<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r40 rd" class="r40 r">a</span> =&gt; <span class="r40 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;id&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                    <span class="r33 r">taskResult</span>.<span class="i">ProcessData</span> = <span class="i">JsonSerializer</span>.<span class="i">Serialize</span>(<span class="r34 r">jobData</span>); <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>false</b>;
                    <b>bool</b> <span id="r41 rd" class="r41 r">runOneTime</span> = <b>bool</b>.<a href="@1@System.Runtime/A.html#e2a8f2e50ecf93c0" class="i method">Parse</a>(<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r42 rd" class="r42 r">a</span> =&gt; <span class="r42 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;runonetime&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                    <a href="@1@System.Runtime/A.html#df6b1eba7461813b" class="t t">DateTime</a>? <span id="r43 rd" class="r43 r">finistAt</span> = <span class="r41 r">runOneTime</span> ? <b>null</b>: <a href="@1@System.Runtime/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@1@System.Runtime/A.html#7f7fa04f5481a0ac" class="i method">Parse</a>(<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r44 rd" class="r44 r">a</span> =&gt; <span class="r44 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;finishat&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
 
                    <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;email&quot;</span>) {
                        <b>try</b> {
                            <a href="@1@System.Runtime/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r45 rd" class="r45 r">maildata</span> = <span class="i">JsonSerializer</span>.<span class="i">Deserialize</span>&lt;<a href="@1@System.Runtime/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt;(<span class="r35 r">data</span>);
                            <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() {
                                <a href="../Classes/ServerCoreClassesDefinitions.cs.html#7c37b3d55e8af25c" class="i property">Sender</a> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#1a5f3bed7121e15a" class="i property">ConfigManagerEmailAddress</a>,
                                <a href="../Classes/ServerCoreClassesDefinitions.cs.html#a391f784cb56ad6c" class="i property">Recipients</a> = <span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r46 rd" class="r46 r">a</span> =&gt; <span class="r46 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;email&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()?.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;;&quot;</span>).<span class="i method">ToList</span>(),
                                <a href="../Classes/ServerCoreClassesDefinitions.cs.html#8f744c8d64616564" class="i property">Subject</a> = <span class="r45 r">maildata</span>?.<span class="i method">First</span>(<span id="r47 rd" class="r47 r">a</span> =&gt; <span class="r47 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;subject&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#efa5e6c14683e022" class="i method">ToString</a>(),
                                <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <span class="r45 r">maildata</span>?.<span class="i method">First</span>(<span id="r48 rd" class="r48 r">a</span> =&gt; <span class="r48 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;content&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#efa5e6c14683e022" class="i method">ToString</a>()
                            },<b>true</b>);
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r49 rd" class="r49 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r49 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r49 r">ex</span>) }); }
                    }
                    <b>else</b> <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;sqlemail&quot;</span>) {
                        <b>try</b> {
                            <b>if</b> (<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r50 rd" class="r50 r">a</span> =&gt; <span class="r50 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;userrole&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>() == <span class="s">&quot;admin&quot;</span>) {
                                <a href="@1@System.Runtime/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r51 rd" class="r51 r">sqlmaildata</span> = <span class="i">JsonSerializer</span>.<span class="i">Deserialize</span>&lt;<a href="@1@System.Runtime/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt;(<span class="r35 r">data</span>);
                                <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() {
                                    <a href="../Classes/ServerCoreClassesDefinitions.cs.html#7c37b3d55e8af25c" class="i property">Sender</a> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#1a5f3bed7121e15a" class="i property">ConfigManagerEmailAddress</a>,
                                    <a href="../Classes/ServerCoreClassesDefinitions.cs.html#a391f784cb56ad6c" class="i property">Recipients</a> = <span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r52 rd" class="r52 r">a</span> =&gt; <span class="r52 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;email&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()?.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;;&quot;</span>).<span class="i method">ToList</span>(),
                                    <a href="../Classes/ServerCoreClassesDefinitions.cs.html#8f744c8d64616564" class="i property">Subject</a> = <span class="r51 r">sqlmaildata</span>?.<span class="i method">First</span>(<span id="r53 rd" class="r53 r">a</span> =&gt; <span class="r53 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;subject&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#efa5e6c14683e022" class="i method">ToString</a>(),
                                    <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <span class="r51 r">sqlmaildata</span>?.<span class="i method">First</span>(<span id="r54 rd" class="r54 r">a</span> =&gt; <span class="r54 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;content&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@1@System.Runtime/A.html#efa5e6c14683e022" class="i method">ToString</a>()
                                }, <b>true</b>);
                            }
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r55 rd" class="r55 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r55 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r55 r">ex</span>) }); }
 
                    }
                    <b>else</b> <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;command&quot;</span>) {
                        <b>try</b> {
                            <b>if</b> (<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r56 rd" class="r56 r">a</span> =&gt; <span class="r56 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;userrole&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>() == <span class="s">&quot;admin&quot;</span>) {
                                <a href="../Classes/ServerCoreClassesDefinitions.cs.html#77b0afbc7a35cb8f" class="t t">ProcessClass</a>? <span id="r57 rd" class="r57 r">process</span> = <b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#77b0afbc7a35cb8f" class="t constructor">ProcessClass</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#04ea8e400cb3a00a" class="i property">Command</a> = <span class="i n">System</span>.<span class="i n">IO</span>.<a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#1274738792cce835" class="i method">GetFullPath</a>(<span class="r35 r">data</span>), <a href="../Classes/ServerCoreClassesDefinitions.cs.html#f7ee48cc77ee85a1" class="i property">Arguments</a> = <span class="s">&quot;&quot;</span>, <a href="../Classes/ServerCoreClassesDefinitions.cs.html#6e7a0a60801d61b2" class="i property">WorkingDirectory</a> = <span class="i n">System</span>.<span class="i n">IO</span>.<a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#1274738792cce835" class="i method">GetFullPath</a>(<span class="r35 r">data</span>.<a href="@1@System.Runtime/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="i n">System</span>.<span class="i n">IO</span>.<a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#95facc58d06cadd0" class="i method">GetFileName</a>(<span class="r35 r">data</span>), <span class="s">&quot;&quot;</span>)) };
                                <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#3296d6d1f949dc8b" class="i method">RunSystemProcess</a>(<span class="r57 r">process</span>);
                            }
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r58 rd" class="r58 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r58 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r58 r">ex</span>) }); }
 
                    }
                    <b>else</b> <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;sqlquery&quot;</span>) {
                        <b>try</b> {
                            <b>if</b> (<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r59 rd" class="r59 r">a</span> =&gt; <span class="r59 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;userrole&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>() == <span class="s">&quot;admin&quot;</span>) {
                                <b>_</b> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">EasyITCenterCollectionFromSql</span>&lt;<span class="i">CustomString</span>&gt;(<span class="s">$&quot;</span><span class="s">EXEC </span>{<span class="r35 r">data</span>}<span class="s">;</span><span class="s">&quot;</span>);
                            }
 
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r60 rd" class="r60 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r60 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r60 r">ex</span>) }); }
 
                    }
                    <b>else</b> <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;websocketnotify&quot;</span>) {
                        <b>try</b> {
                            <a href="../WebSocketManager.cs.html#abc9b696d8dfe043" class="t t">ServerCoreWebHelpers</a>.<a href="../WebSocketManager.cs.html#71f01787c52f4e9b" class="i method">SendMessageAndUpdateWebSocketsInSpecificPath</a>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#c23b6c5dd5ef94a1" class="i property">WebSocketGlobalNotifyPath</a>, <span class="r35 r">data</span>);
 
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r61 rd" class="r61 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r61 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r61 r">ex</span>) }); }
                    }
                    <b>else</b> <b>if</b> (<span class="r38 r">jobType</span> == <span class="s">&quot;sqlwebsocketnotify&quot;</span>) {
                        <b>try</b> {
                            <b>if</b> (<span class="r34 r">jobData</span>.<span class="i method">First</span>(<span id="r62 rd" class="r62 r">a</span> =&gt; <span class="r62 r">a</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;userrole&quot;</span>).<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>?.<a href="@1@System.Runtime/A.html#ff31a6bf27c58f89" class="i method">ToString</a>() == <span class="s">&quot;admin&quot;</span>) {
                                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r63 rd" class="r63 r">result</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">EasyITCenterCollectionFromSql</span>&lt;<span class="i">CustomString</span>&gt;(<span class="s">$&quot;</span><span class="s">EXEC </span>{<span class="r35 r">data</span>}<span class="s">;</span><span class="s">&quot;</span>).<span class="i">ToString</span>();
                                <a href="../WebSocketManager.cs.html#abc9b696d8dfe043" class="t t">ServerCoreWebHelpers</a>.<a href="../WebSocketManager.cs.html#71f01787c52f4e9b" class="i method">SendMessageAndUpdateWebSocketsInSpecificPath</a>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#c23b6c5dd5ef94a1" class="i property">WebSocketGlobalNotifyPath</a>, <span class="r63 r">result</span>);
                            }
 
                        } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r64 rd" class="r64 r">ex</span>) { <span class="r33 r">taskResult</span>.<span class="i">ProcessCrashed</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">ProcessLog</span> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r64 r">ex</span>); <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r64 r">ex</span>) }); }
                    } <b>else</b> {  <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <span class="s">&quot;ThisScheduledTaskNotImplemented &quot;</span> + <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#fa961ce440526a4d" class="i method">Join</a>(<span class="s">&quot;,&quot;</span>,<span class="r34 r">jobData</span>.<span class="i method">KeySet</span>()) }); }
 
                    <span class="c">//Log Process Result</span>
                    <span class="r33 r">taskResult</span>.<span class="i">ProcessCompleted</span> = <b>true</b>; <span class="r33 r">taskResult</span>.<span class="i">TimeStamp</span> = <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@System.Runtime/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@1@System.Runtime/A.html#3b9d9c959702c67b" class="i property">DateTime</a>;
                    <span class="i">EntityEntry</span>&lt;<span class="i">SolutionSchedulerProcessList</span>&gt;? <span id="r65 rd" class="r65 r">dbdata</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionSchedulerProcessLists</span>.<span class="i">Add</span>(<span class="r33 r">taskResult</span>); <span class="r65 r">dbdata</span>.<span class="i">Context</span>.<span class="i">SaveChanges</span>();
 
                    <span class="c">//Deactivate Task in Database</span>
                    <b>if</b> (<span class="r41 r">runOneTime</span> || (<span class="r43 r">finistAt</span> != <b>null</b> &amp;&amp; <span class="r43 r">finistAt</span> &lt; <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@System.Runtime/A.html#c6573f48ac6bd630" class="i property">Now</a>)) {
                        <b>var</b> <span id="r66 rd" class="r66 r">recUpdate</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionSchedulerLists</span>.<span class="i">Where</span>(<span id="r67 rd" class="r67 r">a</span> =&gt; <span class="r67 r">a</span>.<span class="i">Id</span> == <span class="r33 r">taskResult</span>.<span class="i">ScheduledTaskId</span>).<span class="i">FirstOrDefault</span>();
                        <b>if</b> (<span class="r66 r">recUpdate</span> != <b>null</b>) { <span class="r66 r">recUpdate</span>.<span class="i">Active</span> = <b>false</b>; <b>var</b> <span id="r68 rd" class="r68 r">dbChange</span> = <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionSchedulerLists</span>.<span class="i">Update</span>(<span class="r66 r">recUpdate</span>); <span class="r68 r">dbChange</span>.<span class="i">Context</span>.<span class="i">SaveChanges</span>(); }

                        <span class="t t">IScheduler</span>? <span id="r69 rd" class="r69 r">scheduler</span> = <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#afcba8f6bf064d76" class="i field">ServerAutoSchedulerProvider</a>;
                        <span class="t t">JobKey</span> <span id="r70 rd" class="r70 r">remoteScheduledTask</span> = <b>new</b> <span class="t">JobKey</span>(<span class="r33 r">taskResult</span>.<span class="i">ScheduledTaskId</span>.<span class="i">ToString</span>(), <span class="s">&quot;AutoScheduler&quot;</span>); <span class="r69 r">scheduler</span>.<span class="i method">DeleteJob</span>(<span class="r70 r">remoteScheduledTask</span>).<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>();
                    }
 
                }
                <b>else</b> {<b>return</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@System.Runtime/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<span class="s">&quot;DataNotFound&quot;</span>); }
            } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r71 rd" class="r71 r">Ex</span>) {
                <a href="../Operations/CoreOperations.cs.html#a55b94e701f24326" class="t t">CoreOperations</a>.<a href="../Operations/CoreOperations.cs.html#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <a href="../Operations/DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="../Operations/DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r71 r">Ex</span>) });
                <b>return</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@System.Runtime/A.html#55fe1e3de0db4621" class="i method">FromException</a>(<span class="r71 r">Ex</span>);
            }
            <b>return</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@System.Runtime/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<b>true</b>);
        }
    }
    
}</pre></td></tr></table></div></body></html>
