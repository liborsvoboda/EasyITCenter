<!DOCTYPE html>
<html><head><title>WindowSettings.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(143);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#MahApps.Metro/Controls/WindowSettings.cs" target="_top">Controls\WindowSettings.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#MahApps.Metro" target="_top">HelpProjects\WPF-MAIN\MahApps.Metro\src\MahApps.Metro\MahApps.Metro.csproj</a> (MahApps.Metro)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Licensed to the .NET Foundation under one or more agreements.</span>
<span class="c">// The .NET Foundation licenses this file to you under the MIT license.</span>
<span class="c">// See the LICENSE file in the project root for more information.</span>

<b>using</b> <span class="i n">System</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">Win32</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">Win32</span>.<span class="i n">Foundation</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">Win32</span>.<span class="i n">UI</span>.<span class="i n">WindowsAndMessaging</span>;

<b>namespace</b> <span class="i n">MahApps</span>.<span class="i n">Metro</span>.<span class="i n">Controls</span>
{
    <b>public class</b> <a id="672a2a1bd6579cc1" href="../R/672a2a1bd6579cc1.html" target="n" data-glyph="0,0" class="t t"><span id="7b0733194f1262e4">WindowPlacementSetting</span></a>
    {
        <b>public uint</b> <a id="ef2b8703bd3b5b7a" href="../R/ef2b8703bd3b5b7a.html" target="n" data-glyph="42,1" class="i field">showCmd</a>;
        <b>public</b> <a href="@0@WindowsBase/A.html#9120327717fc513d" class="t t">Point</a> <a id="9933041c10b38b4a" href="../R/9933041c10b38b4a.html" target="n" data-glyph="42,1" class="i field">minPosition</a>;
        <b>public</b> <a href="@0@WindowsBase/A.html#9120327717fc513d" class="t t">Point</a> <a id="2625fc0447d9c6ed" href="../R/2625fc0447d9c6ed.html" target="n" data-glyph="42,1" class="i field">maxPosition</a>;
        <b>public</b> <a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="t t">Rect</a> <a id="4172e32a9d827d95" href="../R/4172e32a9d827d95.html" target="n" data-glyph="42,1" class="i field">normalPosition</a>;

        <b>internal</b> <span class="t">WINDOWPLACEMENT</span> <a id="f593f89d32407c96" href="../R/f593f89d32407c96.html" target="n" data-glyph="74,1" class="i method">ToWINDOWPLACEMENT</a>()
        {
            <b>return</b> <b>new</b> <span class="t">WINDOWPLACEMENT</span>
                   {
                       <span class="i">length</span> = (<b>uint</b>)<a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#9fef1d6bb6a505fe" class="i method">SizeOf</a>&lt;<span class="t">WINDOWPLACEMENT</span>&gt;(),
                       <span class="i">showCmd</span> = (<span class="t">SHOW_WINDOW_CMD</span>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#ef2b8703bd3b5b7a" class="i field">showCmd</a>,
                       <span class="i">ptMinPosition</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Drawing</span>.<a href="@0@System.Drawing/A.html#a041be61667d4c9a" class="t constructor">Point</a> { <a href="@0@System.Drawing/A.html#3e7433d837e96641" class="i property">X</a> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#9933041c10b38b4a" class="i field">minPosition</a>.<a href="@0@WindowsBase/A.html#556ea90344bfb3ea" class="i property">X</a>, <a href="@0@System.Drawing/A.html#a6e7daad97b017e5" class="i property">Y</a> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#9933041c10b38b4a" class="i field">minPosition</a>.<a href="@0@WindowsBase/A.html#0a42b94edb8c27ab" class="i property">Y</a> },
                       <span class="i">ptMaxPosition</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Drawing</span>.<a href="@0@System.Drawing/A.html#a041be61667d4c9a" class="t constructor">Point</a> { <a href="@0@System.Drawing/A.html#3e7433d837e96641" class="i property">X</a> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#2625fc0447d9c6ed" class="i field">maxPosition</a>.<a href="@0@WindowsBase/A.html#556ea90344bfb3ea" class="i property">X</a>, <a href="@0@System.Drawing/A.html#a6e7daad97b017e5" class="i property">Y</a> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#2625fc0447d9c6ed" class="i field">maxPosition</a>.<a href="@0@WindowsBase/A.html#0a42b94edb8c27ab" class="i property">Y</a> },
                       <span class="i">rcNormalPosition</span> = <b>new</b> <span class="t">RECT</span> { <span class="i">left</span> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#4172e32a9d827d95" class="i field">normalPosition</a>.<a href="@0@WindowsBase/A.html#e41478f50084bb9f" class="i property">X</a>, <span class="i">top</span> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#4172e32a9d827d95" class="i field">normalPosition</a>.<a href="@0@WindowsBase/A.html#7e3e32042d014946" class="i property">Y</a>, <span class="i">right</span> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#4172e32a9d827d95" class="i field">normalPosition</a>.<a href="@0@WindowsBase/A.html#49bdda261fc8ff58" class="i property">Right</a>, <span class="i">bottom</span> = (<b>int</b>)<a href="#672a2a1bd6579cc1" class="k">this</a>.<a href="#4172e32a9d827d95" class="i field">normalPosition</a>.<a href="@0@WindowsBase/A.html#ff29c878cee62add" class="i property">Bottom</a> }
                   };
        }

        <b>internal static</b> <a href="#672a2a1bd6579cc1" class="t t">WindowPlacementSetting</a> <a id="e92eb31d5e66edce" href="../R/e92eb31d5e66edce.html" target="n" data-glyph="74,1" class="i method">FromWINDOWPLACEMENT</a>(<a href="@0@PresentationFramework/A.html#e438dc91640a8d15" class="t t">Window</a> <span id="r0 rd" class="r0 r">window</span>, <span class="t">WINDOWPLACEMENT</span> <span id="r1 rd" class="r1 r">placement</span>)
        {
            <span class="c">// Get the current DPI scale factor</span>
            <a href="@0@PresentationCore/A.html#92012d9b324abb89" class="k">var</a> <span id="r2 rd" class="r2 r">dpiScale</span> = <a href="@0@PresentationCore/A.html#7f1e2538afba01e7" class="t t">VisualTreeHelper</a>.<a href="@0@PresentationCore/A.html#6018c348adaeec6c" class="i method">GetDpi</a>(<span class="r0 r">window</span>);

            <span class="c">// Adjust the size of the window for DPI scaling</span>
            <b>var</b> <span id="r3 rd" class="r3 r">adjustedWidth</span> = <span class="r1 r">placement</span>.<span class="i">rcNormalPosition</span>.<span class="i">GetWidth</span>() / <span class="r2 r">dpiScale</span>.<a href="@0@PresentationCore/A.html#f3cd63d4e555893c" class="i property">DpiScaleX</a>;
            <b>var</b> <span id="r4 rd" class="r4 r">adjustedHeight</span> = <span class="r1 r">placement</span>.<span class="i">rcNormalPosition</span>.<span class="i">GetHeight</span>() / <span class="r2 r">dpiScale</span>.<a href="@0@PresentationCore/A.html#428c12308d8c6daa" class="i property">DpiScaleY</a>;

            <b>return</b> <b>new</b> <a href="#672a2a1bd6579cc1" class="t constructor">WindowPlacementSetting</a>
                   {
                       <a href="#ef2b8703bd3b5b7a" class="i field">showCmd</a> = (<b>uint</b>)<span class="r1 r">placement</span>.<span class="i">showCmd</span>,
                       <a href="#9933041c10b38b4a" class="i field">minPosition</a> = <b>new</b> <span class="t">Point</span>(<span class="r1 r">placement</span>.<span class="i">ptMinPosition</span>.<span class="i">X</span>, <span class="r1 r">placement</span>.<span class="i">ptMinPosition</span>.<span class="i">Y</span>),
                       <a href="#2625fc0447d9c6ed" class="i field">maxPosition</a> = <b>new</b> <span class="t">Point</span>(<span class="r1 r">placement</span>.<span class="i">ptMaxPosition</span>.<span class="i">X</span>, <span class="r1 r">placement</span>.<span class="i">ptMaxPosition</span>.<span class="i">Y</span>),
                       <a href="#4172e32a9d827d95" class="i field">normalPosition</a> = <b>new</b> <span class="t">Rect</span>(<span class="r1 r">placement</span>.<span class="i">rcNormalPosition</span>.<span class="i">left</span>, <span class="r1 r">placement</span>.<span class="i">rcNormalPosition</span>.<span class="i">top</span>, <span class="r3 r">adjustedWidth</span>, <span class="r4 r">adjustedHeight</span>),
                   };
        }
    }

    <b>public interface</b> <a id="94741d1ddf18ef08" href="../R/94741d1ddf18ef08.html" target="n" data-glyph="48,0" class="t t">IWindowPlacementSettings</a>
    {
        <a href="#672a2a1bd6579cc1" class="t t">WindowPlacementSetting</a>? <a id="e2c938f972ab3ba1" href="../R/e2c938f972ab3ba1.html" target="n" data-glyph="102,1" class="i property">Placement</a> { <b>get</b>; <b>set</b>; }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Refreshes the application settings property values from persistent storage.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="49bcf8f59373bad4" href="../R/49bcf8f59373bad4.html" target="n" data-glyph="72,1" class="i method">Reload</a>();

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Upgrades the application settings on loading.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>bool</b> <a id="4d22994981d7596f" href="../R/4d22994981d7596f.html" target="n" data-glyph="102,1" class="i property">UpgradeSettings</a> { <b>get</b>; <b>set</b>; }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Updates application settings to reflect a more recent installation of the application.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="4cc9c1b8a1fe8853" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Upgrade</a>();

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stores the current values of the settings properties.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="69fc00df5dff9670" href="../R/69fc00df5dff9670.html" target="n" data-glyph="72,1" class="i method">Save</a>();

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calls Reset on the providers.</span>
        <span class="c">///</span><span class="c"> Providers must implement IApplicationSettingsProvider to support this.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="d5529d70de6b8ff4" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Reset</a>();
    }

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> this settings class is the default way to save the placement of the window</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="21b6966aeac78e73" href="../R/21b6966aeac78e73.html" target="n" data-glyph="2,0" class="t t">WindowApplicationSettings</a> : <a href="@0@System/A.html#917106d7cb225f9c" class="t t">ApplicationSettingsBase</a>, <a href="#94741d1ddf18ef08" class="t t">IWindowPlacementSettings</a>
    {
        <b>public</b> <a id="e6efac1e020fae9e" href="../R/e6efac1e020fae9e.html" target="n" data-glyph="72,1" class="t constructor">WindowApplicationSettings</a>(<a href="@0@PresentationFramework/A.html#e438dc91640a8d15" class="t t">Window</a> <span id="r5 rd" class="r5 r">window</span>)
            : <a href="@0@System/A.html#1c38f64a9be795d6" class="k">base</a>(<span class="r5 r">window</span>.<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>().<a href="@0@mscorlib/A.html#976443bb39dc37cd" class="i property">FullName</a>)
        {
        }

        [<a href="@0@System/A.html#2cf0d4f430300175" class="t constructor">UserScopedSetting</a>]
        <b>public</b> <a href="#672a2a1bd6579cc1" class="t t">WindowPlacementSetting</a>? <a id="09cd612a23db2c66" href="../R/09cd612a23db2c66.html" target="n" data-glyph="102,1" class="i property">Placement</a>
        {
            <b>get</b>
            {
                <b>try</b>
                {
                    <b>return</b> <a href="#21b6966aeac78e73" class="k">this</a><a href="@0@System/A.html#9df8c3cb5a1b437a">[</a><b>nameof</b>(<a href="#09cd612a23db2c66" class="i property">Placement</a>)] <b>as</b> <a href="#672a2a1bd6579cc1" class="t t">WindowPlacementSetting</a>;
                }
                <b>catch</b> (<a href="@0@System.Configuration/A.html#e66c32f670e40381" class="t t">ConfigurationErrorsException</a>? <span id="r6 rd" class="r6 r">ex</span>)
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r7 rd" class="r7 r">filename</span> = <b>null</b>;
                    <b>while</b> (<span class="r6 r">ex</span> != <b>null</b> &amp;&amp; (<span class="r7 r">filename</span> = <span class="r6 r">ex</span>.<a href="@0@System.Configuration/A.html#b03a1bff408d82fd" class="i property">Filename</a>) == <b>null</b>)
                    {
                        <span class="r6 r">ex</span> = <span class="r6 r">ex</span>.<a href="@0@mscorlib/A.html#89c20b39fb04108b" class="i property">InnerException</a> <b>as</b> <a href="@0@System.Configuration/A.html#e66c32f670e40381" class="t t">ConfigurationErrorsException</a>;
                    }

                    <b>throw</b> <b>new</b> <a href="../MahAppsException.cs.html#02ed58fa90416e56" class="t constructor">MahAppsException</a>(<span class="s">$&quot;</span><span class="s">The settings file &#39;</span>{<span class="r7 r">filename</span> ?? <span class="s">&quot;&lt;unknown&gt;&quot;</span>}<span class="s">&#39; seems to be corrupted</span><span class="s">&quot;</span>, <span class="r6 r">ex</span>);
                }
            }
            <b>set</b> =&gt; <a href="#21b6966aeac78e73" class="k">this</a><a href="@0@System/A.html#9df8c3cb5a1b437a">[</a><b>nameof</b>(<a href="#09cd612a23db2c66" class="i property">Placement</a>)] = <b>value</b>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Upgrades the application settings on loading.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<a href="@0@System/A.html#2cf0d4f430300175" class="t constructor">UserScopedSetting</a>]
        <b>public bool</b> <a id="add0f6dfbfb5ae2f" href="../R/add0f6dfbfb5ae2f.html" target="n" data-glyph="102,1" class="i property">UpgradeSettings</a>
        {
            <b>get</b>
            {
                <b>try</b>
                {
                    <b>return</b> (<a href="#21b6966aeac78e73" class="k">this</a><a href="@0@System/A.html#9df8c3cb5a1b437a">[</a><b>nameof</b>(<a href="#add0f6dfbfb5ae2f" class="i property">UpgradeSettings</a>)] <b>as bool</b>?).<a href="@0@mscorlib/A.html#8c499091e3b47bc7" class="i method">GetValueOrDefault</a>(<b>true</b>);
                }
                <b>catch</b> (<a href="@0@System.Configuration/A.html#e66c32f670e40381" class="t t">ConfigurationErrorsException</a>? <span id="r8 rd" class="r8 r">ex</span>)
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r9 rd" class="r9 r">filename</span> = <b>null</b>;
                    <b>while</b> (<span class="r8 r">ex</span> != <b>null</b> &amp;&amp; (<span class="r9 r">filename</span> = <span class="r8 r">ex</span>.<a href="@0@System.Configuration/A.html#b03a1bff408d82fd" class="i property">Filename</a>) == <b>null</b>)
                    {
                        <span class="r8 r">ex</span> = <span class="r8 r">ex</span>.<a href="@0@mscorlib/A.html#89c20b39fb04108b" class="i property">InnerException</a> <b>as</b> <a href="@0@System.Configuration/A.html#e66c32f670e40381" class="t t">ConfigurationErrorsException</a>;
                    }

                    <b>throw</b> <b>new</b> <a href="../MahAppsException.cs.html#02ed58fa90416e56" class="t constructor">MahAppsException</a>(<span class="s">$&quot;</span><span class="s">The settings file &#39;</span>{<span class="r9 r">filename</span> ?? <span class="s">&quot;&lt;unknown&gt;&quot;</span>}<span class="s">&#39; seems to be corrupted</span><span class="s">&quot;</span>, <span class="r8 r">ex</span>);
                }
            }
            <b>set</b> =&gt; <a href="#21b6966aeac78e73" class="k">this</a><a href="@0@System/A.html#9df8c3cb5a1b437a">[</a><b>nameof</b>(<a href="#add0f6dfbfb5ae2f" class="i property">UpgradeSettings</a>)] = <b>value</b>;
        }
    }
}</pre></td></tr></table></div></body></html>
