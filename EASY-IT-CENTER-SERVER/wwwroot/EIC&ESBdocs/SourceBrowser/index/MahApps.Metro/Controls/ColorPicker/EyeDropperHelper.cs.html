<!DOCTYPE html>
<html><head><title>EyeDropperHelper.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(97);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#MahApps.Metro/Controls/ColorPicker/EyeDropperHelper.cs" target="_top">Controls\ColorPicker\EyeDropperHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#MahApps.Metro" target="_top">HelpProjects\WPF-MAIN\MahApps.Metro\src\MahApps.Metro\MahApps.Metro.csproj</a> (MahApps.Metro)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Licensed to the .NET Foundation under one or more agreements.</span>
<span class="c">// The .NET Foundation licenses this file to you under the MIT license.</span>
<span class="c">// See the LICENSE file in the project root for more information.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Interop</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>.<span class="i n">Imaging</span>;

<b>namespace</b> <span class="i n">MahApps</span>.<span class="i n">Metro</span>.<span class="i n">Controls</span>
{
    <b>internal static class</b> <a id="e99e9a9d1882485a" href="../../R/e99e9a9d1882485a.html" target="n" data-glyph="2,0" class="t t">EyeDropperHelper</a>
    {
        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern bool</b> <a id="109a2f87f9896132" href="../../R/109a2f87f9896132.html" target="n" data-glyph="76,1" class="i method">BitBlt</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r0 rd" class="r0 r">hdcDest</span>, <b>int</b> <span id="r1 rd" class="r1 r">nxDest</span>, <b>int</b> <span id="r2 rd" class="r2 r">nyDest</span>, <b>int</b> <span id="r3 rd" class="r3 r">nWidth</span>, <b>int</b> <span id="r4 rd" class="r4 r">nHeight</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r5 rd" class="r5 r">hdcSrc</span>, <b>int</b> <span id="r6 rd" class="r6 r">nXSrc</span>, <b>int</b> <span id="r7 rd" class="r7 r">nYSrc</span>, <b>int</b> <span id="r8 rd" class="r8 r">dwRop</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="1574dba82be9c08b" href="../../R/1574dba82be9c08b.html" target="n" data-glyph="76,1" class="i method">CreateCompatibleBitmap</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r9 rd" class="r9 r">hdc</span>, <b>int</b> <span id="r10 rd" class="r10 r">width</span>, <b>int</b> <span id="r11 rd" class="r11 r">nHeight</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="71fbb460acda7aae" href="../../R/71fbb460acda7aae.html" target="n" data-glyph="76,1" class="i method">CreateCompatibleDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r12 rd" class="r12 r">hdc</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="7e5bfb849fceb1c2" href="../../R/7e5bfb849fceb1c2.html" target="n" data-glyph="76,1" class="i method">DeleteDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r13 rd" class="r13 r">hdc</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="c6ed6ed6a62782b5" href="../../R/c6ed6ed6a62782b5.html" target="n" data-glyph="76,1" class="i method">DeleteObject</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r14 rd" class="r14 r">hObject</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="73c46e5aa9515932" href="../../R/73c46e5aa9515932.html" target="n" data-glyph="76,1" class="i method">GetDesktopWindow</a>();

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="84b9e409d9c87941" href="../../R/84b9e409d9c87941.html" target="n" data-glyph="76,1" class="i method">GetWindowDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r15 rd" class="r15 r">hWnd</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>private static extern bool</b> <a id="f67d86955c433757" href="../../R/f67d86955c433757.html" target="n" data-glyph="76,1" class="i method">ReleaseDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r16 rd" class="r16 r">hWnd</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r17 rd" class="r17 r">hDc</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="9660e9b9e97bf8fd" href="../../R/9660e9b9e97bf8fd.html" target="n" data-glyph="76,1" class="i method">GetDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r18 rd" class="r18 r">hwnd</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern uint</b> <a id="d98672df22720e05" href="../../R/d98672df22720e05.html" target="n" data-glyph="76,1" class="i method">GetPixel</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r19 rd" class="r19 r">hdc</span>, <b>int</b> <span id="r20 rd" class="r20 r">nXPos</span>, <b>int</b> <span id="r21 rd" class="r21 r">nYPos</span>);

        [<a href="@0@mscorlib/A.html#19ddb78edbb90890" class="t constructor">DllImport</a>(<span class="s">&quot;gdi32.dll&quot;</span>)]
        <b>private static extern</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="d669192ec2a28c7a" href="../../R/d669192ec2a28c7a.html" target="n" data-glyph="76,1" class="i method">SelectObject</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r22 rd" class="r22 r">hdc</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r23 rd" class="r23 r">hObject</span>);

        <b>private const int</b> <a id="70d1304cb8b7190b" href="../../R/70d1304cb8b7190b.html" target="n" data-glyph="10,1" class="i field">SRCCOPY</a> = 0x00CC0020;
        <b>private const int</b> <a id="ca5fd761c033f51f" href="../../R/ca5fd761c033f51f.html" target="n" data-glyph="10,1" class="i field">CAPTUREBLT</a> = 0x40000000;

        <b>public static</b> <a href="@0@PresentationCore/A.html#0423ed363f952960" class="t t">BitmapSource</a> <a id="cdcce2c7bad436f6" href="../../R/cdcce2c7bad436f6.html" target="n" data-glyph="72,1" class="i method">CaptureRegion</a>(<a href="@0@WindowsBase/A.html#d0ea1899725188a8" class="t t">Int32Rect</a> <span id="r24 rd" class="r24 r">region</span>)
        {
            <a href="@0@PresentationCore/A.html#0423ed363f952960" class="t t">BitmapSource</a> <span id="r25 rd" class="r25 r">result</span>;

            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r26 rd" class="r26 r">desktophWnd</span> = <a href="#73c46e5aa9515932" class="i method">GetDesktopWindow</a>();
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r27 rd" class="r27 r">desktopDc</span> = <a href="#84b9e409d9c87941" class="i method">GetWindowDC</a>(<span class="r26 r">desktophWnd</span>);
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r28 rd" class="r28 r">memoryDc</span> = <a href="#71fbb460acda7aae" class="i method">CreateCompatibleDC</a>(<span class="r27 r">desktopDc</span>);
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r29 rd" class="r29 r">bitmap</span> = <a href="#1574dba82be9c08b" class="i method">CreateCompatibleBitmap</a>(<span class="r27 r">desktopDc</span>, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#49f6834cb4b9f0e6" class="i property">Width</a>, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#c030b4ffcea65de2" class="i property">Height</a>);
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r30 rd" class="r30 r">oldBitmap</span> = <a href="#d669192ec2a28c7a" class="i method">SelectObject</a>(<span class="r28 r">memoryDc</span>, <span class="r29 r">bitmap</span>);

            <b>bool</b> <span id="r31 rd" class="r31 r">success</span> = <a href="#109a2f87f9896132" class="i method">BitBlt</a>(<span class="r28 r">memoryDc</span>, 0, 0, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#49f6834cb4b9f0e6" class="i property">Width</a>, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#c030b4ffcea65de2" class="i property">Height</a>, <span class="r27 r">desktopDc</span>, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#62dde93e7e9bac27" class="i property">X</a>, <span class="r24 r">region</span>.<a href="@0@WindowsBase/A.html#5ae2151f6ae32f6a" class="i property">Y</a>, <a href="#70d1304cb8b7190b" class="i field">SRCCOPY</a> | <a href="#ca5fd761c033f51f" class="i field">CAPTUREBLT</a>);

            <b>try</b>
            {
                <b>if</b> (!<span class="r31 r">success</span>)
                {
                    <b>throw</b> <b>new</b> <a href="@0@System/A.html#4d6d1547b547bda5" class="t constructor">Win32Exception</a>();
                }

                <span class="r25 r">result</span> = <a href="@0@PresentationCore/A.html#a4a547a182b26a50" class="t t">Imaging</a>.<a href="@0@PresentationCore/A.html#086634f6048b5cd6" class="i method">CreateBitmapSourceFromHBitmap</a>(<span class="r29 r">bitmap</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <a href="@0@WindowsBase/A.html#d0ea1899725188a8" class="t t">Int32Rect</a>.<a href="@0@WindowsBase/A.html#f4c8df3be3ec7600" class="i property">Empty</a>, <a href="@0@PresentationCore/A.html#d41011d40e6d5fa0" class="t t">BitmapSizeOptions</a>.<a href="@0@PresentationCore/A.html#d23b737280718834" class="i method">FromEmptyOptions</a>());
            }
            <b>finally</b>
            {
                <a href="#d669192ec2a28c7a" class="i method">SelectObject</a>(<span class="r28 r">memoryDc</span>, <span class="r30 r">oldBitmap</span>);
                <a href="#c6ed6ed6a62782b5" class="i method">DeleteObject</a>(<span class="r29 r">bitmap</span>);
                <a href="#7e5bfb849fceb1c2" class="i method">DeleteDC</a>(<span class="r28 r">memoryDc</span>);
                <a href="#f67d86955c433757" class="i method">ReleaseDC</a>(<span class="r26 r">desktophWnd</span>, <span class="r27 r">desktopDc</span>);
            }

            <span class="r25 r">result</span>.<a href="@0@WindowsBase/A.html#75947ff41474f34b" class="i method">Freeze</a>();
            <b>return</b> <span class="r25 r">result</span>;
        }

        <b>public static</b> <a href="@0@PresentationCore/A.html#9c469acbf7b2cb81" class="t t">Color</a> <a id="73c8739698c0c469" href="../../R/73c8739698c0c469.html" target="n" data-glyph="72,1" class="i method">GetPixelColor</a>(<a href="@0@WindowsBase/A.html#9120327717fc513d" class="t t">Point</a> <span id="r32 rd" class="r32 r">point</span>)
        {
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r33 rd" class="r33 r">hdc</span> = <a href="#9660e9b9e97bf8fd" class="i method">GetDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>);
            <b>uint</b> <span id="r34 rd" class="r34 r">pixel</span> = <a href="#d98672df22720e05" class="i method">GetPixel</a>(<span class="r33 r">hdc</span>, (<b>int</b>)<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#cd022f3da68060cf" class="i method">Round</a>(<span class="r32 r">point</span>.<a href="@0@WindowsBase/A.html#556ea90344bfb3ea" class="i property">X</a>), (<b>int</b>)<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#cd022f3da68060cf" class="i method">Round</a>(<span class="r32 r">point</span>.<a href="@0@WindowsBase/A.html#0a42b94edb8c27ab" class="i property">Y</a>));
            <a href="#f67d86955c433757" class="i method">ReleaseDC</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <span class="r33 r">hdc</span>);
            <a href="@0@PresentationCore/A.html#9c469acbf7b2cb81" class="t t">Color</a> <span id="r35 rd" class="r35 r">color</span> = <a href="@0@PresentationCore/A.html#9c469acbf7b2cb81" class="t t">Color</a>.<a href="@0@PresentationCore/A.html#c0c2e7d2eff59dd2" class="i method">FromRgb</a>((<b>byte</b>)(<span class="r34 r">pixel</span> &amp; 0x000000FF),
                                        (<b>byte</b>)((<span class="r34 r">pixel</span> &amp; 0x0000FF00) &gt;&gt; 8),
                                        (<b>byte</b>)((<span class="r34 r">pixel</span> &amp; 0x00FF0000) &gt;&gt; 16));
            <b>return</b> <span class="r35 r">color</span>;
        }
    }
}</pre></td></tr></table></div></body></html>
