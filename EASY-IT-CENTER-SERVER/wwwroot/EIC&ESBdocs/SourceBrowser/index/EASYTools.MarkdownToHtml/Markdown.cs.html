<!DOCTYPE html>
<html><head><title>Markdown.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(1725);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EASYTools.MarkdownToHtml/Markdown.cs" target="_top">Markdown.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EASYTools.MarkdownToHtml" target="_top">..\..\..\EASY-TOOLS\EASYTools.MarkdownToHtml\EASYTools.MarkdownToHtml.csproj</a> (EASYTools.MarkdownToHtml)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">/*
 * EASYTools.MarkdownToHtml
 * -------------
 * a C# Markdown processor
 * 
 * Markdown is a text-to-HTML conversion tool for web writers
 * Copyright (c) 2004 John Gruber
 * http://daringfireball.net/projects/markdown/
 * 
 * Markdown.NET
 * Copyright (c) 2004-2009 Milan Negovan
 * http://www.aspnetresources.com
 * http://aspnetresources.com/blog/markdown_announced.aspx
 * 
 * EASYTools.MarkdownToHtml
 * Copyright (c) 2009-2010 Jeff Atwood
 * http://stackoverflow.com
 * http://www.codinghorror.com/blog/
 * http://code.google.com/p/EASYTools.MarkdownToHtml/
 * 
 * History: Milan ported the Markdown processor to C#. He granted license to me so I can open source it
 * and let the community contribute to and improve EASYTools.MarkdownToHtml.
 * 
 */</span>
 
<span class="k preprocess">#</span><span class="k preprocess">region</span> Copyright and license
 
<span class="c">/*
 
Copyright (c) 2009 - 2010 Jeff Atwood
 
http://www.opensource.org/licenses/mit-license.php
  
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
 
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
 
THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 
Copyright (c) 2003-2004 John Gruber
&lt;http://daringfireball.net/&gt;   
All rights reserved.
 
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:
 
* Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
 
* Redistributions in binary form must reproduce the above copyright
  notice, this list of conditions and the following disclaimer in the
  documentation and/or other materials provided with the distribution.
 
* Neither the name &quot;Markdown&quot; nor the names of its contributors may
  be used to endorse or promote products derived from this software
  without specific prior written permission.
 
This software is provided by the copyright holders and contributors &quot;as
is&quot; and any express or implied warranties, including, but not limited
to, the implied warranties of merchantability and fitness for a
particular purpose are disclaimed. In no event shall the copyright owner
or contributors be liable for any direct, indirect, incidental, special,
exemplary, or consequential damages (including, but not limited to,
procurement of substitute goods or services; loss of use, data, or
profits; or business interruption) however caused and on any theory of
liability, whether in contract, strict liability, or tort (including
negligence or otherwise) arising in any way out of the use of this
software, even if advised of the possibility of such damage.
*/</span>
 
<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">RegularExpressions</span>;
 
<b>namespace</b> <span class="i n">EASYTools</span>.<span class="i n">MarkdownToHtml</span>
{
 
    <b>public class</b> <a id="46c8bc03224bab91" href="R/46c8bc03224bab91.html" target="n" data-glyph="0,0" class="t t"><span id="59b6b26974bcadf6">MarkdownOptions</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, (most) bare plain URLs are auto-hyperlinked  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="4ad6fa8af5a3bb1d" href="R/4ad6fa8af5a3bb1d.html" target="n" data-glyph="102,1" class="i property">AutoHyperlink</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, RETURN becomes a literal newline  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="578ed7b85bf62ff7" href="R/578ed7b85bf62ff7.html" target="n" data-glyph="102,1" class="i property">AutoNewlines</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> use &quot;&gt;&quot; for HTML output, or &quot; /&gt;&quot; for XHTML output</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="d4c892b53575e775" href="R/d4c892b53575e775.html" target="n" data-glyph="102,1" class="i property">EmptyElementSuffix</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, problematic URL characters like [, ], (, and so forth will be encoded </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="addaf1a30e8ec966" href="R/addaf1a30e8ec966.html" target="n" data-glyph="102,1" class="i property">EncodeProblemUrlCharacters</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when false, email addresses will never be auto-linked  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="bb0cd01e5827b66d" href="R/bb0cd01e5827b66d.html" target="n" data-glyph="102,1" class="i property">LinkEmails</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, bold and italic require non-word characters on either side  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="55f9d11d1d5aefb7" href="R/55f9d11d1d5aefb7.html" target="n" data-glyph="102,1" class="i property">StrictBoldItalic</a> { <b>get</b>; <b>set</b>; }
    }
 
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Markdown is a text-to-HTML conversion tool for web writers. </span>
    <span class="c">///</span><span class="c"> Markdown allows you to write using an easy-to-read, easy-to-write plain text format, </span>
    <span class="c">///</span><span class="c"> then convert it to structurally valid XHTML (or HTML).</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="298f5692dc052796" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">Markdown</a>
    {
        <b>private const string</b> <a id="54bc330357391e95" href="R/54bc330357391e95.html" target="n" data-glyph="10,1" class="i field">_version</a> = <span class="s">&quot;1.13&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors and Options
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new Markdown instance using default options</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="fdc3db7940b845ef" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">Markdown</a>() : <a href="#27295d5eda3b3a9b" class="k">this</a>(<b>false</b>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new Markdown instance and optionally load options from a configuration</span>
        <span class="c">///</span><span class="c"> file. There they should be stored in the appSettings section, available options are:</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c">     Markdown.StrictBoldItalic (true/false)</span>
        <span class="c">///</span><span class="c">     Markdown.EmptyElementSuffix (&quot;&gt;&quot; or &quot; /&gt;&quot; without the quotes)</span>
        <span class="c">///</span><span class="c">     Markdown.LinkEmails (true/false)</span>
        <span class="c">///</span><span class="c">     Markdown.AutoNewLines (true/false)</span>
        <span class="c">///</span><span class="c">     Markdown.AutoHyperlink (true/false)</span>
        <span class="c">///</span><span class="c">     Markdown.EncodeProblemUrlCharacters (true/false) </span>
        <span class="c">///</span><span class="c">     </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="27295d5eda3b3a9b" href="R/27295d5eda3b3a9b.html" target="n" data-glyph="72,1" class="t constructor">Markdown</a>(<b>bool</b> <span id="r0 rd" class="r0 r">loadOptionsFromConfigFile</span>)
        {
            <b>if</b> (!<span class="r0 r">loadOptionsFromConfigFile</span>) <b>return</b>;
 
            <a href="@0@System/A.html#43778f3f0bc795d4" class="k">var</a> <span id="r1 rd" class="r1 r">settings</span> = <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a>;
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">key</span> <b>in</b> <span class="r1 r">settings</span>.<a href="@0@System/A.html#2b55d37e8818f7d0" class="i property">Keys</a>)
            {
                <b>switch</b> (<span class="r2 r">key</span>)
                {
                    <b>case</b> <span class="s">&quot;Markdown.AutoHyperlink&quot;</span>:
                        <a href="#1594d714858db0f5" class="i field">_autoHyperlink</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#9b9012f5a01c7e0f" class="i method">ToBoolean</a>(<span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>]);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;Markdown.AutoNewlines&quot;</span>:
                        <a href="#a27d52d1661e231d" class="i field">_autoNewlines</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#9b9012f5a01c7e0f" class="i method">ToBoolean</a>(<span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>]);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;Markdown.EmptyElementSuffix&quot;</span>:
                        <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a> = <span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>];
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;Markdown.EncodeProblemUrlCharacters&quot;</span>:
                        <a href="#93d9d9146a574451" class="i field">_encodeProblemUrlCharacters</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#9b9012f5a01c7e0f" class="i method">ToBoolean</a>(<span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>]);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;Markdown.LinkEmails&quot;</span>:
                        <a href="#2c626718250bb423" class="i field">_linkEmails</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#9b9012f5a01c7e0f" class="i method">ToBoolean</a>(<span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>]);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;Markdown.StrictBoldItalic&quot;</span>:
                        <a href="#63dd3d77fe5b4758" class="i field">_strictBoldItalic</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#9b9012f5a01c7e0f" class="i method">ToBoolean</a>(<span class="r1 r">settings</span><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="r2 r">key</span>]);
                        <b>break</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new Markdown instance and set the options from the MarkdownOptions object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="7d85da46e2360bec" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">Markdown</a>(<a href="#46c8bc03224bab91" class="t t">MarkdownOptions</a> <span id="r3 rd" class="r3 r">options</span>)
        {
            <a href="#1594d714858db0f5" class="i field">_autoHyperlink</a> = <span class="r3 r">options</span>.<a href="#4ad6fa8af5a3bb1d" class="i property">AutoHyperlink</a>;
            <a href="#a27d52d1661e231d" class="i field">_autoNewlines</a> = <span class="r3 r">options</span>.<a href="#578ed7b85bf62ff7" class="i property">AutoNewlines</a>;
            <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a> = <span class="r3 r">options</span>.<a href="#d4c892b53575e775" class="i property">EmptyElementSuffix</a>;
            <a href="#93d9d9146a574451" class="i field">_encodeProblemUrlCharacters</a> = <span class="r3 r">options</span>.<a href="#addaf1a30e8ec966" class="i property">EncodeProblemUrlCharacters</a>;
            <a href="#2c626718250bb423" class="i field">_linkEmails</a> = <span class="r3 r">options</span>.<a href="#bb0cd01e5827b66d" class="i property">LinkEmails</a>;
            <a href="#63dd3d77fe5b4758" class="i field">_strictBoldItalic</a> = <span class="r3 r">options</span>.<a href="#55f9d11d1d5aefb7" class="i property">StrictBoldItalic</a>;
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> use &quot;&gt;&quot; for HTML output, or &quot; /&gt;&quot; for XHTML output</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="1e8c7205c8035d9f" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">EmptyElementSuffix</a>
        {
            <b>get</b> { <b>return</b> <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a>; }
            <b>set</b> { <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a> = <b>value</b>; }
        }
        <b>private string</b> <a id="f61b6c7bc7cf3183" href="R/f61b6c7bc7cf3183.html" target="n" data-glyph="46,1" class="i field">_emptyElementSuffix</a> = <span class="s">&quot; /&gt;&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when false, email addresses will never be auto-linked  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="0d2f37274f5ffdf4" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">LinkEmails</a>
        {
            <b>get</b> { <b>return</b> <a href="#2c626718250bb423" class="i field">_linkEmails</a>; }
            <b>set</b> { <a href="#2c626718250bb423" class="i field">_linkEmails</a> = <b>value</b>; }
        }
        <b>private bool</b> <a id="2c626718250bb423" href="R/2c626718250bb423.html" target="n" data-glyph="46,1" class="i field">_linkEmails</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, bold and italic require non-word characters on either side  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="39621317c755dbac" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">StrictBoldItalic</a>
        {
            <b>get</b> { <b>return</b> <a href="#63dd3d77fe5b4758" class="i field">_strictBoldItalic</a>; }
            <b>set</b> { <a href="#63dd3d77fe5b4758" class="i field">_strictBoldItalic</a> = <b>value</b>; }
        }
        <b>private bool</b> <a id="63dd3d77fe5b4758" href="R/63dd3d77fe5b4758.html" target="n" data-glyph="46,1" class="i field">_strictBoldItalic</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, RETURN becomes a literal newline  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="7c4c35fb06dfed9f" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">AutoNewLines</a>
        {
            <b>get</b> { <b>return</b> <a href="#a27d52d1661e231d" class="i field">_autoNewlines</a>; }
            <b>set</b> { <a href="#a27d52d1661e231d" class="i field">_autoNewlines</a> = <b>value</b>; }
        }
        <b>private bool</b> <a id="a27d52d1661e231d" href="R/a27d52d1661e231d.html" target="n" data-glyph="46,1" class="i field">_autoNewlines</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, (most) bare plain URLs are auto-hyperlinked  </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="7e9b6fa4bbad270f" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">AutoHyperlink</a>
        {
            <b>get</b> { <b>return</b> <a href="#1594d714858db0f5" class="i field">_autoHyperlink</a>; }
            <b>set</b> { <a href="#1594d714858db0f5" class="i field">_autoHyperlink</a> = <b>value</b>; }
        }
        <b>private bool</b> <a id="1594d714858db0f5" href="R/1594d714858db0f5.html" target="n" data-glyph="46,1" class="i field">_autoHyperlink</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> when true, problematic URL characters like [, ], (, and so forth will be encoded </span>
        <span class="c">///</span><span class="c"> WARNING: this is a significant deviation from the markdown spec</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="964d519ec08fd9fa" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">EncodeProblemUrlCharacters</a>
        {
            <b>get</b> { <b>return</b> <a href="#93d9d9146a574451" class="i field">_encodeProblemUrlCharacters</a>; }
            <b>set</b> { <a href="#93d9d9146a574451" class="i field">_encodeProblemUrlCharacters</a> = <b>value</b>; }
        }
        <b>private bool</b> <a id="93d9d9146a574451" href="R/93d9d9146a574451.html" target="n" data-glyph="46,1" class="i field">_encodeProblemUrlCharacters</a> = <b>false</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>private enum</b> <a id="f4b572ef26981c44" href="R/f4b572ef26981c44.html" target="n" data-glyph="22,1" class="t t"><span id="5987728917455c02">TokenType</span></a> { <a id="86aef846567dbebc" href="R/86aef846567dbebc.html" target="n" data-glyph="24,2" class="i field">Text</a>, <a id="8b4ba131ad2191cd" href="R/8b4ba131ad2191cd.html" target="n" data-glyph="24,2" class="i field">Tag</a> }
 
        <b>private struct</b> <a id="808ab6fb92c55207" href="R/808ab6fb92c55207.html" target="n" data-glyph="112,1" class="t t"><span id="3aea830fb058e3a4">Token</span></a>
        {
            <b>public</b> <a id="57d1ff0f7af19dd9" href="R/57d1ff0f7af19dd9.html" target="n" data-glyph="72,2" class="t constructor">Token</a>(<a href="#f4b572ef26981c44" class="t t">TokenType</a> <span id="r4 rd" class="r4 r">type</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">value</span>)
            {
                <a href="#808ab6fb92c55207" class="k">this</a>.<a href="#7b9358e77af82cac" class="i field">Type</a> = <span class="r4 r">type</span>;
                <a href="#808ab6fb92c55207" class="k">this</a>.<a href="#f57db0e9ff94e05a" class="i field">Value</a> = <span class="r5 r">value</span>;
            }
            <b>public</b> <a href="#f4b572ef26981c44" class="t t">TokenType</a> <a id="7b9358e77af82cac" href="R/7b9358e77af82cac.html" target="n" data-glyph="42,2" class="i field">Type</a>;
            <b>public string</b> <a id="f57db0e9ff94e05a" href="R/f57db0e9ff94e05a.html" target="n" data-glyph="42,2" class="i field">Value</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> maximum nested depth of [] and () supported by the transform; implementation detail</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="289b87b6d5fec007" href="R/289b87b6d5fec007.html" target="n" data-glyph="10,1" class="i field">_nestDepth</a> = 6;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tabs are automatically converted to spaces as part of the transform  </span>
        <span class="c">///</span><span class="c"> this constant determines how &quot;wide&quot; those tabs become in spaces  </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="70110a422f169059" href="R/70110a422f169059.html" target="n" data-glyph="10,1" class="i field">_tabWidth</a> = 4;
 
        <b>private const string</b> <a id="dc40e73210a3176b" href="R/dc40e73210a3176b.html" target="n" data-glyph="10,1" class="i field">_markerUL</a> = <span class="s">@&quot;[*+-]&quot;</span>;
        <b>private const string</b> <a id="eb166f069877be5a" href="R/eb166f069877be5a.html" target="n" data-glyph="10,1" class="i field">_markerOL</a> = <span class="s">@&quot;\d+[.]&quot;</span>;
 
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="94336f8d8f43700e" href="R/94336f8d8f43700e.html" target="n" data-glyph="46,1" class="i field">_escapeTable</a>;
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="92b71d9d86a9ffab" href="R/92b71d9d86a9ffab.html" target="n" data-glyph="46,1" class="i field">_invertedEscapeTable</a>;
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="17fe198196f17f2b" href="R/17fe198196f17f2b.html" target="n" data-glyph="46,1" class="i field">_backslashEscapeTable</a>;        
 
        <b>private readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="e23486b81bd45434" href="R/e23486b81bd45434.html" target="n" data-glyph="46,1" class="i field">_urls</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
        <b>private readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="c72ad66f949807d0" href="R/c72ad66f949807d0.html" target="n" data-glyph="46,1" class="i field">_titles</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
        <b>private readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="7c5c062554594158" href="R/7c5c062554594158.html" target="n" data-glyph="46,1" class="i field">_htmlBlocks</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
 
        <b>private int</b> <a id="b00253147d515681" href="R/b00253147d515681.html" target="n" data-glyph="46,1" class="i field">_listLevel</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In the static constuctor we&#39;ll initialize what stays the same across all transforms.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>static</b> <a id="8b01d727b064d162" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">Markdown</a>()
        {
            <span class="c">// Table of hash values for escaped characters:</span>
            <a href="#94336f8d8f43700e" class="i field">_escapeTable</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
            <a href="#92b71d9d86a9ffab" class="i field">_invertedEscapeTable</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
            <span class="c">// Table of hash value for backslash escaped characters:</span>
            <a href="#17fe198196f17f2b" class="i field">_backslashEscapeTable</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">backslashPattern</span> = <span class="s">&quot;&quot;</span>;
 
            <b>foreach</b> (<b>char</b> <span id="r7 rd" class="r7 r">c</span> <b>in</b> <span class="s">@&quot;\`*_{}[]()&gt;#+-.!&quot;</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">key</span> = <span class="r7 r">c</span>.<a href="@0@mscorlib/A.html#8da116b4ffb677f2" class="i method">ToString</a>();
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">hash</span> = <a href="#fb7258d78287561c" class="i method">GetHashKey</a>(<span class="r8 r">key</span>);
                <a href="#94336f8d8f43700e" class="i field">_escapeTable</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<span class="r8 r">key</span>, <span class="r9 r">hash</span>);
                <a href="#92b71d9d86a9ffab" class="i field">_invertedEscapeTable</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<span class="r9 r">hash</span>, <span class="r8 r">key</span>);
                <a href="#17fe198196f17f2b" class="i field">_backslashEscapeTable</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<span class="s">@&quot;\&quot;</span> + <span class="r8 r">key</span>, <span class="r9 r">hash</span>);
                <span class="r6 r">backslashPattern</span> += <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#70ce8540b4508f2d" class="i method">Escape</a>(<span class="s">@&quot;\&quot;</span> + <span class="r8 r">key</span>) + <span class="s">&quot;|&quot;</span>;
            }
 
            <a href="#d7c07fe4c6961708" class="i field">_backslashEscapes</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="r6 r">backslashPattern</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r6 r">backslashPattern</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> current version of EASYTools.MarkdownToHtml;  </span>
        <span class="c">///</span><span class="c"> see http://code.google.com/p/EASYTools.MarkdownToHtml/ for the latest code or to contribute</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="c967711b658146f7" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Version</a>
        {
            <b>get</b> { <b>return</b> <a href="#54bc330357391e95" class="i field">_version</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Transforms the provided Markdown-formatted text to HTML;  </span>
        <span class="c">///</span><span class="c"> see http://en.wikipedia.org/wiki/Markdown</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The order in which other subs are called here is</span>
        <span class="c">///</span><span class="c"> essential. Link and image substitutions need to happen before</span>
        <span class="c">///</span><span class="c"> EscapeSpecialChars(), so that any *&#39;s or _&#39;s in the a</span>
        <span class="c">///</span><span class="c"> and img tags get encoded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public string</b> <a id="5ad44d360d21ac3f" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Transform</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">text</span>)
        {
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r10 r">text</span>)) <b>return</b> <span class="s">&quot;&quot;</span>;
 
            <a href="#73583acdbb4c8349" class="i method">Setup</a>();
 
            <span class="r10 r">text</span> = <a href="#ea4a6b283ed0bdea" class="i method">Normalize</a>(<span class="r10 r">text</span>);
           
            <span class="r10 r">text</span> = <a href="#33f7eed77632e05f" class="i method">HashHTMLBlocks</a>(<span class="r10 r">text</span>);
            <span class="r10 r">text</span> = <a href="#b8ab47b33e0052ac" class="i method">StripLinkDefinitions</a>(<span class="r10 r">text</span>);
            <span class="r10 r">text</span> = <a href="#c9f66da0652872dc" class="i method">RunBlockGamut</a>(<span class="r10 r">text</span>);
            <span class="r10 r">text</span> = <a href="#0c56c3ad9f38da57" class="i method">Unescape</a>(<span class="r10 r">text</span>);
 
            <a href="#a7e73d6a1c9d883b" class="i method">Cleanup</a>();
 
            <b>return</b> <span class="r10 r">text</span> + <span class="s">&quot;\n&quot;</span>;
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Perform transformations that form block-level tags like paragraphs, headers, and list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="c9f66da0652872dc" href="R/c9f66da0652872dc.html" target="n" data-glyph="76,1" class="i method">RunBlockGamut</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">text</span>)
        {
            <span class="r11 r">text</span> = <a href="#da75a675dead0793" class="i method">DoHeaders</a>(<span class="r11 r">text</span>);
            <span class="r11 r">text</span> = <a href="#1aa04fc9f77bc925" class="i method">DoHorizontalRules</a>(<span class="r11 r">text</span>);
            <span class="r11 r">text</span> = <a href="#b3bd2da3f6b4f8c0" class="i method">DoLists</a>(<span class="r11 r">text</span>);
            <span class="r11 r">text</span> = <a href="#2835c6f169234d0c" class="i method">DoCodeBlocks</a>(<span class="r11 r">text</span>);
            <span class="r11 r">text</span> = <a href="#660ff86e98b6dbc9" class="i method">DoBlockQuotes</a>(<span class="r11 r">text</span>);
 
            <span class="c">// We already ran HashHTMLBlocks() before, in Markdown(), but that</span>
            <span class="c">// was to escape raw HTML in the original Markdown source. This time,</span>
            <span class="c">// we&#39;re escaping the markup we&#39;ve just created, so that we don&#39;t wrap</span>
            <span class="c">// &lt;p&gt; tags around block-level tags.</span>
            <span class="r11 r">text</span> = <a href="#33f7eed77632e05f" class="i method">HashHTMLBlocks</a>(<span class="r11 r">text</span>);
 
            <span class="r11 r">text</span> = <a href="#8f4d93fe41cef458" class="i method">FormParagraphs</a>(<span class="r11 r">text</span>);
 
            <b>return</b> <span class="r11 r">text</span>;
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Perform transformations that occur *within* block-level tags like paragraphs, headers, and list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="2135582728c7d0e8" href="R/2135582728c7d0e8.html" target="n" data-glyph="76,1" class="i method">RunSpanGamut</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">text</span>)
        {
            <span class="r12 r">text</span> = <a href="#d8fad72e1b4f781f" class="i method">DoCodeSpans</a>(<span class="r12 r">text</span>);
            <span class="r12 r">text</span> = <a href="#ddfbf9be255c031d" class="i method">EscapeSpecialCharsWithinTagAttributes</a>(<span class="r12 r">text</span>);
            <span class="r12 r">text</span> = <a href="#a79a77d98c62e661" class="i method">EscapeBackslashes</a>(<span class="r12 r">text</span>);
 
            <span class="c">// Images must come first, because ![foo][f] looks like an anchor.</span>
            <span class="r12 r">text</span> = <a href="#cf3d181da23fc03e" class="i method">DoImages</a>(<span class="r12 r">text</span>);
            <span class="r12 r">text</span> = <a href="#0f288961037107cc" class="i method">DoAnchors</a>(<span class="r12 r">text</span>);
 
            <span class="c">// Must come after DoAnchors(), because you can use &lt; and &gt;</span>
            <span class="c">// delimiters in inline links like [this](&lt;url&gt;).</span>
            <span class="r12 r">text</span> = <a href="#2aaf59103ba3bbe2" class="i method">DoAutoLinks</a>(<span class="r12 r">text</span>);
 
            <span class="r12 r">text</span> = <a href="#e07199c5d085e961" class="i method">EncodeAmpsAndAngles</a>(<span class="r12 r">text</span>);
            <span class="r12 r">text</span> = <a href="#9c83ac1db51199c1" class="i method">DoItalicsAndBold</a>(<span class="r12 r">text</span>);
            <span class="r12 r">text</span> = <a href="#cfb0a3ecbc5b77cf" class="i method">DoHardBreaks</a>(<span class="r12 r">text</span>);
 
            <b>return</b> <span class="r12 r">text</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="cce4b95b7e03ea55" href="R/cce4b95b7e03ea55.html" target="n" data-glyph="46,1" class="i field">_newlinesLeadingTrailing</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;^\n+|\n+\z&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="86542d0ae7baec79" href="R/86542d0ae7baec79.html" target="n" data-glyph="46,1" class="i field">_newlinesMultiple</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;\n{2,}&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="8e6569f07c54074f" href="R/8e6569f07c54074f.html" target="n" data-glyph="46,1" class="i field">_leadingWhitespace</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;^[ ]*&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> splits on two or more newlines, to form &quot;paragraphs&quot;;    </span>
        <span class="c">///</span><span class="c"> each paragraph is then unhashed (if it is a hash) or wrapped in HTML p tag</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="8f4d93fe41cef458" href="R/8f4d93fe41cef458.html" target="n" data-glyph="76,1" class="i method">FormParagraphs</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">text</span>)
        {
            <span class="c">// split on two or more newlines</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r14 rd" class="r14 r">grafs</span> = <a href="#86542d0ae7baec79" class="i field">_newlinesMultiple</a>.<a href="@0@System/A.html#0703e29d2bf2dff7" class="i method">Split</a>(<a href="#cce4b95b7e03ea55" class="i field">_newlinesLeadingTrailing</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r13 r">text</span>, <span class="s">&quot;&quot;</span>));
            
            <b>for</b> (<b>int</b> <span id="r15 rd" class="r15 r">i</span> = 0; <span class="r15 r">i</span> &lt; <span class="r14 r">grafs</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r15 r">i</span>++)
            {
                <b>if</b> (<span class="r14 r">grafs</span>[<span class="r15 r">i</span>].<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;\x1A&quot;</span>))
                {
                    <span class="c">// unhashify HTML blocks</span>
                    <span class="r14 r">grafs</span>[<span class="r15 r">i</span>] = <a href="#7c5c062554594158" class="i field">_htmlBlocks</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r14 r">grafs</span>[<span class="r15 r">i</span>]];
                }
                <b>else</b>
                {
                    <span class="c">// do span level processing inside the block, then wrap result in &lt;p&gt; tags</span>
                    <span class="r14 r">grafs</span>[<span class="r15 r">i</span>] = <a href="#8e6569f07c54074f" class="i field">_leadingWhitespace</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<a href="#2135582728c7d0e8" class="i method">RunSpanGamut</a>(<span class="r14 r">grafs</span>[<span class="r15 r">i</span>]), <span class="s">&quot;&lt;p&gt;&quot;</span>) + <span class="s">&quot;&lt;/p&gt;&quot;</span>;
                }
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#881354baa56fc358" class="i method">Join</a>(<span class="s">&quot;\n\n&quot;</span>, <span class="r14 r">grafs</span>);
        }
 
 
        <b>private void</b> <a id="73583acdbb4c8349" href="R/73583acdbb4c8349.html" target="n" data-glyph="76,1" class="i method">Setup</a>()
        {
            <span class="c">// Clear the global hashes. If we don&#39;t clear these, you get conflicts</span>
            <span class="c">// from other articles when generating a page which contains more than</span>
            <span class="c">// one article (e.g. an index page that shows the N most recent</span>
            <span class="c">// articles):</span>
            <a href="#e23486b81bd45434" class="i field">_urls</a>.<a href="@0@mscorlib/A.html#36b30e4c0708a88c" class="i method">Clear</a>();
            <a href="#c72ad66f949807d0" class="i field">_titles</a>.<a href="@0@mscorlib/A.html#36b30e4c0708a88c" class="i method">Clear</a>();
            <a href="#7c5c062554594158" class="i field">_htmlBlocks</a>.<a href="@0@mscorlib/A.html#36b30e4c0708a88c" class="i method">Clear</a>();
            <a href="#b00253147d515681" class="i field">_listLevel</a> = 0;
        }
 
        <b>private void</b> <a id="a7e73d6a1c9d883b" href="R/a7e73d6a1c9d883b.html" target="n" data-glyph="76,1" class="i method">Cleanup</a>()
        {
            <a href="#73583acdbb4c8349" class="i method">Setup</a>();
        }
 
        <b>private static string</b> <a id="63bafd667dddc3f9" href="R/63bafd667dddc3f9.html" target="n" data-glyph="46,1" class="i field">_nestedBracketsPattern</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reusable pattern to match balanced [brackets]. See Friedl&#39;s </span>
        <span class="c">///</span><span class="c"> &quot;Mastering Regular Expressions&quot;, 2nd Ed., pp. 328-331.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="3aef1aefe779059c" href="R/3aef1aefe779059c.html" target="n" data-glyph="76,1" class="i method">GetNestedBracketsPattern</a>()
        {
            <span class="c">// in other words [this] and [this[also]] and [this[also[too]]]</span>
            <span class="c">// up to _nestDepth</span>
            <b>if</b> (<a href="#63bafd667dddc3f9" class="i field">_nestedBracketsPattern</a> == <b>null</b>)
                <a href="#63bafd667dddc3f9" class="i field">_nestedBracketsPattern</a> =
                    <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot;
                    (?&gt;              # Atomic matching
                       [^\[\]]+      # Anything other than brackets
                     |
                       \[
                           &quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>) + <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(
                    <span class="s">@&quot; \]
                    )*&quot;</span>
                    , <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>);
            <b>return</b> <a href="#63bafd667dddc3f9" class="i field">_nestedBracketsPattern</a>;
        }
 
        <b>private static string</b> <a id="2e0c095089bbbbee" href="R/2e0c095089bbbbee.html" target="n" data-glyph="46,1" class="i field">_nestedParensPattern</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reusable pattern to match balanced (parens). See Friedl&#39;s </span>
        <span class="c">///</span><span class="c"> &quot;Mastering Regular Expressions&quot;, 2nd Ed., pp. 328-331.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="6a0ae1b573bfaa15" href="R/6a0ae1b573bfaa15.html" target="n" data-glyph="76,1" class="i method">GetNestedParensPattern</a>()
        {
            <span class="c">// in other words (this) and (this(also)) and (this(also(too)))</span>
            <span class="c">// up to _nestDepth</span>
            <b>if</b> (<a href="#2e0c095089bbbbee" class="i field">_nestedParensPattern</a> == <b>null</b>)
                <a href="#2e0c095089bbbbee" class="i field">_nestedParensPattern</a> =
                    <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot;
                    (?&gt;              # Atomic matching
                       [^()\s]+      # Anything other than parens or whitespace
                     |
                       \(
                           &quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>) + <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(
                    <span class="s">@&quot; \)
                    )*&quot;</span>
                    , <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>);
            <b>return</b> <a href="#2e0c095089bbbbee" class="i field">_nestedParensPattern</a>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="21ddb98f2c5211f8" href="R/21ddb98f2c5211f8.html" target="n" data-glyph="46,1" class="i field">_linkDef</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                        ^[ ]{{0,{0}}}\[(.+)\]:  # id = $1
                          [ ]*
                          \n?                   # maybe *one* newline
                          [ ]*
                        &lt;?(\S+?)&gt;?              # url = $2
                          [ ]*
                          \n?                   # maybe one newline
                          [ ]*
                        (?:
                            (?&lt;=\s)             # lookbehind for whitespace
                            [&quot;&quot;(]
                            (.+?)               # title = $3
                            [&quot;&quot;)]
                            [ ]*
                        )?                      # title is optional
                        (?:\n+|\Z)&quot;</span>, <a href="#70110a422f169059" class="i field">_tabWidth</a> - 1), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Strips link definitions from text, stores the URLs and titles in hash references.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ^[id]: url &quot;optional title&quot;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="b8ab47b33e0052ac" href="R/b8ab47b33e0052ac.html" target="n" data-glyph="76,1" class="i method">StripLinkDefinitions</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r16 rd" class="r16 r">text</span>)
        {
            <b>return</b> <a href="#21ddb98f2c5211f8" class="i field">_linkDef</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r16 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#747159fe577d4a04" class="i method">LinkEvaluator</a>));
        }
 
        <b>private string</b> <a id="747159fe577d4a04" href="R/747159fe577d4a04.html" target="n" data-glyph="76,1" class="i method">LinkEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r17 rd" class="r17 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r18 rd" class="r18 r">linkID</span> = <span class="r17 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
            <a href="#e23486b81bd45434" class="i field">_urls</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r18 r">linkID</span>] = <a href="#e07199c5d085e961" class="i method">EncodeAmpsAndAngles</a>(<span class="r17 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
 
            <b>if</b> (<span class="r17 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3] != <b>null</b> &amp;&amp; <span class="r17 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#d22878087e24a96d" class="i property">Length</a> &gt; 0)
                <a href="#c72ad66f949807d0" class="i field">_titles</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r18 r">linkID</span>] = <span class="r17 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
 
            <b>return</b> <span class="s">&quot;&quot;</span>;
        }
 
        <span class="c">// compiling this monster regex results in worse performance. trust me.</span>
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="a0327562a674a018" href="R/a0327562a674a018.html" target="n" data-glyph="46,1" class="i field">_blocksHtml</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="#a226deb3cf70715d" class="i method">GetBlockPattern</a>(), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> derived pretty much verbatim from PHP Markdown</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="a226deb3cf70715d" href="R/a226deb3cf70715d.html" target="n" data-glyph="76,1" class="i method">GetBlockPattern</a>()
        {
 
            <span class="c">// Hashify HTML blocks:</span>
            <span class="c">// We only want to do this for block-level HTML tags, such as headers,</span>
            <span class="c">// lists, and tables. That&#39;s because we still want to wrap &lt;p&gt;s around</span>
            <span class="c">// &quot;paragraphs&quot; that are wrapped in non-block-level tags, such as anchors,</span>
            <span class="c">// phrase emphasis, and spans. The list of tags we&#39;re looking for is</span>
            <span class="c">// hard-coded:</span>
            <span class="c">//</span>
            <span class="c">// *  List &quot;a&quot; is made of tags which can be both inline or block-level.</span>
            <span class="c">//    These will be treated block-level when the start tag is alone on </span>
            <span class="c">//    its line, otherwise they&#39;re not matched here and will be taken as </span>
            <span class="c">//    inline later.</span>
            <span class="c">// *  List &quot;b&quot; is made of tags which are always block-level;</span>
            <span class="c">//</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r19 rd" class="r19 r">blockTagsA</span> = <span class="s">&quot;ins|del&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r20 rd" class="r20 r">blockTagsB</span> = <span class="s">&quot;p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|script|noscript|form|fieldset|iframe|math&quot;</span>;
 
            <span class="c">// Regular expression for the content of a block tag.</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">attr</span> = <span class="s">@&quot;
            (?&gt;				            # optional tag attributes
              \s			            # starts with whitespace
              (?&gt;
                [^&gt;&quot;&quot;/]+	            # text outside quotes
              |
                /+(?!&gt;)		            # slash not followed by &gt;
              |
                &quot;&quot;[^&quot;&quot;]*&quot;&quot;		        # text inside double quotes (tolerate &gt;)
              |
                &#39;[^&#39;]*&#39;	                # text inside single quotes (tolerate &gt;)
              )*
            )?	
            &quot;</span>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r22 rd" class="r22 r">content</span> = <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot;
                (?&gt;
                  [^&lt;]+			        # content without tag
                |
                  &lt;\2			        # nested opening tag
                    &quot;</span> + <span class="r21 r">attr</span> + <span class="s">@&quot;       # attributes
                  (?&gt;
                      /&gt;
                  |
                      &gt;&quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>) +   <span class="c">// end of opening tag</span>
                      <span class="s">&quot;.*?&quot;</span> +             <span class="c">// last level nested tag content</span>
            <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot;
                      &lt;/\2\s*&gt;	        # closing nested tag
                  )
                  |				
                  &lt;(?!/\2\s*&gt;           # other tags with a different name
                  )
                )*&quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">content2</span> = <span class="r22 r">content</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">@&quot;\2&quot;</span>, <span class="s">@&quot;\3&quot;</span>);
 
            <span class="c">// First, look for nested blocks, e.g.:</span>
            <span class="c">// 	&lt;div&gt;</span>
            <span class="c">// 		&lt;div&gt;</span>
            <span class="c">// 		tags for inner block must be indented.</span>
            <span class="c">// 		&lt;/div&gt;</span>
            <span class="c">// 	&lt;/div&gt;</span>
            <span class="c">//</span>
            <span class="c">// The outermost tags must start at the left margin for this to match, and</span>
            <span class="c">// the inner nested divs must be indented.</span>
            <span class="c">// We need to do this before the next, more liberal match, because the next</span>
            <span class="c">// match will start at the first `&lt;div&gt;` and stop at the first `&lt;/div&gt;`.</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r24 rd" class="r24 r">pattern</span> = <span class="s">@&quot;
            (?&gt;
                  (?&gt;
                    (?&lt;=\n)     # Starting after a blank line
                    |           # or
                    \A\n?       # the beginning of the doc
                  )
                  (             # save in $1
 
                    # Match from `\n&lt;tag&gt;` to `&lt;/tag&gt;\n`, handling nested tags 
                    # in between.
                      
                        [ ]{0,$less_than_tab}
                        &lt;($block_tags_b_re)   # start tag = $2
                        $attr&gt;                # attributes followed by &gt; and \n
                        $content              # content, support nesting
                        &lt;/\2&gt;                 # the matching end tag
                        [ ]*                  # trailing spaces
                        (?=\n+|\Z)            # followed by a newline or end of document
 
                  | # Special version for tags of group a.
 
                        [ ]{0,$less_than_tab}
                        &lt;($block_tags_a_re)   # start tag = $3
                        $attr&gt;[ ]*\n          # attributes followed by &gt;
                        $content2             # content, support nesting
                        &lt;/\3&gt;                 # the matching end tag
                        [ ]*                  # trailing spaces
                        (?=\n+|\Z)            # followed by a newline or end of document
                      
                  | # Special case just for &lt;hr /&gt;. It was easier to make a special 
                    # case than to make the other regex more complicated.
                  
                        [ ]{0,$less_than_tab}
                        &lt;(hr)                 # start tag = $2
                        $attr                 # attributes
                        /?&gt;                   # the matching end tag
                        [ ]*
                        (?=\n{2,}|\Z)         # followed by a blank line or end of document
                  
                  | # Special case for standalone HTML comments:
                  
                      [ ]{0,$less_than_tab}
                      (?s:
                        &lt;!-- .*? --&gt;
                      )
                      [ ]*
                      (?=\n{2,}|\Z)            # followed by a blank line or end of document
                  
                  | # PHP and ASP-style processor instructions (&lt;? and &lt;%)
                  
                      [ ]{0,$less_than_tab}
                      (?s:
                        &lt;([?%])                # $2
                        .*?
                        \2&gt;
                      )
                      [ ]*
                      (?=\n{2,}|\Z)            # followed by a blank line or end of document
                      
                  )
            )&quot;</span>;
 
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$less_than_tab&quot;</span>, (<a href="#70110a422f169059" class="i field">_tabWidth</a> - 1).<a href="@0@mscorlib/A.html#8d6f2d8bc0589463" class="i method">ToString</a>());
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$block_tags_b_re&quot;</span>, <span class="r20 r">blockTagsB</span>);
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$block_tags_a_re&quot;</span>, <span class="r19 r">blockTagsA</span>);
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$attr&quot;</span>, <span class="r21 r">attr</span>);
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$content2&quot;</span>, <span class="r23 r">content2</span>);
            <span class="r24 r">pattern</span> = <span class="r24 r">pattern</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;$content&quot;</span>, <span class="r22 r">content</span>);
 
            <b>return</b> <span class="r24 r">pattern</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> replaces any block-level HTML blocks with hash entries</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="33f7eed77632e05f" href="R/33f7eed77632e05f.html" target="n" data-glyph="76,1" class="i method">HashHTMLBlocks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r25 rd" class="r25 r">text</span>)
        {
            <b>return</b> <a href="#a0327562a674a018" class="i field">_blocksHtml</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r25 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#2d94fd9936f0f038" class="i method">HtmlEvaluator</a>));
        }
 
        <b>private string</b> <a id="2d94fd9936f0f038" href="R/2d94fd9936f0f038.html" target="n" data-glyph="76,1" class="i method">HtmlEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r26 rd" class="r26 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r27 rd" class="r27 r">text</span> = <span class="r26 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">key</span> = <a href="#fb7258d78287561c" class="i method">GetHashKey</a>(<span class="r27 r">text</span>);
            <a href="#7c5c062554594158" class="i field">_htmlBlocks</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r28 r">key</span>] = <span class="r27 r">text</span>;
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;\n\n&quot;</span>, <span class="r28 r">key</span>, <span class="s">&quot;\n\n&quot;</span>);
        }
 
        <b>private static string</b> <a id="fb7258d78287561c" href="R/fb7258d78287561c.html" target="n" data-glyph="76,1" class="i method">GetHashKey</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r29 rd" class="r29 r">s</span>)
        {
            <b>return</b> <span class="s">&quot;\x1A&quot;</span> + <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#1c02e346de90ef5a" class="i method">Abs</a>(<span class="r29 r">s</span>.<a href="@0@mscorlib/A.html#0a17bbac4851d0d4" class="i method">GetHashCode</a>()).<a href="@0@mscorlib/A.html#8d6f2d8bc0589463" class="i method">ToString</a>() + <span class="s">&quot;\x1A&quot;</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="b5f6b35148fe4722" href="R/b5f6b35148fe4722.html" target="n" data-glyph="46,1" class="i field">_htmlTokens</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
            (&lt;!(?:--.*?--\s*)+&gt;)|        # match &lt;!-- foo --&gt;
            (&lt;\?.*?\?&gt;)|                 # match &lt;?foo?&gt; &quot;</span> +
            <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot; 
            (&lt;[A-Za-z\/!$](?:[^&lt;&gt;]|&quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>) + <a href="#36a4a6921cfe84c9" class="i method">RepeatString</a>(<span class="s">@&quot;)*&gt;)&quot;</span>, <a href="#289b87b6d5fec007" class="i field">_nestDepth</a>) +
                                       <span class="s">&quot; # match &lt;tag&gt; and &lt;/tag&gt;&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#6bdc9d17fea4f440" class="i field">ExplicitCapture</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> returns an array of HTML tokens comprising the input string. Each token is </span>
        <span class="c">///</span><span class="c"> either a tag (possibly with nested, tags contained therein, such </span>
        <span class="c">///</span><span class="c"> as </span><span class="c">&amp;lt;</span><span class="c">a href=&quot;</span><span class="c">&amp;lt;</span><span class="c">MTFoo</span><span class="c">&amp;gt;</span><span class="c">&quot;</span><span class="c">&amp;gt;</span><span class="c">, or a run of text between tags. Each element of the </span>
        <span class="c">///</span><span class="c"> array is a two-element array; the first is either &#39;tag&#39; or &#39;text&#39;; the second is </span>
        <span class="c">///</span><span class="c"> the actual value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#808ab6fb92c55207" class="t t">Token</a>&gt; <a id="0c4b2bc28e5ac5a0" href="R/0c4b2bc28e5ac5a0.html" target="n" data-glyph="76,1" class="i method">TokenizeHTML</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r30 rd" class="r30 r">text</span>)
        {
            <b>int</b> <span id="r31 rd" class="r31 r">pos</span> = 0;
            <b>int</b> <span id="r32 rd" class="r32 r">tagStart</span> = 0;
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r33 rd" class="r33 r">tokens</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#808ab6fb92c55207" class="t t">Token</a>&gt;();
 
            <span class="c">// this regex is derived from the _tokenize() subroutine in Brad Choate&#39;s MTRegex plugin.</span>
            <span class="c">// http://www.bradchoate.com/past/mtregex.php</span>
            <b>foreach</b> (<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r34 rd" class="r34 r">m</span> <b>in</b> <a href="#b5f6b35148fe4722" class="i field">_htmlTokens</a>.<a href="@0@System/A.html#eee0fd08a857f828" class="i method">Matches</a>(<span class="r30 r">text</span>))
            {
                <span class="r32 r">tagStart</span> = <span class="r34 r">m</span>.<a href="@0@System/A.html#d33b0131e21561d5" class="i property">Index</a>;
 
                <b>if</b> (<span class="r31 r">pos</span> &lt; <span class="r32 r">tagStart</span>)
                    <span class="r33 r">tokens</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<b>new</b> <a href="#57d1ff0f7af19dd9" class="t constructor">Token</a>(<a href="#f4b572ef26981c44" class="t t">TokenType</a>.<a href="#86aef846567dbebc" class="i field">Text</a>, <span class="r30 r">text</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(<span class="r31 r">pos</span>, <span class="r32 r">tagStart</span> - <span class="r31 r">pos</span>)));
 
                <span class="r33 r">tokens</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<b>new</b> <a href="#57d1ff0f7af19dd9" class="t constructor">Token</a>(<a href="#f4b572ef26981c44" class="t t">TokenType</a>.<a href="#8b4ba131ad2191cd" class="i field">Tag</a>, <span class="r34 r">m</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>));
                <span class="r31 r">pos</span> = <span class="r32 r">tagStart</span> + <span class="r34 r">m</span>.<a href="@0@System/A.html#d22878087e24a96d" class="i property">Length</a>;
            }
 
            <b>if</b> (<span class="r31 r">pos</span> &lt; <span class="r30 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>)
                <span class="r33 r">tokens</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<b>new</b> <a href="#57d1ff0f7af19dd9" class="t constructor">Token</a>(<a href="#f4b572ef26981c44" class="t t">TokenType</a>.<a href="#86aef846567dbebc" class="i field">Text</a>, <span class="r30 r">text</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(<span class="r31 r">pos</span>, <span class="r30 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - <span class="r31 r">pos</span>)));
 
            <b>return</b> <span class="r33 r">tokens</span>;
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="240b99cf5c6b5bd3" href="R/240b99cf5c6b5bd3.html" target="n" data-glyph="46,1" class="i field">_anchorRef</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
            (                               # wrap whole match in $1
                \[
                    ({0})                   # link text = $2
                \]
 
                [ ]?                        # one optional space
                (?:\n[ ]*)?                 # one optional newline followed by spaces
 
                \[
                    (.*?)                   # id = $3
                \]
            )&quot;</span>, <a href="#3aef1aefe779059c" class="i method">GetNestedBracketsPattern</a>()), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="246de3c9323532f7" href="R/246de3c9323532f7.html" target="n" data-glyph="46,1" class="i field">_anchorInline</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">@&quot;
                (                           # wrap whole match in $1
                    \[
                        ({0})               # link text = $2
                    \]
                    \(                      # literal paren
                        [ ]*
                        ({1})               # href = $3
                        [ ]*
                        (                   # $4
                        ([&#39;&quot;&quot;])           # quote char = $5
                        (.*?)               # title = $6
                        \5                  # matching quote
                        [ ]*                # ignore any spaces between closing quote and )
                        )?                  # title is optional
                    \)
                )&quot;</span>, <a href="#3aef1aefe779059c" class="i method">GetNestedBracketsPattern</a>(), <a href="#6a0ae1b573bfaa15" class="i method">GetNestedParensPattern</a>()),
                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="69a07f06b56034e3" href="R/69a07f06b56034e3.html" target="n" data-glyph="46,1" class="i field">_anchorRefShortcut</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
            (                               # wrap whole match in $1
              \[
                 ([^\[\]]+)                 # link text = $2; can&#39;t contain [ or ]
              \]
            )&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown link shortcuts into HTML anchor tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> [link text](url &quot;title&quot;) </span>
        <span class="c">///</span><span class="c"> [link text][id] </span>
        <span class="c">///</span><span class="c"> [id] </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0f288961037107cc" href="R/0f288961037107cc.html" target="n" data-glyph="76,1" class="i method">DoAnchors</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r35 rd" class="r35 r">text</span>)
        {
            <span class="c">// First, handle reference-style links: [link text] [id]</span>
            <span class="r35 r">text</span> = <a href="#240b99cf5c6b5bd3" class="i field">_anchorRef</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r35 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#9c039fe74c0e6acb" class="i method">AnchorRefEvaluator</a>));
 
            <span class="c">// Next, inline-style links: [link text](url &quot;optional title&quot;) or [link text](url &quot;optional title&quot;)</span>
            <span class="r35 r">text</span> = <a href="#246de3c9323532f7" class="i field">_anchorInline</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r35 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#9769a8a6915c7fd5" class="i method">AnchorInlineEvaluator</a>));
 
            <span class="c">//  Last, handle reference-style shortcuts: [link text]</span>
            <span class="c">//  These must come last in case you&#39;ve also got [link test][1]</span>
            <span class="c">//  or [link test](/foo)</span>
            <span class="r35 r">text</span> = <a href="#69a07f06b56034e3" class="i field">_anchorRefShortcut</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r35 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#883a4eb4474704fe" class="i method">AnchorRefShortcutEvaluator</a>));
            <b>return</b> <span class="r35 r">text</span>;
        }
 
        <b>private string</b> <a id="9c039fe74c0e6acb" href="R/9c039fe74c0e6acb.html" target="n" data-glyph="76,1" class="i method">AnchorRefEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r36 rd" class="r36 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r37 rd" class="r37 r">wholeMatch</span> = <span class="r36 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r38 rd" class="r38 r">linkText</span> = <span class="r36 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r39 rd" class="r39 r">linkID</span> = <span class="r36 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">result</span>;
 
            <span class="c">// for shortcut links like [this][].</span>
            <b>if</b> (<span class="r39 r">linkID</span> == <span class="s">&quot;&quot;</span>)
                <span class="r39 r">linkID</span> = <span class="r38 r">linkText</span>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
 
            <b>if</b> (<a href="#e23486b81bd45434" class="i field">_urls</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r39 r">linkID</span>))
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">url</span> = <a href="#e23486b81bd45434" class="i field">_urls</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r39 r">linkID</span>];
 
                <span class="r41 r">url</span> = <a href="#0b0e1bb228cd87a8" class="i method">EncodeProblemUrlChars</a>(<span class="r41 r">url</span>);
                <span class="r41 r">url</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r41 r">url</span>);                
                <span class="r40 r">result</span> = <span class="s">&quot;&lt;a href=\&quot;&quot;</span> + <span class="r41 r">url</span> + <span class="s">&quot;\&quot;&quot;</span>;
 
                <b>if</b> (<a href="#c72ad66f949807d0" class="i field">_titles</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r39 r">linkID</span>))
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r42 rd" class="r42 r">title</span> = <a href="#c72ad66f949807d0" class="i field">_titles</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r39 r">linkID</span>];
                    <span class="r42 r">title</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r42 r">title</span>);
                    <span class="r40 r">result</span> += <span class="s">&quot; title=\&quot;&quot;</span> + <span class="r42 r">title</span> + <span class="s">&quot;\&quot;&quot;</span>;
                }
 
                <span class="r40 r">result</span> += <span class="s">&quot;&gt;&quot;</span> + <span class="r38 r">linkText</span> + <span class="s">&quot;&lt;/a&gt;&quot;</span>;
            }
            <b>else</b>
                <span class="r40 r">result</span> = <span class="r37 r">wholeMatch</span>;
 
            <b>return</b> <span class="r40 r">result</span>;
        }
 
        <b>private string</b> <a id="883a4eb4474704fe" href="R/883a4eb4474704fe.html" target="n" data-glyph="76,1" class="i method">AnchorRefShortcutEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r43 rd" class="r43 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r44 rd" class="r44 r">wholeMatch</span> = <span class="r43 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r45 rd" class="r45 r">linkText</span> = <span class="r43 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r46 rd" class="r46 r">linkID</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r45 r">linkText</span>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>(), <span class="s">@&quot;[ ]*\n[ ]*&quot;</span>, <span class="s">&quot; &quot;</span>);  <span class="c">// lower case and remove newlines / extra spaces</span>
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r47 rd" class="r47 r">result</span>;
 
            <b>if</b> (<a href="#e23486b81bd45434" class="i field">_urls</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r46 r">linkID</span>))
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r48 rd" class="r48 r">url</span> = <a href="#e23486b81bd45434" class="i field">_urls</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r46 r">linkID</span>];
 
                <span class="r48 r">url</span> = <a href="#0b0e1bb228cd87a8" class="i method">EncodeProblemUrlChars</a>(<span class="r48 r">url</span>);
                <span class="r48 r">url</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r48 r">url</span>);                
                <span class="r47 r">result</span> = <span class="s">&quot;&lt;a href=\&quot;&quot;</span> + <span class="r48 r">url</span> + <span class="s">&quot;\&quot;&quot;</span>;
 
                <b>if</b> (<a href="#c72ad66f949807d0" class="i field">_titles</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r46 r">linkID</span>))
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r49 rd" class="r49 r">title</span> = <a href="#c72ad66f949807d0" class="i field">_titles</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r46 r">linkID</span>];
                    <span class="r49 r">title</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r49 r">title</span>);
                    <span class="r47 r">result</span> += <span class="s">&quot; title=\&quot;&quot;</span> + <span class="r49 r">title</span> + <span class="s">&quot;\&quot;&quot;</span>;
                }
 
                <span class="r47 r">result</span> += <span class="s">&quot;&gt;&quot;</span> + <span class="r45 r">linkText</span> + <span class="s">&quot;&lt;/a&gt;&quot;</span>;
            }
            <b>else</b>
                <span class="r47 r">result</span> = <span class="r44 r">wholeMatch</span>;
 
            <b>return</b> <span class="r47 r">result</span>;
        }
 
 
        <b>private string</b> <a id="9769a8a6915c7fd5" href="R/9769a8a6915c7fd5.html" target="n" data-glyph="76,1" class="i method">AnchorInlineEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r50 rd" class="r50 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r51 rd" class="r51 r">linkText</span> = <span class="r50 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r52 rd" class="r52 r">url</span> = <span class="r50 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r53 rd" class="r53 r">title</span> = <span class="r50 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[6].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r54 rd" class="r54 r">result</span>;
 
            <span class="r52 r">url</span> = <a href="#0b0e1bb228cd87a8" class="i method">EncodeProblemUrlChars</a>(<span class="r52 r">url</span>);
            <span class="r52 r">url</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r52 r">url</span>);
            <b>if</b> (<span class="r52 r">url</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;&lt;&quot;</span>) &amp;&amp; <span class="r52 r">url</span>.<a href="@0@mscorlib/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;&gt;&quot;</span>))
                <span class="r52 r">url</span> = <span class="r52 r">url</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(1, <span class="r52 r">url</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 2); <span class="c">// remove &lt;&gt;&#39;s surrounding URL, if present            </span>
 
            <span class="r54 r">result</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&quot;</span>, <span class="r52 r">url</span>);
 
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r53 r">title</span>))
            {
                <span class="r53 r">title</span> = <span class="r53 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
                <span class="r53 r">title</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r53 r">title</span>);
                <span class="r54 r">result</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r53 r">title</span>);
            }
 
            <span class="r54 r">result</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r51 r">linkText</span>);
            <b>return</b> <span class="r54 r">result</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="11354cd5e8a32e5a" href="R/11354cd5e8a32e5a.html" target="n" data-glyph="46,1" class="i field">_imagesRef</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
                    (               # wrap whole match in $1
                    !\[
                        (.*?)       # alt text = $2
                    \]
 
                    [ ]?            # one optional space
                    (?:\n[ ]*)?     # one optional newline followed by spaces
 
                    \[
                        (.*?)       # id = $3
                    \]
 
                    )&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="d5d52da6376cbad9" href="R/d5d52da6376cbad9.html" target="n" data-glyph="46,1" class="i field">_imagesInline</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
              (                     # wrap whole match in $1
                !\[
                    (.*?)           # alt text = $2
                \]
                \s?                 # one optional whitespace character
                \(                  # literal paren
                    [ ]*
                    ({0})           # href = $3
                    [ ]*
                    (               # $4
                    ([&#39;&quot;&quot;])       # quote char = $5
                    (.*?)           # title = $6
                    \5              # matching quote
                    [ ]*
                    )?              # title is optional
                \)
              )&quot;</span>, <a href="#6a0ae1b573bfaa15" class="i method">GetNestedParensPattern</a>()),
                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown image shortcuts into HTML img tags. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ![alt text][id]</span>
        <span class="c">///</span><span class="c"> ![alt text](url &quot;optional title&quot;)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="cf3d181da23fc03e" href="R/cf3d181da23fc03e.html" target="n" data-glyph="76,1" class="i method">DoImages</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r55 rd" class="r55 r">text</span>)
        {
            <span class="c">// First, handle reference-style labeled images: ![alt text][id]</span>
            <span class="r55 r">text</span> = <a href="#11354cd5e8a32e5a" class="i field">_imagesRef</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r55 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#685c7ae27ab40a16" class="i method">ImageReferenceEvaluator</a>));
 
            <span class="c">// Next, handle inline images:  ![alt text](url &quot;optional title&quot;)</span>
            <span class="c">// Don&#39;t forget: encode * and _</span>
            <span class="r55 r">text</span> = <a href="#d5d52da6376cbad9" class="i field">_imagesInline</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r55 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#2400d73fbce31408" class="i method">ImageInlineEvaluator</a>));
 
            <b>return</b> <span class="r55 r">text</span>;
        }
 
        <b>private string</b> <a id="685c7ae27ab40a16" href="R/685c7ae27ab40a16.html" target="n" data-glyph="76,1" class="i method">ImageReferenceEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r56 rd" class="r56 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r57 rd" class="r57 r">wholeMatch</span> = <span class="r56 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r58 rd" class="r58 r">altText</span> = <span class="r56 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r59 rd" class="r59 r">linkID</span> = <span class="r56 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r60 rd" class="r60 r">result</span>;
 
            <span class="c">// for shortcut links like ![this][].</span>
            <b>if</b> (<span class="r59 r">linkID</span> == <span class="s">&quot;&quot;</span>)
                <span class="r59 r">linkID</span> = <span class="r58 r">altText</span>.<a href="@0@mscorlib/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
 
            <span class="r58 r">altText</span> = <span class="r58 r">altText</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
 
            <b>if</b> (<a href="#e23486b81bd45434" class="i field">_urls</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r59 r">linkID</span>))
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r61 rd" class="r61 r">url</span> = <a href="#e23486b81bd45434" class="i field">_urls</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r59 r">linkID</span>];
                <span class="r61 r">url</span> = <a href="#0b0e1bb228cd87a8" class="i method">EncodeProblemUrlChars</a>(<span class="r61 r">url</span>);
                <span class="r61 r">url</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r61 r">url</span>);                
                <span class="r60 r">result</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;img src=\&quot;{0}\&quot; alt=\&quot;{1}\&quot;&quot;</span>, <span class="r61 r">url</span>, <span class="r58 r">altText</span>);
 
                <b>if</b> (<a href="#c72ad66f949807d0" class="i field">_titles</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r59 r">linkID</span>))
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r62 rd" class="r62 r">title</span> = <a href="#c72ad66f949807d0" class="i field">_titles</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r59 r">linkID</span>];
                    <span class="r62 r">title</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r62 r">title</span>);
 
                    <span class="r60 r">result</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r62 r">title</span>);
                }
 
                <span class="r60 r">result</span> += <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a>;
            }
            <b>else</b>
            {
                <span class="c">// If there&#39;s no such link ID, leave intact:</span>
                <span class="r60 r">result</span> = <span class="r57 r">wholeMatch</span>;
            }
 
            <b>return</b> <span class="r60 r">result</span>;
        }
 
        <b>private string</b> <a id="2400d73fbce31408" href="R/2400d73fbce31408.html" target="n" data-glyph="76,1" class="i method">ImageInlineEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r63 rd" class="r63 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r64 rd" class="r64 r">alt</span> = <span class="r63 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r65 rd" class="r65 r">url</span> = <span class="r63 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r66 rd" class="r66 r">title</span> = <span class="r63 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[6].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r67 rd" class="r67 r">result</span>;
 
            <span class="r64 r">alt</span> = <span class="r64 r">alt</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
            <span class="r66 r">title</span> = <span class="r66 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
            
            <b>if</b> (<span class="r65 r">url</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;&lt;&quot;</span>) &amp;&amp; <span class="r65 r">url</span>.<a href="@0@mscorlib/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;&gt;&quot;</span>))
                <span class="r65 r">url</span> = <span class="r65 r">url</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(1, <span class="r65 r">url</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 2);    <span class="c">// Remove &lt;&gt;&#39;s surrounding URL, if present</span>
            <span class="r65 r">url</span> = <a href="#0b0e1bb228cd87a8" class="i method">EncodeProblemUrlChars</a>(<span class="r65 r">url</span>);
            <span class="r65 r">url</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r65 r">url</span>);
 
            <span class="r67 r">result</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;img src=\&quot;{0}\&quot; alt=\&quot;{1}\&quot;&quot;</span>, <span class="r65 r">url</span>, <span class="r64 r">alt</span>);
 
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r66 r">title</span>))
            {
                <span class="r66 r">title</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r66 r">title</span>);
                <span class="r67 r">result</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r66 r">title</span>);
            }
 
            <span class="r67 r">result</span> += <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a>;
 
            <b>return</b> <span class="r67 r">result</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="c3a130bc430292c5" href="R/c3a130bc430292c5.html" target="n" data-glyph="46,1" class="i field">_headerSetext</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
                ^(.+?)
                [ ]*
                \n
                (=+|-+)     # $1 = string of =&#39;s or -&#39;s
                [ ]*
                \n+&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="6d861f8fc22f3eb5" href="R/6d861f8fc22f3eb5.html" target="n" data-glyph="46,1" class="i field">_headerAtx</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
                ^(\#{1,6})  # $1 = string of #&#39;s
                [ ]*
                (.+?)       # $2 = Header text
                [ ]*
                \#*         # optional closing #&#39;s (not counted)
                \n+&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown headers into HTML header tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Header 1  </span>
        <span class="c">///</span><span class="c"> ========  </span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> Header 2  </span>
        <span class="c">///</span><span class="c"> --------  </span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> # Header 1  </span>
        <span class="c">///</span><span class="c"> ## Header 2  </span>
        <span class="c">///</span><span class="c"> ## Header 2 with closing hashes ##  </span>
        <span class="c">///</span><span class="c"> ...  </span>
        <span class="c">///</span><span class="c"> ###### Header 6  </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="da75a675dead0793" href="R/da75a675dead0793.html" target="n" data-glyph="76,1" class="i method">DoHeaders</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r68 rd" class="r68 r">text</span>)
        {
            <span class="r68 r">text</span> = <a href="#c3a130bc430292c5" class="i field">_headerSetext</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r68 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#6bb2d2c721f54552" class="i method">SetextHeaderEvaluator</a>));
            <span class="r68 r">text</span> = <a href="#6d861f8fc22f3eb5" class="i field">_headerAtx</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r68 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#a158266ace33fd41" class="i method">AtxHeaderEvaluator</a>));
            <b>return</b> <span class="r68 r">text</span>;
        }
 
        <b>private string</b> <a id="6bb2d2c721f54552" href="R/6bb2d2c721f54552.html" target="n" data-glyph="76,1" class="i method">SetextHeaderEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r69 rd" class="r69 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r70 rd" class="r70 r">header</span> = <span class="r69 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>int</b> <span id="r71 rd" class="r71 r">level</span> = <span class="r69 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;=&quot;</span>) ? 1 : 2;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;h{1}&gt;{0}&lt;/h{1}&gt;\n\n&quot;</span>, <a href="#2135582728c7d0e8" class="i method">RunSpanGamut</a>(<span class="r70 r">header</span>), <span class="r71 r">level</span>);
        }
 
        <b>private string</b> <a id="a158266ace33fd41" href="R/a158266ace33fd41.html" target="n" data-glyph="76,1" class="i method">AtxHeaderEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r72 rd" class="r72 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r73 rd" class="r73 r">header</span> = <span class="r72 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>int</b> <span id="r74 rd" class="r74 r">level</span> = <span class="r72 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;h{1}&gt;{0}&lt;/h{1}&gt;\n\n&quot;</span>, <a href="#2135582728c7d0e8" class="i method">RunSpanGamut</a>(<span class="r73 r">header</span>), <span class="r74 r">level</span>);
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="3d08644036fd7ada" href="R/3d08644036fd7ada.html" target="n" data-glyph="46,1" class="i field">_horizontalRules</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
            ^[ ]{0,3}         # Leading space
                ([-*_])       # $1: First marker
                (?&gt;           # Repeated marker group
                    [ ]{0,2}  # Zero, one, or two spaces.
                    \1        # Marker character
                ){2,}         # Group repeated at least twice
                [ ]*          # Trailing spaces
                $             # End of line.
            &quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown horizontal rules into HTML hr tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ***  </span>
        <span class="c">///</span><span class="c"> * * *  </span>
        <span class="c">///</span><span class="c"> ---</span>
        <span class="c">///</span><span class="c"> - - -</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="1aa04fc9f77bc925" href="R/1aa04fc9f77bc925.html" target="n" data-glyph="76,1" class="i method">DoHorizontalRules</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r75 rd" class="r75 r">text</span>)
        {
            <b>return</b> <a href="#3d08644036fd7ada" class="i field">_horizontalRules</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r75 r">text</span>, <span class="s">&quot;&lt;hr&quot;</span> + <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a> + <span class="s">&quot;\n&quot;</span>);
        }
 
        <b>private static string</b> <a id="d3e747aeb2f5a1b2" href="R/d3e747aeb2f5a1b2.html" target="n" data-glyph="46,1" class="i field">_wholeList</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">@&quot;
            (                               # $1 = whole list
              (                             # $2
                [ ]{{0,{1}}}
                ({0})                       # $3 = first list item marker
                [ ]+
              )
              (?s:.+?)
              (                             # $4
                  \z
                |
                  \n{{2,}}
                  (?=\S)
                  (?!                       # Negative lookahead for another list item marker
                    [ ]*
                    {0}[ ]+
                  )
              )
            )&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;(?:{0}|{1})&quot;</span>, <a href="#dc40e73210a3176b" class="i field">_markerUL</a>, <a href="#eb166f069877be5a" class="i field">_markerOL</a>), <a href="#70110a422f169059" class="i field">_tabWidth</a> - 1);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="a2c71c26c85092a7" href="R/a2c71c26c85092a7.html" target="n" data-glyph="46,1" class="i field">_listNested</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;^&quot;</span> + <a href="#d3e747aeb2f5a1b2" class="i field">_wholeList</a>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="3234d1a52e130041" href="R/3234d1a52e130041.html" target="n" data-glyph="46,1" class="i field">_listTopLevel</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;(?:(?&lt;=\n\n)|\A\n?)&quot;</span> + <a href="#d3e747aeb2f5a1b2" class="i field">_wholeList</a>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown lists into HTML ul and ol and li tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="b3bd2da3f6b4f8c0" href="R/b3bd2da3f6b4f8c0.html" target="n" data-glyph="76,1" class="i method">DoLists</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r76 rd" class="r76 r">text</span>)
        {
            <span class="c">// We use a different prefix before nested lists than top-level lists.</span>
            <span class="c">// See extended comment in _ProcessListItems().</span>
            <b>if</b> (<a href="#b00253147d515681" class="i field">_listLevel</a> &gt; 0)
                <span class="r76 r">text</span> = <a href="#a2c71c26c85092a7" class="i field">_listNested</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r76 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#d06f79574fdff56a" class="i method">ListEvaluator</a>));
            <b>else</b>
                <span class="r76 r">text</span> = <a href="#3234d1a52e130041" class="i field">_listTopLevel</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r76 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#d06f79574fdff56a" class="i method">ListEvaluator</a>));
 
            <b>return</b> <span class="r76 r">text</span>;
        }
 
        <b>private string</b> <a id="d06f79574fdff56a" href="R/d06f79574fdff56a.html" target="n" data-glyph="76,1" class="i method">ListEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r77 rd" class="r77 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r78 rd" class="r78 r">list</span> = <span class="r77 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r79 rd" class="r79 r">listType</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#ffaf97ebd1d02f3c" class="i method">IsMatch</a>(<span class="r77 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>, <a href="#dc40e73210a3176b" class="i field">_markerUL</a>) ? <span class="s">&quot;ul&quot;</span> : <span class="s">&quot;ol&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r80 rd" class="r80 r">result</span>;
 
            <span class="c">// Turn double returns into triple returns, so that we can make a</span>
            <span class="c">// paragraph for the last item in a list, if necessary:</span>
            <span class="r78 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r78 r">list</span>, <span class="s">@&quot;\n{2,}&quot;</span>, <span class="s">&quot;\n\n\n&quot;</span>);
            <span class="r80 r">result</span> = <a href="#fa3e2ea9d3126b29" class="i method">ProcessListItems</a>(<span class="r78 r">list</span>, <span class="r79 r">listType</span> == <span class="s">&quot;ul&quot;</span> ? <a href="#dc40e73210a3176b" class="i field">_markerUL</a> : <a href="#eb166f069877be5a" class="i field">_markerOL</a>);
 
            <span class="r80 r">result</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;{0}&gt;\n{1}&lt;/{0}&gt;\n&quot;</span>, <span class="r79 r">listType</span>, <span class="r80 r">result</span>);
            <b>return</b> <span class="r80 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Process the contents of a single ordered or unordered list, splitting it</span>
        <span class="c">///</span><span class="c"> into individual list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="fa3e2ea9d3126b29" href="R/fa3e2ea9d3126b29.html" target="n" data-glyph="76,1" class="i method">ProcessListItems</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r81 rd" class="r81 r">list</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r82 rd" class="r82 r">marker</span>)
        {
            <span class="c">// The listLevel global keeps track of when we&#39;re inside a list.</span>
            <span class="c">// Each time we enter a list, we increment it; when we leave a list,</span>
            <span class="c">// we decrement. If it&#39;s zero, we&#39;re not in a list anymore.</span>
 
            <span class="c">// We do this because when we&#39;re not inside a list, we want to treat</span>
            <span class="c">// something like this:</span>
 
            <span class="c">//    I recommend upgrading to version</span>
            <span class="c">//    8. Oops, now this line is treated</span>
            <span class="c">//    as a sub-list.</span>
 
            <span class="c">// As a single paragraph, despite the fact that the second line starts</span>
            <span class="c">// with a digit-period-space sequence.</span>
 
            <span class="c">// Whereas when we&#39;re inside a list (or sub-list), that line will be</span>
            <span class="c">// treated as the start of a sub-list. What a kludge, huh? This is</span>
            <span class="c">// an aspect of Markdown&#39;s syntax that&#39;s hard to parse perfectly</span>
            <span class="c">// without resorting to mind-reading. Perhaps the solution is to</span>
            <span class="c">// change the syntax rules such that sub-lists must start with a</span>
            <span class="c">// starting cardinal number; e.g. &quot;1.&quot; or &quot;a.&quot;.</span>
 
            <a href="#b00253147d515681" class="i field">_listLevel</a>++;
 
            <span class="c">// Trim trailing blank lines:</span>
            <span class="r81 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r81 r">list</span>, <span class="s">@&quot;\n{2,}\z&quot;</span>, <span class="s">&quot;\n&quot;</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r83 rd" class="r83 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(
              <span class="s">@&quot;(\n)?                      # leading line = $1
                (^[ ]*)                    # leading whitespace = $2
                ({0}) [ ]+                 # list marker = $3
                ((?s:.+?)                  # list item text = $4
                (\n{{1,2}}))      
                (?= \n* (\z | \2 ({0}) [ ]+))&quot;</span>, <span class="r82 r">marker</span>);
 
            <span class="r81 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r81 r">list</span>, <span class="r83 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#174caedba752e530" class="i method">ListItemEvaluator</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
            <a href="#b00253147d515681" class="i field">_listLevel</a>--;
            <b>return</b> <span class="r81 r">list</span>;
        }
 
        <b>private string</b> <a id="174caedba752e530" href="R/174caedba752e530.html" target="n" data-glyph="76,1" class="i method">ListItemEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r84 rd" class="r84 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r85 rd" class="r85 r">item</span> = <span class="r84 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[4].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r86 rd" class="r86 r">leadingLine</span> = <span class="r84 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r86 r">leadingLine</span>) || <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#ffaf97ebd1d02f3c" class="i method">IsMatch</a>(<span class="r85 r">item</span>, <span class="s">@&quot;\n{2,}&quot;</span>))
                <span class="c">// we could correct any bad indentation here..</span>
                <span class="r85 r">item</span> = <a href="#c9f66da0652872dc" class="i method">RunBlockGamut</a>(<a href="#9d6cdaed36039689" class="i method">Outdent</a>(<span class="r85 r">item</span>) + <span class="s">&quot;\n&quot;</span>);
            <b>else</b>
            {
                <span class="c">// recursion for sub-lists</span>
                <span class="r85 r">item</span> = <a href="#b3bd2da3f6b4f8c0" class="i method">DoLists</a>(<a href="#9d6cdaed36039689" class="i method">Outdent</a>(<span class="r85 r">item</span>));
                <span class="r85 r">item</span> = <span class="r85 r">item</span>.<a href="@0@mscorlib/A.html#fc988fb267590f98" class="i method">TrimEnd</a>(<span class="s">&#39;\n&#39;</span>);
                <span class="r85 r">item</span> = <a href="#2135582728c7d0e8" class="i method">RunSpanGamut</a>(<span class="r85 r">item</span>);
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;li&gt;{0}&lt;/li&gt;\n&quot;</span>, <span class="r85 r">item</span>);
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="02c0d67d2db96e65" href="R/02c0d67d2db96e65.html" target="n" data-glyph="46,1" class="i field">_codeBlock</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                    (?:\n\n|\A\n?)
                    (                        # $1 = the code block -- one or more lines, starting with a space
                    (?:
                        (?:[ ]{{{0}}})       # Lines must start with a tab-width of spaces
                        .*\n+
                    )+
                    )
                    ((?=^[ ]{{0,{0}}}\S)|\Z) # Lookahead for non-space at line-start, or end of doc&quot;</span>,
                    <a href="#70110a422f169059" class="i field">_tabWidth</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> /// Turn Markdown 4-space indented code into HTML pre code blocks</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="2835c6f169234d0c" href="R/2835c6f169234d0c.html" target="n" data-glyph="76,1" class="i method">DoCodeBlocks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r87 rd" class="r87 r">text</span>)
        {
            <span class="r87 r">text</span> = <a href="#02c0d67d2db96e65" class="i field">_codeBlock</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r87 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#c833ce59c5a6690c" class="i method">CodeBlockEvaluator</a>));
            <b>return</b> <span class="r87 r">text</span>;
        }
 
        <b>private string</b> <a id="c833ce59c5a6690c" href="R/c833ce59c5a6690c.html" target="n" data-glyph="76,1" class="i method">CodeBlockEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r88 rd" class="r88 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r89 rd" class="r89 r">codeBlock</span> = <span class="r88 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
            <span class="r89 r">codeBlock</span> = <a href="#53cfbb220b9b4eb4" class="i method">EncodeCode</a>(<a href="#9d6cdaed36039689" class="i method">Outdent</a>(<span class="r89 r">codeBlock</span>));
            <span class="r89 r">codeBlock</span> = <a href="#cce4b95b7e03ea55" class="i field">_newlinesLeadingTrailing</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r89 r">codeBlock</span>, <span class="s">&quot;&quot;</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;\n\n&lt;pre&gt;&lt;code&gt;&quot;</span>, <span class="r89 r">codeBlock</span>, <span class="s">&quot;\n&lt;/code&gt;&lt;/pre&gt;\n\n&quot;</span>);
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="ab4f0c134191bbc1" href="R/ab4f0c134191bbc1.html" target="n" data-glyph="46,1" class="i field">_codeSpan</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
                    (?&lt;!\\)   # Character before opening ` can&#39;t be a backslash
                    (`+)      # $1 = Opening run of `
                    (.+?)     # $2 = The code block
                    (?&lt;!`)
                    \1
                    (?!`)&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown `code spans` into HTML code tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="d8fad72e1b4f781f" href="R/d8fad72e1b4f781f.html" target="n" data-glyph="76,1" class="i method">DoCodeSpans</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r90 rd" class="r90 r">text</span>)
        {
            <span class="c">//    * You can use multiple backticks as the delimiters if you want to</span>
            <span class="c">//        include literal backticks in the code span. So, this input:</span>
            <span class="c">//</span>
            <span class="c">//        Just type ``foo `bar` baz`` at the prompt.</span>
            <span class="c">//</span>
            <span class="c">//        Will translate to:</span>
            <span class="c">//</span>
            <span class="c">//          &lt;p&gt;Just type &lt;code&gt;foo `bar` baz&lt;/code&gt; at the prompt.&lt;/p&gt;</span>
            <span class="c">//</span>
            <span class="c">//        There&#39;s no arbitrary limit to the number of backticks you</span>
            <span class="c">//        can use as delimters. If you need three consecutive backticks</span>
            <span class="c">//        in your code, use four for delimiters, etc.</span>
            <span class="c">//</span>
            <span class="c">//    * You can use spaces to get literal backticks at the edges:</span>
            <span class="c">//</span>
            <span class="c">//          ... type `` `bar` `` ...</span>
            <span class="c">//</span>
            <span class="c">//        Turns to:</span>
            <span class="c">//</span>
            <span class="c">//          ... type &lt;code&gt;`bar`&lt;/code&gt; ...         </span>
            <span class="c">//</span>
 
            <b>return</b> <a href="#ab4f0c134191bbc1" class="i field">_codeSpan</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r90 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#d2fad3ea98806b53" class="i method">CodeSpanEvaluator</a>));
        }
 
        <b>private string</b> <a id="d2fad3ea98806b53" href="R/d2fad3ea98806b53.html" target="n" data-glyph="76,1" class="i method">CodeSpanEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r91 rd" class="r91 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r92 rd" class="r92 r">span</span> = <span class="r91 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <span class="r92 r">span</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r92 r">span</span>, <span class="s">@&quot;^[ ]*&quot;</span>, <span class="s">&quot;&quot;</span>); <span class="c">// leading whitespace</span>
            <span class="r92 r">span</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r92 r">span</span>, <span class="s">@&quot;[ ]*$&quot;</span>, <span class="s">&quot;&quot;</span>); <span class="c">// trailing whitespace</span>
            <span class="r92 r">span</span> = <a href="#53cfbb220b9b4eb4" class="i method">EncodeCode</a>(<span class="r92 r">span</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;&lt;code&gt;&quot;</span>, <span class="r92 r">span</span>, <span class="s">&quot;&lt;/code&gt;&quot;</span>);
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="0a9875324159d4d3" href="R/0a9875324159d4d3.html" target="n" data-glyph="46,1" class="i field">_bold</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;(\*\*|__) (?=\S) (.+?[*_]*) (?&lt;=\S) \1&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="6a0f6bfdfb9266fd" href="R/6a0f6bfdfb9266fd.html" target="n" data-glyph="46,1" class="i field">_strictBold</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;([\W_]|^) (\*\*|__) (?=\S) ([^\r]*?\S[\*_]*) \2 ([\W_]|$)&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="0ff8473b280a4bf6" href="R/0ff8473b280a4bf6.html" target="n" data-glyph="46,1" class="i field">_italic</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;(\*|_) (?=\S) (.+?) (?&lt;=\S) \1&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="acad8cededee0644" href="R/acad8cededee0644.html" target="n" data-glyph="46,1" class="i field">_strictItalic</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;([\W_]|^) (\*|_) (?=\S) ([^\r\*_]*?\S) \2 ([\W_]|$)&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown *italics* and **bold** into HTML strong and em tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="9c83ac1db51199c1" href="R/9c83ac1db51199c1.html" target="n" data-glyph="76,1" class="i method">DoItalicsAndBold</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r93 rd" class="r93 r">text</span>)
        {
 
            <span class="c">// &lt;strong&gt; must go first, then &lt;em&gt;</span>
            <b>if</b> (<a href="#63dd3d77fe5b4758" class="i field">_strictBoldItalic</a>)
            {
                <span class="r93 r">text</span> = <a href="#6a0f6bfdfb9266fd" class="i field">_strictBold</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r93 r">text</span>, <span class="s">&quot;$1&lt;strong&gt;$3&lt;/strong&gt;$4&quot;</span>);
                <span class="r93 r">text</span> = <a href="#acad8cededee0644" class="i field">_strictItalic</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r93 r">text</span>, <span class="s">&quot;$1&lt;em&gt;$3&lt;/em&gt;$4&quot;</span>);
            }
            <b>else</b>
            {
                <span class="r93 r">text</span> = <a href="#0a9875324159d4d3" class="i field">_bold</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r93 r">text</span>, <span class="s">&quot;&lt;strong&gt;$2&lt;/strong&gt;&quot;</span>);
                <span class="r93 r">text</span> = <a href="#0ff8473b280a4bf6" class="i field">_italic</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r93 r">text</span>, <span class="s">&quot;&lt;em&gt;$2&lt;/em&gt;&quot;</span>);
            }
            <b>return</b> <span class="r93 r">text</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn markdown line breaks (two space at end of line) into HTML break tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="cfb0a3ecbc5b77cf" href="R/cfb0a3ecbc5b77cf.html" target="n" data-glyph="76,1" class="i method">DoHardBreaks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r94 rd" class="r94 r">text</span>)
        {
            <b>if</b> (<a href="#a27d52d1661e231d" class="i field">_autoNewlines</a>)
                <span class="r94 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r94 r">text</span>, <span class="s">@&quot;\n&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;br{0}\n&quot;</span>, <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a>));
            <b>else</b>
                <span class="r94 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r94 r">text</span>, <span class="s">@&quot; {2,}\n&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;br{0}\n&quot;</span>, <a href="#f61b6c7bc7cf3183" class="i field">_emptyElementSuffix</a>));
            <b>return</b> <span class="r94 r">text</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="c5d566c0864db39f" href="R/c5d566c0864db39f.html" target="n" data-glyph="46,1" class="i field">_blockquote</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;
            (                           # Wrap whole match in $1
                (
                ^[ ]*&gt;[ ]?              # &#39;&gt;&#39; at the start of a line
                    .+\n                # rest of the first line
                (.+\n)*                 # subsequent consecutive lines
                \n*                     # blanks
                )+
            )&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown &gt; quoted blocks into HTML blockquote blocks</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="660ff86e98b6dbc9" href="R/660ff86e98b6dbc9.html" target="n" data-glyph="76,1" class="i method">DoBlockQuotes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r95 rd" class="r95 r">text</span>)
        {
            <b>return</b> <a href="#c5d566c0864db39f" class="i field">_blockquote</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r95 r">text</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#e52dac484b831af6" class="i method">BlockQuoteEvaluator</a>));
        }
 
        <b>private string</b> <a id="e52dac484b831af6" href="R/e52dac484b831af6.html" target="n" data-glyph="76,1" class="i method">BlockQuoteEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r96 rd" class="r96 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r97 rd" class="r97 r">bq</span> = <span class="r96 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^[ ]*&gt;[ ]?&quot;</span>, <span class="s">&quot;&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);       <span class="c">// trim one level of quoting</span>
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^[ ]+$&quot;</span>, <span class="s">&quot;&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);           <span class="c">// trim whitespace-only lines</span>
            <span class="r97 r">bq</span> = <a href="#c9f66da0652872dc" class="i method">RunBlockGamut</a>(<span class="r97 r">bq</span>);                                                  <span class="c">// recurse</span>
 
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^&quot;</span>, <span class="s">&quot;  &quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <span class="c">// These leading spaces screw with &lt;pre&gt; content, so we need to fix that:</span>
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;(\s*&lt;pre&gt;.+?&lt;/pre&gt;)&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#825c5433e204999a" class="i method">BlockQuoteEvaluator2</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;blockquote&gt;\n{0}\n&lt;/blockquote&gt;\n\n&quot;</span>, <span class="r97 r">bq</span>);
        }
 
        <b>private string</b> <a id="825c5433e204999a" href="R/825c5433e204999a.html" target="n" data-glyph="76,1" class="i method">BlockQuoteEvaluator2</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r98 rd" class="r98 r">match</span>)
        {
            <b>return</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r98 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>, <span class="s">@&quot;^  &quot;</span>, <span class="s">&quot;&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="60ec112d37eccd02" href="R/60ec112d37eccd02.html" target="n" data-glyph="46,1" class="i field">_autolinkBare</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;(^|\s)(https?|ftp)(://[-A-Z0-9+&amp;@#/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&amp;@#/%=~_|\[\]])($|\W)&quot;</span>,
            <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#8c4a7c494a4050d5" class="i field">IgnoreCase</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn angle-delimited URLs into HTML anchor tags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&amp;lt;</span><span class="c">http://www.example.com</span><span class="c">&amp;gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="2aaf59103ba3bbe2" href="R/2aaf59103ba3bbe2.html" target="n" data-glyph="76,1" class="i method">DoAutoLinks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r99 rd" class="r99 r">text</span>)
        {
 
            <b>if</b> (<a href="#1594d714858db0f5" class="i field">_autoHyperlink</a>)
            {
                <span class="c">// fixup arbitrary URLs by adding Markdown &lt; &gt; so they get linked as well</span>
                <span class="c">// note that at this point, all other URL in the text are already hyperlinked as &lt;a href=&quot;&quot;&gt;&lt;/a&gt;</span>
                <span class="c">// *except* for the &lt;http://www.foo.com&gt; case</span>
                <span class="r99 r">text</span> = <a href="#60ec112d37eccd02" class="i field">_autolinkBare</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r99 r">text</span>, <span class="s">@&quot;$1&lt;$2$3&gt;$4&quot;</span>);
            }
 
            <span class="c">// Hyperlinks: &lt;http://foo.com&gt;</span>
            <span class="r99 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#f6fa3a1296c0770c" class="i method">Replace</a>(<span class="r99 r">text</span>, <span class="s">&quot;&lt;((https?|ftp):[^&#39;\&quot;&gt;\\s]+)&gt;&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#4e2314f2b31869a1" class="i method">HyperlinkEvaluator</a>));
 
            <b>if</b> (<a href="#2c626718250bb423" class="i field">_linkEmails</a>)
            {
                <span class="c">// Email addresses: &lt;address@domain.foo&gt;</span>
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r100 rd" class="r100 r">pattern</span> =
                    <span class="s">@&quot;&lt;
                      (?:mailto:)?
                      (
                        [-.\w]+
                        \@
                        [-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+
                      )
                      &gt;&quot;</span>;
                <span class="r99 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r99 r">text</span>, <span class="r100 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#af5973d9711d1159" class="i method">EmailEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#8c4a7c494a4050d5" class="i field">IgnoreCase</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            }
 
            <b>return</b> <span class="r99 r">text</span>;
        }
 
        <b>private string</b> <a id="4e2314f2b31869a1" href="R/4e2314f2b31869a1.html" target="n" data-glyph="76,1" class="i method">HyperlinkEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r101 rd" class="r101 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r102 rd" class="r102 r">link</span> = <span class="r101 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r102 r">link</span>);
        }
 
        <b>private string</b> <a id="af5973d9711d1159" href="R/af5973d9711d1159.html" target="n" data-glyph="76,1" class="i method">EmailEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r103 rd" class="r103 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r104 rd" class="r104 r">email</span> = <a href="#0c56c3ad9f38da57" class="i method">Unescape</a>(<span class="r103 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
 
            <span class="c">//</span>
            <span class="c">//    Input: an email address, e.g. &quot;foo@example.com&quot;</span>
            <span class="c">//</span>
            <span class="c">//    Output: the email address as a mailto link, with each character</span>
            <span class="c">//            of the address encoded as either a decimal or hex entity, in</span>
            <span class="c">//            the hopes of foiling most address harvesting spam bots. E.g.:</span>
            <span class="c">//</span>
            <span class="c">//      &lt;a href=&quot;&amp;#x6D;&amp;#97;&amp;#105;&amp;#108;&amp;#x74;&amp;#111;:&amp;#102;&amp;#111;&amp;#111;&amp;#64;&amp;#101;</span>
            <span class="c">//        x&amp;#x61;&amp;#109;&amp;#x70;&amp;#108;&amp;#x65;&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&quot;&gt;&amp;#102;&amp;#111;&amp;#111;</span>
            <span class="c">//        &amp;#64;&amp;#101;x&amp;#x61;&amp;#109;&amp;#x70;&amp;#108;&amp;#x65;&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;</span>
            <span class="c">//</span>
            <span class="c">//    Based by a filter by Matthew Wickline, posted to the BBEdit-Talk</span>
            <span class="c">//    mailing list: &lt;http://tinyurl.com/yu7ue&gt;</span>
            <span class="c">//</span>
            <span class="r104 r">email</span> = <span class="s">&quot;mailto:&quot;</span> + <span class="r104 r">email</span>;
 
            <span class="c">// leave &#39;:&#39; alone (to spot mailto: later) </span>
            <span class="r104 r">email</span> = <a href="#b18b0c46cc2b3991" class="i method">EncodeEmailAddress</a>(<span class="r104 r">email</span>);
 
            <span class="r104 r">email</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r104 r">email</span>);
 
            <span class="c">// strip the mailto: from the visible part</span>
            <span class="r104 r">email</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r104 r">email</span>, <span class="s">&quot;\&quot;&gt;.+?:&quot;</span>, <span class="s">&quot;\&quot;&gt;&quot;</span>);
            <b>return</b> <span class="r104 r">email</span>;
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="dd2ed8f1481b84c2" href="R/dd2ed8f1481b84c2.html" target="n" data-glyph="46,1" class="i field">_outDent</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;^[ ]{1,&quot;</span> + <a href="#70110a422f169059" class="i field">_tabWidth</a> + <span class="s">@&quot;}&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remove one level of line-leading spaces</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="9d6cdaed36039689" href="R/9d6cdaed36039689.html" target="n" data-glyph="76,1" class="i method">Outdent</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r105 rd" class="r105 r">block</span>)
        {
            <b>return</b> <a href="#dd2ed8f1481b84c2" class="i field">_outDent</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r105 r">block</span>, <span class="s">&quot;&quot;</span>);
        }
 
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Encoding and Normalization
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> encodes email address randomly  </span>
        <span class="c">///</span><span class="c"> roughly 10% raw, 45% hex, 45% dec </span>
        <span class="c">///</span><span class="c"> note that @ is always encoded and : never is</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="b18b0c46cc2b3991" href="R/b18b0c46cc2b3991.html" target="n" data-glyph="76,1" class="i method">EncodeEmailAddress</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r106 rd" class="r106 r">addr</span>)
        {
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r107 rd" class="r107 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(<span class="r106 r">addr</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> * 5);
            <a href="@0@mscorlib/A.html#bb77e610694e64ca" class="k">var</a> <span id="r108 rd" class="r108 r">rand</span> = <b>new</b> <a href="@0@mscorlib/A.html#5d22f8880fc9f8d9" class="t constructor">Random</a>();
            <b>int</b> <span id="r109 rd" class="r109 r">r</span>;
            <b>foreach</b> (<b>char</b> <span id="r110 rd" class="r110 r">c</span> <b>in</b> <span class="r106 r">addr</span>)
            {
                <span class="r109 r">r</span> = <span class="r108 r">rand</span>.<a href="@0@mscorlib/A.html#ddd1e9e09c70bab5" class="i method">Next</a>(1, 100);
                <b>if</b> ((<span class="r109 r">r</span> &gt; 90 || <span class="r110 r">c</span> == <span class="s">&#39;:&#39;</span>) &amp;&amp; <span class="r110 r">c</span> != <span class="s">&#39;@&#39;</span>)
                    <span class="r107 r">sb</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="r110 r">c</span>);                         <span class="c">// m</span>
                <b>else</b> <b>if</b> (<span class="r109 r">r</span> &lt; 45)
                    <span class="r107 r">sb</span>.<a href="@0@mscorlib/A.html#ad46fb2c09cab59a" class="i method">AppendFormat</a>(<span class="s">&quot;&amp;#x{0:x};&quot;</span>, (<b>int</b>)<span class="r110 r">c</span>); <span class="c">// &amp;#x6D</span>
                <b>else</b>
                    <span class="r107 r">sb</span>.<a href="@0@mscorlib/A.html#ad46fb2c09cab59a" class="i method">AppendFormat</a>(<span class="s">&quot;&amp;#{0};&quot;</span>, (<b>int</b>)<span class="r110 r">c</span>);    <span class="c">// &amp;#109</span>
            }
            <b>return</b> <span class="r107 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="f94cc6c064f9f3d6" href="R/f94cc6c064f9f3d6.html" target="n" data-glyph="46,1" class="i field">_codeEncoder</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;&amp;|&lt;|&gt;|\\|\*|_|\{|\}|\[|\]&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode/escape certain Markdown characters inside code blocks and spans where they are literals</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="53cfbb220b9b4eb4" href="R/53cfbb220b9b4eb4.html" target="n" data-glyph="76,1" class="i method">EncodeCode</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r111 rd" class="r111 r">code</span>)
        {
            <b>return</b> <a href="#f94cc6c064f9f3d6" class="i field">_codeEncoder</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r111 r">code</span>, <a href="#0be1f333a5ebde31" class="i method">EncodeCodeEvaluator</a>);
        }
        <b>private string</b> <a id="0be1f333a5ebde31" href="R/0be1f333a5ebde31.html" target="n" data-glyph="76,1" class="i method">EncodeCodeEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r112 rd" class="r112 r">match</span>)
        {
            <b>switch</b> (<span class="r112 r">match</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>)
            {
                <span class="c">// Encode all ampersands; HTML entities are not</span>
                <span class="c">// entities within a Markdown code span.</span>
                <b>case</b> <span class="s">&quot;&amp;&quot;</span>:
                    <b>return</b> <span class="s">&quot;&amp;amp;&quot;</span>;
                <span class="c">// Do the angle bracket song and dance</span>
                <b>case</b> <span class="s">&quot;&lt;&quot;</span>:
                    <b>return</b> <span class="s">&quot;&amp;lt;&quot;</span>;
                <b>case</b> <span class="s">&quot;&gt;&quot;</span>:
                    <b>return</b> <span class="s">&quot;&amp;gt;&quot;</span>;
                <span class="c">// escape characters that are magic in Markdown</span>
                <b>default</b>:
                    <b>return</b> <a href="#94336f8d8f43700e" class="i field">_escapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r112 r">match</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>];
            }
        }
 
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="2a9423b4e396e518" href="R/2a9423b4e396e518.html" target="n" data-glyph="46,1" class="i field">_amps</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;&amp;(?!(#[0-9]+)|(#[xX][a-fA-F0-9])|([a-zA-Z][a-zA-Z0-9]*);)&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#6bdc9d17fea4f440" class="i field">ExplicitCapture</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="5645d8cdecc9329f" href="R/5645d8cdecc9329f.html" target="n" data-glyph="46,1" class="i field">_angles</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">@&quot;&lt;(?![A-Za-z/?\$!])&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#6bdc9d17fea4f440" class="i field">ExplicitCapture</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode any ampersands (that aren&#39;t part of an HTML entity) and left or right angle brackets</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="e07199c5d085e961" href="R/e07199c5d085e961.html" target="n" data-glyph="76,1" class="i method">EncodeAmpsAndAngles</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r113 rd" class="r113 r">s</span>)
        {
            <span class="r113 r">s</span> = <a href="#2a9423b4e396e518" class="i field">_amps</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r113 r">s</span>, <span class="s">&quot;&amp;amp;&quot;</span>);
            <span class="r113 r">s</span> = <a href="#5645d8cdecc9329f" class="i field">_angles</a>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r113 r">s</span>, <span class="s">&quot;&amp;lt;&quot;</span>);
            <b>return</b> <span class="r113 r">s</span>;
        }
 
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="d7c07fe4c6961708" href="R/d7c07fe4c6961708.html" target="n" data-glyph="46,1" class="i field">_backslashEscapes</a>; 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encodes any escaped characters such as \`, \*, \[ etc</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="a79a77d98c62e661" href="R/a79a77d98c62e661.html" target="n" data-glyph="76,1" class="i method">EscapeBackslashes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r114 rd" class="r114 r">s</span>)
        {
            <b>return</b> <a href="#d7c07fe4c6961708" class="i field">_backslashEscapes</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r114 r">s</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#f43a0e22fbb2635a" class="i method">EscapeBackslashesEvaluator</a>));
        }
        <b>private string</b> <a id="f43a0e22fbb2635a" href="R/f43a0e22fbb2635a.html" target="n" data-glyph="76,1" class="i method">EscapeBackslashesEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r115 rd" class="r115 r">match</span>)
        {
            <b>return</b> <a href="#17fe198196f17f2b" class="i field">_backslashEscapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r115 r">match</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>];
        }
       
        <b>private static</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <a id="caf681bfab859ead" href="R/caf681bfab859ead.html" target="n" data-glyph="46,1" class="i field">_unescapes</a> = <b>new</b> <a href="@0@System/A.html#b3bb3375cf8e8736" class="t constructor">Regex</a>(<span class="s">&quot;\x1A\\d+\x1A&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#469792903a91e65e" class="i field">Compiled</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> swap back in all the special characters we&#39;ve hidden</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0c56c3ad9f38da57" href="R/0c56c3ad9f38da57.html" target="n" data-glyph="76,1" class="i method">Unescape</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r116 rd" class="r116 r">s</span>)
        {
            <b>return</b> <a href="#caf681bfab859ead" class="i field">_unescapes</a>.<a href="@0@System/A.html#70f9f3d109fc80a4" class="i method">Replace</a>(<span class="r116 r">s</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#a9cfe5c98cb08042" class="i method">UnescapeEvaluator</a>));
        }
        <b>private string</b> <a id="a9cfe5c98cb08042" href="R/a9cfe5c98cb08042.html" target="n" data-glyph="76,1" class="i method">UnescapeEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r117 rd" class="r117 r">match</span>)
        {
            <b>return</b> <a href="#92b71d9d86a9ffab" class="i field">_invertedEscapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r117 r">match</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>];
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> escapes Bold [ * ] and Italic [ _ ] characters</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0a60ff6cff6adfc6" href="R/0a60ff6cff6adfc6.html" target="n" data-glyph="76,1" class="i method">EscapeBoldItalic</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r118 rd" class="r118 r">s</span>)
        {
            <span class="r118 r">s</span> = <span class="r118 r">s</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#94336f8d8f43700e" class="i field">_escapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="s">&quot;*&quot;</span>]);
            <span class="r118 r">s</span> = <span class="r118 r">s</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#94336f8d8f43700e" class="i field">_escapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="s">&quot;_&quot;</span>]);
            <b>return</b> <span class="r118 r">s</span>;
        }
 
        <b>private static char</b>[] <a id="b9cb1bdf95224eb6" href="R/b9cb1bdf95224eb6.html" target="n" data-glyph="46,1" class="i field">_problemUrlChars</a> = <span class="s">@&quot;&quot;&quot;&#39;*()[]$:&quot;</span>.<a href="@0@mscorlib/A.html#81c2d980f5d0ee35" class="i method">ToCharArray</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> hex-encodes some unusual &quot;problem&quot; chars in URLs to avoid URL detection problems </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0b0e1bb228cd87a8" href="R/0b0e1bb228cd87a8.html" target="n" data-glyph="76,1" class="i method">EncodeProblemUrlChars</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r119 rd" class="r119 r">url</span>)
        {
            <b>if</b> (!<a href="#93d9d9146a574451" class="i field">_encodeProblemUrlCharacters</a>) <b>return</b> <span class="r119 r">url</span>;
 
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r120 rd" class="r120 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(<span class="r119 r">url</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
            <b>bool</b> <span id="r121 rd" class="r121 r">encode</span>;
            <b>char</b> <span id="r122 rd" class="r122 r">c</span>;
 
            <b>for</b> (<b>int</b> <span id="r123 rd" class="r123 r">i</span> = 0; <span class="r123 r">i</span> &lt; <span class="r119 r">url</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>; <span class="r123 r">i</span>++)
            {
                <span class="r122 r">c</span> = <span class="r119 r">url</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r123 r">i</span>];
                <span class="r121 r">encode</span> = <a href="@0@mscorlib/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@0@mscorlib/A.html#9dfd2c89c8d18414" class="i method">IndexOf</a>(<a href="#b9cb1bdf95224eb6" class="i field">_problemUrlChars</a>, <span class="r122 r">c</span>) != -1;
                <b>if</b> (<span class="r121 r">encode</span> &amp;&amp; <span class="r122 r">c</span> == <span class="s">&#39;:&#39;</span> &amp;&amp; <span class="r123 r">i</span> &lt; <span class="r119 r">url</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1)
                    <span class="r121 r">encode</span> = !(<span class="r119 r">url</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r123 r">i</span> + 1] == <span class="s">&#39;/&#39;</span>) &amp;&amp; !(<span class="r119 r">url</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r123 r">i</span> + 1] &gt;= <span class="s">&#39;0&#39;</span> &amp;&amp; <span class="r119 r">url</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r123 r">i</span> + 1] &lt;= <span class="s">&#39;9&#39;</span>);
 
                <b>if</b> (<span class="r121 r">encode</span>)
                    <span class="r120 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;%&quot;</span> + <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;{0:x}&quot;</span>, (<b>byte</b>)<span class="r122 r">c</span>));
                <b>else</b>
                    <span class="r120 r">sb</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="r122 r">c</span>);                
            }
 
            <b>return</b> <span class="r120 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Within tags -- meaning between </span><span class="c">&amp;lt;</span><span class="c"> and </span><span class="c">&amp;gt;</span><span class="c"> -- encode [\ ` * _] so they </span>
        <span class="c">///</span><span class="c"> don&#39;t conflict with their use in Markdown for code, italics and strong. </span>
        <span class="c">///</span><span class="c"> We&#39;re replacing each such character with its corresponding hash </span>
        <span class="c">///</span><span class="c"> value; this is likely overkill, but it should prevent us from colliding </span>
        <span class="c">///</span><span class="c"> with the escape values by accident.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="ddfbf9be255c031d" href="R/ddfbf9be255c031d.html" target="n" data-glyph="76,1" class="i method">EscapeSpecialCharsWithinTagAttributes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r124 rd" class="r124 r">text</span>)
        {
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r125 rd" class="r125 r">tokens</span> = <a href="#0c4b2bc28e5ac5a0" class="i method">TokenizeHTML</a>(<span class="r124 r">text</span>);
 
            <span class="c">// now, rebuild text from the tokens</span>
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r126 rd" class="r126 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(<span class="r124 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
 
            <b>foreach</b> (<a href="#808ab6fb92c55207" class="k">var</a> <span id="r127 rd" class="r127 r">token</span> <b>in</b> <span class="r125 r">tokens</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r128 rd" class="r128 r">value</span> = <span class="r127 r">token</span>.<a href="#f57db0e9ff94e05a" class="i field">Value</a>;
 
                <b>if</b> (<span class="r127 r">token</span>.<a href="#7b9358e77af82cac" class="i field">Type</a> == <a href="#f4b572ef26981c44" class="t t">TokenType</a>.<a href="#8b4ba131ad2191cd" class="i field">Tag</a>)
                {
                    <span class="r128 r">value</span> = <span class="r128 r">value</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">@&quot;\&quot;</span>, <a href="#94336f8d8f43700e" class="i field">_escapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="s">@&quot;\&quot;</span>]);
                    <span class="r128 r">value</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r128 r">value</span>, <span class="s">&quot;(?&lt;=.)&lt;/?code&gt;(?=.)&quot;</span>, <a href="#94336f8d8f43700e" class="i field">_escapeTable</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="s">@&quot;`&quot;</span>]);
                    <span class="r128 r">value</span> = <a href="#0a60ff6cff6adfc6" class="i method">EscapeBoldItalic</a>(<span class="r128 r">value</span>);
                }
 
                <span class="r126 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r128 r">value</span>);
            }
 
            <b>return</b> <span class="r126 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> convert all tabs to _tabWidth spaces; </span>
        <span class="c">///</span><span class="c"> standardizes line endings from DOS (CR LF) or Mac (CR) to UNIX (LF); </span>
        <span class="c">///</span><span class="c"> makes sure text ends with a couple of newlines; </span>
        <span class="c">///</span><span class="c"> removes any blank lines (only spaces) in the text</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="ea4a6b283ed0bdea" href="R/ea4a6b283ed0bdea.html" target="n" data-glyph="76,1" class="i method">Normalize</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r129 rd" class="r129 r">text</span>)
        {            
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r130 rd" class="r130 r">output</span> = <b>new</b> <a href="@0@mscorlib/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(<span class="r129 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r131 rd" class="r131 r">line</span> = <b>new</b> <a href="@0@mscorlib/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
            <b>bool</b> <span id="r132 rd" class="r132 r">valid</span> = <b>false</b>;
 
            <b>for</b> (<b>int</b> <span id="r133 rd" class="r133 r">i</span> = 0; <span class="r133 r">i</span> &lt; <span class="r129 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>; <span class="r133 r">i</span>++)
            {
                <b>switch</b> (<span class="r129 r">text</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r133 r">i</span>])
                {
                    <b>case</b> <span class="s">&#39;\n&#39;</span>:
                        <b>if</b> (<span class="r132 r">valid</span>) <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#7685cb28f3648166" class="i method">Append</a>(<span class="r131 r">line</span>);
                        <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;\n&#39;</span>);
                        <span class="r131 r">line</span>.<a href="@0@mscorlib/A.html#7d7729bd88adac53" class="i property">Length</a> = 0; <span class="r132 r">valid</span> = <b>false</b>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&#39;\r&#39;</span>:
                        <b>if</b> ((<span class="r133 r">i</span> &lt; <span class="r129 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1) &amp;&amp; (<span class="r129 r">text</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r133 r">i</span> + 1] != <span class="s">&#39;\n&#39;</span>))
                        {
                            <b>if</b> (<span class="r132 r">valid</span>) <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#7685cb28f3648166" class="i method">Append</a>(<span class="r131 r">line</span>);
                            <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;\n&#39;</span>);
                            <span class="r131 r">line</span>.<a href="@0@mscorlib/A.html#7d7729bd88adac53" class="i property">Length</a> = 0; <span class="r132 r">valid</span> = <b>false</b>;
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&#39;\t&#39;</span>:
                        <b>int</b> <span id="r134 rd" class="r134 r">width</span> = (<a href="#70110a422f169059" class="i field">_tabWidth</a> - <span class="r131 r">line</span>.<a href="@0@mscorlib/A.html#7d7729bd88adac53" class="i property">Length</a> % <a href="#70110a422f169059" class="i field">_tabWidth</a>);
                        <b>for</b> (<b>int</b> <span id="r135 rd" class="r135 r">k</span> = 0; <span class="r135 r">k</span> &lt; <span class="r134 r">width</span>; <span class="r135 r">k</span>++)
                            <span class="r131 r">line</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39; &#39;</span>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&#39;\x1A&#39;</span>:
                        <b>break</b>;
                    <b>default</b>:
                        <b>if</b> (!<span class="r132 r">valid</span> &amp;&amp; <span class="r129 r">text</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r133 r">i</span>] != <span class="s">&#39; &#39;</span>) <span class="r132 r">valid</span> = <b>true</b>;
                        <span class="r131 r">line</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="r129 r">text</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r133 r">i</span>]);
                        <b>break</b>;
                }
            }
 
            <b>if</b> (<span class="r132 r">valid</span>) <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#7685cb28f3648166" class="i method">Append</a>(<span class="r131 r">line</span>);
            <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;\n&#39;</span>);
 
            <span class="c">// add two newlines to the end before return</span>
            <b>return</b> <span class="r130 r">output</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;\n\n&quot;</span>).<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> this is to emulate what&#39;s evailable in PHP</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="36a4a6921cfe84c9" href="R/36a4a6921cfe84c9.html" target="n" data-glyph="76,1" class="i method">RepeatString</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r136 rd" class="r136 r">text</span>, <b>int</b> <span id="r137 rd" class="r137 r">count</span>)
        {
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r138 rd" class="r138 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(<span class="r136 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> * <span class="r137 r">count</span>);
            <b>for</b> (<b>int</b> <span id="r139 rd" class="r139 r">i</span> = 0; <span class="r139 r">i</span> &lt; <span class="r137 r">count</span>; <span class="r139 r">i</span>++)
                <span class="r138 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r136 r">text</span>);
            <b>return</b> <span class="r138 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
    }
}</pre></td></tr></table></div></body></html>
