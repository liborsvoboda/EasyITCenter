<!DOCTYPE html>
<html><head><title>CoreOperations.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(206);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EasyITcenter-HELP/ServerCore/Operations/CoreOperations.cs" target="_top">ServerCore\Operations\CoreOperations.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EasyITcenter-HELP" target="_top">HelpProjects\EasyITcenter-HELP\EasyITcenter-HELP.csproj</a> (EasyITcenter-HELP)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Mail</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
 
<b>namespace</b> <span class="i n">EasyITCenter</span>.<span class="i n">ServerCoreStructure</span> {
 
    <b>public static class</b> <a id="a55b94e701f24326" href="../../R/a55b94e701f24326.html" target="n" data-glyph="0,0" class="t t">CoreOperations</a> {
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sends the mass mail.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">mailRequests</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The mail requests.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="498b348bcd6a59af" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SendMassEmail</a>(<span class="t t">List</span>&lt;<a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t t">MailRequest</a>&gt; <span id="r0 rd" class="r0 r">mailRequests</span>) {
            <span class="r0 r">mailRequests</span>.<span class="i method">ForEach</span>(<span id="r1 rd" class="r1 r">mailRequest</span> =&gt; { <a href="#ac62fb219a785dd3" class="i method">SendEmail</a>(<span class="r1 r">mailRequest</span>, <b>true</b>); });
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> System Mailer sending Emails To service email with detected fail for analyze and</span>
        <span class="c">///</span><span class="c"> corrections on the Way provide better services every time !!! This You can implement</span>
        <span class="c">///</span><span class="c"> everywhere, !!! In Debug mode is written to Console, in Release will be sent email Empty</span>
        <span class="c">///</span><span class="c"> Sender And Recipients set email for Service Recipient</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">mailRequest</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">    </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">sendImmediately</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="ac62fb219a785dd3" href="../../R/ac62fb219a785dd3.html" target="n" data-glyph="72,1" class="i method">SendEmail</a>(<a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t t">MailRequest</a> <span id="r2 rd" class="r2 r">mailRequest</span>, <b>bool</b> <span id="r3 rd" class="r3 r">sendImmediately</span> = <b>false</b>) {
            <b>try</b> {
                <b>if</b> ((!<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#c6b274c5fb9a0664" class="i property">DebugMode</a> &amp;&amp; !<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#d484a4ec71f850ab" class="i property">ConfigLogWarnPlusToDbEnabled</a>) || <span class="r3 r">sendImmediately</span>) {
                    <b>if</b> (<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#df65374f4422901c" class="i property">ServiceCoreCheckerEmailSenderActive</a> || <span class="r3 r">sendImmediately</span>) {
                        <span class="t t">MailMessage</span> <span id="r4 rd" class="r4 r">Email</span> = <b>new</b>() { <span class="i property">From</span> = <b>new</b> <span class="t constructor">MailAddress</span>(<span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#7c37b3d55e8af25c" class="i property">Sender</a> ?? <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#5fa614712b013493" class="i property">EmailerSMTPLoginUsername</a>) };
 
                        <b>if</b> (<span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#a391f784cb56ad6c" class="i property">Recipients</a> != <b>null</b> &amp;&amp; <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#a391f784cb56ad6c" class="i property">Recipients</a>.<span class="i method">Any</span>()) { <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#a391f784cb56ad6c" class="i property">Recipients</a>.<span class="i method">ForEach</span>(<span id="r5 rd" class="r5 r">email</span> =&gt; { <span class="r4 r">Email</span>.<span class="i property">To</span>.<span class="i method">Add</span>(<span class="r5 r">email</span>); }); }
                        <b>else</b> { <span class="r4 r">Email</span>.<span class="i property">To</span>.<span class="i method">Add</span>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#08642b0aa428675f" class="i property">EmailerServiceEmailAddress</a>); }
 
                        <span class="r4 r">Email</span>.<span class="i property">Subject</span> = <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#8f744c8d64616564" class="i property">Subject</a> ?? <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#df12387ffd1b520a" class="i property">ConfigCoreServerRegisteredName</a>;
                        <span class="r4 r">Email</span>.<span class="i property">Body</span> = <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a>;
                        <span class="r4 r">Email</span>.<span class="i property">IsBodyHtml</span> = <b>true</b>;
 
                        <span class="t t">SmtpClient</span> <span id="r6 rd" class="r6 r">MailClient</span> = <b>new</b>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#4607dd9e374891bc" class="i property">EmailerSMTPServerAddress</a>, <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#2920a1ae646202f7" class="i property">EmailerSMTPPort</a>) {
                            <span class="i property">Credentials</span> = <b>new</b> <span class="i">NetworkCredential</span>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#5fa614712b013493" class="i property">EmailerSMTPLoginUsername</a>, <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#73effa95a15a4f56" class="i property">EmailerSMTPLoginPassword</a>),
                            <span class="i property">EnableSsl</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#28777f4fa85aef9f" class="i property">EmailerSMTPSslIsEnabled</a>,
                            <span class="i property">Host</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#4607dd9e374891bc" class="i property">EmailerSMTPServerAddress</a>,
                            <span class="i property">Port</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#2920a1ae646202f7" class="i property">EmailerSMTPPort</a>
                        };
                        <span class="r6 r">MailClient</span>.<span class="i property">Timeout</span> = 5000;
                        <span class="r6 r">MailClient</span>.<span class="i method">SendAsync</span>(<span class="r4 r">Email</span>, <a href="@1@System.Runtime/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@System.Runtime/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@1@System.Runtime/A.html#a6547a472def7796" class="i method">ToString</a>());
                    }
                }
                <b>else</b> {
                    <b>if</b> (<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#d484a4ec71f850ab" class="i property">ConfigLogWarnPlusToDbEnabled</a> &amp;&amp; <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> != <b>null</b> &amp;&amp;
                        !<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#ea4c0128cfccd991" class="i field">ServerRestartRequest</a> &amp;&amp; <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#e0dbbb5577682e9d" class="i field">ServerCoreStatus</a> == <a href="../Classes/ServerCoreClassesDefinitions.cs.html#4cc3aa46754eee66" class="t t">ServerStatuses</a>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#ee947d78a976688d" class="i field">Running</a>.<a href="@1@System.Runtime/A.html#1365cfeffd45409d" class="i method">ToString</a>()) {
                        <span class="i">SolutionFailList</span> <span id="r7 rd" class="r7 r">SolutionFailList</span> = <b>new</b> <span class="i">SolutionFailList</span>() { <span class="i">UserId</span> = <b>null</b>, <span class="i">Source</span> = <span class="s">&quot;Server&quot;</span>, <span class="i">Message</span> = <span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a>, <span class="i">LogLevel</span> = <b>null</b>, <span class="i">UserName</span> = <b>null</b> };
                        <b>new</b> <span class="i">EasyITCenterContext</span>().<span class="i">SolutionFailLists</span>.<span class="i">Add</span>(<span class="r7 r">SolutionFailList</span>).<span class="i">Context</span>.<span class="i">SaveChanges</span>();
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a>); <span class="i">Debug</span>.<span class="i">WriteLine</span>(<span class="r2 r">mailRequest</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a>);
                    }
                }
                <b>return</b> <span class="i">DBResult</span>.<span class="i">success</span>.<span class="i">ToString</span>();
            } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r8 rd" class="r8 r">ex</span>) {
                <b>return</b> <span class="i">DBResult</span>.<span class="i">error</span>.<span class="i">ToString</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the self signed certificate For API Security HTTPS.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">password</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The password.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">X509Certificate2</span> <a id="ceb0c1aa8aafc7a8" href="../../R/ceb0c1aa8aafc7a8.html" target="n" data-glyph="72,1" class="i method">GetSelfSignedCertificate</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">password</span>) {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r10 rd" class="r10 r">commonName</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#896e4fec836d8320" class="i property">ConfigCertificateDomain</a>;
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r11 rd" class="r11 r">rsaKeySize</span> = 2048;
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r12 rd" class="r12 r">years</span> = 10;
            <b>var</b> <span id="r13 rd" class="r13 r">hashAlgorithm</span> = <span class="i">HashAlgorithmName</span>.<span class="i">SHA256</span>;
 
            <b>using</b> (<b>var</b> <span id="r14 rd" class="r14 r">rsa</span> = <span class="i">RSA</span>.<span class="i">Create</span>(<span class="r11 r">rsaKeySize</span>)) {
                <b>var</b> <span id="r15 rd" class="r15 r">request</span> = <b>new</b> <span class="i">CertificateRequest</span>(<span class="s">$&quot;</span><span class="s">cn=</span>{<span class="r10 r">commonName</span>}<span class="s">&quot;</span>, <span class="r14 r">rsa</span>, <span class="r13 r">hashAlgorithm</span>, <span class="i">RSASignaturePadding</span>.<span class="i">Pkcs1</span>);
 
                <span class="i">SubjectAlternativeNameBuilder</span> <span id="r16 rd" class="r16 r">subjectAlternativeNameBuilder</span> = <b>new</b>();
                <span class="r16 r">subjectAlternativeNameBuilder</span>.<span class="i">AddDnsName</span>(<span class="i">Assembly</span>.<span class="i">GetExecutingAssembly</span>().<span class="i">GetName</span>().<span class="i">FullName</span>);
 
                <span class="i">X509BasicConstraintsExtension</span> <span id="r17 rd" class="r17 r">extension</span> = <b>new</b>();
 
                <span class="r15 r">request</span>.<span class="i">CertificateExtensions</span>.<span class="i">Add</span>(
                  <b>new</b> <span class="i">X509KeyUsageExtension</span>(<span class="i">X509KeyUsageFlags</span>.<span class="i">DataEncipherment</span> | <span class="i">X509KeyUsageFlags</span>.<span class="i">KeyEncipherment</span> | <span class="i">X509KeyUsageFlags</span>.<span class="i">DigitalSignature</span> | <span class="i">X509KeyUsageFlags</span>.<span class="i">KeyCertSign</span>, <b>false</b>)
                );
 
                <span class="r15 r">request</span>.<span class="i">CertificateExtensions</span>.<span class="i">Add</span>(
                  <b>new</b> <span class="i">X509EnhancedKeyUsageExtension</span>(
                    <b>new</b> <span class="i">OidCollection</span> { <b>new</b> <span class="i">Oid</span>(<span class="s">&quot;1.3.6.1.5.5.7.3.1&quot;</span>), <b>new</b> <span class="i">Oid</span>(<span class="s">&quot;1.3.6.1.5.5.7.3.2&quot;</span>) }, <b>false</b>)
                );
 
                <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r18 rd" class="r18 r">notAfter</span> = <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@System.Runtime/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@1@System.Runtime/A.html#b67a36522c868c9f" class="i method">AddYears</a>(<span class="r12 r">years</span>);
                <b>var</b> <span id="r19 rd" class="r19 r">certificate</span> = <span class="r15 r">request</span>.<span class="i">CreateSelfSigned</span>(<a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@System.Runtime/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@1@System.Runtime/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(-1), <span class="r18 r">notAfter</span>);
                <b>if</b> (<a href="#2669f9bbfcbdda4c" class="t t">GetOperatingSystemInfo</a>.<a href="#533a018ad73bad9a" class="i method">IsWindows</a>()) { <span class="r19 r">certificate</span>.<span class="i">FriendlyName</span> = <span class="i">Assembly</span>.<span class="i">GetExecutingAssembly</span>().<span class="i">GetName</span>().<span class="i">FullName</span>; }
 
                <b>try</b> { <span class="c">//Saving Autogenerate Certificate</span>
                    <b>byte</b>[] <span id="r20 rd" class="r20 r">exportedData</span> = <span class="r19 r">certificate</span>.<span class="i">Export</span>(<span class="i">X509ContentType</span>.<span class="i">Pfx</span>, <span class="r9 r">password</span>);
                    <a href="@1@System.Runtime/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@1@System.Runtime/A.html#3ee06d70517eea0b" class="i method">WriteAllBytes</a>(<span class="i n">System</span>.<span class="i n">IO</span>.<a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#b24651eb14e8aa68" class="i method">Combine</a>(<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#5d21a2d6ecd0ad6f" class="i property">Startup_path</a>, <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b16e0ea33c87fc5b" class="i property">DataPath</a>, <span class="s">&quot;ServerAutoCertificate.pfx&quot;</span>), <span class="r20 r">exportedData</span>);
                } <b>catch</b> { }
 
                <b>return</b> <b>new</b> <span class="i">X509Certificate2</span>(<span class="r19 r">certificate</span>.<span class="i">Export</span>(<span class="i">X509ContentType</span>.<span class="i">Pfx</span>, <span class="r9 r">password</span>), <span class="r9 r">password</span>, <span class="i">X509KeyStorageFlags</span>.<span class="i">Exportable</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set Imported Certificate from file on Server for Https File must has Valid path from</span>
        <span class="c">///</span><span class="c"> Startup Data Path</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">X509Certificate2</span> <a id="f33daaafb145b4d3" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetSelfSignedCertificateFromFile</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">FileNameFromDataPath</span>) {
            <b>byte</b>[]? <span id="r22 rd" class="r22 r">certificate</span> = <b>null</b>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r23 rd" class="r23 r">password</span> = <b>null</b>;
            <b>try</b> {
                <span class="r22 r">certificate</span> = <a href="@1@System.Runtime/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@1@System.Runtime/A.html#ee8033fcb7e7a677" class="i method">ReadAllBytes</a>(<span class="i n">System</span>.<span class="i n">IO</span>.<a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#b24651eb14e8aa68" class="i method">Combine</a>(<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#5d21a2d6ecd0ad6f" class="i property">Startup_path</a>, <a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b22b05b0ecb479ff" class="t t">ServerRuntimeData</a>.<a href="../Classes/ServerCoreRuntimeDefinitions.cs.html#b16e0ea33c87fc5b" class="i property">DataPath</a>, <span class="r21 r">FileNameFromDataPath</span>));
                <span class="r23 r">password</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#d31629df2a7e60a6" class="i property">ConfigCertificatePassword</a>;
                <b>return</b> <b>new</b> <span class="i">X509Certificate2</span>(<span class="r22 r">certificate</span>, <span class="r23 r">password</span>);
            } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r24 rd" class="r24 r">Ex</span>) { <a href="#ac62fb219a785dd3" class="i method">SendEmail</a>(<b>new</b> <a href="../Classes/ServerCoreClassesDefinitions.cs.html#580b6a6b65ebdd43" class="t constructor">MailRequest</a>() { <a href="../Classes/ServerCoreClassesDefinitions.cs.html#b6cd5c8e7062c3c3" class="i property">Content</a> = <span class="s">&quot;Incorrect Certificate Path or Password, &quot;</span> + <a href="DataOperations.cs.html#af32a54ca0919c6e" class="t t">DataOperations</a>.<a href="DataOperations.cs.html#05cbf8c12b2d9dca" class="i method">GetSystemErrMessage</a>(<span class="r24 r">Ex</span>) }); }
            <b>return</b> <a href="#ceb0c1aa8aafc7a8" class="i method">GetSelfSignedCertificate</a>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#d31629df2a7e60a6" class="i property">ConfigCertificatePassword</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calls the GET API URL with string Response</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The URL.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="2115723eb807c542" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CallGetApiUrl</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r25 rd" class="r25 r">url</span>) {
            <span class="t t">HttpClient</span> <span id="r26 rd" class="r26 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>();
            <b>return</b> <b>await</b> <span class="r26 r">httpClient</span>.<span class="i method">GetStringAsync</span>(<span class="r25 r">url</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Server Function For Running External Processes</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">processDefinition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The process definition.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="3296d6d1f949dc8b" href="../../R/3296d6d1f949dc8b.html" target="n" data-glyph="72,1" class="i method">RunSystemProcess</a>(<a href="../Classes/ServerCoreClassesDefinitions.cs.html#77b0afbc7a35cb8f" class="t t">ProcessClass</a> <span id="r27 rd" class="r27 r">processDefinition</span>) {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">resultOutput</span> = <span class="s">&quot;&quot;</span>, <span id="r29 rd" class="r29 r">resultError</span> = <span class="s">&quot;&quot;</span>;
 
            <b>try</b> {
                <b>using</b> (<span class="i">Process</span> <span id="r30 rd" class="r30 r">proc</span> = <b>new</b> <span class="i">Process</span>()) {
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">FileName</span> = <span class="r27 r">processDefinition</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#04ea8e400cb3a00a" class="i property">Command</a>;
                    <b>if</b> (<a href="#2669f9bbfcbdda4c" class="t t">GetOperatingSystemInfo</a>.<a href="#533a018ad73bad9a" class="i method">IsWindows</a>()) { <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">WorkingDirectory</span> = <span class="r27 r">processDefinition</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#6e7a0a60801d61b2" class="i property">WorkingDirectory</a> + <span class="s">&quot;\\&quot;</span> ?? <b>null</b>; }
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">Arguments</span> = <span class="r27 r">processDefinition</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#f7ee48cc77ee85a1" class="i property">Arguments</a> ?? <b>null</b>;
                    <span class="c">//proc.StartInfo.LoadUserProfile = false;</span>
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">CreateNoWindow</span> = <b>true</b>;
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">UseShellExecute</span> = <b>false</b>;
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">WindowStyle</span> = <span class="i">ProcessWindowStyle</span>.<span class="i">Hidden</span>;
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span> = <b>true</b>;
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span> = <b>true</b>;
                    <span class="r30 r">proc</span>.<span class="i">StartInfo</span>.<span class="i">Verb</span> = (<a href="@1@System.Runtime/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@1@System.Runtime/A.html#67900ccbbcff63a2" class="i property">OSVersion</a>.<a href="@1@System.Runtime/A.html#7ed000628190bd24" class="i property">Version</a>.<a href="@1@System.Runtime/A.html#22e3177b6b55f6bc" class="i property">Major</a> &gt;= 6) ? <span class="s">&quot;runas&quot;</span> : <span class="s">&quot;&quot;</span>;
                    <span class="r30 r">proc</span>.<span class="i">Start</span>();
 
                    <span class="r28 r">resultOutput</span> += <span class="r30 r">proc</span>.<span class="i">StandardOutput</span>.<span class="i">ReadToEnd</span>();
                    <span class="r29 r">resultError</span> += <span class="r30 r">proc</span>.<span class="i">StandardError</span>.<span class="i">ReadToEnd</span>();
 
                    <b>if</b> (<span class="r27 r">processDefinition</span>.<a href="../Classes/ServerCoreClassesDefinitions.cs.html#15303e83ab27b800" class="i field">WaitForExit</a>) { <span class="r30 r">proc</span>.<span class="i">WaitForExit</span>(); }
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="r29 r">resultError</span>);
                }
                <b>return</b> <b>true</b>;
            } <b>catch</b> { }
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Server Token Validation Parameters definition For Api is Used if is ON/Off for Api is On everyTime</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">TokenValidationParameters</span> <a id="89b513cd305e0b09" href="../../R/89b513cd305e0b09.html" target="n" data-glyph="72,1" class="i method">ValidAndGetTokenParameters</a>() {
            <b>return</b> <b>new</b> <span class="i">TokenValidationParameters</span> {
                <span class="i">ValidateIssuerSigningKey</span> = <b>true</b>,
                <span class="i">IssuerSigningKey</span> = <b>new</b> <span class="i">SymmetricSecurityKey</span>(<span class="i">Encoding</span>.<span class="i">ASCII</span>.<span class="i">GetBytes</span>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#2db2bf5bee8310b6" class="i property">ConfigJwtLocalKey</a>)),
                <span class="i">ValidateIssuer</span> = <b>false</b>,
                <span class="i">ValidateAudience</span> = <b>false</b>,
                <span class="i">ValidateLifetime</span> = <a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#93fbbb716102dbac" class="i property">ConfigTimeTokenValidationEnabled</a>,
                <span class="i">ClockSkew</span> = <a href="@1@System.Runtime/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@System.Runtime/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(<a href="../Classes/ServerConfigurationDefinitions.cs.html#de6c49ae64743fc3" class="t t">ServerConfigSettings</a>.<a href="../Classes/ServerConfigurationDefinitions.cs.html#1eac698f9d57a0dd" class="i property">ConfigApiTokenTimeoutMin</a>),
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Token Validator Extension For Server WebPages</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">tokenString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The token string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">ServerWebPagesToken</span> <a id="271dba309604c952" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CheckTokenValidityFromString</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r31 rd" class="r31 r">tokenString</span>) {
            <b>try</b> {
                <span class="i">JwtSecurityTokenHandler</span>? <span id="r32 rd" class="r32 r">tokenForChek</span> = <b>new</b> <span class="i">JwtSecurityTokenHandler</span>();
                <span class="i">ClaimsPrincipal</span> <span id="r33 rd" class="r33 r">userClaims</span> = <span class="r32 r">tokenForChek</span>.<span class="i">ValidateToken</span>(<span class="r31 r">tokenString</span>, <a href="#89b513cd305e0b09" class="i method">ValidAndGetTokenParameters</a>(), <b>out</b> <span class="i">SecurityToken</span> <span id="r34 rd" class="r34 r">refreshedToken</span>);
                <span class="i">ServerWebPagesToken</span> <span id="r35 rd" class="r35 r">validation</span> = <b>new</b>() { <span class="i">Data</span> = <b>new</b>() { { <span class="s">&quot;Token&quot;</span>, <span class="r31 r">tokenString</span> } }, <span class="i">UserClaims</span> = <span class="r33 r">userClaims</span>, <span class="i">stringToken</span> = <span class="r31 r">tokenString</span>, <span class="i">Token</span> = <span class="r34 r">refreshedToken</span>, <span class="i">IsValid</span> = <span class="r34 r">refreshedToken</span> != <b>null</b> };
                <b>return</b> <span class="r35 r">validation</span>;
            } <b>catch</b> { }
            <b>return</b> <b>new</b> <span class="i">ServerWebPagesToken</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Extension For Checking Operation System of Server Running</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static class</b> <a id="2669f9bbfcbdda4c" href="../../R/2669f9bbfcbdda4c.html" target="n" data-glyph="0,1" class="t t">GetOperatingSystemInfo</a> {
 
            <b>public static bool</b> <a id="533a018ad73bad9a" href="../../R/533a018ad73bad9a.html" target="n" data-glyph="72,2" class="i method">IsWindows</a>() =&gt;
                <span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">Windows</span>);
 
            <b>public static bool</b> <a id="5d493439934de2b4" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">IsMacOS</a>() =&gt;
                <span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">OSX</span>);
 
            <b>public static bool</b> <a id="26b6cf4a94c7ba92" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">IsLinux</a>() =&gt;
                <span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">Linux</span>);
        }
    }
}</pre></td></tr></table></div></body></html>
