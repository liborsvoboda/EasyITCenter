<!DOCTYPE html>
<html><head><title>MarkdownOld.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(1311);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EASYTools.MarkdownToHtml/MarkdownOld.cs" target="_top">MarkdownOld.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EASYTools.MarkdownToHtml" target="_top">..\..\..\EASY-TOOLS\EASYTools.MarkdownToHtml\EASYTools.MarkdownToHtml.csproj</a> (EASYTools.MarkdownToHtml)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">/*
 * Markdown  -  A text-to-HTML conversion tool for web writers
 * Copyright (c) 2004 John Gruber
 * http://daringfireball.net/projects/markdown/
 * 
 * Copyright (c) 2004 Michel Fortin - Translation to PHP
 * http://www.michelf.com/projects/php-markdown/
 * 
 * Copyright (c) 2004-2005 Milan Negovan - C# translation to .NET
 * http://www.aspnetresources.com
 * 
 */</span>
 
<span class="k preprocess">#</span><span class="k preprocess">region</span> Copyright and license
 
<span class="c">/*
Copyright (c) 2003-2004 John Gruber   
&lt;http://daringfireball.net/&gt;   
All rights reserved.
 
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:
 
* Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
 
* Redistributions in binary form must reproduce the above copyright
  notice, this list of conditions and the following disclaimer in the
  documentation and/or other materials provided with the distribution.
 
* Neither the name &quot;Markdown&quot; nor the names of its contributors may
  be used to endorse or promote products derived from this software
  without specific prior written permission.
 
This software is provided by the copyright holders and contributors &quot;as
is&quot; and any express or implied warranties, including, but not limited
to, the implied warranties of merchantability and fitness for a
particular purpose are disclaimed. In no event shall the copyright owner
or contributors be liable for any direct, indirect, incidental, special,
exemplary, or consequential damages (including, but not limited to,
procurement of substitute goods or services; loss of use, data, or
profits; or business interruption) however caused and on any theory of
liability, whether in contract, strict liability, or tort (including
negligence or otherwise) arising in any way out of the use of this
software, even if advised of the possibility of such damage.
*/</span>
 
<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">RegularExpressions</span>;
 
<b>namespace</b> <span class="i n">EASYTools</span>.<span class="i n">MarkdownToHtml</span>
{
    [<a href="@0@mscorlib/A.html#66ed4e142f4e14e7" class="t constructor">Obsolete</a>(<span class="s">&quot;This old version is included only for historical comparison purposes; use at your own risk!&quot;</span>)]
    <b>public class</b> <a id="a22b54ed7f721890" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">MarkdownOld</a>
    {
        <b>public class</b> <a id="f4fb2404f86a7090" href="R/f4fb2404f86a7090.html" target="n" data-glyph="0,1" class="t t"><span id="f1d31c213765618a">Pair</span></a>
        {
            <b>public</b> <a href="@0@mscorlib/A.html#d9262ceecc1719ab" class="t t">Object</a> <a id="e9a587d05b059050" href="R/e9a587d05b059050.html" target="n" data-glyph="42,2" class="i field">First</a>;
            <b>public</b> <a href="@0@mscorlib/A.html#d9262ceecc1719ab" class="t t">Object</a> <a id="c206d6a0b8fcb942" href="R/c206d6a0b8fcb942.html" target="n" data-glyph="42,2" class="i field">Second</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Class members
 
        <b>private const int</b> <a id="24368cdbcb0fbc0f" href="R/24368cdbcb0fbc0f.html" target="n" data-glyph="10,1" class="i field">nestedBracketDepth</a> = 6;
        <b>private const string</b> <a id="e55b20f6aa29aebc" href="R/e55b20f6aa29aebc.html" target="n" data-glyph="10,1" class="i field">emptyElementSuffix</a> = <span class="s">&quot; /&gt;&quot;</span>; <span class="c">// Change to &quot;&gt;&quot; for HTML output</span>
        <b>private const int</b> <a id="3869c16ed3620e2e" href="R/3869c16ed3620e2e.html" target="n" data-glyph="10,1" class="i field">tabWidth</a> = 4;
 
        <b>private static readonly string</b> <a id="60ff95040a7a9be4" href="R/60ff95040a7a9be4.html" target="n" data-glyph="46,1" class="i field">markerUL</a>;
        <b>private static readonly string</b> <a id="d5e22991fff6c210" href="R/d5e22991fff6c210.html" target="n" data-glyph="46,1" class="i field">markerOL</a>;
        <b>private static readonly string</b> <a id="fa13051269c69db8" href="R/fa13051269c69db8.html" target="n" data-glyph="46,1" class="i field">markerAny</a>;
 
        <b>private static readonly string</b> <a id="c51dc7f6ed31ea3a" href="R/c51dc7f6ed31ea3a.html" target="n" data-glyph="46,1" class="i field">nestedBrackets</a>;
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#10fefb6e0ae510dd" class="t t">Hashtable</a> <a id="095dd688fd14db33" href="R/095dd688fd14db33.html" target="n" data-glyph="46,1" class="i field">escapeTable</a>;
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#10fefb6e0ae510dd" class="t t">Hashtable</a> <a id="65510e74856999b0" href="R/65510e74856999b0.html" target="n" data-glyph="46,1" class="i field">backslashEscapeTable</a>;
 
        <b>private</b> <a href="@0@mscorlib/A.html#10fefb6e0ae510dd" class="t t">Hashtable</a> <a id="874115dd0dafae17" href="R/874115dd0dafae17.html" target="n" data-glyph="46,1" class="i field">urls</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#10fefb6e0ae510dd" class="t t">Hashtable</a> <a id="3270354a9701096f" href="R/3270354a9701096f.html" target="n" data-glyph="46,1" class="i field">titles</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#10fefb6e0ae510dd" class="t t">Hashtable</a> <a id="bb683682ec97a961" href="R/bb683682ec97a961.html" target="n" data-glyph="46,1" class="i field">htmlBlocks</a>;
 
        <b>private int</b> <a id="464fd498c7571c0d" href="R/464fd498c7571c0d.html" target="n" data-glyph="46,1" class="i field">listLevel</a> = 0;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Static constructor</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In the static constuctor we&#39;ll initialize what stays the same across all transforms.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>static</b> <a id="6d0d91e025ca9bb4" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">MarkdownOld</a>()
        {
            <a href="#c51dc7f6ed31ea3a" class="i field">nestedBrackets</a> += <a href="#8f9a5c15adfa7291" class="i method">RepeatString</a>(<span class="s">@&quot;(?&gt;[^\[\]]+|\[&quot;</span>, <a href="#24368cdbcb0fbc0f" class="i field">nestedBracketDepth</a>);
            <a href="#c51dc7f6ed31ea3a" class="i field">nestedBrackets</a> += <a href="#8f9a5c15adfa7291" class="i method">RepeatString</a>(<span class="s">@&quot;\])*&quot;</span>, <a href="#24368cdbcb0fbc0f" class="i field">nestedBracketDepth</a>);
 
            <a href="#60ff95040a7a9be4" class="i field">markerUL</a> = <span class="s">@&quot;[*+-]&quot;</span>;
            <a href="#d5e22991fff6c210" class="i field">markerOL</a> = <span class="s">@&quot;\d+[.]&quot;</span>;
            <a href="#fa13051269c69db8" class="i field">markerAny</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;(?:{0}|{1})&quot;</span>, <a href="#60ff95040a7a9be4" class="i field">markerUL</a>, <a href="#d5e22991fff6c210" class="i field">markerOL</a>);
 
            <span class="c">// Table of hash values for escaped characters:</span>
            <a href="#095dd688fd14db33" class="i field">escapeTable</a> = <b>new</b> <a href="@0@mscorlib/A.html#35eb148f5d60a68c" class="t constructor">Hashtable</a>();
 
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">@&quot;\&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">@&quot;\&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;`&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;`&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;*&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;_&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;{&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;{&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;}&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;}&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;[&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;[&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;]&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;]&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;(&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;(&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;)&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;)&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;&gt;&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;&gt;&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;#&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;#&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;+&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;+&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;-&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;-&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;.&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;.&quot;</span>);
            <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;!&quot;</span>] = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="s">&quot;!&quot;</span>);
 
            <span class="c">// Create an identical table but for escaped characters.</span>
            <a href="#65510e74856999b0" class="i field">backslashEscapeTable</a> = <b>new</b> <a href="@0@mscorlib/A.html#35eb148f5d60a68c" class="t constructor">Hashtable</a>();
 
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">key</span> <b>in</b> <a href="#095dd688fd14db33" class="i field">escapeTable</a>.<a href="@0@mscorlib/A.html#d4c2d1ac82a925b3" class="i property">Keys</a>)
                <a href="#65510e74856999b0" class="i field">backslashEscapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">@&quot;\&quot;</span> + <span class="r0 r">key</span>] = <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r0 r">key</span>];
        }
 
        <b>public</b> <a id="13f42da1b38e7b62" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">MarkdownOld</a>()
        {
            <a href="#874115dd0dafae17" class="i field">urls</a> = <b>new</b> <a href="@0@mscorlib/A.html#35eb148f5d60a68c" class="t constructor">Hashtable</a>();
            <a href="#3270354a9701096f" class="i field">titles</a> = <b>new</b> <a href="@0@mscorlib/A.html#35eb148f5d60a68c" class="t constructor">Hashtable</a>();
            <a href="#bb683682ec97a961" class="i field">htmlBlocks</a> = <b>new</b> <a href="@0@mscorlib/A.html#35eb148f5d60a68c" class="t constructor">Hashtable</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Main function. The order in which other subs are called here is</span>
        <span class="c">///</span><span class="c"> essential. Link and image substitutions need to happen before</span>
        <span class="c">///</span><span class="c"> EscapeSpecialChars(), so that any *&#39;s or _&#39;s in the </span><span class="c">&lt;</span><span class="c">a</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">img</span><span class="c">&gt;</span><span class="c"> tags get encoded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="a518310d507b7a43" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Transform</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">text</span>)
        {
            <span class="c">// Standardize line endings:</span>
            <span class="c">// DOS to Unix and Mac to Unix</span>
            <span class="r1 r">text</span> = <span class="r1 r">text</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\r\n&quot;</span>, <span class="s">&quot;\n&quot;</span>).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\r&quot;</span>, <span class="s">&quot;\n&quot;</span>);
 
            <span class="c">// Make sure $text ends with a couple of newlines:</span>
            <span class="r1 r">text</span> += <span class="s">&quot;\n\n&quot;</span>;
 
            <span class="c">// Convert all tabs to spaces.</span>
            <span class="r1 r">text</span> = <a href="#6e36340e38e5b0b4" class="i method">Detab</a>(<span class="r1 r">text</span>);
 
            <span class="c">// Strip any lines consisting only of spaces and tabs.</span>
            <span class="c">// This makes subsequent regexen easier to write, because we can</span>
            <span class="c">// match consecutive blank lines with /\n+/ instead of something</span>
            <span class="c">// contorted like /[ \t]*\n+/ .</span>
            <span class="r1 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r1 r">text</span>, <span class="s">@&quot;^[ \t]+$&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <span class="c">// Turn block-level HTML blocks into hash entries</span>
            <span class="r1 r">text</span> = <a href="#0574bbb01c87d82c" class="i method">HashHTMLBlocks</a>(<span class="r1 r">text</span>);
 
            <span class="c">// Strip link definitions, store in hashes.</span>
            <span class="r1 r">text</span> = <a href="#e1754d70f9b94214" class="i method">StripLinkDefinitions</a>(<span class="r1 r">text</span>);
 
            <span class="r1 r">text</span> = <a href="#41977ac050e87df4" class="i method">RunBlockGamut</a>(<span class="r1 r">text</span>);
 
            <span class="r1 r">text</span> = <a href="#fd7ffcf9c2c1520e" class="i method">UnescapeSpecialChars</a>(<span class="r1 r">text</span>);
 
            <b>return</b> <span class="r1 r">text</span> + <span class="s">&quot;\n&quot;</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process link definitions
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Strips link definitions from text, stores the URLs and titles in hash references.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Link defs are in the form: ^[id]: url &quot;optional title&quot;</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="e1754d70f9b94214" href="R/e1754d70f9b94214.html" target="n" data-glyph="76,1" class="i method">StripLinkDefinitions</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">text</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
						^[ ]{{0,{0}}}\[(.+)\]:	# id = $1
						  [ \t]*
						  \n?				# maybe *one* newline
						  [ \t]*
						&lt;?(\S+?)&gt;?			# url = $2
						  [ \t]*
						  \n?				# maybe one newline
						  [ \t]*
						(?:
							(?&lt;=\s)			# lookbehind for whitespace
							[\x22(]
							(.+?)			# title = $3
							[\x22)]
							[ \t]*
						)?	# title is optional
						(?:\n+|\Z)&quot;</span>, <a href="#3869c16ed3620e2e" class="i field">tabWidth</a> - 1);
 
            <span class="r2 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r2 r">text</span>, <span class="r3 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#e5bdbb04a985333f" class="i method">LinkEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            <b>return</b> <span class="r2 r">text</span>;
        }
 
        <b>private string</b> <a id="e5bdbb04a985333f" href="R/e5bdbb04a985333f.html" target="n" data-glyph="76,1" class="i method">LinkEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r4 rd" class="r4 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">linkID</span> = <span class="r4 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            <a href="#874115dd0dafae17" class="i field">urls</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r5 r">linkID</span>] = <a href="#85190ba63f9c062f" class="i method">EncodeAmpsAndAngles</a>(<span class="r4 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
 
            <b>if</b> (<span class="r4 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3] != <b>null</b> &amp;&amp; <span class="r4 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#d22878087e24a96d" class="i property">Length</a> &gt; 0)
                <a href="#3270354a9701096f" class="i field">titles</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r5 r">linkID</span>] = <span class="r4 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Hashify HTML blocks
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Hashify HTML blocks</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="0574bbb01c87d82c" href="R/0574bbb01c87d82c.html" target="n" data-glyph="76,1" class="i method">HashHTMLBlocks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">text</span>)
        {
            <span class="c">/*
             We only want to do this for block-level HTML tags, such as headers,
             lists, and tables. That&#39;s because we still want to wrap &lt;p&gt;s around
             &quot;paragraphs&quot; that are wrapped in non-block-level tags, such as anchors,
             phrase emphasis, and spans. The list of tags we&#39;re looking for is
             hard-coded:
            */</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">blockTags1</span> = <span class="s">&quot;p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">blockTags2</span> = <span class="s">&quot;p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math&quot;</span>;
 
            <span class="c">/*
             First, look for nested blocks, e.g.:
            &lt;div&gt;
                &lt;div&gt;
                tags for inner block must be indented.
                &lt;/div&gt;
            &lt;/div&gt;
	        
             The outermost tags must start at the left margin for this to match, and
             the inner nested divs must be indented.
             We need to do this before the next, more liberal match, because the next
             match will start at the first `&lt;div&gt;` and stop at the first `&lt;/div&gt;`.
            */</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                (						# save in $1
					^					# start of line  (with /m)
					&lt;({0})	            # start tag = $2
					\b					# word break
					(.*\n)*?			# any number of lines, minimally matching
					&lt;/\2&gt;				# the matching end tag
					[ \t]*				# trailing spaces/tabs
					(?=\n+|\Z)	        # followed by a newline or end of document
				)&quot;</span>, <span class="r7 r">blockTags1</span>);
 
            <span class="r6 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r6 r">text</span>, <span class="r9 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#c5f200980eaf871d" class="i method">HtmlEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <span class="c">// Now match more liberally, simply from `\n&lt;tag&gt;` to `&lt;/tag&gt;\n`</span>
            <span class="r9 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
               (						# save in $1
					^					# start of line  (with /m)
					&lt;({0})	            # start tag = $2
					\b					# word break
					(.*\n)*?			# any number of lines, minimally matching
					.*&lt;/\2&gt;				# the matching end tag
					[ \t]*				# trailing spaces/tabs
					(?=\n+|\Z)	        # followed by a newline or end of document
				)&quot;</span>, <span class="r8 r">blockTags2</span>);
 
            <span class="r6 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r6 r">text</span>, <span class="r9 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#c5f200980eaf871d" class="i method">HtmlEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <span class="c">// Special case just for &lt;hr /&gt;. It was easier to make a special case than</span>
            <span class="c">// to make the other regex more complicated.</span>
            <span class="r9 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                (?:
					(?&lt;=\n\n)		    # Starting after a blank line
					|				    # or
					\A\n?			    # the beginning of the doc
				)
				(						# save in $1
					[ ]{{0, {0}}}
					&lt;(hr)				# start tag = $2
					\b					# word break
					([^&lt;&gt;])*?			#
					/?&gt;					# the matching end tag
					[ \t]*
					(?=\n{{2,}}|\Z)		# followed by a blank line or end of document
				)&quot;</span>, <a href="#3869c16ed3620e2e" class="i field">tabWidth</a> - 1);
            <span class="r6 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r6 r">text</span>, <span class="r9 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#c5f200980eaf871d" class="i method">HtmlEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <span class="c">// Special case for standalone HTML comments:</span>
            <span class="r9 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
				(?:
					(?&lt;=\n\n)		# Starting after a blank line
					|				# or
					\A\n?			# the beginning of the doc
				)
				(						# save in $1
					[ ]{{0,{0}}}
					(?s:
						&lt;!
						(--.*?--\s*)+
						&gt;
					)
					[ \t]*
					(?=\n{{2,}}|\Z)		# followed by a blank line or end of document
				)&quot;</span>, <a href="#3869c16ed3620e2e" class="i field">tabWidth</a> - 1);
            <span class="r6 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r6 r">text</span>, <span class="r9 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#c5f200980eaf871d" class="i method">HtmlEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <b>return</b> <span class="r6 r">text</span>;
        }
 
        <b>private string</b> <a id="c5f200980eaf871d" href="R/c5f200980eaf871d.html" target="n" data-glyph="76,1" class="i method">HtmlEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r10 rd" class="r10 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">text</span> = <span class="r10 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">key</span> = <a href="#52dd542615ea5ef9" class="i method">ComputeMD5</a>(<span class="r11 r">text</span>);
            <a href="#bb683682ec97a961" class="i field">htmlBlocks</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r12 r">key</span>] = <span class="r11 r">text</span>;
 
            <span class="c">// # String that will replace the block</span>
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;\n\n&quot;</span>, <span class="r12 r">key</span>, <span class="s">&quot;\n\n&quot;</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Run transformations that form block-level elements (RunBlockGamut)
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> These are all the transformations that form block-level </span>
        <span class="c">///</span><span class="c"> tags like paragraphs, headers, and list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="41977ac050e87df4" href="R/41977ac050e87df4.html" target="n" data-glyph="76,1" class="i method">RunBlockGamut</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">text</span>)
        {
            <span class="r13 r">text</span> = <a href="#f8a89100ee2979cb" class="i method">DoHeaders</a>(<span class="r13 r">text</span>);
 
            <span class="c">// Do Horizontal Rules:</span>
            <span class="r13 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r13 r">text</span>, <span class="s">@&quot;^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$&quot;</span>, <span class="s">&quot;&lt;hr&quot;</span> + <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a> + <span class="s">&quot;\n&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            <span class="r13 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r13 r">text</span>, <span class="s">@&quot;^[ ]{0,2}([ ]? -[ ]?){3,}[ \t]*$&quot;</span>, <span class="s">&quot;&lt;hr&quot;</span> + <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a> + <span class="s">&quot;\n&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            <span class="r13 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r13 r">text</span>, <span class="s">@&quot;^[ ]{0,2}([ ]? _[ ]?){3,}[ \t]*$&quot;</span>, <span class="s">&quot;&lt;hr&quot;</span> + <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a> + <span class="s">&quot;\n&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
 
            <span class="r13 r">text</span> = <a href="#f7a0a60c85a6974d" class="i method">DoLists</a>(<span class="r13 r">text</span>);
            <span class="r13 r">text</span> = <a href="#f345ca4563177453" class="i method">DoCodeBlocks</a>(<span class="r13 r">text</span>);
            <span class="r13 r">text</span> = <a href="#7ad23ff387485534" class="i method">DoBlockQuotes</a>(<span class="r13 r">text</span>);
 
            <span class="c">/*
                We already ran _HashHTMLBlocks() before, in Markdown(), but that
                was to escape raw HTML in the original Markdown source. This time,
                we&#39;re escaping the markup we&#39;ve just created, so that we don&#39;t wrap
                &lt;p&gt; tags around block-level tags.
            */</span>
            <span class="r13 r">text</span> = <a href="#0574bbb01c87d82c" class="i method">HashHTMLBlocks</a>(<span class="r13 r">text</span>);
 
            <span class="r13 r">text</span> = <a href="#53940169192a0978" class="i method">FormParagraphs</a>(<span class="r13 r">text</span>);
 
            <b>return</b> <span class="r13 r">text</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Run transformations within block-level elements (RunSpanGamut)
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> These are all the transformations that occur *within* block-level </span>
        <span class="c">///</span><span class="c"> tags like paragraphs, headers, and list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="a3bfefbc3f3d3684" href="R/a3bfefbc3f3d3684.html" target="n" data-glyph="76,1" class="i method">RunSpanGamut</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r14 rd" class="r14 r">text</span>)
        {
            <span class="r14 r">text</span> = <a href="#f1751b52d670ff01" class="i method">DoCodeSpans</a>(<span class="r14 r">text</span>);
 
            <span class="r14 r">text</span> = <a href="#e539d3b68e8c54ec" class="i method">EscapeSpecialChars</a>(<span class="r14 r">text</span>);
 
            <span class="c">// Process anchor and image tags. Images must come first,</span>
            <span class="c">// because ![foo][f] looks like an anchor.</span>
            <span class="r14 r">text</span> = <a href="#95c86764f1934f50" class="i method">DoImages</a>(<span class="r14 r">text</span>);
            <span class="r14 r">text</span> = <a href="#c173859795ec909f" class="i method">DoAnchors</a>(<span class="r14 r">text</span>);
 
            <span class="c">// Make links out of things like `&lt;http://example.com/&gt;`</span>
            <span class="c">// Must come after DoAnchors(), because you can use &lt; and &gt;</span>
            <span class="c">// delimiters in inline links like [this](&lt;url&gt;).</span>
            <span class="r14 r">text</span> = <a href="#fa9b764d4be423a2" class="i method">DoAutoLinks</a>(<span class="r14 r">text</span>);
 
            <span class="c">// Fix unencoded ampersands and &lt;&#39;s:</span>
            <span class="r14 r">text</span> = <a href="#85190ba63f9c062f" class="i method">EncodeAmpsAndAngles</a>(<span class="r14 r">text</span>);
 
            <span class="r14 r">text</span> = <a href="#33315a82b93302ad" class="i method">DoItalicsAndBold</a>(<span class="r14 r">text</span>);
 
            <span class="c">// Do hard breaks:  </span>
            <span class="r14 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r14 r">text</span>, <span class="s">@&quot; {2,}\n&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;br{0}\n&quot;</span>, <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a>));
 
            <b>return</b> <span class="r14 r">text</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parse HTML into tokens
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">text</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">String containing HTML markup.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An array of the tokens comprising the input string. Each token is </span>
        <span class="c">///</span><span class="c"> either a tag (possibly with nested, tags contained therein, such </span>
        <span class="c">///</span><span class="c"> as </span><span class="c">&amp;lt;</span><span class="c">a href=&quot;</span><span class="c">&lt;</span><span class="c">MTFoo</span><span class="c">&gt;</span><span class="c">&quot;</span><span class="c">&amp;gt;</span><span class="c">, or a run of text between tags. Each element of the </span>
        <span class="c">///</span><span class="c"> array is a two-element array; the first is either &#39;tag&#39; or &#39;text&#39;; the second is </span>
        <span class="c">///</span><span class="c"> the actual value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="@0@mscorlib/A.html#3e3f6715773d6643" class="t t">ArrayList</a> <a id="fc345be9b88896a1" href="R/fc345be9b88896a1.html" target="n" data-glyph="76,1" class="i method">TokenizeHTML</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r15 rd" class="r15 r">text</span>)
        {
            <span class="c">// Regular expression derived from the _tokenize() subroutine in </span>
            <span class="c">// Brad Choate&#39;s MTRegex plugin.</span>
            <span class="c">// http://www.bradchoate.com/past/mtregex.php</span>
            <b>int</b> <span id="r16 rd" class="r16 r">pos</span> = 0;
            <b>int</b> <span id="r17 rd" class="r17 r">depth</span> = 6;
            <a href="@0@mscorlib/A.html#3e3f6715773d6643" class="t t">ArrayList</a> <span id="r18 rd" class="r18 r">tokens</span> = <b>new</b> <a href="@0@mscorlib/A.html#3113636092b18f20" class="t constructor">ArrayList</a>();
 
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r19 rd" class="r19 r">nestedTags</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55b2f6374a7cf7c1" class="i method">Concat</a>(<a href="#8f9a5c15adfa7291" class="i method">RepeatString</a>(<span class="s">@&quot;(?:&lt;[a-z\/!$](?:[^&lt;&gt;]|&quot;</span>, <span class="r17 r">depth</span>),
                <a href="#8f9a5c15adfa7291" class="i method">RepeatString</a>(<span class="s">@&quot;)*&gt;)&quot;</span>, <span class="r17 r">depth</span>));
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r20 rd" class="r20 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55b2f6374a7cf7c1" class="i method">Concat</a>(<span class="s">@&quot;(?s:&lt;!(?:--.*?--\s*)+&gt;)|(?s:&lt;\?.*?\?&gt;)|&quot;</span>, <span class="r19 r">nestedTags</span>);
 
            <a href="@0@System/A.html#7376f85d6ff213d1" class="t t">MatchCollection</a> <span id="r21 rd" class="r21 r">mc</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#a148e513003e4cdf" class="i method">Matches</a>(<span class="r15 r">text</span>, <span class="r20 r">pattern</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#8c4a7c494a4050d5" class="i field">IgnoreCase</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <b>foreach</b> (<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r22 rd" class="r22 r">m</span> <b>in</b> <span class="r21 r">mc</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">wholeTag</span> = <span class="r22 r">m</span>.<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
                <b>int</b> <span id="r24 rd" class="r24 r">tagStart</span> = <span class="r22 r">m</span>.<a href="@0@System/A.html#d33b0131e21561d5" class="i property">Index</a>;
                <a href="#f4fb2404f86a7090" class="t t">Pair</a> <span id="r25 rd" class="r25 r">token</span> = <b>null</b>;
 
                <b>if</b> (<span class="r16 r">pos</span> &lt; <span class="r24 r">tagStart</span>)
                {
                    <span class="r25 r">token</span> = <b>new</b> <a href="#f4fb2404f86a7090" class="t constructor">Pair</a>();
                    <span class="r25 r">token</span>.<a href="#e9a587d05b059050" class="i field">First</a> = <span class="s">&quot;text&quot;</span>;
                    <span class="r25 r">token</span>.<a href="#c206d6a0b8fcb942" class="i field">Second</a> = <span class="r15 r">text</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(<span class="r16 r">pos</span>, <span class="r24 r">tagStart</span> - <span class="r16 r">pos</span>);
                    <span class="r18 r">tokens</span>.<a href="@0@mscorlib/A.html#5e9cf3d0a9ed0b29" class="i method">Add</a>(<span class="r25 r">token</span>);
                }
 
                <span class="r25 r">token</span> = <b>new</b> <a href="#f4fb2404f86a7090" class="t constructor">Pair</a>();
                <span class="r25 r">token</span>.<a href="#e9a587d05b059050" class="i field">First</a> = <span class="s">&quot;tag&quot;</span>;
                <span class="r25 r">token</span>.<a href="#c206d6a0b8fcb942" class="i field">Second</a> = <span class="r23 r">wholeTag</span>;
                <span class="r18 r">tokens</span>.<a href="@0@mscorlib/A.html#5e9cf3d0a9ed0b29" class="i method">Add</a>(<span class="r25 r">token</span>);
 
                <span class="r16 r">pos</span> = <span class="r22 r">m</span>.<a href="@0@System/A.html#d33b0131e21561d5" class="i property">Index</a> + <span class="r22 r">m</span>.<a href="@0@System/A.html#d22878087e24a96d" class="i property">Length</a>;
            }
 
            <b>if</b> (<span class="r16 r">pos</span> &lt; <span class="r15 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>)
            {
                <a href="#f4fb2404f86a7090" class="t t">Pair</a> <span id="r26 rd" class="r26 r">token</span> = <b>new</b> <a href="#f4fb2404f86a7090" class="t constructor">Pair</a>();
                <span class="r26 r">token</span>.<a href="#e9a587d05b059050" class="i field">First</a> = <span class="s">&quot;text&quot;</span>;
                <span class="r26 r">token</span>.<a href="#c206d6a0b8fcb942" class="i field">Second</a> = <span class="r15 r">text</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(<span class="r16 r">pos</span>, <span class="r15 r">text</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - <span class="r16 r">pos</span>);
                <span class="r18 r">tokens</span>.<a href="@0@mscorlib/A.html#5e9cf3d0a9ed0b29" class="i method">Add</a>(<span class="r26 r">token</span>);
            }
 
            <b>return</b> <span class="r18 r">tokens</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Escape special characters
 
        <b>private string</b> <a id="e539d3b68e8c54ec" href="R/e539d3b68e8c54ec.html" target="n" data-glyph="76,1" class="i method">EscapeSpecialChars</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r27 rd" class="r27 r">text</span>)
        {
            <a href="@0@mscorlib/A.html#3e3f6715773d6643" class="t t">ArrayList</a> <span id="r28 rd" class="r28 r">tokens</span> = <a href="#fc345be9b88896a1" class="i method">TokenizeHTML</a>(<span class="r27 r">text</span>);
 
            <span class="c">// Rebuild text from the tokens</span>
            <span class="r27 r">text</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
 
            <b>foreach</b> (<a href="#f4fb2404f86a7090" class="t t">Pair</a> <span id="r29 rd" class="r29 r">token</span> <b>in</b> <span class="r28 r">tokens</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r30 rd" class="r30 r">value</span> = <span class="r29 r">token</span>.<a href="#c206d6a0b8fcb942" class="i field">Second</a>.<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
 
                <b>if</b> (<span class="r29 r">token</span>.<a href="#e9a587d05b059050" class="i field">First</a>.<a href="@0@mscorlib/A.html#517682d5f6f4f8b4" class="i method">Equals</a>(<span class="s">&quot;tag&quot;</span>))
                    <span class="c">/*
                        Within tags, encode * and _ so they don&#39;t conflict with their use 
                        in Markdown for italics and strong. We&#39;re replacing each 
                        such character with its corresponding MD5 checksum value; 
                        this is likely overkill, but it should prevent us from colliding
                        with the escape values by accident.
                    */</span>
                    <span class="r30 r">value</span> = <span class="r30 r">value</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                <b>else</b>
                    <span class="r30 r">value</span> = <a href="#58af98b7d7be7fee" class="i method">EncodeBackslashEscapes</a>(<span class="r30 r">value</span>);
 
                <span class="r27 r">text</span> += <span class="r30 r">value</span>;
            }
 
            <b>return</b> <span class="r27 r">text</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process referenced and inline anchors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown link shortcuts into XHTML </span><span class="c">&lt;</span><span class="c">a</span><span class="c">&gt;</span><span class="c"> tags. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="c173859795ec909f" href="R/c173859795ec909f.html" target="n" data-glyph="76,1" class="i method">DoAnchors</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r31 rd" class="r31 r">text</span>)
        {
            <span class="c">//</span>
            <span class="c">// First, handle reference-style links: [link text] [id]</span>
            <span class="c">//</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r32 rd" class="r32 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
            (                               # wrap whole match in $1
		        \[
			        ({0})                   # link text = $2
		        \]
 
		        [ ]?                        # one optional space
		        (?:\n[ ]*)?                 # one optional newline followed by spaces
 
		        \[
			        (.*?)                   # id = $3
		        \]
		    )&quot;</span>, <a href="#c51dc7f6ed31ea3a" class="i field">nestedBrackets</a>);
 
            <span class="r31 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r31 r">text</span>, <span class="r32 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#7797126037a380e5" class="i method">AnchorReferenceEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <span class="c">//</span>
            <span class="c">// Next, inline-style links: [link text](url &quot;optional title&quot;)</span>
            <span class="c">//</span>
            <span class="r32 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                (                          # wrap whole match in $1
		            \[
			            ({0})              # link text = $2
		            \]
		            \(                     # literal paren
			            [ \t]*
			            &lt;?(.*?)&gt;?          # href = $3
			            [ \t]*
			            (                  # $4
			            ([&#39;\x22])          # quote char = $5
			            (.*?)              # Title = $6
			            \5                 # matching quote
			            )?                 # title is optional
		            \)
        		)&quot;</span>, <a href="#c51dc7f6ed31ea3a" class="i field">nestedBrackets</a>);
 
            <span class="r31 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r31 r">text</span>, <span class="r32 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#d1c4d4bbd3a153e6" class="i method">AnchorInlineEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <b>return</b> <span class="r31 r">text</span>;
        }
 
        <b>private string</b> <a id="7797126037a380e5" href="R/7797126037a380e5.html" target="n" data-glyph="76,1" class="i method">AnchorReferenceEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r33 rd" class="r33 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r34 rd" class="r34 r">wholeMatch</span> = <span class="r33 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r35 rd" class="r35 r">linkText</span> = <span class="r33 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r36 rd" class="r36 r">linkID</span> = <span class="r33 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r37 rd" class="r37 r">url</span> = <b>null</b>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r38 rd" class="r38 r">res</span> = <b>null</b>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r39 rd" class="r39 r">title</span> = <b>null</b>;
 
            <span class="c">// for shortcut links like [this][].</span>
            <b>if</b> (<span class="r36 r">linkID</span>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>))
                <span class="r36 r">linkID</span> = <span class="r35 r">linkText</span>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
 
            <b>if</b> (<a href="#874115dd0dafae17" class="i field">urls</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r36 r">linkID</span>] != <b>null</b>)
            {
                <span class="r37 r">url</span> = <a href="#874115dd0dafae17" class="i field">urls</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r36 r">linkID</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
 
                <span class="c">//We&#39;ve got to encode these to avoid conflicting with italics/bold.</span>
                <span class="r37 r">url</span> = <span class="r37 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                <span class="r38 r">res</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&quot;</span>, <span class="r37 r">url</span>);
 
                <b>if</b> (<a href="#3270354a9701096f" class="i field">titles</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r36 r">linkID</span>] != <b>null</b>)
                {
                    <span class="r39 r">title</span> = <a href="#3270354a9701096f" class="i field">titles</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r36 r">linkID</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
                    <span class="r39 r">title</span> = <span class="r39 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                    <span class="r38 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r39 r">title</span>);
                }
 
                <span class="r38 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r35 r">linkText</span>);
            }
            <b>else</b>
                <span class="r38 r">res</span> = <span class="r34 r">wholeMatch</span>;
 
            <b>return</b> <span class="r38 r">res</span>;
        }
 
        <b>private string</b> <a id="d1c4d4bbd3a153e6" href="R/d1c4d4bbd3a153e6.html" target="n" data-glyph="76,1" class="i method">AnchorInlineEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r40 rd" class="r40 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">linkText</span> = <span class="r40 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r42 rd" class="r42 r">url</span> = <span class="r40 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r43 rd" class="r43 r">title</span> = <span class="r40 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[6].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r44 rd" class="r44 r">res</span> = <b>null</b>;
 
            <span class="c">// We&#39;ve got to encode these to avoid conflicting with italics/bold.</span>
            <span class="r42 r">url</span> = <span class="r42 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
            <span class="r44 r">res</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&quot;</span>, <span class="r42 r">url</span>);
 
            <b>if</b> (<span class="r43 r">title</span> != <b>null</b> &amp;&amp; <span class="r43 r">title</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
            {
                <span class="r43 r">title</span> = <span class="r43 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                <span class="r44 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r43 r">title</span>);
            }
 
            <span class="r44 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r41 r">linkText</span>);
            <b>return</b> <span class="r44 r">res</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process inline and referenced images
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Turn Markdown image shortcuts into </span><span class="c">&lt;</span><span class="c">img</span><span class="c">&gt;</span><span class="c"> tags. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="95c86764f1934f50" href="R/95c86764f1934f50.html" target="n" data-glyph="76,1" class="i method">DoImages</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r45 rd" class="r45 r">text</span>)
        {
            <span class="c">// First, handle reference-style labeled images: ![alt text][id]</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r46 rd" class="r46 r">pattern</span> = <span class="s">@&quot;
                    (               # wrap whole match in $1
		            !\[
			            (.*?)	    # alt text = $2
		            \]
 
		            [ ]?            # one optional space
		            (?:\n[ ]*)?		# one optional newline followed by spaces
 
		            \[
			            (.*?)       # id = $3
		            \]
 
		            )&quot;</span>;
 
            <span class="r45 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r45 r">text</span>, <span class="r46 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#57749b886650c94d" class="i method">ImageReferenceEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <span class="c">// Next, handle inline images:  ![alt text](url &quot;optional title&quot;)</span>
            <span class="c">// Don&#39;t forget: encode * and _</span>
            <span class="r46 r">pattern</span> = <span class="s">@&quot;
                (				# wrap whole match in $1
		        !\[
			        (.*?)		# alt text = $2
		        \]
		        \(			    # literal paren
			        [ \t]*
			        &lt;?(\S+?)&gt;?	# src url = $3
			        [ \t]*
			        (			# $4
			        ([&#39;\x22])	# quote char = $5
			        (.*?)		# title = $6
			        \5		    # matching quote
			        [ \t]*
			        )?			# title is optional
		        \)
		        )&quot;</span>;
 
            <span class="r45 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r45 r">text</span>, <span class="r46 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#88b259900e5b1c20" class="i method">ImageInlineEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <b>return</b> <span class="r45 r">text</span>;
        }
 
        <b>private string</b> <a id="57749b886650c94d" href="R/57749b886650c94d.html" target="n" data-glyph="76,1" class="i method">ImageReferenceEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r47 rd" class="r47 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r48 rd" class="r48 r">wholeMatch</span> = <span class="r47 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r49 rd" class="r49 r">altText</span> = <span class="r47 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r50 rd" class="r50 r">linkID</span> = <span class="r47 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r51 rd" class="r51 r">url</span> = <b>null</b>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r52 rd" class="r52 r">res</span> = <b>null</b>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r53 rd" class="r53 r">title</span> = <b>null</b>;
 
            <span class="c">// for shortcut links like ![this][].</span>
            <b>if</b> (<span class="r50 r">linkID</span>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>))
                <span class="r50 r">linkID</span> = <span class="r49 r">altText</span>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
 
            <span class="r49 r">altText</span> = <span class="r49 r">altText</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
 
            <b>if</b> (<a href="#874115dd0dafae17" class="i field">urls</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r50 r">linkID</span>] != <b>null</b>)
            {
                <span class="r51 r">url</span> = <a href="#874115dd0dafae17" class="i field">urls</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r50 r">linkID</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
 
                <span class="c">// We&#39;ve got to encode these to avoid conflicting with italics/bold.</span>
                <span class="r51 r">url</span> = <span class="r51 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
                <span class="r52 r">res</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;img src=\&quot;{0}\&quot; alt=\&quot;{1}\&quot;&quot;</span>, <span class="r51 r">url</span>, <span class="r49 r">altText</span>);
 
                <b>if</b> (<a href="#3270354a9701096f" class="i field">titles</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r50 r">linkID</span>] != <b>null</b>)
                {
                    <span class="r53 r">title</span> = <a href="#3270354a9701096f" class="i field">titles</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r50 r">linkID</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
                    <span class="r53 r">title</span> = <span class="r53 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
 
                    <span class="r52 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r53 r">title</span>);
                }
 
                <span class="r52 r">res</span> += <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a>;
            }
            <b>else</b>
            {
                <span class="c">// If there&#39;s no such link ID, leave intact:</span>
                <span class="r52 r">res</span> = <span class="r48 r">wholeMatch</span>;
            }
 
            <b>return</b> <span class="r52 r">res</span>;
        }
 
        <b>private string</b> <a id="88b259900e5b1c20" href="R/88b259900e5b1c20.html" target="n" data-glyph="76,1" class="i method">ImageInlineEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r54 rd" class="r54 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r55 rd" class="r55 r">altText</span> = <span class="r54 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r56 rd" class="r56 r">url</span> = <span class="r54 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r57 rd" class="r57 r">title</span> = <span class="r54 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[6].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r58 rd" class="r58 r">res</span> = <b>null</b>;
 
 
            <span class="r55 r">altText</span> = <span class="r55 r">altText</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
            <span class="r57 r">title</span> = <span class="r57 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\&quot;&quot;</span>, <span class="s">&quot;&amp;quot;&quot;</span>);
 
            <span class="c">// We&#39;ve got to encode these to avoid conflicting with italics/bold.</span>
            <span class="r56 r">url</span> = <span class="r56 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
            <span class="r58 r">res</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;img src=\&quot;{0}\&quot; alt=\&quot;{1}\&quot;&quot;</span>, <span class="r56 r">url</span>, <span class="r55 r">altText</span>);
 
            <span class="r57 r">title</span> = <span class="r57 r">title</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;*&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;*&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>()).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;_&quot;</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="s">&quot;_&quot;</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
            <span class="r58 r">res</span> += <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; title=\&quot;{0}\&quot;&quot;</span>, <span class="r57 r">title</span>);
 
            <span class="r58 r">res</span> += <a href="#e55b20f6aa29aebc" class="i field">emptyElementSuffix</a>;
            <b>return</b> <span class="r58 r">res</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process headers
 
        <b>private string</b> <a id="f8a89100ee2979cb" href="R/f8a89100ee2979cb.html" target="n" data-glyph="76,1" class="i method">DoHeaders</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r59 rd" class="r59 r">text</span>)
        {
            <span class="c">/*
            Setext-style headers:
            
            Header 1
            ========
	          
            Header 2
            --------
            */</span>
 
            <span class="r59 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r59 r">text</span>, <span class="s">@&quot;^(.+)[ \t]*\n=+[ \t]*\n+&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#a8db6775449861dc" class="i method">SetextHeader1Evaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            <span class="r59 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r59 r">text</span>, <span class="s">@&quot;^(.+)[ \t]*\n-+[ \t]*\n+&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#7050c5c38e1fe10c" class="i method">SetextHeader2Evaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <span class="c">/*
             atx-style headers:
                # Header 1
                ## Header 2
                ## Header 2 with closing hashes ##
                ...
                ###### Header 6
            */</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r60 rd" class="r60 r">pattern</span> = <span class="s">@&quot;
                ^(\#{1,6})	# $1 = string of #&#39;s
			    [ \t]*
			    (.+?)		# $2 = Header text
			    [ \t]*
			    \#*			# optional closing #&#39;s (not counted)
			    \n+&quot;</span>;
 
            <span class="r59 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r59 r">text</span>, <span class="r60 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#7996206b6cac28eb" class="i method">AtxHeaderEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <b>return</b> <span class="r59 r">text</span>;
        }
 
        <b>private string</b> <a id="a8db6775449861dc" href="R/a8db6775449861dc.html" target="n" data-glyph="76,1" class="i method">SetextHeader1Evaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r61 rd" class="r61 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r62 rd" class="r62 r">header</span> = <span class="r61 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;&lt;h1&gt;&quot;</span>, <a href="#a3bfefbc3f3d3684" class="i method">RunSpanGamut</a>(<span class="r62 r">header</span>), <span class="s">&quot;&lt;/h1&gt;\n\n&quot;</span>);
        }
 
        <b>private string</b> <a id="7050c5c38e1fe10c" href="R/7050c5c38e1fe10c.html" target="n" data-glyph="76,1" class="i method">SetextHeader2Evaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r63 rd" class="r63 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r64 rd" class="r64 r">header</span> = <span class="r63 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;&lt;h2&gt;&quot;</span>, <a href="#a3bfefbc3f3d3684" class="i method">RunSpanGamut</a>(<span class="r64 r">header</span>), <span class="s">&quot;&lt;/h2&gt;\n\n&quot;</span>);
        }
 
        <b>private string</b> <a id="7996206b6cac28eb" href="R/7996206b6cac28eb.html" target="n" data-glyph="76,1" class="i method">AtxHeaderEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r65 rd" class="r65 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r66 rd" class="r66 r">headerSig</span> = <span class="r65 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r67 rd" class="r67 r">headerText</span> = <span class="r65 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#40825b9a6e8f4b1e" class="i method">Concat</a>(<span class="s">&quot;&lt;h&quot;</span>, <span class="r66 r">headerSig</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>, <span class="s">&quot;&gt;&quot;</span>, <a href="#a3bfefbc3f3d3684" class="i method">RunSpanGamut</a>(<span class="r67 r">headerText</span>), <span class="s">&quot;&lt;/h&quot;</span>, <span class="r66 r">headerSig</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>, <span class="s">&quot;&gt;\n\n&quot;</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process ordered and unordered lists
 
        <b>private string</b> <a id="f7a0a60c85a6974d" href="R/f7a0a60c85a6974d.html" target="n" data-glyph="76,1" class="i method">DoLists</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r68 rd" class="r68 r">text</span>)
        {
            <span class="c">// Re-usable pattern to match any entirel ul or ol list:</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r69 rd" class="r69 r">pattern</span> = <b>null</b>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r70 rd" class="r70 r">wholeList</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">@&quot;
			(                               # $1 = whole list
			  (                             # $2
				[ ]{{0,{1}}}
			    ({0})                       # $3 = first list item marker
				[ \t]+
			  )
			  (?s:.+?)
			  (                             # $4
				  \z
				|
				  \n{{2,}}
				  (?=\S)
				  (?!                       # Negative lookahead for another list item marker
				  	[ \t]*
				  	{0}[ \t]+
				  )
			  )
			)&quot;</span>, <a href="#fa13051269c69db8" class="i field">markerAny</a>, <a href="#3869c16ed3620e2e" class="i field">tabWidth</a> - 1);
 
            <span class="c">// We use a different prefix before nested lists than top-level lists.</span>
            <span class="c">// See extended comment in _ProcessListItems().</span>
            <b>if</b> (<a href="#464fd498c7571c0d" class="i field">listLevel</a> &gt; 0)
            {
                <span class="r69 r">pattern</span> = <span class="s">&quot;^&quot;</span> + <span class="r70 r">wholeList</span>;
                <span class="r68 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r68 r">text</span>, <span class="r69 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#735fb44b3fa5064c" class="i method">ListEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            }
            <b>else</b>
            {
                <span class="r69 r">pattern</span> = <span class="s">@&quot;(?:(?&lt;=\n\n)|\A\n?)&quot;</span> + <span class="r70 r">wholeList</span>;
                <span class="r68 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r68 r">text</span>, <span class="r69 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#735fb44b3fa5064c" class="i method">ListEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
            }
 
            <b>return</b> <span class="r68 r">text</span>;
        }
 
        <b>private string</b> <a id="735fb44b3fa5064c" href="R/735fb44b3fa5064c.html" target="n" data-glyph="76,1" class="i method">ListEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r71 rd" class="r71 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r72 rd" class="r72 r">list</span> = <span class="r71 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r73 rd" class="r73 r">listType</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#ffaf97ebd1d02f3c" class="i method">IsMatch</a>(<span class="r71 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[3].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>, <a href="#60ff95040a7a9be4" class="i field">markerUL</a>) ? <span class="s">&quot;ul&quot;</span> : <span class="s">&quot;ol&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r74 rd" class="r74 r">result</span> = <b>null</b>;
 
            <span class="c">// Turn double returns into triple returns, so that we can make a</span>
            <span class="c">// paragraph for the last item in a list, if necessary:</span>
            <span class="r72 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r72 r">list</span>, <span class="s">@&quot;\n{2,}&quot;</span>, <span class="s">&quot;\n\n\n&quot;</span>);
            <span class="r74 r">result</span> = <a href="#c242e43bd6d9aa73" class="i method">ProcessListItems</a>(<span class="r72 r">list</span>, <a href="#fa13051269c69db8" class="i field">markerAny</a>);
            <span class="r74 r">result</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;&lt;{0}&gt;\n{1}&lt;/{0}&gt;\n&quot;</span>, <span class="r73 r">listType</span>, <span class="r74 r">result</span>);
 
            <b>return</b> <span class="r74 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Process the contents of a single ordered or unordered list, splitting it</span>
        <span class="c">///</span><span class="c"> into individual list items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="c242e43bd6d9aa73" href="R/c242e43bd6d9aa73.html" target="n" data-glyph="76,1" class="i method">ProcessListItems</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r75 rd" class="r75 r">list</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r76 rd" class="r76 r">marker</span>)
        {
            <span class="c">/*
	            The listLevel global keeps track of when we&#39;re inside a list.
	            Each time we enter a list, we increment it; when we leave a list,
	            we decrement. If it&#39;s zero, we&#39;re not in a list anymore.
	        
	            We do this because when we&#39;re not inside a list, we want to treat
	            something like this:
	        
	            	I recommend upgrading to version
	            	8. Oops, now this line is treated
	            	as a sub-list.
	        
	            As a single paragraph, despite the fact that the second line starts
	            with a digit-period-space sequence.
	        
	            Whereas when we&#39;re inside a list (or sub-list), that line will be
	            treated as the start of a sub-list. What a kludge, huh? This is
	            an aspect of Markdown&#39;s syntax that&#39;s hard to parse perfectly
	            without resorting to mind-reading. Perhaps the solution is to
	            change the syntax rules such that sub-lists must start with a
	            starting cardinal number; e.g. &quot;1.&quot; or &quot;a.&quot;.
            */</span>
 
            <a href="#464fd498c7571c0d" class="i field">listLevel</a>++;
 
            <span class="c">// Trim trailing blank lines:</span>
            <span class="r75 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r75 r">list</span>, <span class="s">@&quot;\n{2,}\z&quot;</span>, <span class="s">&quot;\n&quot;</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r77 rd" class="r77 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(
              <span class="s">@&quot;(\n)?                      # leading line = $1
                (^[ \t]*)                  # leading whitespace = $2
                ({0}) [ \t]+               # list marker = $3
		        ((?s:.+?)                  # list item text = $4
                (\n{{1,2}}))      
		        (?= \n* (\z | \2 ({0}) [ \t]+))&quot;</span>, <span class="r76 r">marker</span>);
 
            <span class="r75 r">list</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r75 r">list</span>, <span class="r77 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#b34e8bfd1a9930a8" class="i method">ListEvaluator2</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
            <a href="#464fd498c7571c0d" class="i field">listLevel</a>--;
            <b>return</b> <span class="r75 r">list</span>;
        }
 
        <b>private string</b> <a id="b34e8bfd1a9930a8" href="R/b34e8bfd1a9930a8.html" target="n" data-glyph="76,1" class="i method">ListEvaluator2</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r78 rd" class="r78 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r79 rd" class="r79 r">item</span> = <span class="r78 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[4].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r80 rd" class="r80 r">leadingLine</span> = <span class="r78 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
 
            <b>if</b> ((<span class="r80 r">leadingLine</span> != <b>null</b> &amp;&amp; <span class="r80 r">leadingLine</span> != <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>) || <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#ffaf97ebd1d02f3c" class="i method">IsMatch</a>(<span class="r79 r">item</span>, <span class="s">@&quot;\n{2,}&quot;</span>))
                <span class="r79 r">item</span> = <a href="#41977ac050e87df4" class="i method">RunBlockGamut</a>(<a href="#99f8ed941822b89a" class="i method">Outdent</a>(<span class="r79 r">item</span>));
            <b>else</b>
            {
                <span class="c">// Recursion for sub-lists:</span>
                <span class="r79 r">item</span> = <a href="#f7a0a60c85a6974d" class="i method">DoLists</a>(<a href="#99f8ed941822b89a" class="i method">Outdent</a>(<span class="r79 r">item</span>));
                <span class="r79 r">item</span> = <span class="r79 r">item</span>.<a href="@0@mscorlib/A.html#fc988fb267590f98" class="i method">TrimEnd</a>(<span class="s">&#39;\n&#39;</span>);
                <span class="r79 r">item</span> = <a href="#a3bfefbc3f3d3684" class="i method">RunSpanGamut</a>(<span class="r79 r">item</span>);
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;li&gt;{0}&lt;/li&gt;\n&quot;</span>, <span class="r79 r">item</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process code blocks
 
        <b>private string</b> <a id="f345ca4563177453" href="R/f345ca4563177453.html" target="n" data-glyph="76,1" class="i method">DoCodeBlocks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r81 rd" class="r81 r">text</span>)
        {
            <span class="c">// TODO: Should we allow 2 empty lines here or only one?</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r82 rd" class="r82 r">pattern</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">@&quot;
                    (?:\n\n|\A)
			        (	                     # $1 = the code block -- one or more lines, starting with a space/tab
			        (?:
				        (?:[ ]{{{0}}} | \t)  # Lines must start with a tab or a tab-width of spaces
				        .*\n+
			        )+
			        )
			        ((?=^[ ]{{0,{0}}}\S)|\Z) # Lookahead for non-space at line-start, or end of doc&quot;</span>,
                                            <a href="#3869c16ed3620e2e" class="i field">tabWidth</a>);
 
            <span class="r81 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r81 r">text</span>, <span class="r82 r">pattern</span>,
                                  <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#bd4434defa367f0b" class="i method">CodeBlockEvaluator</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <b>return</b> <span class="r81 r">text</span>;
        }
 
        <b>private string</b> <a id="bd4434defa367f0b" href="R/bd4434defa367f0b.html" target="n" data-glyph="76,1" class="i method">CodeBlockEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r83 rd" class="r83 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r84 rd" class="r84 r">codeBlock</span> = <span class="r83 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <span class="r84 r">codeBlock</span> = <a href="#9d1f9b9d02a909d0" class="i method">EncodeCode</a>(<a href="#99f8ed941822b89a" class="i method">Outdent</a>(<span class="r84 r">codeBlock</span>));
 
            <span class="c">// Trim leading newlines and trailing whitespace</span>
            <span class="r84 r">codeBlock</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r84 r">codeBlock</span>, <span class="s">@&quot;^\n+&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <span class="r84 r">codeBlock</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r84 r">codeBlock</span>, <span class="s">@&quot;\s+\z&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;\n\n&lt;pre&gt;&lt;code&gt;&quot;</span>, <span class="r84 r">codeBlock</span>, <span class="s">&quot;\n&lt;/code&gt;&lt;/pre&gt;\n\n&quot;</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process code spans
 
        <b>private string</b> <a id="f1751b52d670ff01" href="R/f1751b52d670ff01.html" target="n" data-glyph="76,1" class="i method">DoCodeSpans</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r85 rd" class="r85 r">text</span>)
        {
            <span class="c">/*
                *	Backtick quotes are used for &lt;code&gt;&lt;/code&gt; spans.
                *	You can use multiple backticks as the delimiters if you want to
                    include literal backticks in the code span. So, this input:
 
                    Just type ``foo `bar` baz`` at the prompt.
        
                    Will translate to:
        
                      &lt;p&gt;Just type &lt;code&gt;foo `bar` baz&lt;/code&gt; at the prompt.&lt;/p&gt;
        
                    There&#39;s no arbitrary limit to the number of backticks you
                    can use as delimters. If you need three consecutive backticks
                    in your code, use four for delimiters, etc.
        
                *	You can use spaces to get literal backticks at the edges:
        
                      ... type `` `bar` `` ...
        
                    Turns to:
        
                      ... type &lt;code&gt;`bar`&lt;/code&gt; ...	        
            */</span>
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r86 rd" class="r86 r">pattern</span> = <span class="s">@&quot;
                    (`+)		# $1 = Opening run of `
			        (.+?)		# $2 = The code block
			        (?&lt;!`)
			        \1
			        (?!`)&quot;</span>;
            <span class="r85 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r85 r">text</span>, <span class="r86 r">pattern</span>,
                                  <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#bd739ff2c53acf3d" class="i method">CodeSpanEvaluator</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <b>return</b> <span class="r85 r">text</span>;
        }
 
        <b>private string</b> <a id="bd739ff2c53acf3d" href="R/bd739ff2c53acf3d.html" target="n" data-glyph="76,1" class="i method">CodeSpanEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r87 rd" class="r87 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r88 rd" class="r88 r">s</span> = <span class="r87 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <span class="r88 r">s</span> = <span class="r88 r">s</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">@&quot;^[ \t]*&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">@&quot;[ \t]*$&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <span class="r88 r">s</span> = <a href="#9d1f9b9d02a909d0" class="i method">EncodeCode</a>(<span class="r88 r">s</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#17e1cc2f91f20974" class="i method">Concat</a>(<span class="s">&quot;&lt;code&gt;&quot;</span>, <span class="r88 r">s</span>, <span class="s">&quot;&lt;/code&gt;&quot;</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Encode/escape certain characters inside Markdown code runs
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode/escape certain characters inside Markdown code runs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The point is that in code, these characters are literals, and lose their </span>
        <span class="c">///</span><span class="c"> special Markdown meanings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private string</b> <a id="9d1f9b9d02a909d0" href="R/9d1f9b9d02a909d0.html" target="n" data-glyph="76,1" class="i method">EncodeCode</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r89 rd" class="r89 r">code</span>)
        {
            <span class="r89 r">code</span> = <span class="r89 r">code</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;&amp;&quot;</span>, <span class="s">&quot;&amp;amp;&quot;</span>).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;&lt;&quot;</span>, <span class="s">&quot;&amp;lt;&quot;</span>).<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;&gt;&quot;</span>, <span class="s">&quot;&amp;gt;&quot;</span>);
 
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r90 rd" class="r90 r">key</span> <b>in</b> <a href="#095dd688fd14db33" class="i field">escapeTable</a>.<a href="@0@mscorlib/A.html#d4c2d1ac82a925b3" class="i property">Keys</a>)
                <span class="r89 r">code</span> = <span class="r89 r">code</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="r90 r">key</span>, <a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r90 r">key</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
 
            <b>return</b> <span class="r89 r">code</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process bold and italics
 
        <b>private string</b> <a id="33315a82b93302ad" href="R/33315a82b93302ad.html" target="n" data-glyph="76,1" class="i method">DoItalicsAndBold</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r91 rd" class="r91 r">text</span>)
        {
            <span class="c">// &lt;strong&gt; must go first:</span>
            <span class="r91 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r91 r">text</span>, <span class="s">@&quot;(\*\*|__) (?=\S) (.+?[*_]*) (?&lt;=\S) \1&quot;</span>,
                                  <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#ef4a131353a76878" class="i method">BoldEvaluator</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <span class="c">// Then &lt;em&gt;:</span>
            <span class="r91 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r91 r">text</span>, <span class="s">@&quot;(\*|_) (?=\S) (.+?) (?&lt;=\S) \1&quot;</span>,
                                  <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#032c25d1c4249e17" class="i method">ItalicsEvaluator</a>),
                                  <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
            <b>return</b> <span class="r91 r">text</span>;
        }
 
        <b>private string</b> <a id="032c25d1c4249e17" href="R/032c25d1c4249e17.html" target="n" data-glyph="76,1" class="i method">ItalicsEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r92 rd" class="r92 r">match</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;em&gt;{0}&lt;/em&gt;&quot;</span>, <span class="r92 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
        }
 
        <b>private string</b> <a id="ef4a131353a76878" href="R/ef4a131353a76878.html" target="n" data-glyph="76,1" class="i method">BoldEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r93 rd" class="r93 r">match</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;strong&gt;{0}&lt;/strong&gt;&quot;</span>, <span class="r93 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[2].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process blockquotes
 
        <b>private string</b> <a id="7ad23ff387485534" href="R/7ad23ff387485534.html" target="n" data-glyph="76,1" class="i method">DoBlockQuotes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r94 rd" class="r94 r">text</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r95 rd" class="r95 r">pattern</span> =
                <span class="s">@&quot;(				        # Wrap whole match in $1
			    (
			    ^[ \t]*&gt;[ \t]?			# &#39;&gt;&#39; at the start of a line
				    .+\n				# rest of the first line
			    (.+\n)*					# subsequent consecutive lines
			    \n*						# blanks
			    )+
		    )&quot;</span>;
 
            <span class="r94 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r94 r">text</span>, <span class="r95 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#a089d57bc9e75d9c" class="i method">BlockQuoteEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
            <b>return</b> <span class="r94 r">text</span>;
        }
 
        <b>private string</b> <a id="a089d57bc9e75d9c" href="R/a089d57bc9e75d9c.html" target="n" data-glyph="76,1" class="i method">BlockQuoteEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r96 rd" class="r96 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r97 rd" class="r97 r">bq</span> = <span class="r96 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
 
            <span class="c">// Trim one level of quoting - trim whitespace-only lines</span>
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^[ \t]*&gt;[ \t]?&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^[ \t]+$&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <span class="r97 r">bq</span> = <a href="#41977ac050e87df4" class="i method">RunBlockGamut</a>(<span class="r97 r">bq</span>);
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;^&quot;</span>, <span class="s">&quot;  &quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <span class="c">// These leading spaces screw with &lt;pre&gt; content, so we need to fix that:</span>
            <span class="r97 r">bq</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r97 r">bq</span>, <span class="s">@&quot;(\s*&lt;pre&gt;.+?&lt;/pre&gt;)&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#882d76f020db5c7d" class="i method">BlockQuoteEvaluator2</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#edddd4e8e2241e93" class="i field">Singleline</a>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;blockquote&gt;\n{0}\n&lt;/blockquote&gt;\n\n&quot;</span>, <span class="r97 r">bq</span>);
        }
 
        <b>private string</b> <a id="882d76f020db5c7d" href="R/882d76f020db5c7d.html" target="n" data-glyph="76,1" class="i method">BlockQuoteEvaluator2</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r98 rd" class="r98 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r99 rd" class="r99 r">pre</span> = <span class="r98 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <span class="r99 r">pre</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r99 r">pre</span>, <span class="s">@&quot;^  &quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
 
            <b>return</b> <span class="r99 r">pre</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Create paragraph tags
 
        <b>private string</b> <a id="53940169192a0978" href="R/53940169192a0978.html" target="n" data-glyph="76,1" class="i method">FormParagraphs</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r100 rd" class="r100 r">text</span>)
        {
            <span class="c">// Strip leading and trailing lines:</span>
            <span class="r100 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r100 r">text</span>, <span class="s">@&quot;^\n+&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <span class="r100 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r100 r">text</span>, <span class="s">@&quot;\n+\z&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r101 rd" class="r101 r">grafs</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#8fc24fbfab2b1e7f" class="i method">Split</a>(<span class="r100 r">text</span>, <span class="s">@&quot;\n{2,}&quot;</span>);
 
            <span class="c">// Wrap &lt;p&gt; tags.</span>
            <b>for</b> (<b>int</b> <span id="r102 rd" class="r102 r">i</span> = 0; <span class="r102 r">i</span> &lt; <span class="r101 r">grafs</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r102 r">i</span>++)
            {
                <span class="c">// Milan Negovan: I&#39;m adding an additional check for an empty block of code.</span>
                <span class="c">// Otherwise an empty &lt;p&gt;&lt;/p&gt; is created.</span>
                <b>if</b> (<a href="#bb683682ec97a961" class="i field">htmlBlocks</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r101 r">grafs</span>[<span class="r102 r">i</span>]] == <b>null</b> &amp;&amp; <span class="r101 r">grafs</span>[<span class="r102 r">i</span>].<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r103 rd" class="r103 r">block</span> = <span class="r101 r">grafs</span>[<span class="r102 r">i</span>];
 
                    <span class="r103 r">block</span> = <a href="#a3bfefbc3f3d3684" class="i method">RunSpanGamut</a>(<span class="r103 r">block</span>);
                    <span class="r103 r">block</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r103 r">block</span>, <span class="s">@&quot;^([ \t]*)&quot;</span>, <span class="s">&quot;&lt;p&gt;&quot;</span>);
                    <span class="r103 r">block</span> += <span class="s">&quot;&lt;/p&gt;&quot;</span>;
 
                    <span class="r101 r">grafs</span>[<span class="r102 r">i</span>] = <span class="r103 r">block</span>;
                }
            }
 
            <span class="c">// Unhashify HTML blocks</span>
            <b>for</b> (<b>int</b> <span id="r104 rd" class="r104 r">i</span> = 0; <span class="r104 r">i</span> &lt; <span class="r101 r">grafs</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r104 r">i</span>++)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r105 rd" class="r105 r">block</span> = (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>)<a href="#bb683682ec97a961" class="i field">htmlBlocks</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r101 r">grafs</span>[<span class="r104 r">i</span>]];
 
                <b>if</b> (<span class="r105 r">block</span> != <b>null</b>)
                    <span class="r101 r">grafs</span>[<span class="r104 r">i</span>] = <span class="r105 r">block</span>;
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#881354baa56fc358" class="i method">Join</a>(<span class="s">&quot;\n\n&quot;</span>, <span class="r101 r">grafs</span>);
 
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process emails and links
 
        <b>private string</b> <a id="fa9b764d4be423a2" href="R/fa9b764d4be423a2.html" target="n" data-glyph="76,1" class="i method">DoAutoLinks</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r106 rd" class="r106 r">text</span>)
        {
            <span class="r106 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#f6fa3a1296c0770c" class="i method">Replace</a>(<span class="r106 r">text</span>, <span class="s">&quot;&lt;((https?|ftp):[^&#39;\&quot;&gt;\\s]+)&gt;&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#cacbd4772f0ec1e7" class="i method">HyperlinkEvaluator</a>));
 
            <span class="c">// Email addresses: &lt;address@domain.foo&gt;</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r107 rd" class="r107 r">pattern</span> =
                <span class="s">@&quot;&lt;
                (?:mailto:)?
		        (
			        [-.\w]+
			        \@
			        [-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+
		        )
		        &gt;&quot;</span>;
 
            <span class="r106 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r106 r">text</span>, <span class="r107 r">pattern</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#daaf77957856182d" class="i method">EmailEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#8c4a7c494a4050d5" class="i field">IgnoreCase</a> | <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#3ab76ad67a735d21" class="i field">IgnorePatternWhitespace</a>);
 
            <b>return</b> <span class="r106 r">text</span>;
        }
 
        <b>private string</b> <a id="cacbd4772f0ec1e7" href="R/cacbd4772f0ec1e7.html" target="n" data-glyph="76,1" class="i method">HyperlinkEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r108 rd" class="r108 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r109 rd" class="r109 r">link</span> = <span class="r108 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r109 r">link</span>);
        }
 
        <b>private string</b> <a id="daaf77957856182d" href="R/daaf77957856182d.html" target="n" data-glyph="76,1" class="i method">EmailEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r110 rd" class="r110 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r111 rd" class="r111 r">email</span> = <a href="#fd7ffcf9c2c1520e" class="i method">UnescapeSpecialChars</a>(<span class="r110 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
 
            <span class="c">/*
                Input: an email address, e.g. &quot;foo@example.com&quot;
            
                Output: the email address as a mailto link, with each character
                        of the address encoded as either a decimal or hex entity, in
                        the hopes of foiling most address harvesting spam bots. E.g.:
            
                  &lt;a href=&quot;&amp;#x6D;&amp;#97;&amp;#105;&amp;#108;&amp;#x74;&amp;#111;:&amp;#102;&amp;#111;&amp;#111;&amp;#64;&amp;#101;
                    x&amp;#x61;&amp;#109;&amp;#x70;&amp;#108;&amp;#x65;&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&quot;&gt;&amp;#102;&amp;#111;&amp;#111;
                    &amp;#64;&amp;#101;x&amp;#x61;&amp;#109;&amp;#x70;&amp;#108;&amp;#x65;&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;
            
                Based by a filter by Matthew Wickline, posted to the BBEdit-Talk
                mailing list: &lt;http://tinyurl.com/yu7ue&gt;
            
             */</span>
            <span class="r111 r">email</span> = <span class="s">&quot;mailto:&quot;</span> + <span class="r111 r">email</span>;
 
            <span class="c">// leave &#39;:&#39; alone (to spot mailto: later) </span>
            <span class="r111 r">email</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#f6fa3a1296c0770c" class="i method">Replace</a>(<span class="r111 r">email</span>, <span class="s">@&quot;([^\:])&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#08a7d0d8463b2387" class="i method">EncodeEmailEvaluator</a>));
 
            <span class="r111 r">email</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&lt;a href=\&quot;{0}\&quot;&gt;{0}&lt;/a&gt;&quot;</span>, <span class="r111 r">email</span>);
 
            <span class="c">// strip the mailto: from the visible part</span>
            <span class="r111 r">email</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r111 r">email</span>, <span class="s">&quot;\&quot;&gt;.+?:&quot;</span>, <span class="s">&quot;\&quot;&gt;&quot;</span>);
            <b>return</b> <span class="r111 r">email</span>;
        }
 
        <b>private string</b> <a id="08a7d0d8463b2387" href="R/08a7d0d8463b2387.html" target="n" data-glyph="76,1" class="i method">EncodeEmailEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r112 rd" class="r112 r">match</span>)
        {
            <b>char</b> <span id="r113 rd" class="r113 r">c</span> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#79e3df6ed04452cc" class="i method">ToChar</a>(<span class="r112 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>);
 
            <a href="@0@mscorlib/A.html#bb77e610694e64ca" class="t t">Random</a> <span id="r114 rd" class="r114 r">rnd</span> = <b>new</b> <a href="@0@mscorlib/A.html#5d22f8880fc9f8d9" class="t constructor">Random</a>();
            <b>int</b> <span id="r115 rd" class="r115 r">r</span> = <span class="r114 r">rnd</span>.<a href="@0@mscorlib/A.html#ddd1e9e09c70bab5" class="i method">Next</a>(0, 100);
 
            <span class="c">// Original author note:</span>
            <span class="c">// Roughly 10% raw, 45% hex, 45% dec </span>
            <span class="c">// &#39;@&#39; *must* be encoded. I insist.</span>
            <b>if</b> (<span class="r115 r">r</span> &gt; 90 &amp;&amp; <span class="r113 r">c</span> != <span class="s">&#39;@&#39;</span>) <b>return</b> <span class="r113 r">c</span>.<a href="@0@mscorlib/A.html#8da116b4ffb677f2" class="i method">ToString</a>();
            <b>if</b> (<span class="r115 r">r</span> &lt; 45) <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&amp;#x{0:x};&quot;</span>, (<b>int</b>)<span class="r113 r">c</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;&amp;#x{0:x};&quot;</span>, (<b>int</b>)<span class="r113 r">c</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> EncodeAmpsAndAngles, EncodeBackslashEscapes, UnescapeSpecialChars, Outdent, UnslashQuotes
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Smart processing for ampersands and angle brackets that need to be encoded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="85190ba63f9c062f" href="R/85190ba63f9c062f.html" target="n" data-glyph="76,1" class="i method">EncodeAmpsAndAngles</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r116 rd" class="r116 r">text</span>)
        {
            <span class="c">// Ampersand-encoding based entirely on Nat Irons&#39;s Amputator MT plugin:</span>
            <span class="c">// http://bumppo.net/projects/amputator/</span>
 
            <span class="r116 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#825196ff9130bce9" class="i method">Replace</a>(<span class="r116 r">text</span>, <span class="s">@&quot;&amp;(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)&quot;</span>, <span class="s">&quot;&amp;amp;&quot;</span>);
 
            <span class="c">// Encode naked &lt;&#39;s</span>
            <span class="r116 r">text</span> = <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r116 r">text</span>, <span class="s">@&quot;&lt;(?![a-z/?\$!])&quot;</span>, <span class="s">&quot;&amp;lt;&quot;</span>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#8c4a7c494a4050d5" class="i field">IgnoreCase</a>);
 
            <b>return</b> <span class="r116 r">text</span>;
        }
 
        <b>private string</b> <a id="58af98b7d7be7fee" href="R/58af98b7d7be7fee.html" target="n" data-glyph="76,1" class="i method">EncodeBackslashEscapes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r117 rd" class="r117 r">value</span>)
        {
            <span class="c">// Must process escaped backslashes first.</span>
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r118 rd" class="r118 r">key</span> <b>in</b> <a href="#65510e74856999b0" class="i field">backslashEscapeTable</a>.<a href="@0@mscorlib/A.html#d4c2d1ac82a925b3" class="i property">Keys</a>)
                <span class="r117 r">value</span> = <span class="r117 r">value</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="r118 r">key</span>, <a href="#65510e74856999b0" class="i field">backslashEscapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r118 r">key</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>());
 
            <b>return</b> <span class="r117 r">value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Swap back in all the special characters we&#39;ve hidden. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="fd7ffcf9c2c1520e" href="R/fd7ffcf9c2c1520e.html" target="n" data-glyph="76,1" class="i method">UnescapeSpecialChars</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r119 rd" class="r119 r">text</span>)
        {
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r120 rd" class="r120 r">key</span> <b>in</b> <a href="#095dd688fd14db33" class="i field">escapeTable</a>.<a href="@0@mscorlib/A.html#d4c2d1ac82a925b3" class="i property">Keys</a>)
                <span class="r119 r">text</span> = <span class="r119 r">text</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<a href="#095dd688fd14db33" class="i field">escapeTable</a><a href="@0@mscorlib/A.html#cd969ff2abf65ce3">[</a><span class="r120 r">key</span>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>(), <span class="r120 r">key</span>);
 
            <b>return</b> <span class="r119 r">text</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remove one level of line-leading tabs or spaces</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="99f8ed941822b89a" href="R/99f8ed941822b89a.html" target="n" data-glyph="76,1" class="i method">Outdent</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r121 rd" class="r121 r">block</span>)
        {
            <b>return</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#6cb5310610af2845" class="i method">Replace</a>(<span class="r121 r">block</span>, <span class="s">@&quot;^(\t|[ ]{1,&quot;</span> + <a href="#3869c16ed3620e2e" class="i field">tabWidth</a>.<a href="@0@mscorlib/A.html#8d6f2d8bc0589463" class="i method">ToString</a>() + <span class="s">@&quot;})&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Replace tabs with spaces and pad them to tab width
 
        <b>private string</b> <a id="6e36340e38e5b0b4" href="R/6e36340e38e5b0b4.html" target="n" data-glyph="76,1" class="i method">Detab</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r122 rd" class="r122 r">text</span>)
        {
            <span class="c">// Inspired from a post by Bart Lateur: </span>
            <span class="c">// http://www.nntp.perl.org/group/perl.macperl.anyperl/154</span>
            <b>return</b> <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a>.<a href="@0@System/A.html#2b0d89103af2a957" class="i method">Replace</a>(<span class="r122 r">text</span>, <span class="s">@&quot;^(.*?)\t&quot;</span>, <b>new</b> <span class="t">MatchEvaluator</span>(<a href="#57fa3fbf46d9acb9" class="i method">TabEvaluator</a>), <a href="@0@System/A.html#09480297afa1a686" class="t t">RegexOptions</a>.<a href="@0@System/A.html#58cb536c9fb96071" class="i field">Multiline</a>);
        }
 
        <b>private string</b> <a id="57fa3fbf46d9acb9" href="R/57fa3fbf46d9acb9.html" target="n" data-glyph="76,1" class="i method">TabEvaluator</a>(<a href="@0@System/A.html#d8a604d3af777b1c" class="t t">Match</a> <span id="r123 rd" class="r123 r">match</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r124 rd" class="r124 r">leading</span> = <span class="r123 r">match</span>.<a href="@0@System/A.html#882064d8e42ed216" class="i property">Groups</a>[1].<a href="@0@System/A.html#5cf0d171c91c6cc1" class="i property">Value</a>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55b2f6374a7cf7c1" class="i method">Concat</a>(<span class="r124 r">leading</span>, <a href="#8f9a5c15adfa7291" class="i method">RepeatString</a>(<span class="s">&quot; &quot;</span>, <a href="#3869c16ed3620e2e" class="i field">tabWidth</a> - <span class="r124 r">leading</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> % <a href="#3869c16ed3620e2e" class="i field">tabWidth</a>));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper methods (RepeatString &amp; ComputeMD5)
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is to emulate what&#39;s evailable in PHP</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">text</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">count</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="8f9a5c15adfa7291" href="R/8f9a5c15adfa7291.html" target="n" data-glyph="76,1" class="i method">RepeatString</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r125 rd" class="r125 r">text</span>, <b>int</b> <span id="r126 rd" class="r126 r">count</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r127 rd" class="r127 r">res</span> = <b>null</b>;
 
            <b>for</b> (<b>int</b> <span id="r128 rd" class="r128 r">i</span> = 0; <span class="r128 r">i</span> &lt; <span class="r126 r">count</span>; <span class="r128 r">i</span>++)
                <span class="r127 r">res</span> += <span class="r125 r">text</span>;
 
            <b>return</b> <span class="r127 r">res</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calculate an MD5 hash of an arbitrary string</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">text</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="52dd542615ea5ef9" href="R/52dd542615ea5ef9.html" target="n" data-glyph="76,1" class="i method">ComputeMD5</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r129 rd" class="r129 r">text</span>)
        {
            <a href="@0@mscorlib/A.html#c7a9f849977ccfaa" class="t t">MD5</a> <span id="r130 rd" class="r130 r">algo</span> = <a href="@0@mscorlib/A.html#c7a9f849977ccfaa" class="t t">MD5</a>.<a href="@0@mscorlib/A.html#dbd8d3af8cb2e795" class="i method">Create</a>();
            <b>byte</b>[] <span id="r131 rd" class="r131 r">plainText</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="r129 r">text</span>);
            <b>byte</b>[] <span id="r132 rd" class="r132 r">hashedText</span> = <span class="r130 r">algo</span>.<a href="@0@mscorlib/A.html#a71a3cba2c656040" class="i method">ComputeHash</a>(<span class="r131 r">plainText</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r133 rd" class="r133 r">res</span> = <b>null</b>;
 
            <b>foreach</b> (<b>byte</b> <span id="r134 rd" class="r134 r">b</span> <b>in</b> <span class="r132 r">hashedText</span>)
                <span class="r133 r">res</span> += <span class="r134 r">b</span>.<a href="@0@mscorlib/A.html#51506b5791391f8f" class="i method">ToString</a>(<span class="s">&quot;x2&quot;</span>);
 
            <b>return</b> <span class="r133 r">res</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}</pre></td></tr></table></div></body></html>
