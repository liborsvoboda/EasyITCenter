<!DOCTYPE html>
<html><head><title>Dialog.xaml.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(221);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EASYTools.SqlConnectionDialog/Dialog.xaml.cs" target="_top">Dialog.xaml.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EASYTools.SqlConnectionDialog" target="_top">..\..\..\EASY-TOOLS\EASYTools.SqlConnectionDialog\EASYTools.SqlConnectionDialog.csproj</a> (EASYTools.SqlConnectionDialog)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Data</span>.<span class="i n">SqlClient</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Input</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Threading</span>;
 
<b>namespace</b> <span class="i n">EASYTools</span>.<span class="i n">SqlConnectionDialog</span>
{
	<span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
	<span class="c">///</span><span class="c">     Sql connection window</span>
	<span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
	<b>internal</b> <a href="P/e39199a8b5036d1f.html" target="s" class="k">partial</a> <b>class</b> <a id="e39199a8b5036d1f" href="R/e39199a8b5036d1f.html" target="n" data-glyph="2,0" class="t t">Dialog</a> : <a href="@0@System/A.html#fd4b42d7e29d53e5" class="t t">INotifyPropertyChanged</a>
	{
		<b>private const string</b> <a id="b5c4ed5a967afb35" href="R/b5c4ed5a967afb35.html" target="n" data-glyph="10,1" class="i field">WindowsAuthentication</a> = <span class="s">&quot;Windows&quot;</span>;
		<b>private const string</b> <a id="595574f9f0e5bc37" href="R/595574f9f0e5bc37.html" target="n" data-glyph="10,1" class="i field">SqlServerAutentication</a> = <span class="s">&quot;SQL server authentication&quot;</span>;
		<b>public event</b> <a href="@0@System/A.html#670754815f6804ff" class="t t">PropertyChangedEventHandler</a> <a id="dafb3753cc991183" href="R/dafb3753cc991183.html" target="n" data-glyph="30,1" class="i">PropertyChanged</a>;
 
        <b>private readonly string</b> <a id="bc4c5bb059bb982a" href="R/bc4c5bb059bb982a.html" target="n" data-glyph="46,1" class="i field">IsValidPropertyName</a> = <span class="s">&quot;IsValid&quot;</span>;
		<b>private string</b> <a id="a2b927bd392368e6" href="R/a2b927bd392368e6.html" target="n" data-glyph="46,1" class="i field">authentication</a>;
		<b>private string</b> <a id="c1c88f9e60b800b6" href="R/c1c88f9e60b800b6.html" target="n" data-glyph="46,1" class="i field">databaseName</a>;
		<b>private string</b> <a id="f0470e74ddba7de1" href="R/f0470e74ddba7de1.html" target="n" data-glyph="46,1" class="i field">serverName</a>;
		<b>private string</b> <a id="187d97598cfbae2e" href="R/187d97598cfbae2e.html" target="n" data-glyph="46,1" class="i field">userName</a>;
 
		<b>public</b> <a id="6837e2d01c0728be" href="R/6837e2d01c0728be.html" target="n" data-glyph="72,1" class="t constructor">Dialog</a>()
		{
			<a href="obj/Debug/Dialog.g.cs.html#5ff6a5af68f5aa82" class="i method">InitializeComponent</a>();
			<a href="#659c0998cb962372" class="i method">InitDataContext</a>();
			<a href="#b74e360ea53a956a" class="i method">SetupControls</a>();
			<a href="#80066f914632e93e" class="i method">InitCommands</a>();
		}
 
		<b>public string</b> <a id="4d845646e3aeb6b7" href="R/4d845646e3aeb6b7.html" target="n" data-glyph="102,1" class="i property">ServerName</a>
		{
			<b>get</b> { <b>return</b> <a href="#f0470e74ddba7de1" class="i field">serverName</a>; }
			<b>set</b>
			{
				<a href="#f0470e74ddba7de1" class="i field">serverName</a> = <b>value</b>;
				<a href="#e5a38af01b2ef4da" class="i method">OnPropertyChanged</a>(<a href="#bc4c5bb059bb982a" class="i field">IsValidPropertyName</a>);
			}
		}
 
		<b>public string</b> <a id="8a81340564fa1f8d" href="R/8a81340564fa1f8d.html" target="n" data-glyph="102,1" class="i property">DatabaseName</a>
		{
			<b>get</b> { <b>return</b> <a href="#c1c88f9e60b800b6" class="i field">databaseName</a>; }
			<b>set</b>
			{
				<a href="#c1c88f9e60b800b6" class="i field">databaseName</a> = <b>value</b>;
				<a href="#8362325b9894523e" class="i method">NotifyIsValid</a>();
			}
		}
 
		<b>public string</b> <a id="e3df4e7fca89e3ae" href="R/e3df4e7fca89e3ae.html" target="n" data-glyph="102,1" class="i property">Authentication</a>
		{
			<b>get</b> { <b>return</b> <a href="#a2b927bd392368e6" class="i field">authentication</a>; }
			<b>set</b>
			{
				<a href="#a2b927bd392368e6" class="i field">authentication</a> = <b>value</b>;
				<a href="#8362325b9894523e" class="i method">NotifyIsValid</a>();
			}
		}
 
		<b>public string</b> <a id="42d8f84bb9197732" href="R/42d8f84bb9197732.html" target="n" data-glyph="102,1" class="i property">UserName</a>
		{
			<b>get</b> { <b>return</b> <a href="#187d97598cfbae2e" class="i field">userName</a>; }
			<b>set</b>
			{
				<a href="#187d97598cfbae2e" class="i field">userName</a> = <b>value</b>;
				<a href="#8362325b9894523e" class="i method">NotifyIsValid</a>();
			}
		}
 
		<b>public string</b>[] <a id="7285daa8f5399031" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">AuthenticationModes</a> { <b>get</b>; } = {<a href="#b5c4ed5a967afb35" class="i field">WindowsAuthentication</a>, <a href="#595574f9f0e5bc37" class="i field">SqlServerAutentication</a>};
 
		<b>public bool</b> <a id="2cd03b6b6c722c6f" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">IsValid</a> =&gt; <a href="#76c382c26db2609c" class="i method">Validate</a>();
 
		<b>public bool</b> <a id="38b4ae163d978fa0" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">IsCredentialInputEnabled</a> =&gt; <a href="#e3df4e7fca89e3ae" class="i property">Authentication</a> == <a href="#595574f9f0e5bc37" class="i field">SqlServerAutentication</a>;
 
		<b>public string</b> <a id="77ccf4566a910793" href="R/77ccf4566a910793.html" target="n" data-glyph="102,1" class="i property">ConnectionString</a> { <b>get</b>; <b>private set</b>; }
 
 
		<b>public</b> <a href="@0@System/A.html#f0e0f4acfe262659" class="t t">ICommand</a> <a id="2ab19a9a1d5d2aa5" href="R/2ab19a9a1d5d2aa5.html" target="n" data-glyph="102,1" class="i property">TestCommand</a> { <b>get</b>; <b>set</b>; }
 
		<b>public</b> <a href="@0@System/A.html#f0e0f4acfe262659" class="t t">ICommand</a> <a id="442e073dccf4b26c" href="R/442e073dccf4b26c.html" target="n" data-glyph="102,1" class="i property">CancelCommand</a> { <b>get</b>; <b>set</b>; }
 
		<b>public</b> <a href="@0@System/A.html#f0e0f4acfe262659" class="t t">ICommand</a> <a id="18c11a19a2b124f2" href="R/18c11a19a2b124f2.html" target="n" data-glyph="102,1" class="i property">OkCommand</a> { <b>get</b>; <b>set</b>; }
 
 
		<b>private void</b> <a id="b74e360ea53a956a" href="R/b74e360ea53a956a.html" target="n" data-glyph="76,1" class="i method">SetupControls</a>()
		{
			<a href="obj/Debug/Dialog.g.cs.html#a57ceddb1e8c5170" class="i field">ServerNameTextBox</a>.<a href="@0@PresentationCore/A.html#0e11f7ae56f1c30f" class="i method">Focus</a>();
			<a href="obj/Debug/Dialog.g.cs.html#19ad0b130b0a571a" class="i field">PasswordBox</a>.<a href="@0@PresentationFramework/A.html#8acdf645fca8464f" class="i">PasswordChanged</a> += (<span id="r0 rd" class="r0 r">sender</span>, <span id="r1 rd" class="r1 r">args</span>) =&gt; { <a href="#e5a38af01b2ef4da" class="i method">OnPropertyChanged</a>(<a href="#bc4c5bb059bb982a" class="i field">IsValidPropertyName</a>); };
			<a href="#e3df4e7fca89e3ae" class="i property">Authentication</a> = <a href="#b5c4ed5a967afb35" class="i field">WindowsAuthentication</a>;
 
			<a href="@0@PresentationCore/A.html#798084dd6c266279" class="i">IsVisibleChanged</a> += (<span id="r2 rd" class="r2 r">sender</span>, <span id="r3 rd" class="r3 r">args</span>) =&gt;
			{
				<b>if</b> (!<a href="@0@PresentationCore/A.html#90bc97a020426061" class="i property">IsVisible</a>)
				{
					<b>return</b>;
				}
 
				<span class="c">//activate wpf window. see http://stackoverflow.com/questions/257587/bring-a-window-to-the-front-in-wpf</span>
				<a href="@0@PresentationFramework/A.html#5dba8bee218265c4" class="i method">Activate</a>();
				<a href="@0@PresentationFramework/A.html#9345a405b71a7b1a" class="i property">Topmost</a> = <b>true</b>;  <span class="c">// important</span>
				<a href="@0@PresentationFramework/A.html#9345a405b71a7b1a" class="i property">Topmost</a> = <b>false</b>; <span class="c">// important</span>
				<a href="@0@PresentationCore/A.html#0e11f7ae56f1c30f" class="i method">Focus</a>();
 
				<span class="c">//set focus on textbox. see http://stackoverflow.com/questions/13955340/keyboard-focus-does-not-work-on-text-box-in-wpf</span>
				<a href="@0@WindowsBase/A.html#bd03df1631104fbc" class="i property">Dispatcher</a>.<a href="@0@WindowsBase/A.html#bcbefade88f12503" class="i method">BeginInvoke</a>(<a href="@0@WindowsBase/A.html#af2d44a802e4535c" class="t t">DispatcherPriority</a>.<a href="@0@WindowsBase/A.html#57171cb6115df956" class="i field">Input</a>,
					<b>new</b> <span class="t">Action</span>(() =&gt;
					{
						<a href="obj/Debug/Dialog.g.cs.html#a57ceddb1e8c5170" class="i field">ServerNameTextBox</a>.<a href="@0@PresentationCore/A.html#0e11f7ae56f1c30f" class="i method">Focus</a>(); <span class="c">// Set Logical Focus</span>
						<a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>.<a href="@0@PresentationCore/A.html#f2c91036443df9aa" class="i method">Focus</a>(<a href="obj/Debug/Dialog.g.cs.html#a57ceddb1e8c5170" class="i field">ServerNameTextBox</a>); <span class="c">// Set Keyboard Focus</span>
					}));
			};
		}
 
		<b>private void</b> <a id="80066f914632e93e" href="R/80066f914632e93e.html" target="n" data-glyph="76,1" class="i method">InitCommands</a>()
		{
			<a href="#2ab19a9a1d5d2aa5" class="i property">TestCommand</a> = <b>new</b> <a href="Command.cs.html#f343f4b202b1343c" class="t constructor">Command</a>(<span id="r4 rd" class="r4 r">x</span> =&gt; <a href="#4562846b98ec52b0" class="i method">Test</a>());
			<a href="#18c11a19a2b124f2" class="i property">OkCommand</a> = <b>new</b> <a href="Command.cs.html#f343f4b202b1343c" class="t constructor">Command</a>(<span id="r5 rd" class="r5 r">x</span> =&gt; <a href="#790f923832a97462" class="i method">Ok</a>());
			<a href="#442e073dccf4b26c" class="i property">CancelCommand</a> = <b>new</b> <a href="Command.cs.html#f343f4b202b1343c" class="t constructor">Command</a>(<span id="r6 rd" class="r6 r">x</span> =&gt; <a href="#a250ec2364232a98" class="i method">Cancel</a>());
		}
 
		<b>private void</b> <a id="659c0998cb962372" href="R/659c0998cb962372.html" target="n" data-glyph="76,1" class="i method">InitDataContext</a>()
		{
			<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a> = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>;
		}
 
		<b>private void</b> <a id="790f923832a97462" href="R/790f923832a97462.html" target="n" data-glyph="76,1" class="i method">Ok</a>()
		{
			<a href="#77ccf4566a910793" class="i property">ConnectionString</a> = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="#ec4d9dc863a50e3e" class="i method">BuildConnectionString</a>();
			<a href="@0@PresentationFramework/A.html#82d83d68eca4bf03" class="i property">DialogResult</a> = <b>true</b>;
		}
 
		<b>private void</b> <a id="a250ec2364232a98" href="R/a250ec2364232a98.html" target="n" data-glyph="76,1" class="i method">Cancel</a>()
		{
			<a href="@0@PresentationFramework/A.html#82d83d68eca4bf03" class="i property">DialogResult</a> = <b>false</b>;
		}
 
		<b>private void</b> <a id="4562846b98ec52b0" href="R/4562846b98ec52b0.html" target="n" data-glyph="76,1" class="i method">Test</a>()
		{
			<b>bool</b> <span id="r7 rd" class="r7 r">success</span> = <b>true</b>;
			
			<b>try</b>
			{
				<b>using</b> (<a href="@0@System.Data/A.html#48932d2b804ed473" class="k">var</a> <span id="r8 rd" class="r8 r">connection</span> = <b>new</b> <a href="@0@System.Data/A.html#5bfcbd0806b49ca2" class="t constructor">SqlConnection</a>(<a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="#ec4d9dc863a50e3e" class="i method">BuildConnectionString</a>()))
				{
					<span class="r8 r">connection</span>.<a href="@0@System.Data/A.html#ac652552a54adc78" class="i method">Open</a>();
					<span class="r8 r">connection</span>.<a href="@0@System.Data/A.html#9414944f8fe487ef" class="i method">Close</a>();
				}
			}
			<b>catch</b>
			{
				<span class="r7 r">success</span> = <b>false</b>;
			}
 
			<a href="@0@PresentationFramework/A.html#5f466a86dcc227ac" class="t t">MessageBox</a>.<a href="@0@PresentationFramework/A.html#b0b05e2016dddf55" class="i method">Show</a>(<a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>, <span class="r7 r">success</span> ? <span class="s">&quot;Connection succeeded&quot;</span> : <span class="s">&quot;Connection failed&quot;</span>);
		}
 
		<b>private string</b> <a id="ec4d9dc863a50e3e" href="R/ec4d9dc863a50e3e.html" target="n" data-glyph="76,1" class="i method">BuildConnectionString</a>()
		{
			<a href="@0@System.Data/A.html#82a8a113eee683b8" class="k">var</a> <span id="r9 rd" class="r9 r">builder</span> = <b>new</b> <a href="@0@System.Data/A.html#acaf5687e2ab42a8" class="t constructor">SqlConnectionStringBuilder</a>
			{
				[<span class="s">&quot;Data Source&quot;</span>] = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="#4d845646e3aeb6b7" class="i property">ServerName</a>,
				[<span class="s">&quot;Initial Catalog&quot;</span>] = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="#8a81340564fa1f8d" class="i property">DatabaseName</a>
			};
 
			<b>if</b> (<a href="#e3df4e7fca89e3ae" class="i property">Authentication</a> == <a href="#b5c4ed5a967afb35" class="i field">WindowsAuthentication</a>)
			{
				<span class="r9 r">builder</span><a href="@0@System.Data/A.html#5ac15bffd9793211">[</a><span class="s">&quot;Integrated Security&quot;</span>] = <span class="s">&quot;True&quot;</span>;
                <span class="c">//builder[&quot;Trusted Connection&quot;] = &quot;True&quot;;</span>
            }
			<b>else</b>
			{
				<span class="r9 r">builder</span><a href="@0@System.Data/A.html#5ac15bffd9793211">[</a><span class="s">&quot;User Id&quot;</span>] = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="#42d8f84bb9197732" class="i property">UserName</a>;
				<span class="r9 r">builder</span><a href="@0@System.Data/A.html#5ac15bffd9793211">[</a><span class="s">&quot;Password&quot;</span>] = <a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>.<a href="obj/Debug/Dialog.g.cs.html#19ad0b130b0a571a" class="i field">PasswordBox</a>.<a href="@0@PresentationFramework/A.html#b61d59d675a2381e" class="i property">Password</a>;
			}
			<b>return</b> <span class="r9 r">builder</span>.<a href="@0@System.Data/A.html#23cb62da5c0c684b" class="i property">ConnectionString</a>;
		}
 
		<b>private void</b> <a id="8362325b9894523e" href="R/8362325b9894523e.html" target="n" data-glyph="76,1" class="i method">NotifyIsValid</a>()
		{
			<a href="#e5a38af01b2ef4da" class="i method">OnPropertyChanged</a>(<a href="#bc4c5bb059bb982a" class="i field">IsValidPropertyName</a>);
			<a href="#e5a38af01b2ef4da" class="i method">OnPropertyChanged</a>(<span class="s">&quot;IsCredentialInputEnabled&quot;</span>);
		}
 
		<b>private bool</b> <a id="76c382c26db2609c" href="R/76c382c26db2609c.html" target="n" data-glyph="76,1" class="i method">Validate</a>()
		{
			<b>return</b> !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#8a81340564fa1f8d" class="i property">DatabaseName</a>)
			       &amp;&amp; !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#4d845646e3aeb6b7" class="i property">ServerName</a>)
			       &amp;&amp; ((<a href="#e3df4e7fca89e3ae" class="i property">Authentication</a> == <a href="#b5c4ed5a967afb35" class="i field">WindowsAuthentication</a> ||
			            (<a href="#e3df4e7fca89e3ae" class="i property">Authentication</a> == <a href="#595574f9f0e5bc37" class="i field">SqlServerAutentication</a> &amp;&amp; !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#42d8f84bb9197732" class="i property">UserName</a>) &amp;&amp; !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="obj/Debug/Dialog.g.cs.html#19ad0b130b0a571a" class="i field">PasswordBox</a>.<a href="@0@PresentationFramework/A.html#b61d59d675a2381e" class="i property">Password</a>))));
		}
 
		<b>protected virtual void</b> <a id="e5a38af01b2ef4da" href="R/e5a38af01b2ef4da.html" target="n" data-glyph="75,1" class="i method">OnPropertyChanged</a>([<a href="@0@mscorlib/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">propertyName</span> = <b>null</b>)
		{
			<a href="#dafb3753cc991183" class="i">PropertyChanged</a>?.<a href="@0@System/A.html#c66222f7abfe2e28" class="i method">Invoke</a>(<a href="P/e39199a8b5036d1f.html#e39199a8b5036d1f" class="k">this</a>, <b>new</b> <a href="@0@System/A.html#76958b0a96ed2a2e" class="t constructor">PropertyChangedEventArgs</a>(<span class="r10 r">propertyName</span>));
		}
 
        <b>internal static bool</b> <a id="1181e9203181531f" href="R/1181e9203181531f.html" target="n" data-glyph="74,1" class="i method">TestConnection</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">conn</span>)
        {
            <b>bool</b> <span id="r12 rd" class="r12 r">success</span> = <b>true</b>;
 
            <b>try</b>
            {
                <b>using</b> (<a href="@0@System.Data/A.html#48932d2b804ed473" class="k">var</a> <span id="r13 rd" class="r13 r">connection</span> = <b>new</b> <a href="@0@System.Data/A.html#5bfcbd0806b49ca2" class="t constructor">SqlConnection</a>(<span class="r11 r">conn</span>))
                {
                    <span class="r13 r">connection</span>.<a href="@0@System.Data/A.html#ac652552a54adc78" class="i method">Open</a>();
                    <span class="r13 r">connection</span>.<a href="@0@System.Data/A.html#9414944f8fe487ef" class="i method">Close</a>();
                }
            }
            <b>catch</b>
            {
                <span class="r12 r">success</span> = <b>false</b>;
            }
            <b>return</b> <span class="r12 r">success</span>;
        }
    }
}</pre></td></tr></table></div></body></html>
