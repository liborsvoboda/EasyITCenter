<!DOCTYPE html>
<html><head><title>MainWindow.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(592);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#InsertTextClient/MainWindow.cs" target="_top">MainWindow.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#InsertTextClient" target="_top">HelpProjects\WPF-MORE\Accessibility\InsertText\InsertTextClient\InsertTextClient.csproj</a> (InsertTextClient)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// // Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// // Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Forms</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="t">Application</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Forms</span>.<a href="@0@System.Windows.Forms/A.html#522e1b8d8fc7285d" class="t t">Application</a>;
<b>using</b> <span class="t">Button</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#bfc2d93e5b6e9a96" class="t t">Button</a>;

<b>namespace</b> <span class="i n">InsertTextClient</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">     Interaction logic for MainWindow.xaml</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public</b> <a href="P/e577d21b3d1a3239.html" target="s" class="k">partial</a> <b>class</b> <a id="e577d21b3d1a3239" href="R/e577d21b3d1a3239.html" target="n" data-glyph="0,0" class="t t">MainWindow</a> : <a href="@0@PresentationFramework/A.html#e438dc91640a8d15" class="t t">Window</a>
    {
        <span class="c">// InsertTextTarget.exe should be automatically copied to the </span>
        <span class="c">// InsertText client folder when you build the sample. </span>
        <span class="c">// You may have to manually copy this file if you receive an error </span>
        <span class="c">// stating the file cannot be found.</span>
        <b>private readonly string</b> <a id="b7d5ca24c2eee9d6" href="R/b7d5ca24c2eee9d6.html" target="n" data-glyph="46,1" class="i field">_filePath</a> =
            <a href="@0@System.Windows.Forms/A.html#522e1b8d8fc7285d" class="t t">Application</a>.<a href="@0@System.Windows.Forms/A.html#5192d0366d9b1a8c" class="i property">StartupPath</a>
            + <span class="s">&quot;\\InsertTextTarget.exe&quot;</span>;

        <b>private</b> <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="t t">StringBuilder</a> <a id="463a66f1e38ab500" href="R/463a66f1e38ab500.html" target="n" data-glyph="46,1" class="i field">_feedbackText</a>;
        <b>private</b> <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <a id="fad8fb636241f48c" href="R/fad8fb636241f48c.html" target="n" data-glyph="46,1" class="i field">_targetWindow</a>;
        <b>private</b> <a href="@0@UIAutomationClient/A.html#72f61a774d826dda" class="t t">AutomationElementCollection</a> <a id="3fffc768592e2c77" href="R/3fffc768592e2c77.html" target="n" data-glyph="46,1" class="i field">_textControls</a>;
        <span class="c">// Initialize both client and target applications.</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     The class constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>public</b> <a id="8ad1596883483fed" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">MainWindow</a>()
        {
            <a href="obj/Debug/MainWindow.g.cs.html#0426d29fc27847b2" class="i method">InitializeComponent</a>();
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Handles the click event for the Start App button.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object that raised the event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Event arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="48b366ae06cd055c" href="R/48b366ae06cd055c.html" target="n" data-glyph="76,1" class="i method">btnStartApp_Click</a>(<b>object</b> <span id="r0 rd" class="r0 r">sender</span>, <a href="@0@PresentationCore/A.html#3089ebf2139eba9d" class="t t">RoutedEventArgs</a> <span id="r1 rd" class="r1 r">e</span>)
        {
            <a href="#fad8fb636241f48c" class="i field">_targetWindow</a> = <a href="#2f7e39f52190baee" class="i method">StartTargetApp</a>(<a href="#b7d5ca24c2eee9d6" class="i field">_filePath</a>);

            <b>if</b> (<a href="#fad8fb636241f48c" class="i field">_targetWindow</a> == <b>null</b>)
            {
                <b>return</b>;
            }

            <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="s">&quot;Target started.&quot;</span>);

            <a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r2 rd" class="r2 r">clientLocationTop</span> = <a href="obj/Debug/MainWindow.g.cs.html#c593aa33aec5ddf0" class="i field">Client</a>.<a href="@0@PresentationFramework/A.html#d6db15f2bca39f0b" class="i property">Top</a>;
            <a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r3 rd" class="r3 r">clientLocationRight</span> = <a href="obj/Debug/MainWindow.g.cs.html#c593aa33aec5ddf0" class="i field">Client</a>.<a href="@0@PresentationFramework/A.html#c3f9155c7db6905b" class="i property">Left</a> + <a href="obj/Debug/MainWindow.g.cs.html#c593aa33aec5ddf0" class="i field">Client</a>.<a href="@0@PresentationFramework/A.html#d0e1f940abafebe8" class="i property">Width</a> + 100;
            <a href="@0@UIAutomationClient/A.html#a0311d01cf30b67d" class="k">var</a> <span id="r4 rd" class="r4 r">transformPattern</span> =
                <a href="#fad8fb636241f48c" class="i field">_targetWindow</a>.<a href="@0@UIAutomationClient/A.html#6faef7f55c720cc5" class="i method">GetCurrentPattern</a>(<a href="@0@UIAutomationClient/A.html#a0311d01cf30b67d" class="t t">TransformPattern</a>.<a href="@0@UIAutomationClient/A.html#795c265a84e009a8" class="i field">Pattern</a>)
                    <b>as</b> <a href="@0@UIAutomationClient/A.html#a0311d01cf30b67d" class="t t">TransformPattern</a>;
            <span class="r4 r">transformPattern</span>?.<a href="@0@UIAutomationClient/A.html#fbf6986be10acdda" class="i method">Move</a>(<span class="r3 r">clientLocationRight</span>, <span class="r2 r">clientLocationTop</span>);

            <span class="c">// Get required control patterns </span>
            <span class="c">//</span>
            <span class="c">// Once you have an instance of an AutomationElement for the target </span>
            <span class="c">// obtain a WindowPattern object to handle the WindowClosed event.</span>
            <b>try</b>
            {
                <a href="@0@UIAutomationClient/A.html#8f0e6e604f8703cd" class="k">var</a> <span id="r5 rd" class="r5 r">windowPattern</span> =
                    <a href="#fad8fb636241f48c" class="i field">_targetWindow</a>.<a href="@0@UIAutomationClient/A.html#6faef7f55c720cc5" class="i method">GetCurrentPattern</a>(<a href="@0@UIAutomationClient/A.html#8f0e6e604f8703cd" class="t t">WindowPattern</a>.<a href="@0@UIAutomationClient/A.html#bc6d16728c4d0c03" class="i field">Pattern</a>) <b>as</b> <a href="@0@UIAutomationClient/A.html#8f0e6e604f8703cd" class="t t">WindowPattern</a>;
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a>)
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="s">&quot;Object does not support the Window Pattern&quot;</span>);
                <b>return</b>;
            }

            <span class="c">// Register for an Event</span>
            <span class="c">// </span>
            <span class="c">// The WindowPattern allows you to programmatically </span>
            <span class="c">// manipulate a window. </span>
            <span class="c">// It also exposes a window closed event. </span>
            <span class="c">// The following code shows an example of listening </span>
            <span class="c">// for the WindowClosed event.</span>
            <span class="c">//</span>
            <span class="c">// To intercept the WindowClosed event for our target application</span>
            <span class="c">// you define an AutomationEventHandler delegate.</span>
            <a href="@0@UIAutomationTypes/A.html#75740672a12d7608" class="k">var</a> <span id="r6 rd" class="r6 r">targetClosedHandler</span> =
                <b>new</b> <span class="t">AutomationEventHandler</span>(<a href="#b9ad3166a60a3242" class="i method">OnTargetClosed</a>);

            <span class="c">// Use AddAutomationEventHandler() to add this event handler.</span>
            <span class="c">// When listening for a WindowClosed event you must either scope </span>
            <span class="c">// the event to the automation element as done here, or cast </span>
            <span class="c">// the AutomationEventArgs in the handler to WindowClosedEventArgs </span>
            <span class="c">// and compare the RuntimeId of the automation element that raised </span>
            <span class="c">// the WindowClosed event to the automation element in the </span>
            <span class="c">// class member data.</span>
            <a href="@0@UIAutomationClient/A.html#c642a9ded5d36ffc" class="t t">Automation</a>.<a href="@0@UIAutomationClient/A.html#f69e142d4884b75c" class="i method">AddAutomationEventHandler</a>(
                <a href="@0@UIAutomationClient/A.html#8f0e6e604f8703cd" class="t t">WindowPattern</a>.<a href="@0@UIAutomationClient/A.html#29e6db542632fde3" class="i field">WindowClosedEvent</a>,
                <a href="#fad8fb636241f48c" class="i field">_targetWindow</a>,
                <a href="@0@UIAutomationTypes/A.html#a1d27540ebadfe65" class="t t">TreeScope</a>.<a href="@0@UIAutomationTypes/A.html#7c11d77300aad618" class="i field">Element</a>,
                <span class="r6 r">targetClosedHandler</span>);

            <a href="#b4f10828888d95c2" class="i method">SetClientControlProperties</a>(<b>false</b>, <b>true</b>);

            <span class="c">// Get our collection of interesting controls.</span>
            <a href="#3fffc768592e2c77" class="i field">_textControls</a> = <a href="#9b4d3fdc2ccc7035" class="i method">FindTextControlsInTarget</a>();
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Handles the click event for the Insert Text buttons.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object that raised the event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Event arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="0f7d3654659a873b" href="R/0f7d3654659a873b.html" target="n" data-glyph="76,1" class="i method">btnInsert_Click</a>(<b>object</b> <span id="r7 rd" class="r7 r">sender</span>, <a href="@0@PresentationCore/A.html#3089ebf2139eba9d" class="t t">RoutedEventArgs</a> <span id="r8 rd" class="r8 r">e</span>)
        {
            <a href="#463a66f1e38ab500" class="i field">_feedbackText</a> = <b>new</b> <a href="@0@mscorlib/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="obj/Debug/MainWindow.g.cs.html#a4ad4a6324273542" class="i field">tbInsert</a>.<a href="@0@PresentationFramework/A.html#7b5be95f7a8f33a8" class="i property">Text</a>))
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="s">&quot;Please enter some text to insert.&quot;</span>);
                <b>return</b>;
            }
            <b>switch</b> (((<a href="@0@PresentationFramework/A.html#bfc2d93e5b6e9a96" class="t t">Button</a>) <span class="r7 r">sender</span>).<a href="@0@PresentationFramework/A.html#2811283b5ba60413" class="i property">Content</a>.<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>())
            {
                <b>case</b> <span class="s">&quot;UIAutomation&quot;</span>:
                    <a href="#38780b1d198f13f8" class="i method">SetValueWithUiAutomation</a>(<a href="obj/Debug/MainWindow.g.cs.html#a4ad4a6324273542" class="i field">tbInsert</a>.<a href="@0@PresentationFramework/A.html#7b5be95f7a8f33a8" class="i property">Text</a>);
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;Win32&quot;</span>:
                    <a href="#17d3e3a51c44e185" class="i method">SetValueWithWin32</a>(<a href="obj/Debug/MainWindow.g.cs.html#a4ad4a6324273542" class="i field">tbInsert</a>.<a href="@0@PresentationFramework/A.html#7b5be95f7a8f33a8" class="i property">Text</a>);
                    <b>break</b>;
                <b>default</b>:
                    <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="s">&quot;Insert failed.&quot;</span>);
                    <b>return</b>;
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Sets the values of the text controls using managed methods.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string to be inserted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="38780b1d198f13f8" href="R/38780b1d198f13f8.html" target="n" data-glyph="76,1" class="i method">SetValueWithUiAutomation</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">s</span>)
        {
            <b>foreach</b> (<a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <span id="r10 rd" class="r10 r">control</span> <b>in</b> <a href="#3fffc768592e2c77" class="i field">_textControls</a>)
            {
                <a href="#78ea8e870e91e3b1" class="i method">InsertTextUsingUiAutomation</a>(<span class="r10 r">control</span>, <span class="r9 r">s</span>);
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Inserts a string into each text control of interest.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A text control.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string to be inserted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="78ea8e870e91e3b1" href="R/78ea8e870e91e3b1.html" target="n" data-glyph="76,1" class="i method">InsertTextUsingUiAutomation</a>(<a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <span id="r11 rd" class="r11 r">element</span>,
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">value</span>)
        {
            <b>try</b>
            {
                <span class="c">// Validate arguments / initial setup</span>
                <b>if</b> (<span class="r12 r">value</span> == <b>null</b>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(
                        <span class="s">&quot;String parameter must not be null.&quot;</span>);

                <b>if</b> (<span class="r11 r">element</span> == <b>null</b>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(
                        <span class="s">&quot;AutomationElement parameter must not be null&quot;</span>);

                <span class="c">// A series of basic checks prior to attempting an insertion.</span>
                <span class="c">//</span>
                <span class="c">// Check #1: Is control enabled?</span>
                <span class="c">// An alternative to testing for static or read-only controls </span>
                <span class="c">// is to filter using </span>
                <span class="c">// PropertyCondition(AutomationElement.IsEnabledProperty, true) </span>
                <span class="c">// and exclude all read-only text controls from the collection.</span>
                <b>if</b> (!<span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#466408a8c6af876c" class="i property">IsEnabled</a>)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The control with an AutomationID of &quot;</span>
                        + <span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>
                        + <span class="s">&quot; is not enabled.\n\n&quot;</span>);
                }

                <span class="c">// Check #2: Are there styles that prohibit us </span>
                <span class="c">//           from sending text to this control?</span>
                <b>if</b> (!<span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#582079f450dee34e" class="i property">IsKeyboardFocusable</a>)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The control with an AutomationID of &quot;</span>
                        + <span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>
                        + <span class="s">&quot;is read-only.\n\n&quot;</span>);
                }


                <span class="c">// Once you have an instance of an AutomationElement,  </span>
                <span class="c">// check if it supports the ValuePattern pattern.</span>
                <b>object</b> <span id="r13 rd" class="r13 r">valuePattern</span> = <b>null</b>;

                <span class="c">// Control does not support the ValuePattern pattern </span>
                <span class="c">// so use keyboard input to insert content.</span>
                <span class="c">//</span>
                <span class="c">// NOTE: Elements that support TextPattern </span>
                <span class="c">//       do not support ValuePattern and TextPattern</span>
                <span class="c">//       does not support setting the text of </span>
                <span class="c">//       multi-line edit or document controls.</span>
                <span class="c">//       For this reason, text input must be simulated</span>
                <span class="c">//       using one of the following methods.</span>
                <span class="c">//       </span>
                <b>if</b> (!<span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#b87cda1d8eda38ec" class="i method">TryGetCurrentPattern</a>(
                    <a href="@0@UIAutomationClient/A.html#98d7d51b45d28b3f" class="t t">ValuePattern</a>.<a href="@0@UIAutomationClient/A.html#254c211ed5f5cbf7" class="i field">Pattern</a>, <b>out</b> <span class="r13 r">valuePattern</span>))
                {
                    <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;The control with an AutomationID of &quot;</span>)
                        .<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>)
                        .<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot; does not support ValuePattern.&quot;</span>)
                        .<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="s">&quot; Using keyboard input.\n&quot;</span>);

                    <span class="c">// Set focus for input functionality and begin.</span>
                    <span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#58ac36137aa75371" class="i method">SetFocus</a>();

                    <span class="c">// Pause before sending keyboard input.</span>
                    <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(100);

                    <span class="c">// Delete existing content in the control and insert new content.</span>
                    <a href="@0@System.Windows.Forms/A.html#6d527af0f72a8a75" class="t t">SendKeys</a>.<a href="@0@System.Windows.Forms/A.html#12eb8c0dc44f5a3c" class="i method">SendWait</a>(<span class="s">&quot;^{HOME}&quot;</span>); <span class="c">// Move to start of control</span>
                    <a href="@0@System.Windows.Forms/A.html#6d527af0f72a8a75" class="t t">SendKeys</a>.<a href="@0@System.Windows.Forms/A.html#12eb8c0dc44f5a3c" class="i method">SendWait</a>(<span class="s">&quot;^+{END}&quot;</span>); <span class="c">// Select everything</span>
                    <a href="@0@System.Windows.Forms/A.html#6d527af0f72a8a75" class="t t">SendKeys</a>.<a href="@0@System.Windows.Forms/A.html#12eb8c0dc44f5a3c" class="i method">SendWait</a>(<span class="s">&quot;{DEL}&quot;</span>); <span class="c">// Delete selection</span>
                    <a href="@0@System.Windows.Forms/A.html#6d527af0f72a8a75" class="t t">SendKeys</a>.<a href="@0@System.Windows.Forms/A.html#12eb8c0dc44f5a3c" class="i method">SendWait</a>(<span class="r12 r">value</span>);
                }
                <span class="c">// Control supports the ValuePattern pattern so we can </span>
                <span class="c">// use the SetValue method to insert content.</span>
                <b>else</b>
                {
                    <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;The control with an AutomationID of &quot;</span>)
                        .<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>)
                        .<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>((<span class="s">&quot; supports ValuePattern.&quot;</span>))
                        .<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="s">&quot; Using ValuePattern.SetValue().\n&quot;</span>);

                    <span class="c">// Set focus for input functionality and begin.</span>
                    <span class="r11 r">element</span>.<a href="@0@UIAutomationClient/A.html#58ac36137aa75371" class="i method">SetFocus</a>();

                    ((<a href="@0@UIAutomationClient/A.html#98d7d51b45d28b3f" class="t t">ValuePattern</a>) <span class="r13 r">valuePattern</span>).<a href="@0@UIAutomationClient/A.html#a2d7145ae3143072" class="i method">SetValue</a>(<span class="r12 r">value</span>);
                }
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a> <span id="r14 rd" class="r14 r">exc</span>)
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r14 r">exc</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a> <span id="r15 rd" class="r15 r">exc</span>)
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r15 r">exc</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            }
            <b>finally</b>
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>());
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Sets the values of the text controls using unmanaged methods.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string to be inserted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="17d3e3a51c44e185" href="R/17d3e3a51c44e185.html" target="n" data-glyph="76,1" class="i method">SetValueWithWin32</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r16 rd" class="r16 r">s</span>)
        {
            <b>foreach</b> (<a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <span id="r17 rd" class="r17 r">control</span> <b>in</b> <a href="#3fffc768592e2c77" class="i field">_textControls</a>)
            {
                <span class="c">// An alternative to testing for static or read-only controls</span>
                <span class="c">// is to filter using </span>
                <span class="c">// PropertyCondition(AutomationElement.IsEnabledProperty, true) </span>
                <span class="c">// and exclude all read-only text controls from the collection.</span>
                <a href="#7fa68f8c2e71830c" class="i method">InsertTextUsingWin32</a>(<span class="r17 r">control</span>, <span class="r16 r">s</span>);
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Inserts the specified string into a text control.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A text control.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string to be inserted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="7fa68f8c2e71830c" href="R/7fa68f8c2e71830c.html" target="n" data-glyph="76,1" class="i method">InsertTextUsingWin32</a>(<a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <span id="r18 rd" class="r18 r">element</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r19 rd" class="r19 r">value</span>)
        {
            <b>try</b>
            {
                <span class="c">// Validate arguments / initial setup</span>
                <b>if</b> (<span class="r19 r">value</span> == <b>null</b>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(
                        <span class="s">&quot;String parameter &#39;value&#39; must not be null.&quot;</span>);

                <b>if</b> (<span class="r18 r">element</span> == <b>null</b>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(
                        <span class="s">&quot;AutomationElement parameter &#39;element&#39; must not be null&quot;</span>);

                <span class="c">// Get hwnd</span>
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="k">var</a> <span id="r20 rd" class="r20 r">_hwnd</span> = <b>new</b> <a href="@0@mscorlib/A.html#99344357553a6239" class="t constructor">IntPtr</a>(<span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#fd1cc54df261fea0" class="i property">NativeWindowHandle</a>);
                <b>if</b> (<span class="r20 r">_hwnd</span> == <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;Unable to get handle to object.&quot;</span>);

                <span class="c">// A series of basic checks for the text control </span>
                <span class="c">// prior to attempting an insertion.</span>
                <span class="c">//</span>
                <span class="c">// Check #1: Is control enabled?</span>
                <span class="c">// An alternative to testing for static or read-only controls </span>
                <span class="c">// is to filter using </span>
                <span class="c">// PropertyCondition(AutomationElement.IsEnabledProperty, true) </span>
                <span class="c">// and exclude all read-only text controls from the collection.</span>
                <b>if</b> (!<a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#a1faae47852e5333" class="i method">IsWindowEnabled</a>(<span class="r20 r">_hwnd</span>))
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The control with an AutomationID of &quot;</span>
                        + <span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>
                        + <span class="s">&quot; is not enabled.\n&quot;</span>);
                }

                <span class="c">// Check #2: Are there styles that prohibit us from </span>
                <span class="c">//           sending text to this control?</span>
                <a href="UnmanagedClass.cs.html#7bd5ff02ce17e775" class="k">var</a> <span id="r21 rd" class="r21 r">hwnd</span> = <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#7bd5ff02ce17e775" class="t t">Hwnd</a>.<a href="UnmanagedClass.cs.html#28b364359ad4219b" class="i method">Cast</a>(<span class="r20 r">_hwnd</span>);
                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r22 rd" class="r22 r">controlStyle</span> = <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#90fced2eb2d38f9e" class="i method">GetWindowLong</a>(<span class="r21 r">hwnd</span>,
                    <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#b4e940e495c2d28c" class="i field">GclStyle</a>);

                <b>if</b> (<a href="#e8e9f834aea62749" class="i method">IsBitSet</a>(<span class="r22 r">controlStyle</span>, <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#19c5ecb1e3c84eb1" class="i field">EsReadonly</a>))
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The control with an AutomationID of &quot;</span>
                        + <span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a> +
                        <span class="s">&quot; is read-only.&quot;</span>);
                }

                <span class="c">// Check #3: Is the size of the text we want to set </span>
                <span class="c">//           greater than what the control accepts?</span>
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r23 rd" class="r23 r">result</span>;
                <b>int</b> <span id="r24 rd" class="r24 r">resultInt</span>;

                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="k">var</a> <span id="r25 rd" class="r25 r">resultSendMessage</span> = <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#4478079f10c49704" class="i method">SendMessageTimeout</a>(
                    <span class="r21 r">hwnd</span>,
                    <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#d687493d0682ba3a" class="i field">EmGetlimittext</a>,
                    <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>,
                    <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>,
                    1,
                    10000,
                    <b>out</b> <span class="r23 r">result</span>);
                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r26 rd" class="r26 r">lastWin32Error</span> =
                    <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#271dfd5a7c6bfad5" class="i method">GetLastWin32Error</a>();

                <b>if</b> (<span class="r25 r">resultSendMessage</span> == <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;SendMessageTimeout() timed out.&quot;</span>);
                }
                <span class="r24 r">resultInt</span> = <b>unchecked</b>((<b>int</b>) (<b>long</b>) <span class="r23 r">result</span>);

                <span class="c">// A result of -1 means that no limit is set.</span>
                <b>if</b> (<span class="r24 r">resultInt</span> != -1 &amp;&amp; <span class="r24 r">resultInt</span> &lt; <span class="r19 r">value</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The length of text entered (&quot;</span>
                        + <span class="r19 r">value</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>
                        + <span class="s">&quot;) is greater than the upper limit of the &quot;</span>
                        + <span class="s">&quot;control with an AutomationID of &quot;</span>
                        + <span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>
                        + <span class="s">&quot; (&quot;</span> + <span class="r24 r">resultInt</span> + <span class="s">&quot;)&quot;</span>
                        + <span class="s">&quot;.&quot;</span>);
                }

                <span class="c">// Send the message...!</span>
                <span class="r23 r">result</span> = <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#eb209d1d85d5f20c" class="i method">SendMessageTimeout</a>(
                    <span class="r21 r">hwnd</span>,
                    <a href="UnmanagedClass.cs.html#99e2cf61139b27a6" class="t t">UnmanagedClass</a>.<a href="UnmanagedClass.cs.html#0ef9aa34de440e8e" class="i field">WmSettext</a>,
                    <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>,
                    <b>new</b> <a href="@0@mscorlib/A.html#57b9d3a70c2aba34" class="t constructor">StringBuilder</a>(<span class="r19 r">value</span>),
                    1,
                    10000,
                    <b>out</b> <span class="r23 r">result</span>);
                <span class="r24 r">resultInt</span> = <b>unchecked</b>((<b>int</b>) (<b>long</b>) <span class="r23 r">result</span>);
                <b>if</b> (<span class="r24 r">resultInt</span> != 1)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(
                        <span class="s">&quot;The text of the control with an AutomationID of &quot;</span>
                        + <span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a> +
                        <span class="s">&quot; cannot be changed.&quot;</span>);
                }
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(
                    <span class="s">&quot;The text of the control with an AutomationID of &quot;</span>)
                    .<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r18 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a>)
                    .<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="s">&quot; has been set.\n&quot;</span>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#70ec02ec268b892a" class="t t">EntryPointNotFoundException</a> <span id="r27 rd" class="r27 r">exc</span>)
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="r27 r">exc</span>.<a href="@0@mscorlib/A.html#23854dd720498168" class="i property">Message</a>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a> <span id="r28 rd" class="r28 r">exc</span>)
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="r28 r">exc</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a> <span id="r29 rd" class="r29 r">exc</span>)
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="r29 r">exc</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            }
            <b>finally</b>
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>());
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Gets a pointer to an AutomationElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A text control.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A pointer to an AutomationElement</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="5033153b29a970de" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetWindowHandleFromAutomationElement</a>
            (<a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <span id="r30 rd" class="r30 r">element</span>)
        {
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="k">var</a> <span id="r31 rd" class="r31 r">ptr</span> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>;
            <b>try</b>
            {
                <a href="@0@mscorlib/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r32 rd" class="r32 r">objHwnd</span> = <span class="r30 r">element</span>.<a href="@0@UIAutomationClient/A.html#acd21961115a57b5" class="i method">GetCurrentPropertyValue</a>(
                    <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#83b5878f046288ae" class="i field">NativeWindowHandleProperty</a>);

                <b>if</b> (<span class="r32 r">objHwnd</span> <b>is</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>)
                    <span class="r31 r">ptr</span> = (<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>) <span class="r32 r">objHwnd</span>;
                <b>else</b>
                    <span class="r31 r">ptr</span> = <b>new</b> <a href="@0@mscorlib/A.html#349501d5fc6328c3" class="t constructor">IntPtr</a>(<a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#c5cd118abb2f8635" class="i method">ToInt64</a>(<span class="r32 r">objHwnd</span>));

                <b>if</b> (<span class="r31 r">ptr</span> == <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>
                        (<span class="s">&quot;Unable to get a handle for the element with an AutomationID of &quot;</span>
                         + <span class="r30 r">element</span>.<a href="@0@UIAutomationClient/A.html#ee08ee488f5af65c" class="i property">Current</a>.<a href="@0@UIAutomationClient/A.html#4f056361f899c532" class="i property">AutomationId</a> + <span class="s">&quot;.&quot;</span>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a> <span id="r33 rd" class="r33 r">exc</span>)
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="r33 r">exc</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            }
            <b>return</b> <span class="r31 r">ptr</span>;
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Is bit set?</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">flags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The flag(s) of interest.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">bit</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The bit value(s).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private bool</b> <a id="e8e9f834aea62749" href="R/e8e9f834aea62749.html" target="n" data-glyph="76,1" class="i method">IsBitSet</a>(<b>int</b> <span id="r34 rd" class="r34 r">flags</span>, <b>int</b> <span id="r35 rd" class="r35 r">bit</span>) =&gt; (<span class="r34 r">flags</span> &amp; <span class="r35 r">bit</span>) == <span class="r35 r">bit</span>;

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Finds the text controls of interest.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     A collection of Automation Elements</span>
        <span class="c">///</span><span class="c">     that satisfy the specified conditions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">// Find all &#39;text&#39; controls that support TextPattern.</span>
        <b>private</b> <a href="@0@UIAutomationClient/A.html#72f61a774d826dda" class="t t">AutomationElementCollection</a> <a id="9b4d3fdc2ccc7035" href="R/9b4d3fdc2ccc7035.html" target="n" data-glyph="76,1" class="i method">FindTextControlsInTarget</a>()
        {
            <a href="@0@UIAutomationClient/A.html#8a7ff98d765a2bc3" class="k">var</a> <span id="r36 rd" class="r36 r">condition</span> = <b>new</b> <a href="@0@UIAutomationClient/A.html#e94e4dbe539f6408" class="t constructor">AndCondition</a>(
                <b>new</b> <a href="@0@UIAutomationClient/A.html#cba561b36766f70c" class="t constructor">OrCondition</a>(
                    <b>new</b> <a href="@0@UIAutomationClient/A.html#d71f410cfd4f99cc" class="t constructor">PropertyCondition</a>(
                        <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#10d34aeeb335d087" class="i field">ControlTypeProperty</a>,
                        <a href="@0@UIAutomationTypes/A.html#0ac120ae07310aad" class="t t">ControlType</a>.<a href="@0@UIAutomationTypes/A.html#4d9c34720ba6f6f2" class="i field">Edit</a>),
                    <b>new</b> <a href="@0@UIAutomationClient/A.html#d71f410cfd4f99cc" class="t constructor">PropertyCondition</a>(
                        <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#10d34aeeb335d087" class="i field">ControlTypeProperty</a>,
                        <a href="@0@UIAutomationTypes/A.html#0ac120ae07310aad" class="t t">ControlType</a>.<a href="@0@UIAutomationTypes/A.html#3e17b8ab34539c3d" class="i field">Document</a>),
                    <b>new</b> <a href="@0@UIAutomationClient/A.html#d71f410cfd4f99cc" class="t constructor">PropertyCondition</a>(
                        <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#10d34aeeb335d087" class="i field">ControlTypeProperty</a>,
                        <a href="@0@UIAutomationTypes/A.html#0ac120ae07310aad" class="t t">ControlType</a>.<a href="@0@UIAutomationTypes/A.html#45d429b07790f556" class="i field">Text</a>)),
                <b>new</b> <a href="@0@UIAutomationClient/A.html#d71f410cfd4f99cc" class="t constructor">PropertyCondition</a>(
                    <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#cb481449094ea658" class="i field">IsTextPatternAvailableProperty</a>,
                    <b>true</b>)
                );
            <b>return</b> <a href="#fad8fb636241f48c" class="i field">_targetWindow</a>.<a href="@0@UIAutomationClient/A.html#4da2c9a72e1c7e9e" class="i method">FindAll</a>(<a href="@0@UIAutomationTypes/A.html#a1d27540ebadfe65" class="t t">TreeScope</a>.<a href="@0@UIAutomationTypes/A.html#0a53a35d12ae2d84" class="i field">Descendants</a>, <span class="r36 r">condition</span>);
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Starts the target app that contains the text controls of interest.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">sTarget</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The target exe.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An Automation Element from our target window.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">// Start our target Win32 application</span>
        <b>private</b> <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a> <a id="2f7e39f52190baee" href="R/2f7e39f52190baee.html" target="n" data-glyph="76,1" class="i method">StartTargetApp</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r37 rd" class="r37 r">target</span>)
        {
            <b>if</b> (!<a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#3360368484a9f131" class="i method">Exists</a>(<span class="r37 r">target</span>))
            {
                <a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r37 r">target</span>).<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot; not found.&quot;</span>);
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<a href="#463a66f1e38ab500" class="i field">_feedbackText</a>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>());
                <b>return</b> <b>null</b>;
            }
            <a href="@0@System/A.html#f8b2e604d6f1fe04" class="t t">Process</a> <span id="r38 rd" class="r38 r">p</span>;
            <b>try</b>
            {
                <span class="c">// Start application.</span>
                <span class="r38 r">p</span> = <a href="@0@System/A.html#f8b2e604d6f1fe04" class="t t">Process</a>.<a href="@0@System/A.html#5a01d1705abb24d6" class="i method">Start</a>(<span class="r37 r">target</span>);
                <b>if</b> (<span class="r38 r">p</span> == <b>null</b>)
                    <b>return</b> <b>null</b>;

                <span class="c">// Give the target application some time to startup.</span>
                <span class="c">// For Win32 applications, WaitForInputIdle can be used instead.</span>
                <span class="c">// Another alternative is to listen for WindowOpened events.</span>
                <span class="c">// Otherwise, an ArgumentException results when you try to</span>
                <span class="c">// retrieve an automation element from the window handle.</span>
                <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(2500);

                <span class="c">// Return the automation element</span>
                <b>return</b> <a href="@0@UIAutomationClient/A.html#8ca578c7b4242263" class="t t">AutomationElement</a>.<a href="@0@UIAutomationClient/A.html#32b73da488a24b89" class="i method">FromHandle</a>(<span class="r38 r">p</span>.<a href="@0@System/A.html#4a6008b8d55b354b" class="i property">MainWindowHandle</a>);
            }
            <b>catch</b> (<a href="@0@System/A.html#824f982cf95a6267" class="t t">Win32Exception</a> <span id="r39 rd" class="r39 r">e</span>)
            {
                <a href="#d321192a66d08f66" class="i method">Feedback</a>(<span class="r39 r">e</span>.<a href="@0@mscorlib/A.html#914040cb46a40f66" class="i method">ToString</a>());
                <b>return</b> <b>null</b>;
            }
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Intercepts the target window closed event and starts the client</span>
        <span class="c">///</span><span class="c">     window BackgroundWorker object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object that raised the event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Event arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     It is not advisable to operate on your own UI within an</span>
        <span class="c">///</span><span class="c">     event handler. This is especially true in a multi-threaded</span>
        <span class="c">///</span><span class="c">     environment as the event handler is unlikely to be called on the</span>
        <span class="c">///</span><span class="c">     UI thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="b9ad3166a60a3242" href="R/b9ad3166a60a3242.html" target="n" data-glyph="76,1" class="i method">OnTargetClosed</a>(<b>object</b> <span id="r40 rd" class="r40 r">sender</span>, <a href="@0@UIAutomationTypes/A.html#14f8c86e50924645" class="t t">AutomationEventArgs</a> <span id="r41 rd" class="r41 r">e</span>)
        {
            <span class="c">// Schedule the update function in the UI thread.</span>
            <a href="obj/Debug/MainWindow.g.cs.html#bdee4ce378f840ac" class="i field">spInsert</a>.<a href="@0@WindowsBase/A.html#bd03df1631104fbc" class="i property">Dispatcher</a>.<a href="@0@WindowsBase/A.html#0261f455048296a9" class="i method">BeginInvoke</a>(
                <a href="@0@WindowsBase/A.html#af2d44a802e4535c" class="t t">DispatcherPriority</a>.<a href="@0@WindowsBase/A.html#246ca2ab395503e0" class="i field">Send</a>,
                <b>new</b> <span class="t">ControlsDelegate</span>(<a href="#b4f10828888d95c2" class="i method">SetClientControlProperties</a>),
                <b>true</b>, <b>false</b>);
            <a href="obj/Debug/MainWindow.g.cs.html#3d3fb916b8de15b8" class="i field">txtFeedback</a>.<a href="@0@WindowsBase/A.html#bd03df1631104fbc" class="i property">Dispatcher</a>.<a href="@0@WindowsBase/A.html#035566f3e2455f79" class="i method">BeginInvoke</a>(
                <a href="@0@WindowsBase/A.html#af2d44a802e4535c" class="t t">DispatcherPriority</a>.<a href="@0@WindowsBase/A.html#246ca2ab395503e0" class="i field">Send</a>,
                <b>new</b> <span class="t">FeedbackDelegate</span>(<a href="#d321192a66d08f66" class="i method">Feedback</a>),
                <span class="s">&quot;Target closed.&quot;</span>);
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Sets attributes of the controls in the client app.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Enabled property.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">v</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Visibility property.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="b4f10828888d95c2" href="R/b4f10828888d95c2.html" target="n" data-glyph="76,1" class="i method">SetClientControlProperties</a>(<b>bool</b> <span id="r42 rd" class="r42 r">e1</span>, <b>bool</b> <span id="r43 rd" class="r43 r">e2</span>)
        {
            <a href="obj/Debug/MainWindow.g.cs.html#84462446950a146d" class="i field">btnStartApp</a>.<a href="@0@PresentationCore/A.html#166ae927a742c046" class="i property">IsEnabled</a> = <span class="r42 r">e1</span>;
            <a href="obj/Debug/MainWindow.g.cs.html#61efebac9e462c39" class="i field">tbkInsert</a>.<a href="@0@PresentationCore/A.html#166ae927a742c046" class="i property">IsEnabled</a> = <span class="r43 r">e2</span>;
            <a href="obj/Debug/MainWindow.g.cs.html#bdee4ce378f840ac" class="i field">spInsert</a>.<a href="@0@PresentationCore/A.html#166ae927a742c046" class="i property">IsEnabled</a> = <span class="r43 r">e2</span>;
        }

        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Outputs information to the client window.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string to display.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> --------------------------------------------------------------------</span>
        <b>private void</b> <a id="d321192a66d08f66" href="R/d321192a66d08f66.html" target="n" data-glyph="76,1" class="i method">Feedback</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r44 rd" class="r44 r">s</span>)
        {
            <a href="obj/Debug/MainWindow.g.cs.html#3d3fb916b8de15b8" class="i field">txtFeedback</a>.<a href="@0@PresentationFramework/A.html#e77c881b0d6f7e9e" class="i property">Text</a> = <span class="r44 r">s</span>;
        }

        <span class="c">// Delegates to be used in placing jobs onto the Dispatcher.</span>
        <b>private delegate void</b> <a id="238e2ee501384eea" href="R/../../0000000000.html" target="n" data-glyph="16,1" class="t t"><span id="78607eef295ca495">ControlsDelegate</span></a>(<b>bool</b> <span id="r45 rd" class="r45 r">arg1</span>, <b>bool</b> <span id="r46 rd" class="r46 r">arg2</span>);

        <b>private delegate void</b> <a id="d822e68828b67d6d" href="R/../../0000000000.html" target="n" data-glyph="16,1" class="t t"><span id="39bf9fab8f9f81dc">FeedbackDelegate</span></a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r47 rd" class="r47 r">arg1</span>);
    }
}</pre></td></tr></table></div></body></html>
