<!DOCTYPE html>
<html><head><title>ServerDatabaseEngine.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(79);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EasyITcenter-HELP/GenericDB/ServerDatabaseEngine.cs" target="_top">GenericDB\ServerDatabaseEngine.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EasyITcenter-HELP" target="_top">HelpProjects\EasyITcenter-HELP\EasyITcenter-HELP.csproj</a> (EasyITcenter-HELP)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>.<span class="i n">Data</span>;
 
<span class="c">/*
 * Server Core Configuration Part
 */</span>
 
<b>namespace</b> <span class="i n">EasyITCenter</span>.<span class="i n">ServerCoreDBSettings</span> {
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Server Main Database Settings Here is Included ScaffoldContext which is connected via Visual</span>
    <span class="c">///</span><span class="c"> Studio Tool Here can Be added customization which are not on the server Here is Extended the</span>
    <span class="c">///</span><span class="c"> Context with Insert News Functionality Customizing and implement Settings for Automatic</span>
    <span class="c">///</span><span class="c"> Adopted Database Schema for Unlimited Working and Operations For Specifics API schemas</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public</b> <b>partial</b> <b>class</b> <a id="a02777b7ef37c2a5" href="../R/a02777b7ef37c2a5.html" target="n" data-glyph="0,0" class="t t">EasyITCenterContext</a> : <span class="i">ScaffoldContext</span> {
        <b>private static</b> <span class="t t">ILogger</span>&lt;<a href="#a02777b7ef37c2a5" class="t t">EasyITCenterContext</a>&gt; <a id="766663ce792ee84f" href="../R/766663ce792ee84f.html" target="n" data-glyph="46,1" class="i field">_logger</a>;
 
        <b>public</b> <a id="f92473fb67bf8ab8" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">EasyITCenterContext</a>(<span class="t t">ILogger</span>&lt;<a href="#a02777b7ef37c2a5" class="t t">EasyITCenterContext</a>&gt; <span id="r0 rd" class="r0 r">logger</span>) =&gt; <a href="#766663ce792ee84f" class="i field">_logger</a> = <span class="r0 r">logger</span>;
 
        <b>public</b> <a id="3d43ecebad2dcc54" href="../R/3d43ecebad2dcc54.html" target="n" data-glyph="72,1" class="t constructor">EasyITCenterContext</a>() {
        }
 
        <b>public</b> <a id="efc7aaace518c9b8" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">EasyITCenterContext</a>(<span class="i">DbContextOptions</span>&lt;<span class="i">ScaffoldContext</span>&gt; <span id="r1 rd" class="r1 r">options</span>)
            : <b>base</b>(<span class="r1 r">options</span>) {
            <span class="i">ChangeTracker</span>.<span class="i">QueryTrackingBehavior</span> = <span class="i">QueryTrackingBehavior</span>.<span class="i">NoTracking</span>;
        }
 
        <b>protected override void</b> <a id="5c942e7c74018b54" href="../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">OnConfiguring</a>(<span class="i">DbContextOptionsBuilder</span> <span id="r2 rd" class="r2 r">optionsBuilder</span>) {
            <b>if</b> (!<span class="r2 r">optionsBuilder</span>.<span class="i">IsConfigured</span>) {
                <span class="r2 r">optionsBuilder</span>.<span class="i">ConfigureLoggingCacheTime</span>(<a href="@1@System.Runtime/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<span class="i">FromMinutes</span>(<span class="i">ServerConfigSettings</span>.<span class="i">DatabaseInternalCacheTimeoutMin</span>));
                <span class="r2 r">optionsBuilder</span>.<span class="i">EnableServiceProviderCaching</span>(<span class="i">ServerConfigSettings</span>.<span class="i">DatabaseInternalCachingEnabled</span>);
                <span class="r2 r">optionsBuilder</span>.<span class="i">UseQueryTrackingBehavior</span>(<span class="i">QueryTrackingBehavior</span>.<span class="i">NoTracking</span>);
                <span class="r2 r">optionsBuilder</span>.<span class="i">EnableSensitiveDataLogging</span>(<b>false</b>); <span class="c">//everytime must be disabled other problem on release</span>
 
                <span class="r2 r">optionsBuilder</span>.<span class="i">UseSqlServer</span>(<span class="i">ServerConfigSettings</span>.<span class="i">DatabaseConnectionString</span>,
                      <span id="r3 rd" class="r3 r">x</span> =&gt; <span class="r3 r">x</span>.<span class="i">MigrationsHistoryTable</span>(<span class="s">&quot;MigrationsHistory&quot;</span>, <span class="s">&quot;dbo&quot;</span>));
 
                <b>if</b> (<span class="i">ServerRuntimeData</span>.<span class="i">DebugMode</span>) {
                    <span class="r2 r">optionsBuilder</span>.<span class="i">UseLoggerFactory</span>(<span class="t t">LoggerFactory</span>.<span class="i method">Create</span>(<span id="r4 rd" class="r4 r">builder</span> =&gt; {
                        <span class="r4 r">builder</span>.<span class="i method">AddEventLog</span>().<span class="i method">AddConsole</span>();
                    }
                    )).<span class="i">LogTo</span>(<span id="r5 rd" class="r5 r">message</span> =&gt; { <span class="i">Debug</span>.<span class="i">WriteLine</span>(<span class="r5 r">message</span>); }).<span class="i">LogTo</span>(<span class="t t">Console</span>.<span class="i">WriteLine</span>);
                }
                <b>else</b> <b>if</b> (<span class="i">ServerConfigSettings</span>.<span class="i">ConfigLogWarnPlusToDbEnabled</span>) {
                    <span class="r2 r">optionsBuilder</span>.<span class="i">UseLoggerFactory</span>(<span class="t t">LoggerFactory</span>.<span class="i method">Create</span>(<span id="r6 rd" class="r6 r">builder</span> =&gt; {
                        <span class="r6 r">builder</span>.<span class="i method">SetMinimumLevel</span>(<span class="t t">LogLevel</span>.<span class="i field">Warning</span>).<span class="i method">AddEventLog</span>();
                    })).<span class="i">EnableSensitiveDataLogging</span>(<b>false</b>).<span class="i">LogTo</span>(<span id="r7 rd" class="r7 r">message</span> =&gt; {
                        <span class="i">SolutionFailList</span> <span id="r8 rd" class="r8 r">SolutionFailList</span> = <b>new</b> <span class="i">SolutionFailList</span>() { <span class="i">UserId</span> = <b>null</b>, <span class="i">Source</span> = <span class="s">&quot;Server&quot;</span>, <span class="i">Message</span> = <span class="r7 r">message</span>, <span class="i">LogLevel</span> = <b>null</b>, <span class="i">UserName</span> = <b>null</b> };
                        <b>new</b> <a href="#3d43ecebad2dcc54" class="t constructor">EasyITCenterContext</a>().<span class="i">SolutionFailLists</span>.<span class="i">Add</span>(<span class="r8 r">SolutionFailList</span>).<span class="i">Context</span>.<span class="i">SaveChanges</span>();
                    }, <span class="t t">LogLevel</span>.<span class="i field">Warning</span>);
                }
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Database Context Extensions for All Types Procedures For Retun Data in procedure can be</span>
    <span class="c">///</span><span class="c"> Simple SELECT * XXX and you Create Same Class for returned DataSet</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public static class</b> <a id="a8f6d9459c33d8f8" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">DatabaseContextExtensions</a> {
 
        <b>public static</b> <span class="t t">List</span>&lt;<span class="r9 r t">T</span>&gt; <a id="f6cd36f19c4c0189" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EasyITCenterCollectionFromSql</a>&lt;<span id="r9 rd t" class="r9 r t">T</span>&gt;(<b>this</b> <a href="#a02777b7ef37c2a5" class="t t">EasyITCenterContext</a> <span id="r10 rd" class="r10 r">dbContext</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">sql</span>) <b>where</b> <span class="r9 r t">T</span> : <b>class</b>, <b>new</b>() {
            <b>using</b> <b>var</b> <span id="r12 rd" class="r12 r">cmd</span> = <span class="r10 r">dbContext</span>.<span class="i">Database</span>.<span class="i">GetDbConnection</span>().<span class="i">CreateCommand</span>();
            <span class="r12 r">cmd</span>.<span class="i">CommandText</span> = <span class="r11 r">sql</span>;
            <b>if</b> (<span class="r12 r">cmd</span>.<span class="i">Connection</span>.<span class="i">State</span> != <span class="t t">ConnectionState</span>.<span class="i field">Open</span>)
                <span class="r12 r">cmd</span>.<span class="i">Connection</span>.<span class="i">Open</span>();
            <b>try</b> {
                <span class="t t">List</span>&lt;<span class="r9 r t">T</span>&gt; <span id="r13 rd" class="r13 r">results</span> = <b>null</b>;
                <span class="t t">DataTable</span> <span id="r14 rd" class="r14 r">table</span> = <b>new</b> <span class="t constructor">DataTable</span>();
                <span class="r14 r">table</span>.<span class="i property">Locale</span> = <span class="i n">System</span>.<span class="i n">Globalization</span>.<a href="@1@System.Runtime/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@System.Runtime/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>;
                <span class="r14 r">table</span>.<span class="i">Load</span>(<span class="r12 r">cmd</span>.<span class="i">ExecuteReader</span>());
                <span class="r13 r">results</span> = <span class="i">DbOperations</span>.<span class="i">BindList</span>&lt;<span class="r9 r t">T</span>&gt;(<span class="r14 r">table</span>).<span class="i">ToList</span>();
 
                <b>return</b> <span class="r13 r">results</span>;
            } <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r15 rd" class="r15 r">Ex</span>) { <span class="i">CoreOperations</span>.<span class="i">SendEmail</span>(<b>new</b> <span class="i">MailRequest</span>() { <span class="i">Content</span> = <span class="i">DataOperations</span>.<span class="i">GetSystemErrMessage</span>(<span class="r15 r">Ex</span>) }); } <b>finally</b> { <span class="r12 r">cmd</span>.<span class="i">Connection</span>.<span class="i">Close</span>(); }
            <b>return</b> <b>new</b> <span class="t constructor">List</span>&lt;<span class="r9 r t">T</span>&gt;();
        }
    }
}</pre></td></tr></table></div></body></html>
