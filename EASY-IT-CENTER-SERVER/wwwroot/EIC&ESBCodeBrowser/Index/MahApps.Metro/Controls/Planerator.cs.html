<!DOCTYPE html>
<html><head><title>Planerator.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(277);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#MahApps.Metro/Controls/Planerator.cs" target="_top">Controls\Planerator.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#MahApps.Metro" target="_top">HelpProjects\WPF-MAIN\MahApps.Metro\src\MahApps.Metro\MahApps.Metro.csproj</a> (MahApps.Metro)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Licensed to the .NET Foundation under one or more agreements.</span>
<span class="c">// The .NET Foundation licenses this file to you under the MIT license.</span>
<span class="c">// See the LICENSE file in the project root for more information.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Markup</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>.<span class="i n">Media3D</span>;

<b>namespace</b> <span class="i n">MahApps</span>.<span class="i n">Metro</span>.<span class="i n">Controls</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   Based on Greg Schechter&#39;s Planerator</span>
    <span class="c">///</span><span class="c">   http://blogs.msdn.com/b/greg_schechter/archive/2007/10/26/enter-the-planerator-dead-simple-3d-in-wpf-with-a-stupid-name.aspx</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<a href="@0@System.Xaml/A.html#b7f5565c3af7268c" class="t constructor">ContentProperty</a>(<b>nameof</b>(<a href="#b23f9c225bebbe7f" class="i property">Child</a>))]
    <b>public class</b> <a id="c4eceb3b06f5ed9e" href="../R/c4eceb3b06f5ed9e.html" target="n" data-glyph="0,0" class="t t"><span id="e8682d3b9cc4b6bc">Planerator</span></a> : <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Identifies the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4f46408cc3ec49a6" class="i property">RotationX</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> dependency property.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="983d1bfbe93d1ff1" href="../R/983d1bfbe93d1ff1.html" target="n" data-glyph="42,1" class="i field">RotationXProperty</a>
            = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a>(<b>nameof</b>(<a href="#4f46408cc3ec49a6" class="i property">RotationX</a>),
                                          <b>typeof</b>(<b>double</b>),
                                          <b>typeof</b>(<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>),
                                          <b>new</b> <a href="@0@PresentationCore/A.html#1708823089fadef6" class="t constructor">UIPropertyMetadata</a>(0.0, (<span id="r0 rd" class="r0 r">d</span>, <span id="r1 rd" class="r1 r">args</span>) =&gt; ((<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>)<span class="r0 r">d</span>).<a href="#20e64cc74ec1c268" class="i method">UpdateRotation</a>()));

        <b>public double</b> <a id="4f46408cc3ec49a6" href="../R/4f46408cc3ec49a6.html" target="n" data-glyph="102,1" class="i property">RotationX</a>
        {
            <b>get</b> =&gt; (<b>double</b>)<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a>(<a href="#983d1bfbe93d1ff1" class="i field">RotationXProperty</a>);
            <b>set</b> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a>(<a href="#983d1bfbe93d1ff1" class="i field">RotationXProperty</a>, <b>value</b>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Identifies the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9bf83566125ba1e1" class="i property">RotationY</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> dependency property.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="013bd5605d9ef652" href="../R/013bd5605d9ef652.html" target="n" data-glyph="42,1" class="i field">RotationYProperty</a>
            = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a>(<b>nameof</b>(<a href="#9bf83566125ba1e1" class="i property">RotationY</a>),
                                          <b>typeof</b>(<b>double</b>),
                                          <b>typeof</b>(<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>),
                                          <b>new</b> <a href="@0@PresentationCore/A.html#1708823089fadef6" class="t constructor">UIPropertyMetadata</a>(0.0, (<span id="r2 rd" class="r2 r">d</span>, <span id="r3 rd" class="r3 r">args</span>) =&gt; ((<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>)<span class="r2 r">d</span>).<a href="#20e64cc74ec1c268" class="i method">UpdateRotation</a>()));

        <b>public double</b> <a id="9bf83566125ba1e1" href="../R/9bf83566125ba1e1.html" target="n" data-glyph="102,1" class="i property">RotationY</a>
        {
            <b>get</b> =&gt; (<b>double</b>)<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a>(<a href="#013bd5605d9ef652" class="i field">RotationYProperty</a>);
            <b>set</b> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a>(<a href="#013bd5605d9ef652" class="i field">RotationYProperty</a>, <b>value</b>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Identifies the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d3087f9564064dc2" class="i property">RotationZ</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> dependency property.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="0ed8253f0733a145" href="../R/0ed8253f0733a145.html" target="n" data-glyph="42,1" class="i field">RotationZProperty</a>
            = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a>(<b>nameof</b>(<a href="#d3087f9564064dc2" class="i property">RotationZ</a>),
                                          <b>typeof</b>(<b>double</b>),
                                          <b>typeof</b>(<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>),
                                          <b>new</b> <a href="@0@PresentationCore/A.html#1708823089fadef6" class="t constructor">UIPropertyMetadata</a>(0.0, (<span id="r4 rd" class="r4 r">d</span>, <span id="r5 rd" class="r5 r">args</span>) =&gt; ((<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>)<span class="r4 r">d</span>).<a href="#20e64cc74ec1c268" class="i method">UpdateRotation</a>()));

        <b>public double</b> <a id="d3087f9564064dc2" href="../R/d3087f9564064dc2.html" target="n" data-glyph="102,1" class="i property">RotationZ</a>
        {
            <b>get</b> =&gt; (<b>double</b>)<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a>(<a href="#0ed8253f0733a145" class="i field">RotationZProperty</a>);
            <b>set</b> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a>(<a href="#0ed8253f0733a145" class="i field">RotationZProperty</a>, <b>value</b>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Identifies the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#c4f0cab1dbd5b664" class="i property">FieldOfView</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> dependency property.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="5c3c96bea994b625" href="../R/5c3c96bea994b625.html" target="n" data-glyph="42,1" class="i field">FieldOfViewProperty</a>
            = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a>(<b>nameof</b>(<a href="#c4f0cab1dbd5b664" class="i property">FieldOfView</a>),
                                          <b>typeof</b>(<b>double</b>),
                                          <b>typeof</b>(<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>),
                                          <b>new</b> <a href="@0@PresentationCore/A.html#9ab998ce35f16677" class="t constructor">UIPropertyMetadata</a>(45.0, (<span id="r6 rd" class="r6 r">d</span>, <span id="r7 rd" class="r7 r">args</span>) =&gt; ((<a href="#c4eceb3b06f5ed9e" class="t t">Planerator</a>)<span class="r6 r">d</span>).<a href="#0027c3b714bb0e40" class="i method">Update3D</a>(), (<span id="r8 rd" class="r8 r">d</span>, <span id="r9 rd" class="r9 r">val</span>) =&gt; <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#e248b38c0156e9dd" class="i method">Min</a>(<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#e66bf1275e54a4bc" class="i method">Max</a>((<b>double</b>)<span class="r9 r">val</span>, 0.5), 179.9)));

        <b>public double</b> <a id="c4f0cab1dbd5b664" href="../R/c4f0cab1dbd5b664.html" target="n" data-glyph="102,1" class="i property">FieldOfView</a>
        {
            <b>get</b> =&gt; (<b>double</b>)<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a>(<a href="#5c3c96bea994b625" class="i field">FieldOfViewProperty</a>);
            <b>set</b> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a>(<a href="#5c3c96bea994b625" class="i field">FieldOfViewProperty</a>, <b>value</b>);
        }

        <span class="c">// clamp to a meaningful range</span>

        <b>private static readonly</b> <a href="@0@PresentationCore/A.html#ffa035ac3c851f92" class="t t">Point3D</a>[] <a id="96b4ce1c09c3c7e5" href="../R/96b4ce1c09c3c7e5.html" target="n" data-glyph="46,1" class="i field">Mesh</a> =
        {
            <b>new</b> <a href="@0@PresentationCore/A.html#f885a91f28f0ea13" class="t constructor">Point3D</a>(0, 0, 0), <b>new</b> <a href="@0@PresentationCore/A.html#f885a91f28f0ea13" class="t constructor">Point3D</a>(0, 1, 0), <b>new</b> <a href="@0@PresentationCore/A.html#f885a91f28f0ea13" class="t constructor">Point3D</a>(1, 1, 0),
            <b>new</b> <a href="@0@PresentationCore/A.html#f885a91f28f0ea13" class="t constructor">Point3D</a>(1, 0, 0)
        };

        <b>private static readonly</b> <a href="@0@WindowsBase/A.html#9120327717fc513d" class="t t">Point</a>[] <a id="9bfb48ec58d9276e" href="../R/9bfb48ec58d9276e.html" target="n" data-glyph="46,1" class="i field">TexCoords</a> =
        {
            <b>new</b> <a href="@0@WindowsBase/A.html#df31222d1f00fae5" class="t constructor">Point</a>(0, 1), <b>new</b> <a href="@0@WindowsBase/A.html#df31222d1f00fae5" class="t constructor">Point</a>(0, 0), <b>new</b> <a href="@0@WindowsBase/A.html#df31222d1f00fae5" class="t constructor">Point</a>(1, 0),
            <b>new</b> <a href="@0@WindowsBase/A.html#df31222d1f00fae5" class="t constructor">Point</a>(1, 1)
        };

        <b>private static readonly int</b>[] <a id="b18431a5412870ee" href="../R/b18431a5412870ee.html" target="n" data-glyph="46,1" class="i field">Indices</a> = { 0, 2, 1, 0, 3, 2 };
        <b>private static readonly</b> <a href="@0@PresentationCore/A.html#eaf7ad1d4aa42d7b" class="t t">Vector3D</a> <a id="a64a9fdc840ad113" href="../R/a64a9fdc840ad113.html" target="n" data-glyph="46,1" class="i field">XAxis</a> = <b>new</b> <a href="@0@PresentationCore/A.html#773628212c014341" class="t constructor">Vector3D</a>(1, 0, 0);
        <b>private static readonly</b> <a href="@0@PresentationCore/A.html#eaf7ad1d4aa42d7b" class="t t">Vector3D</a> <a id="3d784efe1acab00a" href="../R/3d784efe1acab00a.html" target="n" data-glyph="46,1" class="i field">YAxis</a> = <b>new</b> <a href="@0@PresentationCore/A.html#773628212c014341" class="t constructor">Vector3D</a>(0, 1, 0);
        <b>private static readonly</b> <a href="@0@PresentationCore/A.html#eaf7ad1d4aa42d7b" class="t t">Vector3D</a> <a id="65f1b7b8940b33ff" href="../R/65f1b7b8940b33ff.html" target="n" data-glyph="46,1" class="i field">ZAxis</a> = <b>new</b> <a href="@0@PresentationCore/A.html#773628212c014341" class="t constructor">Vector3D</a>(0, 0, 1);
        <b>private readonly</b> <a href="@0@PresentationCore/A.html#ef215b298f07fb32" class="t t">QuaternionRotation3D</a> <a id="6143492f6b32fd2e" href="../R/6143492f6b32fd2e.html" target="n" data-glyph="46,1" class="i field">quaternionRotation</a> = <b>new</b> <a href="@0@PresentationCore/A.html#0d319cc80c22173f" class="t constructor">QuaternionRotation3D</a>();
        <b>private readonly</b> <a href="@0@PresentationCore/A.html#e79a4e520967efcb" class="t t">RotateTransform3D</a> <a id="f0d912389b22e757" href="../R/f0d912389b22e757.html" target="n" data-glyph="46,1" class="i field">rotationTransform</a> = <b>new</b> <a href="@0@PresentationCore/A.html#723285f0b956101b" class="t constructor">RotateTransform3D</a>();
        <b>private readonly</b> <a href="@0@PresentationCore/A.html#3be86b016efeabbb" class="t t">ScaleTransform3D</a> <a id="3bcd487959d35ec9" href="../R/3bcd487959d35ec9.html" target="n" data-glyph="46,1" class="i field">scaleTransform</a> = <b>new</b> <a href="@0@PresentationCore/A.html#093ad145fc602713" class="t constructor">ScaleTransform3D</a>();
        <b>private</b> <a href="@0@PresentationFramework/A.html#69b4bdadbc461ce5" class="t t">Decorator</a>? <a id="21a8eb8582ccef32" href="../R/21a8eb8582ccef32.html" target="n" data-glyph="46,1" class="i field">logicalChild</a>;
        <b>private</b> <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>? <a id="f0955bbed37374a8" href="../R/f0955bbed37374a8.html" target="n" data-glyph="46,1" class="i field">originalChild</a>;
        <b>private</b> <a href="@0@PresentationFramework/A.html#906cf52d2e7ddbf6" class="t t">Viewport3D</a>? <a id="90fa0b63335c1532" href="../R/90fa0b63335c1532.html" target="n" data-glyph="46,1" class="i field">viewport3D</a>;
        <b>private</b> <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>? <a id="01777a60c762dcc5" href="../R/01777a60c762dcc5.html" target="n" data-glyph="46,1" class="i field">visualChild</a>;
        <b>private</b> <a href="@0@PresentationCore/A.html#71d0130ab524ea69" class="t t">Viewport2DVisual3D</a>? <a id="2ed09b036069b612" href="../R/2ed09b036069b612.html" target="n" data-glyph="46,1" class="i field">frontModel</a>;

        <b>public</b> <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>? <a id="b23f9c225bebbe7f" href="../R/b23f9c225bebbe7f.html" target="n" data-glyph="102,1" class="i property">Child</a>
        {
            <b>get</b> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0955bbed37374a8" class="i field">originalChild</a>;
            <b>set</b>
            {
                <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0955bbed37374a8" class="i field">originalChild</a> == <b>value</b>)
                {
                    <b>return</b>;
                }

                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationCore/A.html#84f7a5515178591e" class="i method">RemoveVisualChild</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a>);
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationFramework/A.html#86c322367f01be1a" class="i method">RemoveLogicalChild</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>);

                <span class="c">// Wrap child with special decorator that catches layout invalidations. </span>
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0955bbed37374a8" class="i field">originalChild</a> = <b>value</b>;
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a> = <b>new</b> <a href="LayoutInvalidationCatcher.cs.html#648a88e650879624" class="t constructor">LayoutInvalidationCatcher</a> { <a href="@0@PresentationFramework/A.html#2a880652079bdb31" class="i property">Child</a> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0955bbed37374a8" class="i field">originalChild</a> };
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#61e785d33e154d8e" class="i method">CreateVisualChild</a>();

                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationCore/A.html#61b5eca15b34d985" class="i method">AddVisualChild</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a>);

                <span class="c">// Need to use a logical child here to make sure databinding operations get down to it,</span>
                <span class="c">// since otherwise the child appears only as the Visual to a Viewport2DVisual3D, which </span>
                <span class="c">// doesn&#39;t have databinding operations pass into it from above.</span>
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationFramework/A.html#6e5996ad8b83b2b6" class="i method">AddLogicalChild</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>);
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationCore/A.html#45a2b3d7f602e83f" class="i method">InvalidateMeasure</a>();
            }
        }

        <b>protected override int</b> <a id="e42ad8eebe0ecd1b" href="../R/e42ad8eebe0ecd1b.html" target="n" data-glyph="105,1" class="i property">VisualChildrenCount</a> =&gt; <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a> == <b>null</b> ? 0 : 1;

        <b>protected override</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="179c19e765a0db5b" href="../R/179c19e765a0db5b.html" target="n" data-glyph="75,1" class="i method">MeasureOverride</a>(<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r10 rd" class="r10 r">availableSize</span>)
        {
            <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a> != <b>null</b>)
            {
                <span class="c">// Measure based on the size of the logical child, since we want to align with it.</span>
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>.<a href="@0@PresentationCore/A.html#0e6c09a4266b5db0" class="i method">Measure</a>(<span class="r10 r">availableSize</span>);
                <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="k">var</a> <span id="r11 rd" class="r11 r">result</span> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>.<a href="@0@PresentationCore/A.html#32042c7c3b8912f8" class="i property">DesiredSize</a>;
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a>?.<a href="@0@PresentationCore/A.html#0e6c09a4266b5db0" class="i method">Measure</a>(<span class="r11 r">result</span>);
                <b>return</b> <span class="r11 r">result</span>;
            }

            <b>return</b> <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">Size</a>(0, 0);
        }

        <b>protected override</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="24739ca02732c057" href="../R/24739ca02732c057.html" target="n" data-glyph="75,1" class="i method">ArrangeOverride</a>(<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r12 rd" class="r12 r">finalSize</span>)
        {
            <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a> != <b>null</b>)
            {
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>.<a href="@0@PresentationCore/A.html#db317f34429aad8f" class="i method">Arrange</a>(<b>new</b> <a href="@0@WindowsBase/A.html#76998d12a82ab004" class="t constructor">Rect</a>(<span class="r12 r">finalSize</span>));
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a>?.<a href="@0@PresentationCore/A.html#db317f34429aad8f" class="i method">Arrange</a>(<b>new</b> <a href="@0@WindowsBase/A.html#76998d12a82ab004" class="t constructor">Rect</a>(<span class="r12 r">finalSize</span>));
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#0027c3b714bb0e40" class="i method">Update3D</a>();
            }

            <b>return</b> <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="k">base</a>.<a href="@0@PresentationFramework/A.html#bcf74c9a1ba49aea" class="i method">ArrangeOverride</a>(<span class="r12 r">finalSize</span>);
        }

        <b>protected override</b> <a href="@0@PresentationCore/A.html#5dae7b267e6db0d6" class="t t">Visual</a>? <a id="c7ef5e16156893ba" href="../R/c7ef5e16156893ba.html" target="n" data-glyph="75,1" class="i method">GetVisualChild</a>(<b>int</b> <span id="r13 rd" class="r13 r">index</span>)
        {
            <b>return</b> <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#01777a60c762dcc5" class="i field">visualChild</a>;
        }

        <b>private</b> <a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a> <a id="61e785d33e154d8e" href="../R/61e785d33e154d8e.html" target="n" data-glyph="76,1" class="i method">CreateVisualChild</a>()
        {
            <a href="@0@PresentationCore/A.html#1560d9e8872f8c40" class="k">var</a> <span id="r14 rd" class="r14 r">simpleQuad</span> = <b>new</b> <a href="@0@PresentationCore/A.html#4d5c705305386f1c" class="t constructor">MeshGeometry3D</a>
                             {
                                 <a href="@0@PresentationCore/A.html#d4e3bc3a4e704d38" class="i property">Positions</a> = <b>new</b> <a href="@0@PresentationCore/A.html#3731836f77eeff7a" class="t constructor">Point3DCollection</a>(<a href="#96b4ce1c09c3c7e5" class="i field">Mesh</a>),
                                 <a href="@0@PresentationCore/A.html#d85bf03fb31af15a" class="i property">TextureCoordinates</a> = <b>new</b> <a href="@0@PresentationCore/A.html#37beb532807435a4" class="t constructor">PointCollection</a>(<a href="#9bfb48ec58d9276e" class="i field">TexCoords</a>),
                                 <a href="@0@PresentationCore/A.html#9bb064ad1ec5adef" class="i property">TriangleIndices</a> = <b>new</b> <a href="@0@PresentationCore/A.html#75fdf99f20f6d133" class="t constructor">Int32Collection</a>(<a href="#b18431a5412870ee" class="i field">Indices</a>)
                             };

            <span class="c">// Front material is interactive, back material is not.</span>
            <a href="@0@PresentationCore/A.html#325035f9fe918878" class="t t">Material</a> <span id="r15 rd" class="r15 r">frontMaterial</span> = <b>new</b> <a href="@0@PresentationCore/A.html#f44d6f67f88089b2" class="t constructor">DiffuseMaterial</a>(<a href="@0@PresentationCore/A.html#0110a86641bd833b" class="t t">Brushes</a>.<a href="@0@PresentationCore/A.html#11eb50ba6c5ef1c6" class="i property">White</a>);
            <span class="r15 r">frontMaterial</span>.<a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a>(<a href="@0@PresentationCore/A.html#71d0130ab524ea69" class="t t">Viewport2DVisual3D</a>.<a href="@0@PresentationCore/A.html#58cbadb3d97856a0" class="i field">IsVisualHostMaterialProperty</a>, <b>true</b>);

            <a href="@0@PresentationCore/A.html#8e1ca7f4559cf12c" class="k">var</a> <span id="r16 rd" class="r16 r">vb</span> = <b>new</b> <a href="@0@PresentationCore/A.html#a32a8025edc26c70" class="t constructor">VisualBrush</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>);
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#e07f6eb0f5193f9d" class="i method">SetCachingForObject</a>(<span class="r16 r">vb</span>); <span class="c">// big perf wins by caching!!</span>
            <a href="@0@PresentationCore/A.html#325035f9fe918878" class="t t">Material</a> <span id="r17 rd" class="r17 r">backMaterial</span> = <b>new</b> <a href="@0@PresentationCore/A.html#f44d6f67f88089b2" class="t constructor">DiffuseMaterial</a>(<span class="r16 r">vb</span>);

            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0d912389b22e757" class="i field">rotationTransform</a>.<a href="@0@PresentationCore/A.html#7a689427e6d97d7f" class="i property">Rotation</a> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#6143492f6b32fd2e" class="i field">quaternionRotation</a>;
            <a href="@0@PresentationCore/A.html#56c334b998ddfaf1" class="k">var</a> <span id="r18 rd" class="r18 r">xfGroup</span> = <b>new</b> <a href="@0@PresentationCore/A.html#280da74d0311f3d4" class="t constructor">Transform3DGroup</a> { <a href="@0@PresentationCore/A.html#6480ede1b80dc20f" class="i property">Children</a> = { <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#3bcd487959d35ec9" class="i field">scaleTransform</a>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0d912389b22e757" class="i field">rotationTransform</a> } };

            <a href="@0@PresentationCore/A.html#1b848fb265cea79d" class="k">var</a> <span id="r19 rd" class="r19 r">backModel</span> = <b>new</b> <a href="@0@PresentationCore/A.html#c6caf45092c8b5f3" class="t constructor">GeometryModel3D</a> { <a href="@0@PresentationCore/A.html#7e0553c37f0134b9" class="i property">Geometry</a> = <span class="r14 r">simpleQuad</span>, <a href="@0@PresentationCore/A.html#bafdb54ae1d028ec" class="i property">Transform</a> = <span class="r18 r">xfGroup</span>, <a href="@0@PresentationCore/A.html#abdd620c64eceb5e" class="i property">BackMaterial</a> = <span class="r17 r">backMaterial</span> };
            <a href="@0@PresentationCore/A.html#cdee94c59f5ce65f" class="k">var</a> <span id="r20 rd" class="r20 r">m3dGroup</span> = <b>new</b> <a href="@0@PresentationCore/A.html#1ccca5ea71e3eb51" class="t constructor">Model3DGroup</a>
                           {
                               <a href="@0@PresentationCore/A.html#acdf987d4f5ad60b" class="i property">Children</a> =
                               {
                                   <b>new</b> <a href="@0@PresentationCore/A.html#10ddfd9bdb2db154" class="t constructor">DirectionalLight</a>(<a href="@0@PresentationCore/A.html#0584e1e7d7fb612c" class="t t">Colors</a>.<a href="@0@PresentationCore/A.html#f67f2a25c7c7b3fd" class="i property">White</a>, <b>new</b> <a href="@0@PresentationCore/A.html#773628212c014341" class="t constructor">Vector3D</a>(0, 0, -1)),
                                   <b>new</b> <a href="@0@PresentationCore/A.html#10ddfd9bdb2db154" class="t constructor">DirectionalLight</a>(<a href="@0@PresentationCore/A.html#0584e1e7d7fb612c" class="t t">Colors</a>.<a href="@0@PresentationCore/A.html#f67f2a25c7c7b3fd" class="i property">White</a>, <b>new</b> <a href="@0@PresentationCore/A.html#773628212c014341" class="t constructor">Vector3D</a>(0.1, -0.1, 1)),
                                   <span class="r19 r">backModel</span>
                               }
                           };

            <span class="c">// Non-interactive Visual3D consisting of the backside, and two lights.</span>
            <a href="@0@PresentationCore/A.html#66c1955656299d81" class="k">var</a> <span id="r21 rd" class="r21 r">mv3d</span> = <b>new</b> <a href="@0@PresentationCore/A.html#ca5482dc8a110e79" class="t constructor">ModelVisual3D</a> { <a href="@0@PresentationCore/A.html#4c186e7932939f1c" class="i property">Content</a> = <span class="r20 r">m3dGroup</span> };

            <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#2ed09b036069b612" class="i field">frontModel</a> != <b>null</b>)
            {
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#2ed09b036069b612" class="i field">frontModel</a>.<a href="@0@PresentationCore/A.html#11ea3ead8061f67d" class="i property">Visual</a> = <b>null</b>;
            }

            <span class="c">// Interactive frontside Visual3D</span>
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#2ed09b036069b612" class="i field">frontModel</a> = <b>new</b> <a href="@0@PresentationCore/A.html#c125d0a72c375005" class="t constructor">Viewport2DVisual3D</a>
                              {
                                  <a href="@0@PresentationCore/A.html#f5a0f440454632b1" class="i property">Geometry</a> = <span class="r14 r">simpleQuad</span>,
                                  <a href="@0@PresentationCore/A.html#11ea3ead8061f67d" class="i property">Visual</a> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>,
                                  <a href="@0@PresentationCore/A.html#ba35a58cf5a278ba" class="i property">Material</a> = <span class="r15 r">frontMaterial</span>,
                                  <a href="@0@PresentationCore/A.html#79378e25e8fa08f1" class="i property">Transform</a> = <span class="r18 r">xfGroup</span>
                              };

            <span class="c">// Cache the brush in the VP2V3 by setting caching on it.  Big perf wins.</span>
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#e07f6eb0f5193f9d" class="i method">SetCachingForObject</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#2ed09b036069b612" class="i field">frontModel</a>);

            <span class="c">// Scene consists of both the above Visual3D&#39;s.</span>
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#90fa0b63335c1532" class="i field">viewport3D</a> = <b>new</b> <a href="@0@PresentationFramework/A.html#9bf998dd0c4ecc05" class="t constructor">Viewport3D</a> { <a href="@0@PresentationCore/A.html#7a5eb06f8488b333" class="i property">ClipToBounds</a> = <b>false</b>, <a href="@0@PresentationFramework/A.html#4fd9be21c9fdec01" class="i property">Children</a> = { <span class="r21 r">mv3d</span>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#2ed09b036069b612" class="i field">frontModel</a> } };

            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#20e64cc74ec1c268" class="i method">UpdateRotation</a>();

            <b>return</b> <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#90fa0b63335c1532" class="i field">viewport3D</a>;
        }

        <b>public void</b> <a id="1a09d567b2eba170" href="../R/1a09d567b2eba170.html" target="n" data-glyph="72,1" class="i method">Refresh</a>()
        {
            <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a> != <b>null</b>)
            {
                <span class="c">// #3720 I didn&#39;t find a better solution to update the child after changing accent/theme</span>
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>.<a href="@0@PresentationFramework/A.html#2a880652079bdb31" class="i property">Child</a> = <b>null</b>;
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>.<a href="@0@PresentationFramework/A.html#2a880652079bdb31" class="i property">Child</a> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#b23f9c225bebbe7f" class="i property">Child</a>;

                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationCore/A.html#fdda546b8cd3480c" class="i method">InvalidateVisual</a>();
                <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="@0@PresentationCore/A.html#45a2b3d7f602e83f" class="i method">InvalidateMeasure</a>();
            }
        }

        <b>private void</b> <a id="e07f6eb0f5193f9d" href="../R/e07f6eb0f5193f9d.html" target="n" data-glyph="76,1" class="i method">SetCachingForObject</a>(<a href="@0@WindowsBase/A.html#3ce192f6633decc8" class="t t">DependencyObject</a> <span id="r22 rd" class="r22 r">d</span>)
        {
            <a href="@0@PresentationCore/A.html#f907851e1f998ce5" class="t t">RenderOptions</a>.<a href="@0@PresentationCore/A.html#5b9cfc35543d0aa6" class="i method">SetCachingHint</a>(<span class="r22 r">d</span>, <a href="@0@PresentationCore/A.html#ffd1b00349c5182d" class="t t">CachingHint</a>.<a href="@0@PresentationCore/A.html#b5ebad8309f33650" class="i field">Cache</a>);
            <a href="@0@PresentationCore/A.html#f907851e1f998ce5" class="t t">RenderOptions</a>.<a href="@0@PresentationCore/A.html#186b4fcd316702c7" class="i method">SetCacheInvalidationThresholdMinimum</a>(<span class="r22 r">d</span>, 0.5);
            <a href="@0@PresentationCore/A.html#f907851e1f998ce5" class="t t">RenderOptions</a>.<a href="@0@PresentationCore/A.html#1c2d3f6560239184" class="i method">SetCacheInvalidationThresholdMaximum</a>(<span class="r22 r">d</span>, 2.0);
        }

        <b>private void</b> <a id="20e64cc74ec1c268" href="../R/20e64cc74ec1c268.html" target="n" data-glyph="76,1" class="i method">UpdateRotation</a>()
        {
            <a href="@0@PresentationCore/A.html#d7fe24535ba22e11" class="k">var</a> <span id="r23 rd" class="r23 r">qx</span> = <b>new</b> <a href="@0@PresentationCore/A.html#6435a4c882a20632" class="t constructor">Quaternion</a>(<a href="#a64a9fdc840ad113" class="i field">XAxis</a>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#4f46408cc3ec49a6" class="i property">RotationX</a>);
            <a href="@0@PresentationCore/A.html#d7fe24535ba22e11" class="k">var</a> <span id="r24 rd" class="r24 r">qy</span> = <b>new</b> <a href="@0@PresentationCore/A.html#6435a4c882a20632" class="t constructor">Quaternion</a>(<a href="#3d784efe1acab00a" class="i field">YAxis</a>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#9bf83566125ba1e1" class="i property">RotationY</a>);
            <a href="@0@PresentationCore/A.html#d7fe24535ba22e11" class="k">var</a> <span id="r25 rd" class="r25 r">qz</span> = <b>new</b> <a href="@0@PresentationCore/A.html#6435a4c882a20632" class="t constructor">Quaternion</a>(<a href="#65f1b7b8940b33ff" class="i field">ZAxis</a>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#d3087f9564064dc2" class="i property">RotationZ</a>);

            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#6143492f6b32fd2e" class="i field">quaternionRotation</a>.<a href="@0@PresentationCore/A.html#31334699fac4360e" class="i property">Quaternion</a> = <span class="r23 r">qx</span> * <span class="r24 r">qy</span> * <span class="r25 r">qz</span>;
        }

        <b>private void</b> <a id="0027c3b714bb0e40" href="../R/0027c3b714bb0e40.html" target="n" data-glyph="76,1" class="i method">Update3D</a>()
        {
            <b>if</b> (<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#90fa0b63335c1532" class="i field">viewport3D</a> <b>is null</b>
                || <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a> <b>is null</b>)
            {
                <b>return</b>;
            }

            <span class="c">// Use GetDescendantBounds for sizing and centering since DesiredSize includes layout whitespace, whereas GetDescendantBounds </span>
            <span class="c">// is tighter</span>
            <a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="t t">Rect</a> <span id="r26 rd" class="r26 r">logicalBounds</span> = <a href="@0@PresentationCore/A.html#7f1e2538afba01e7" class="t t">VisualTreeHelper</a>.<a href="@0@PresentationCore/A.html#2fd20ec2221a0f47" class="i method">GetDescendantBounds</a>(<a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#21a8eb8582ccef32" class="i field">logicalChild</a>);
            <b>double</b> <span id="r27 rd" class="r27 r">w</span> = <span class="r26 r">logicalBounds</span>.<a href="@0@WindowsBase/A.html#fcc6efd876cb44c2" class="i property">Width</a>;
            <b>double</b> <span id="r28 rd" class="r28 r">h</span> = <span class="r26 r">logicalBounds</span>.<a href="@0@WindowsBase/A.html#fc918653cc6706b1" class="i property">Height</a>;

            <span class="c">// Create a camera that looks down -Z, with up as Y, and positioned right halfway in X and Y on the element, </span>
            <span class="c">// and back along Z the right distance based on the field-of-view is the same projected size as the 2D content</span>
            <span class="c">// that it&#39;s looking at.  See http://blogs.msdn.com/greg_schechter/archive/2007/04/03/camera-construction-in-parallaxui.aspx</span>
            <span class="c">// for derivation of this camera.</span>
            <b>double</b> <span id="r29 rd" class="r29 r">fovInRadians</span> = <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#c4f0cab1dbd5b664" class="i property">FieldOfView</a> * (<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#fa5fd1f4e5f6f911" class="i field">PI</a> / 180);
            <b>double</b> <span id="r30 rd" class="r30 r">zValue</span> = <span class="r27 r">w</span> / <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#0bdc7ecc726222ef" class="i method">Tan</a>(<span class="r29 r">fovInRadians</span> / 2) / 2;
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#90fa0b63335c1532" class="i field">viewport3D</a>.<a href="@0@PresentationFramework/A.html#47cf185ce6ff176b" class="i property">Camera</a> = <b>new</b> <a href="@0@PresentationCore/A.html#d4cc0b4494612b08" class="t constructor">PerspectiveCamera</a>(<b>new</b> <a href="@0@PresentationCore/A.html#f885a91f28f0ea13" class="t constructor">Point3D</a>(<span class="r27 r">w</span> / 2, <span class="r28 r">h</span> / 2, <span class="r30 r">zValue</span>), -<a href="#65f1b7b8940b33ff" class="i field">ZAxis</a>, <a href="#3d784efe1acab00a" class="i field">YAxis</a>, <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#c4f0cab1dbd5b664" class="i property">FieldOfView</a>);

            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#3bcd487959d35ec9" class="i field">scaleTransform</a>.<a href="@0@PresentationCore/A.html#d835b1b2eba3d38e" class="i property">ScaleX</a> = <span class="r27 r">w</span>;
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#3bcd487959d35ec9" class="i field">scaleTransform</a>.<a href="@0@PresentationCore/A.html#e4263a61df6b0f0f" class="i property">ScaleY</a> = <span class="r28 r">h</span>;
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0d912389b22e757" class="i field">rotationTransform</a>.<a href="@0@PresentationCore/A.html#648f7a0e5dee8264" class="i property">CenterX</a> = <span class="r27 r">w</span> / 2;
            <a href="#c4eceb3b06f5ed9e" class="k">this</a>.<a href="#f0d912389b22e757" class="i field">rotationTransform</a>.<a href="@0@PresentationCore/A.html#0026641c31352402" class="i property">CenterY</a> = <span class="r28 r">h</span> / 2;
        }
    }
}</pre></td></tr></table></div></body></html>
