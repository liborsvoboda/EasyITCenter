<!DOCTYPE html>
<html><head><title>MediaOperations.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(98);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#EasySYSTEMbuilderHelp/GlobalOperations/MediaOperations.cs" target="_top">GlobalOperations\MediaOperations.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#EasySYSTEMbuilderHelp" target="_top">HelpProjects\EasySYSTEMbuilderHelp\EasySYSTEMbuilderHelp.vbproj</a> (EasySYSTEMbuilderHelp)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i">HelixToolkit</span>.<span class="i">Wpf</span>.<span class="i">SharpDX</span>;
<b>using</b> <span class="i">Microsoft</span>.<span class="i">Win32</span>;
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Windows</span>.<span class="i">Media</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Windows</span>.<span class="i">Media</span>.<span class="i">Imaging</span>;
 
<b>namespace</b> <span class="i n">EasyITSystemCenter</span>.<span class="i n">GlobalOperations</span> {
 
    <span class="i">internal</span> <b>class</b> <a id="978078a42cb12d31" href="../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t"><span id="c6788b7da0bf4e61">MediaOperations</span></a> {
 
        <b>public static</b> <a id="a23c9e39b134e01a" href="../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">ImageSource</a> <span class="i">ByteToImage</span>(<b>byte</b>[] <span class="i">imageData</span>) {
            <span class="i">BitmapImage</span> <a id="2302a6e93cf39394" href="../R/2302a6e93cf39394.html" target="n" data-glyph="46,1" class="i field">biImg</a> = <b>new</b> <a href="@0@PresentationCore/A.html#940e003698ec4c39" class="t constructor">BitmapImage</a>();
            <span class="i">MemoryStream</span> <a id="759038762646656c" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">ms</a> = <b>new</b> <span class="i">MemoryStream</span>(<span class="i">imageData</span>);
            <span class="i">biImg</span>.<span class="i">BeginInit</span>();
            <span class="i">biImg</span>.<span class="i">StreamSource</span> = <span class="i">ms</span>;
            <span class="i">biImg</span>.<span class="i">EndInit</span>();
 
            <span class="i">ImageSource</span> <a id="fff7c0d9c6e2328f" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">imgSrc</a> = <a href="#2302a6e93cf39394" class="i field">biImg</a> <b>as</b> <span class="i">ImageSource</span>;
 
            <b>return</b> <span class="i">imgSrc</span>;
        }
 
        /// &lt;<span class="i">summary</span>&gt;
        /// <span class="i">ScreenShot</span> <b>Function For</b> <span class="i">Application</span> <span class="i">Menu</span> <span class="i">Tool</span> <b>If Return</b> <span class="i">Array</span> <b>True</b>, <span class="i">Image</span> <b>is</b> <span class="i">returned</span> <b>in</b>
        /// <span class="i">response</span> <span class="i">Other</span> <span class="i">Save</span> <span class="i">Dialog</span> <b>is</b> <span class="i">Opened</span>
        /// &lt;/<span class="i">summary</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;MainWindow&quot;</span>&gt;     <span class="i">The</span> <span class="i">main</span> <span class="i">window</span>.&lt;/<span class="i">param</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;returnArrayOnly&quot;</span>&gt;&lt;/<span class="i">param</span>&gt;
        <b>public static async</b> <a id="a64a4d1a9f4a3a08" href="../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">Task</a>&lt;<b>byte</b>[]&gt; <span class="i">SaveAppScreenShot</span>(<span class="i">MainWindow</span> <span class="i">MainWindow</span>, <span class="i">bool</span> <span class="i">returnArrayOnly</span> = <b>false</b>) {
            <span class="i">RenderTargetBitmap</span> <a id="aabde85986edf448" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">bmp</a>;
            <span class="i">bmp</span> = <b>new</b> <span class="i">RenderTargetBitmap</span>((<span class="i">int</span>)<span class="i">MainWindow</span>.<span class="i">ActualWidth</span>, (<span class="i">int</span>)<span class="i">MainWindow</span>.<span class="i">ActualHeight</span>, 96, 96, <span class="i">PixelFormats</span>.<span class="i">Pbgra32</span>);
            <b>try</b> {
                <span class="i">PngBitmapEncoder</span> <a id="e277689e9c1c970e" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">encoder</a> = <b>new</b> <a href="@0@PresentationCore/A.html#d83082bf870487dc" class="t constructor">PngBitmapEncoder</a>(); <span class="i">bmp</span>.<span class="i">Render</span>(<span class="i">MainWindow</span>); <span class="i">encoder</span>.<span class="i">Frames</span>.<span class="i">Add</span>(<span class="i">BitmapFrame</span>.<span class="i">Create</span>(<span class="i">bmp</span>));
                <b>if</b> (!<span class="i">returnArrayOnly</span>) {
                    <span class="i">SaveFileDialog</span> <a id="dee3118f89e93805" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">dlg</a> = <b>new</b> <span class="i">SaveFileDialog</span>() { <span class="i">DefaultExt</span> = <span class="s">&quot;.png&quot;</span>, <span class="i">Filter</span> = <span class="s">&quot;Image files |*.png;&quot;</span> };
                    <b>if</b> (<span class="i">dlg</span>.<span class="i">ShowDialog</span>() == <b>true</b>) { <span class="i">FileStream</span> <span class="i">fs</span> = <b>new</b> <span class="i">FileStream</span>(<span class="i">dlg</span>.<span class="i">FileName</span>, <span class="i">FileMode</span>.<span class="i">Create</span>); <span class="i">encoder</span>.<span class="i">Save</span>(<span class="i">fs</span>); <span class="i">fs</span>.<span class="i">Close</span>(); }
                }
            } <b>catch</b> (<span class="i">Exception</span> <span class="i">ex</span>) { <span class="i">await</span> <span class="i">MainWindow</span>.<span class="i">ShowMessageOnMainWindow</span>(<b>true</b>, <span class="i">ex</span>.<span class="i">Message</span> + <span class="i">Environment</span>.<span class="i">NewLine</span> + <span class="i">ex</span>.<span class="i">StackTrace</span>); }
            <b>return</b> <span class="i">bmp</span>.<span class="i">ToByteArray</span>();
        }
 
        /// &lt;<span class="i">summary</span>&gt;
        /// <span class="i">Important</span> <span class="i">Closing</span> <span class="i">connections</span> <b>of</b> <span class="i">openned</span> <span class="i">files</span> <span class="i">by</span> <span class="i">Form</span> <b>and</b> <span class="i">binding</span> <span class="i">this</span> <b>is</b> <span class="i">solution</span> <b>for</b>
        /// <span class="i">close</span> <span class="i">oppened</span> <span class="i">file</span> <span class="i">after</span> <span class="i">load</span> <span class="i">Solution</span> <b>for</b> <span class="i">All</span> <span class="i">Files</span>
        /// &lt;/<span class="i">summary</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;path&quot;</span>&gt;&lt;/<span class="i">param</span>&gt;
        <b>public static</b> <a id="6bea15d2d06207ff" href="../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">BitmapImage</a> <span class="i">GetImageImmediatelly</span>(<b>string</b> <span class="i">path</span>) {
            <span class="i">var</span> <a id="fc5cce45a13543d4" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">image</a> = <b>new</b> <a href="@0@PresentationCore/A.html#940e003698ec4c39" class="t constructor">BitmapImage</a>();
            <b>using</b> (<span class="i">var</span> <span class="i">stream</span> = <span class="i">File</span>.<span class="i">OpenRead</span>(<span class="i">path</span>)) {
                <span class="i">image</span>.<span class="i">BeginInit</span>();
                <span class="i">image</span>.<span class="i">CacheOption</span> = <span class="i">BitmapCacheOption</span>.<span class="i">OnLoad</span>;
                <span class="i">image</span>.<span class="i">StreamSource</span> = <span class="i">stream</span>;
                <span class="i">image</span>.<span class="i">EndInit</span>();
            }
            <b>return</b> <span class="i">image</span>;
        }
 
        /// &lt;<span class="i">summary</span>&gt;
        /// <span class="i">Cresate</span> <span class="i">Bitmap</span> <span class="i">Image</span> <span class="i">from</span> <span class="i">DB</span> <span class="i">array</span> <b>to</b> <span class="i">Image</span> <b>for</b> <span class="i">show</span> <span class="i">preview</span>
        /// &lt;/<span class="i">summary</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;array&quot;</span>&gt;&lt;/<span class="i">param</span>&gt;
        /// &lt;<span class="i">returns</span>&gt;&lt;/<span class="i">returns</span>&gt;
        <b>public static</b> <a id="6bea15d2d06207ff" href="../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">BitmapImage</a> <span class="i">ArrayToImage</span>(<b>byte</b>[] <span class="i">array</span>) {
            <span class="i">BitmapImage</span> <a id="fc5cce45a13543d4" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">image</a> = <b>new</b> <a href="@0@PresentationCore/A.html#940e003698ec4c39" class="t constructor">BitmapImage</a>();
            <span class="i">image</span>.<span class="i">BeginInit</span>();
            <span class="i">image</span>.<span class="i">StreamSource</span> = <b>new</b> <span class="i">MemoryStream</span>(<span class="i">array</span>);
            <span class="i">image</span>.<span class="i">EndInit</span>();
            <b>return</b> <span class="i">image</span>;
        }
 
        /// &lt;<span class="i">summary</span>&gt;
        /// <span class="i">Create</span> <span class="i">More</span> <span class="i">Image</span> <span class="i">File</span> <span class="i">Types</span> <span class="i">NotUsed</span>
        /// &lt;/<span class="i">summary</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;file&quot;</span>&gt;    &lt;/<span class="i">param</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;frame&quot;</span>&gt;   &lt;/<span class="i">param</span>&gt;
        /// &lt;<span class="i">param</span> <span class="i">name</span>=<span class="s">&quot;fileType&quot;</span>&gt;&lt;/<span class="i">param</span>&gt;
        <b>public</b> <a id="8677f5d6245a9891" href="../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">void</a> <span class="i">CreateImageFile</span>(<span class="i">FileStream</span> <span class="i">file</span>, <span class="i">BitmapFrame</span> <span class="i">frame</span>, <b>string</b> <span class="i">fileType</span>) {
            <b>if</b> (<span class="i">file</span> == <span class="i">null</span>) <b>return</b>;
            <span class="i">BitmapEncoder</span> <a id="e277689e9c1c970e" href="../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">encoder</a> = <span class="i">null</span>;
            <span class="i">switch</span> (<span class="i">fileType</span>.<span class="i">ToLower</span>()) {
                <b>case</b> <span class="s">&quot;bmp&quot;</span>: <span class="i">encoder</span> = <b>new</b> <span class="i">BmpBitmapEncoder</span>(); <span class="i">break</span>;
                <b>case</b> <span class="s">&quot;gif&quot;</span>: <span class="i">encoder</span> = <b>new</b> <span class="i">GifBitmapEncoder</span>(); <span class="i">break</span>;
                <b>case</b> <span class="s">&quot;tiff&quot;</span>:
                <b>case</b> <span class="s">&quot;tif&quot;</span>:
                    <span class="i">encoder</span> = <b>new</b> <span class="i">TiffBitmapEncoder</span>() { <span class="i">Compression</span> = <span class="i">TiffCompressOption</span>.<b>Default</b> }; <span class="i">break</span>;
                <b>case</b> <span class="s">&quot;jpg&quot;</span>:
                <b>case</b> <span class="s">&quot;jpeg&quot;</span>:
                    <span class="i">encoder</span> = <b>new</b> <span class="i">JpegBitmapEncoder</span>() { <span class="i">QualityLevel</span> = 100 }; <span class="i">break</span>;
                <b>default</b>:
                    <span class="i">encoder</span> = <b>new</b> <span class="i">PngBitmapEncoder</span>(); <span class="i">break</span>;
            }
            <span class="i">encoder</span>.<span class="i">Frames</span>.<span class="i">Add</span>(<span class="i">frame</span>);
            <span class="i">encoder</span>.<span class="i">Save</span>(<span class="i">file</span>);
        }
    }
}</pre></td></tr></table></div></body></html>
