<!DOCTYPE html>
<html><head><title>HtmlToXamlConverter.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(2765);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#HtmlToXamlDemo/HtmlToXamlConverter.cs" target="_top">HtmlToXamlConverter.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#HtmlToXamlDemo" target="_top">HelpProjects\WPF-MORE\Sample Applications\HtmlToXamlDemo\HtmlToXamlDemo.csproj</a> (HtmlToXamlDemo)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// // Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// // Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Documents</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Xml</span>;

<b>namespace</b> <span class="i n">HtmlToXamlDemo</span>
{
    <span class="c">// DependencyProperty</span>

    <span class="c">// TextElement</span>

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">     HtmlToXamlConverter is a static class that takes an HTML string</span>
    <span class="c">///</span><span class="c">     and converts it into XAML</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public static class</b> <a id="0275cb1bce27f200" href="R/0275cb1bce27f200.html" target="n" data-glyph="0,0" class="t t">HtmlToXamlConverter</a>
    {
        <span class="c">// ----------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Internal Constants</span>
        <span class="c">//</span>
        <span class="c">// ----------------------------------------------------------------</span>

        <span class="c">// The constants reprtesent all Xaml names used in a conversion</span>
        <b>public const string</b> <a id="14b06a60629d663d" href="R/14b06a60629d663d.html" target="n" data-glyph="6,1" class="i field">XamlFlowDocument</a> = <span class="s">&quot;FlowDocument&quot;</span>;
        <b>public const string</b> <a id="45b3f96115176532" href="R/45b3f96115176532.html" target="n" data-glyph="6,1" class="i field">XamlRun</a> = <span class="s">&quot;Run&quot;</span>;
        <b>public const string</b> <a id="f6bc89e2454da8fc" href="R/f6bc89e2454da8fc.html" target="n" data-glyph="6,1" class="i field">XamlSpan</a> = <span class="s">&quot;Span&quot;</span>;
        <b>public const string</b> <a id="97ec350cef700711" href="R/97ec350cef700711.html" target="n" data-glyph="6,1" class="i field">XamlHyperlink</a> = <span class="s">&quot;Hyperlink&quot;</span>;
        <b>public const string</b> <a id="62b3bd717dac7281" href="R/62b3bd717dac7281.html" target="n" data-glyph="6,1" class="i field">XamlHyperlinkNavigateUri</a> = <span class="s">&quot;NavigateUri&quot;</span>;
        <b>public const string</b> <a id="f566a4d59cb74dd9" href="R/f566a4d59cb74dd9.html" target="n" data-glyph="6,1" class="i field">XamlHyperlinkTargetName</a> = <span class="s">&quot;TargetName&quot;</span>;
        <b>public const string</b> <a id="29bb948d4c81fba0" href="R/29bb948d4c81fba0.html" target="n" data-glyph="6,1" class="i field">XamlSection</a> = <span class="s">&quot;Section&quot;</span>;
        <b>public const string</b> <a id="3632e9f713eb2c4c" href="R/3632e9f713eb2c4c.html" target="n" data-glyph="6,1" class="i field">XamlList</a> = <span class="s">&quot;List&quot;</span>;
        <b>public const string</b> <a id="86482d026a420505" href="R/86482d026a420505.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyle</a> = <span class="s">&quot;MarkerStyle&quot;</span>;
        <b>public const string</b> <a id="64ebbf50dbe47391" href="R/64ebbf50dbe47391.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleNone</a> = <span class="s">&quot;None&quot;</span>;
        <b>public const string</b> <a id="23fb19148294c867" href="R/23fb19148294c867.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleDecimal</a> = <span class="s">&quot;Decimal&quot;</span>;
        <b>public const string</b> <a id="e25282d203a5adf1" href="R/e25282d203a5adf1.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleDisc</a> = <span class="s">&quot;Disc&quot;</span>;
        <b>public const string</b> <a id="c5b2a6df070c92ad" href="R/c5b2a6df070c92ad.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleCircle</a> = <span class="s">&quot;Circle&quot;</span>;
        <b>public const string</b> <a id="f140f82cb5890d71" href="R/f140f82cb5890d71.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleSquare</a> = <span class="s">&quot;Square&quot;</span>;
        <b>public const string</b> <a id="18686ec206261b91" href="R/18686ec206261b91.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleBox</a> = <span class="s">&quot;Box&quot;</span>;
        <b>public const string</b> <a id="3c272f5cc63f5624" href="R/3c272f5cc63f5624.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleLowerLatin</a> = <span class="s">&quot;LowerLatin&quot;</span>;
        <b>public const string</b> <a id="fe7b60011564df3f" href="R/fe7b60011564df3f.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleUpperLatin</a> = <span class="s">&quot;UpperLatin&quot;</span>;
        <b>public const string</b> <a id="d87a7989882ba4c8" href="R/d87a7989882ba4c8.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleLowerRoman</a> = <span class="s">&quot;LowerRoman&quot;</span>;
        <b>public const string</b> <a id="244013f91ab96161" href="R/244013f91ab96161.html" target="n" data-glyph="6,1" class="i field">XamlListMarkerStyleUpperRoman</a> = <span class="s">&quot;UpperRoman&quot;</span>;
        <b>public const string</b> <a id="fdd1bca0c23aef50" href="R/fdd1bca0c23aef50.html" target="n" data-glyph="6,1" class="i field">XamlListItem</a> = <span class="s">&quot;ListItem&quot;</span>;
        <b>public const string</b> <a id="aa02ca601ff7e966" href="R/aa02ca601ff7e966.html" target="n" data-glyph="6,1" class="i field">XamlLineBreak</a> = <span class="s">&quot;LineBreak&quot;</span>;
        <b>public const string</b> <a id="86fc141063c26a7a" href="R/86fc141063c26a7a.html" target="n" data-glyph="6,1" class="i field">XamlParagraph</a> = <span class="s">&quot;Paragraph&quot;</span>;
        <b>public const string</b> <a id="5d27a30185e27472" href="R/5d27a30185e27472.html" target="n" data-glyph="6,1" class="i field">XamlMargin</a> = <span class="s">&quot;Margin&quot;</span>;
        <b>public const string</b> <a id="f5532f3489f10745" href="R/f5532f3489f10745.html" target="n" data-glyph="6,1" class="i field">XamlPadding</a> = <span class="s">&quot;Padding&quot;</span>;
        <b>public const string</b> <a id="bd000b0488172883" href="R/bd000b0488172883.html" target="n" data-glyph="6,1" class="i field">XamlBorderBrush</a> = <span class="s">&quot;BorderBrush&quot;</span>;
        <b>public const string</b> <a id="cf294307a05c23d5" href="R/cf294307a05c23d5.html" target="n" data-glyph="6,1" class="i field">XamlBorderThickness</a> = <span class="s">&quot;BorderThickness&quot;</span>;
        <b>public const string</b> <a id="3cded5c531fa0c02" href="R/3cded5c531fa0c02.html" target="n" data-glyph="6,1" class="i field">XamlTable</a> = <span class="s">&quot;Table&quot;</span>;
        <span class="c">// flowdocument table requires this element, take Table prefix because XMLReader cannot resolve the namespace of this element </span>
        <b>public const string</b> <a id="5d5732ec7bb65aa3" href="R/5d5732ec7bb65aa3.html" target="n" data-glyph="6,1" class="i field">XamlTableColumnGroup</a> = <span class="s">&quot;Table.Columns&quot;</span>;
        <b>public const string</b> <a id="184458ba79237333" href="R/184458ba79237333.html" target="n" data-glyph="6,1" class="i field">XamlTableColumn</a> = <span class="s">&quot;TableColumn&quot;</span>;
        <b>public const string</b> <a id="91d2ca1889dbfdbf" href="R/91d2ca1889dbfdbf.html" target="n" data-glyph="6,1" class="i field">XamlTableRowGroup</a> = <span class="s">&quot;TableRowGroup&quot;</span>;
        <b>public const string</b> <a id="61de1738883c2769" href="R/61de1738883c2769.html" target="n" data-glyph="6,1" class="i field">XamlTableRow</a> = <span class="s">&quot;TableRow&quot;</span>;
        <b>public const string</b> <a id="9dfc8ea21aa144d7" href="R/9dfc8ea21aa144d7.html" target="n" data-glyph="6,1" class="i field">XamlTableCell</a> = <span class="s">&quot;TableCell&quot;</span>;
        <b>public const string</b> <a id="3ffa97f5188ca693" href="R/3ffa97f5188ca693.html" target="n" data-glyph="6,1" class="i field">XamlTableCellBorderThickness</a> = <span class="s">&quot;BorderThickness&quot;</span>;
        <b>public const string</b> <a id="7ad1964877cef6c2" href="R/7ad1964877cef6c2.html" target="n" data-glyph="6,1" class="i field">XamlTableCellBorderBrush</a> = <span class="s">&quot;BorderBrush&quot;</span>;
        <b>public const string</b> <a id="475c1b80d24ab33d" href="R/475c1b80d24ab33d.html" target="n" data-glyph="6,1" class="i field">XamlTableCellColumnSpan</a> = <span class="s">&quot;ColumnSpan&quot;</span>;
        <b>public const string</b> <a id="f1317ab3d3189059" href="R/f1317ab3d3189059.html" target="n" data-glyph="6,1" class="i field">XamlTableCellRowSpan</a> = <span class="s">&quot;RowSpan&quot;</span>;
        <b>public const string</b> <a id="67050ea94870f5cc" href="R/67050ea94870f5cc.html" target="n" data-glyph="6,1" class="i field">XamlWidth</a> = <span class="s">&quot;Width&quot;</span>;
        <b>public const string</b> <a id="fa95d15ff3865c4e" href="R/fa95d15ff3865c4e.html" target="n" data-glyph="6,1" class="i field">XamlBrushesBlack</a> = <span class="s">&quot;Black&quot;</span>;
        <b>public const string</b> <a id="231a77e1e5d11e6c" href="R/231a77e1e5d11e6c.html" target="n" data-glyph="6,1" class="i field">XamlFontFamily</a> = <span class="s">&quot;FontFamily&quot;</span>;
        <b>public const string</b> <a id="5a4594aa67910492" href="R/5a4594aa67910492.html" target="n" data-glyph="6,1" class="i field">XamlFontSize</a> = <span class="s">&quot;FontSize&quot;</span>;
        <b>public const string</b> <a id="e1d3c3803fda3d0c" href="R/e1d3c3803fda3d0c.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeXxLarge</a> = <span class="s">&quot;22pt&quot;</span>; <span class="c">// &quot;XXLarge&quot;;</span>
        <b>public const string</b> <a id="9ebf95e395e8b545" href="R/9ebf95e395e8b545.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeXLarge</a> = <span class="s">&quot;20pt&quot;</span>; <span class="c">// &quot;XLarge&quot;;</span>
        <b>public const string</b> <a id="961cc0caf394e50f" href="R/961cc0caf394e50f.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeLarge</a> = <span class="s">&quot;18pt&quot;</span>; <span class="c">// &quot;Large&quot;;</span>
        <b>public const string</b> <a id="2ba3437774c22f2c" href="R/2ba3437774c22f2c.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeMedium</a> = <span class="s">&quot;16pt&quot;</span>; <span class="c">// &quot;Medium&quot;;</span>
        <b>public const string</b> <a id="eed6b23e89941ed8" href="R/eed6b23e89941ed8.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeSmall</a> = <span class="s">&quot;12pt&quot;</span>; <span class="c">// &quot;Small&quot;;</span>
        <b>public const string</b> <a id="6d8cedd8262e9b28" href="R/6d8cedd8262e9b28.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeXSmall</a> = <span class="s">&quot;10pt&quot;</span>; <span class="c">// &quot;XSmall&quot;;</span>
        <b>public const string</b> <a id="61011c17d978d181" href="R/61011c17d978d181.html" target="n" data-glyph="6,1" class="i field">XamlFontSizeXxSmall</a> = <span class="s">&quot;8pt&quot;</span>; <span class="c">// &quot;XXSmall&quot;;</span>
        <b>public const string</b> <a id="a464525191aa2987" href="R/a464525191aa2987.html" target="n" data-glyph="6,1" class="i field">XamlFontWeight</a> = <span class="s">&quot;FontWeight&quot;</span>;
        <b>public const string</b> <a id="c95d868a19756a68" href="R/../../0000000000.html" target="n" data-glyph="6,1" class="i field">XamlFontWeightBold</a> = <span class="s">&quot;Bold&quot;</span>;
        <b>public const string</b> <a id="0f0eb79c0bc53a5d" href="R/0f0eb79c0bc53a5d.html" target="n" data-glyph="6,1" class="i field">XamlFontStyle</a> = <span class="s">&quot;FontStyle&quot;</span>;
        <b>public const string</b> <a id="2c1e2578c1a2b9a3" href="R/../../0000000000.html" target="n" data-glyph="6,1" class="i field">XamlForeground</a> = <span class="s">&quot;Foreground&quot;</span>;
        <b>public const string</b> <a id="7bd11904ecc8f3e0" href="R/../../0000000000.html" target="n" data-glyph="6,1" class="i field">XamlBackground</a> = <span class="s">&quot;Background&quot;</span>;
        <b>public const string</b> <a id="a1936a27bf5eaeec" href="R/a1936a27bf5eaeec.html" target="n" data-glyph="6,1" class="i field">XamlTextDecorations</a> = <span class="s">&quot;TextDecorations&quot;</span>;
        <b>public const string</b> <a id="ebf557ae47891b92" href="R/ebf557ae47891b92.html" target="n" data-glyph="6,1" class="i field">XamlTextDecorationsUnderline</a> = <span class="s">&quot;Underline&quot;</span>;
        <b>public const string</b> <a id="83f0ccbbca11bdb2" href="R/83f0ccbbca11bdb2.html" target="n" data-glyph="6,1" class="i field">XamlTextIndent</a> = <span class="s">&quot;TextIndent&quot;</span>;
        <b>public const string</b> <a id="952566b9739cc5f6" href="R/952566b9739cc5f6.html" target="n" data-glyph="6,1" class="i field">XamlTextAlignment</a> = <span class="s">&quot;TextAlignment&quot;</span>;
        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Private Fields</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Fields

        <b>private static readonly string</b> <a id="82254182bc44cac2" href="R/82254182bc44cac2.html" target="n" data-glyph="46,1" class="i field">XamlNamespace</a> = <span class="s">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span>;

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Fields

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Internal Methods</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts an html string into xaml string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">htmlString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Input html which may be badly formated xml.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">asFlowDocument</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     true indicates that we need a FlowDocument as a root element;</span>
        <span class="c">///</span><span class="c">     false means that Section or Span elements will be used</span>
        <span class="c">///</span><span class="c">     dependeing on StartFragment/EndFragment comments locations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Well-formed xml representing XAML equivalent for the input html string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="d0b6ee7f8be05786" href="R/d0b6ee7f8be05786.html" target="n" data-glyph="72,1" class="i method">ConvertHtmlToXaml</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">htmlString</span>, <b>bool</b> <span id="r1 rd" class="r1 r">asFlowDocument</span>)
        {
            <span class="c">// Create well-formed Xml from Html string</span>
            <b>var</b> <span id="r2 rd" class="r2 r">htmlElement</span> = <a href="HtmlParser.cs.html#4266efe2bed168a1" class="t t">HtmlParser</a>.<a href="HtmlParser.cs.html#ba55482ed64d30eb" class="i method">ParseHtml</a>(<span class="r0 r">htmlString</span>);

            <span class="c">// Decide what name to use as a root</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r3 rd" class="r3 r">rootElementName</span> = <span class="r1 r">asFlowDocument</span> ? <a href="#14b06a60629d663d" class="i field">XamlFlowDocument</a> : <a href="#29bb948d4c81fba0" class="i field">XamlSection</a>;

            <span class="c">// Create an XmlDocument for generated xaml</span>
            <b>var</b> <span id="r4 rd" class="r4 r">xamlTree</span> = <b>new</b> <span class="t constructor">XmlDocument</span>();
            <b>var</b> <span id="r5 rd" class="r5 r">xamlFlowDocumentElement</span> = <span class="r4 r">xamlTree</span>.<span class="i method">CreateElement</span>(<b>null</b>, <span class="r3 r">rootElementName</span>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

            <span class="c">// Extract style definitions from all STYLE elements in the document</span>
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="k">var</a> <span id="r6 rd" class="r6 r">stylesheet</span> = <b>new</b> <a href="CssStylesheet.cs.html#d9bd4e70f68c69ed" class="t constructor">CssStylesheet</a>(<span class="r2 r">htmlElement</span>);

            <span class="c">// Source context is a stack of all elements - ancestors of a parentElement</span>
            <b>var</b> <span id="r7 rd" class="r7 r">sourceContext</span> = <b>new</b> <span class="t constructor">List</span>&lt;<span class="t t">XmlElement</span>&gt;(10);

            <span class="c">// Clear fragment parent</span>
            <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a> = <b>null</b>;

            <span class="c">// convert root html element</span>
            <a href="#8e1071541426e5e6" class="i method">AddBlock</a>(<span class="r5 r">xamlFlowDocumentElement</span>, <span class="r2 r">htmlElement</span>, <b>new</b> <span class="t constructor">Hashtable</span>(), <span class="r6 r">stylesheet</span>, <span class="r7 r">sourceContext</span>);

            <span class="c">// In case if the selected fragment is inline, extract it into a separate Span wrapper</span>
            <b>if</b> (!<span class="r1 r">asFlowDocument</span>)
            {
                <span class="r5 r">xamlFlowDocumentElement</span> = <a href="#54b55fc75cac372f" class="i method">ExtractInlineFragment</a>(<span class="r5 r">xamlFlowDocumentElement</span>);
            }

            <span class="c">// Return a string representing resulting Xaml</span>
            <span class="r5 r">xamlFlowDocumentElement</span>.<span class="i method">SetAttribute</span>(<span class="s">&quot;xml:space&quot;</span>, <span class="s">&quot;preserve&quot;</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r8 rd" class="r8 r">xaml</span> = <span class="r5 r">xamlFlowDocumentElement</span>.<span class="i property">OuterXml</span>;

            <b>return</b> <span class="r8 r">xaml</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Returns a value for an attribute by its name (ignoring casing)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement in which we are trying to find the specified attribute</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">attributeName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     String representing the attribute name to be searched for</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="b08ffeae8f65e4a8" href="R/b08ffeae8f65e4a8.html" target="n" data-glyph="72,1" class="i method">GetAttribute</a>(<span class="t t">XmlElement</span> <span id="r9 rd" class="r9 r">element</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">attributeName</span>)
        {
            <span class="r10 r">attributeName</span> = <span class="r10 r">attributeName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r11 rd" class="r11 r">i</span> = 0; <span class="r11 r">i</span> &lt; <span class="r9 r">element</span>.<span class="i property">Attributes</span>.<span class="i property">Count</span>; <span class="r11 r">i</span>++)
            {
                <b>if</b> (<span class="r9 r">element</span>.<span class="i property">Attributes</span>[<span class="r11 r">i</span>].<span class="i property">Name</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="r10 r">attributeName</span>)
                {
                    <b>return</b> <span class="r9 r">element</span>.<span class="i property">Attributes</span>[<span class="r11 r">i</span>].<span class="i property">Value</span>;
                }
            }

            <b>return</b> <b>null</b>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Returns string extracted from quotation marks</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     String representing value enclosed in quotation marks</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="56cf6c4e7709a507" href="R/56cf6c4e7709a507.html" target="n" data-glyph="74,1" class="i method">UnQuote</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">value</span>)
        {
            <b>if</b> (<span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;\&quot;&quot;</span>) &amp;&amp; <span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;\&quot;&quot;</span>) || <span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;&#39;&quot;</span>) &amp;&amp; <span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;&#39;&quot;</span>))
            {
                <span class="r12 r">value</span> = <span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(1, <span class="r12 r">value</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> - 2).<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>();
            }
            <b>return</b> <span class="r12 r">value</span>;
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Methods

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Private Methods</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Analyzes the given htmlElement expecting it to be converted</span>
        <span class="c">///</span><span class="c">     into some of xaml Block elements and adds the converted block</span>
        <span class="c">///</span><span class="c">     to the children collection of xamlParentElement.</span>
        <span class="c">///</span><span class="c">     Analyzes the given XmlElement htmlElement, recognizes it as some HTML element</span>
        <span class="c">///</span><span class="c">     and adds it as a child to a xamlParentElement.</span>
        <span class="c">///</span><span class="c">     In some cases several following siblings of the given htmlElement</span>
        <span class="c">///</span><span class="c">     will be consumed too (e.g. LIs encountered without wrapping UL/OL,</span>
        <span class="c">///</span><span class="c">     which must be collected together and wrapped into one implicit List element).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Parent xaml element, to which new converted element will be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">htmlElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Source html element subject to convert to xaml.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Properties inherited from an outer context.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Last processed html node. Normally it should be the same htmlElement</span>
        <span class="c">///</span><span class="c">     as was passed as a paramater, but in some irregular cases</span>
        <span class="c">///</span><span class="c">     it could one of its following siblings.</span>
        <span class="c">///</span><span class="c">     The caller must use this node to get to next sibling from it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">XmlNode</span> <a id="8e1071541426e5e6" href="R/8e1071541426e5e6.html" target="n" data-glyph="76,1" class="i method">AddBlock</a>(<span class="t t">XmlElement</span> <span id="r13 rd" class="r13 r">xamlParentElement</span>, <span class="t t">XmlNode</span> <span id="r17 rd" class="r17 r">htmlNode</span>, <span class="t t">Hashtable</span> <span id="r14 rd" class="r14 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r15 rd" class="r15 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r16 rd" class="r16 r">sourceContext</span>)
        {
            <b>if</b> (<span class="r17 r">htmlNode</span> <b>is</b> <span class="t t">XmlComment</span>)
            {
                <a href="#e8ab55055ee602ab" class="i method">DefineInlineFragmentParent</a>((<span class="t t">XmlComment</span>) <span class="r17 r">htmlNode</span>, <span class="c">/*xamlParentElement:*/</span><b>null</b>);
            }
            <b>else</b> <b>if</b> (<span class="r17 r">htmlNode</span> <b>is</b> <span class="t t">XmlText</span>)
            {
                <span class="r17 r">htmlNode</span> = <a href="#67b2e5a227ae256a" class="i method">AddImplicitParagraph</a>(<span class="r13 r">xamlParentElement</span>, <span class="r17 r">htmlNode</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>,
                    <span class="r16 r">sourceContext</span>);
            }
            <b>else</b> <b>if</b> (<span class="r17 r">htmlNode</span> <b>is</b> <span class="t t">XmlElement</span>)
            {
                <span class="c">// Identify element name</span>
                <b>var</b> <span id="r18 rd" class="r18 r">htmlElement</span> = (<span class="t t">XmlElement</span>) <span class="r17 r">htmlNode</span>;

                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r19 rd" class="r19 r">htmlElementName</span> = <span class="r18 r">htmlElement</span>.<span class="i property">LocalName</span>; <span class="c">// Keep the name case-sensitive to check xml names</span>
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r20 rd" class="r20 r">htmlElementNamespace</span> = <span class="r18 r">htmlElement</span>.<span class="i property">NamespaceURI</span>;

                <b>if</b> (<span class="r20 r">htmlElementNamespace</span> != <a href="HtmlParser.cs.html#4266efe2bed168a1" class="t t">HtmlParser</a>.<a href="HtmlParser.cs.html#77eab4c3778cf47c" class="i field">XhtmlNamespace</a>)
                {
                    <span class="c">// Non-html element. skip it</span>
                    <span class="c">// Isn&#39;t it too agressive? What if this is just an error in html tag name?</span>
                    <span class="c">// TODO: Consider skipping just a wparrer in recursing into the element tree,</span>
                    <span class="c">// which may produce some garbage though coming from xml fragments.</span>
                    <b>return</b> <span class="r18 r">htmlElement</span>;
                }

                <span class="c">// Put source element to the stack</span>
                <span class="r16 r">sourceContext</span>.<span class="i method">Add</span>(<span class="r18 r">htmlElement</span>);

                <span class="c">// Convert the name to lowercase, because html elements are case-insensitive</span>
                <span class="r19 r">htmlElementName</span> = <span class="r19 r">htmlElementName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

                <span class="c">// Switch to an appropriate kind of processing depending on html element name</span>
                <b>switch</b> (<span class="r19 r">htmlElementName</span>)
                {
                    <span class="c">// Sections:</span>
                    <b>case</b> <span class="s">&quot;html&quot;</span>:
                    <b>case</b> <span class="s">&quot;body&quot;</span>:
                    <b>case</b> <span class="s">&quot;div&quot;</span>:
                    <b>case</b> <span class="s">&quot;form&quot;</span>: <span class="c">// not a block according to xhtml spec</span>
                    <b>case</b> <span class="s">&quot;pre&quot;</span>: <span class="c">// Renders text in a fixed-width font</span>
                    <b>case</b> <span class="s">&quot;blockquote&quot;</span>:
                    <b>case</b> <span class="s">&quot;caption&quot;</span>:
                    <b>case</b> <span class="s">&quot;center&quot;</span>:
                    <b>case</b> <span class="s">&quot;cite&quot;</span>:
                        <a href="#b9408b328f81e057" class="i method">AddSection</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>, <span class="r16 r">sourceContext</span>);
                        <b>break</b>;

                    <span class="c">// Paragraphs:</span>
                    <b>case</b> <span class="s">&quot;p&quot;</span>:
                    <b>case</b> <span class="s">&quot;h1&quot;</span>:
                    <b>case</b> <span class="s">&quot;h2&quot;</span>:
                    <b>case</b> <span class="s">&quot;h3&quot;</span>:
                    <b>case</b> <span class="s">&quot;h4&quot;</span>:
                    <b>case</b> <span class="s">&quot;h5&quot;</span>:
                    <b>case</b> <span class="s">&quot;h6&quot;</span>:
                    <b>case</b> <span class="s">&quot;nsrtitle&quot;</span>:
                    <b>case</b> <span class="s">&quot;textarea&quot;</span>:
                    <b>case</b> <span class="s">&quot;dd&quot;</span>: <span class="c">// ???</span>
                    <b>case</b> <span class="s">&quot;dl&quot;</span>: <span class="c">// ???</span>
                    <b>case</b> <span class="s">&quot;dt&quot;</span>: <span class="c">// ???</span>
                    <b>case</b> <span class="s">&quot;tt&quot;</span>: <span class="c">// ???</span>
                        <a href="#0e4de37baf597367" class="i method">AddParagraph</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>, <span class="r16 r">sourceContext</span>);
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;ol&quot;</span>:
                    <b>case</b> <span class="s">&quot;ul&quot;</span>:
                    <b>case</b> <span class="s">&quot;dir&quot;</span>: <span class="c">//  treat as UL element</span>
                    <b>case</b> <span class="s">&quot;menu&quot;</span>: <span class="c">//  treat as UL element</span>
                        <span class="c">// List element conversion</span>
                        <a href="#87a253c2a1f7a1eb" class="i method">AddList</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>, <span class="r16 r">sourceContext</span>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;li&quot;</span>:
                        <span class="c">// LI outside of OL/UL</span>
                        <span class="c">// Collect all sibling LIs, wrap them into a List and then proceed with the element following the last of LIs</span>
                        <span class="r17 r">htmlNode</span> = <a href="#4ef1606030ddcf16" class="i method">AddOrphanListItems</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>,
                            <span class="r16 r">sourceContext</span>);
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;img&quot;</span>:
                        <span class="c">// TODO: Add image processing</span>
                        <a href="#dfab64d1ac1c863f" class="i method">AddImage</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>, <span class="r16 r">sourceContext</span>);
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;table&quot;</span>:
                        <span class="c">// hand off to table parsing function which will perform special table syntax checks</span>
                        <a href="#c9eac659b6953f61" class="i method">AddTable</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>, <span class="r16 r">sourceContext</span>);
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;tbody&quot;</span>:
                    <b>case</b> <span class="s">&quot;tfoot&quot;</span>:
                    <b>case</b> <span class="s">&quot;thead&quot;</span>:
                    <b>case</b> <span class="s">&quot;tr&quot;</span>:
                    <b>case</b> <span class="s">&quot;td&quot;</span>:
                    <b>case</b> <span class="s">&quot;th&quot;</span>:
                        <span class="c">// Table stuff without table wrapper</span>
                        <span class="c">// TODO: add special-case processing here for elements that should be within tables when the</span>
                        <span class="c">// parent element is NOT a table. If the parent element is a table they can be processed normally.</span>
                        <span class="c">// we need to compare against the parent element here, we can&#39;t just break on a switch</span>
                        <b>goto</b> <b>default</b>; <span class="c">// Thus we will skip this element as unknown, but still recurse into it.</span>

                    <b>case</b> <span class="s">&quot;style&quot;</span>: <span class="c">// We already pre-processed all style elements. Ignore it now</span>
                    <b>case</b> <span class="s">&quot;meta&quot;</span>:
                    <b>case</b> <span class="s">&quot;head&quot;</span>:
                    <b>case</b> <span class="s">&quot;title&quot;</span>:
                    <b>case</b> <span class="s">&quot;script&quot;</span>:
                        <span class="c">// Ignore these elements</span>
                        <b>break</b>;

                    <b>default</b>:
                        <span class="c">// Wrap a sequence of inlines into an implicit paragraph</span>
                        <span class="r17 r">htmlNode</span> = <a href="#67b2e5a227ae256a" class="i method">AddImplicitParagraph</a>(<span class="r13 r">xamlParentElement</span>, <span class="r18 r">htmlElement</span>, <span class="r14 r">inheritedProperties</span>, <span class="r15 r">stylesheet</span>,
                            <span class="r16 r">sourceContext</span>);
                        <b>break</b>;
                }

                <span class="c">// Remove the element from the stack</span>
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r16 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r16 r">sourceContext</span>[<span class="r16 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r18 r">htmlElement</span>);
                <span class="r16 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r16 r">sourceContext</span>.<span class="i property">Count</span> - 1);
            }

            <span class="c">// Return last processed node</span>
            <b>return</b> <span class="r17 r">htmlNode</span>;
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Line Breaks</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <b>private static void</b> <a id="d9e7044cc2b8346a" href="R/d9e7044cc2b8346a.html" target="n" data-glyph="76,1" class="i method">AddBreak</a>(<span class="t t">XmlElement</span> <span id="r21 rd" class="r21 r">xamlParentElement</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r22 rd" class="r22 r">htmlElementName</span>)
        {
            <span class="c">// Create new xaml element corresponding to this html element</span>
            <b>var</b> <span id="r23 rd" class="r23 r">xamlLineBreak</span> = <span class="r21 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                <b>null</b>, <span class="c">/*localName:*/</span><a href="#aa02ca601ff7e966" class="i field">XamlLineBreak</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
            <span class="r21 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r23 r">xamlLineBreak</span>);
            <b>if</b> (<span class="r22 r">htmlElementName</span> == <span class="s">&quot;hr&quot;</span>)
            {
                <b>var</b> <span id="r24 rd" class="r24 r">xamlHorizontalLine</span> = <span class="r21 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateTextNode</span>(<span class="s">&quot;----------------------&quot;</span>);
                <span class="r21 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r24 r">xamlHorizontalLine</span>);
                <span class="r23 r">xamlLineBreak</span> = <span class="r21 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                    <b>null</b>, <span class="c">/*localName:*/</span><a href="#aa02ca601ff7e966" class="i field">XamlLineBreak</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                <span class="r21 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r23 r">xamlLineBreak</span>);
            }
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Text Flow Elements</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Generates Section or Paragraph element from DIV depending whether it contains any block elements or not</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml parent to which the converted element should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">htmlElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true indicates that a content added by this call contains at least one block element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/param&gt;</span>
        <b>private static void</b> <a id="b9408b328f81e057" href="R/b9408b328f81e057.html" target="n" data-glyph="76,1" class="i method">AddSection</a>(<span class="t t">XmlElement</span> <span id="r25 rd" class="r25 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r26 rd" class="r26 r">htmlElement</span>,
            <span class="t t">Hashtable</span> <span id="r27 rd" class="r27 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r28 rd" class="r28 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r29 rd" class="r29 r">sourceContext</span>)
        {
            <span class="c">// Analyze the content of htmlElement to decide what xaml element to choose - Section or Paragraph.</span>
            <span class="c">// If this Div has at least one block child then we need to use Section, otherwise use Paragraph</span>
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r30 rd" class="r30 r">htmlElementContainsBlocks</span> = <b>false</b>;
            <b>for</b> (<b>var</b> <span id="r31 rd" class="r31 r">htmlChildNode</span> = <span class="r26 r">htmlElement</span>.<span class="i property">FirstChild</span>;
                <span class="r31 r">htmlChildNode</span> != <b>null</b>;
                <span class="r31 r">htmlChildNode</span> = <span class="r31 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
            {
                <b>if</b> (<span class="r31 r">htmlChildNode</span> <b>is</b> <span class="t t">XmlElement</span>)
                {
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r32 rd" class="r32 r">htmlChildName</span> = ((<span class="t t">XmlElement</span>) <span class="r31 r">htmlChildNode</span>).<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                    <b>if</b> (<a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#6d31aa47e7b94d04" class="i method">IsBlockElement</a>(<span class="r32 r">htmlChildName</span>))
                    {
                        <span class="r30 r">htmlElementContainsBlocks</span> = <b>true</b>;
                        <b>break</b>;
                    }
                }
            }

            <b>if</b> (!<span class="r30 r">htmlElementContainsBlocks</span>)
            {
                <span class="c">// The Div does not contain any block elements, so we can treat it as a Paragraph</span>
                <a href="#0e4de37baf597367" class="i method">AddParagraph</a>(<span class="r25 r">xamlParentElement</span>, <span class="r26 r">htmlElement</span>, <span class="r27 r">inheritedProperties</span>, <span class="r28 r">stylesheet</span>, <span class="r29 r">sourceContext</span>);
            }
            <b>else</b>
            {
                <span class="c">// The Div has some nested blocks, so we treat it as a Section</span>

                <span class="c">// Create currentProperties as a compilation of local and inheritedProperties, set localProperties</span>
                <span class="t t">Hashtable</span> <span id="r33 rd" class="r33 r">localProperties</span>;
                <b>var</b> <span id="r34 rd" class="r34 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r26 r">htmlElement</span>, <span class="r27 r">inheritedProperties</span>, <b>out</b> <span class="r33 r">localProperties</span>,
                    <span class="r28 r">stylesheet</span>,
                    <span class="r29 r">sourceContext</span>);

                <span class="c">// Create a XAML element corresponding to this html element</span>
                <b>var</b> <span id="r35 rd" class="r35 r">xamlElement</span> = <span class="r25 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                    <b>null</b>, <span class="c">/*localName:*/</span><a href="#29bb948d4c81fba0" class="i field">XamlSection</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                <a href="#ef2c926ede15198c" class="i method">ApplyLocalProperties</a>(<span class="r35 r">xamlElement</span>, <span class="r33 r">localProperties</span>, <span class="c">/*isBlock:*/</span><b>true</b>);

                <span class="c">// Decide whether we can unwrap this element as not having any formatting significance.</span>
                <b>if</b> (!<span class="r35 r">xamlElement</span>.<span class="i property">HasAttributes</span>)
                {
                    <span class="c">// This elements is a group of block elements whitout any additional formatting.</span>
                    <span class="c">// We can add blocks directly to xamlParentElement and avoid</span>
                    <span class="c">// creating unnecessary Sections nesting.</span>
                    <span class="r35 r">xamlElement</span> = <span class="r25 r">xamlParentElement</span>;
                }

                <span class="c">// Recurse into element subtree</span>
                <b>for</b> (<b>var</b> <span id="r36 rd" class="r36 r">htmlChildNode</span> = <span class="r26 r">htmlElement</span>.<span class="i property">FirstChild</span>;
                    <span class="r36 r">htmlChildNode</span> != <b>null</b>;
                    <span class="r36 r">htmlChildNode</span> = <span class="r36 r">htmlChildNode</span>?.<span class="i property">NextSibling</span>)
                {
                    <span class="r36 r">htmlChildNode</span> = <a href="#8e1071541426e5e6" class="i method">AddBlock</a>(<span class="r35 r">xamlElement</span>, <span class="r36 r">htmlChildNode</span>, <span class="r34 r">currentProperties</span>, <span class="r28 r">stylesheet</span>, <span class="r29 r">sourceContext</span>);
                }

                <span class="c">// Add the new element to the parent.</span>
                <b>if</b> (<span class="r35 r">xamlElement</span> != <span class="r25 r">xamlParentElement</span>)
                {
                    <span class="r25 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r35 r">xamlElement</span>);
                }
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Generates Paragraph element from P, H1-H7, Center etc.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml parent to which the converted element should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">htmlElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true indicates that a content added by this call contains at least one block element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/param&gt;</span>
        <b>private static void</b> <a id="0e4de37baf597367" href="R/0e4de37baf597367.html" target="n" data-glyph="76,1" class="i method">AddParagraph</a>(<span class="t t">XmlElement</span> <span id="r37 rd" class="r37 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r38 rd" class="r38 r">htmlElement</span>,
            <span class="t t">Hashtable</span> <span id="r39 rd" class="r39 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r40 rd" class="r40 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r41 rd" class="r41 r">sourceContext</span>)
        {
            <span class="c">// Create currentProperties as a compilation of local and inheritedProperties, set localProperties</span>
            <span class="t t">Hashtable</span> <span id="r42 rd" class="r42 r">localProperties</span>;
            <b>var</b> <span id="r43 rd" class="r43 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r38 r">htmlElement</span>, <span class="r39 r">inheritedProperties</span>, <b>out</b> <span class="r42 r">localProperties</span>,
                <span class="r40 r">stylesheet</span>,
                <span class="r41 r">sourceContext</span>);

            <span class="c">// Create a XAML element corresponding to this html element</span>
            <b>var</b> <span id="r44 rd" class="r44 r">xamlElement</span> = <span class="r37 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                <b>null</b>, <span class="c">/*localName:*/</span><a href="#86fc141063c26a7a" class="i field">XamlParagraph</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
            <a href="#ef2c926ede15198c" class="i method">ApplyLocalProperties</a>(<span class="r44 r">xamlElement</span>, <span class="r42 r">localProperties</span>, <span class="c">/*isBlock:*/</span><b>true</b>);

            <span class="c">// Recurse into element subtree</span>
            <b>for</b> (<b>var</b> <span id="r45 rd" class="r45 r">htmlChildNode</span> = <span class="r38 r">htmlElement</span>.<span class="i property">FirstChild</span>;
                <span class="r45 r">htmlChildNode</span> != <b>null</b>;
                <span class="r45 r">htmlChildNode</span> = <span class="r45 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
            {
                <a href="#c8faa7e253ab76a7" class="i method">AddInline</a>(<span class="r44 r">xamlElement</span>, <span class="r45 r">htmlChildNode</span>, <span class="r43 r">currentProperties</span>, <span class="r40 r">stylesheet</span>, <span class="r41 r">sourceContext</span>);
            }

            <span class="c">// Add the new element to the parent.</span>
            <span class="r37 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r44 r">xamlElement</span>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Creates a Paragraph element and adds all nodes starting from htmlNode</span>
        <span class="c">///</span><span class="c">     converted to appropriate Inlines.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml parent to which the converted element should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">htmlNode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlNode starting a collection of implicitly wrapped inlines.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true indicates that a content added by this call contains at least one block element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/param&gt;</span>
        <span class="c">///</span><span class="c"> &lt;returns&gt;</span>
        <span class="c">///</span><span class="c">     The last htmlNode added to the implicit paragraph</span>
        <span class="c">///</span><span class="c"> &lt;/returns&gt;</span>
        <b>private static</b> <span class="t t">XmlNode</span> <a id="67b2e5a227ae256a" href="R/67b2e5a227ae256a.html" target="n" data-glyph="76,1" class="i method">AddImplicitParagraph</a>(<span class="t t">XmlElement</span> <span id="r46 rd" class="r46 r">xamlParentElement</span>, <span class="t t">XmlNode</span> <span id="r47 rd" class="r47 r">htmlNode</span>,
            <span class="t t">Hashtable</span> <span id="r48 rd" class="r48 r">inheritedProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r49 rd" class="r49 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r50 rd" class="r50 r">sourceContext</span>)
        {
            <span class="c">// Collect all non-block elements and wrap them into implicit Paragraph</span>
            <b>var</b> <span id="r51 rd" class="r51 r">xamlParagraph</span> = <span class="r46 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                <b>null</b>, <span class="c">/*localName:*/</span><a href="#86fc141063c26a7a" class="i field">XamlParagraph</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
            <span class="t t">XmlNode</span> <span id="r52 rd" class="r52 r">lastNodeProcessed</span> = <b>null</b>;
            <b>while</b> (<span class="r47 r">htmlNode</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r47 r">htmlNode</span> <b>is</b> <span class="t t">XmlComment</span>)
                {
                    <a href="#e8ab55055ee602ab" class="i method">DefineInlineFragmentParent</a>((<span class="t t">XmlComment</span>) <span class="r47 r">htmlNode</span>, <span class="c">/*xamlParentElement:*/</span><b>null</b>);
                }
                <b>else</b> <b>if</b> (<span class="r47 r">htmlNode</span> <b>is</b> <span class="t t">XmlText</span>)
                {
                    <b>if</b> (<span class="r47 r">htmlNode</span>.<span class="i property">Value</span>.<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>().<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
                    {
                        <a href="#64ab587cf24be76e" class="i method">AddTextRun</a>(<span class="r51 r">xamlParagraph</span>, <span class="r47 r">htmlNode</span>.<span class="i property">Value</span>);
                    }
                }
                <b>else</b> <b>if</b> (<span class="r47 r">htmlNode</span> <b>is</b> <span class="t t">XmlElement</span>)
                {
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r53 rd" class="r53 r">htmlChildName</span> = ((<span class="t t">XmlElement</span>) <span class="r47 r">htmlNode</span>).<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                    <b>if</b> (<a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#6d31aa47e7b94d04" class="i method">IsBlockElement</a>(<span class="r53 r">htmlChildName</span>))
                    {
                        <span class="c">// The sequence of non-blocked inlines ended. Stop implicit loop here.</span>
                        <b>break</b>;
                    }
                    <a href="#c8faa7e253ab76a7" class="i method">AddInline</a>(<span class="r51 r">xamlParagraph</span>, (<span class="t t">XmlElement</span>) <span class="r47 r">htmlNode</span>, <span class="r48 r">inheritedProperties</span>, <span class="r49 r">stylesheet</span>, <span class="r50 r">sourceContext</span>);
                }

                <span class="c">// Store last processed node to return it at the end</span>
                <span class="r52 r">lastNodeProcessed</span> = <span class="r47 r">htmlNode</span>;
                <span class="r47 r">htmlNode</span> = <span class="r47 r">htmlNode</span>.<span class="i property">NextSibling</span>;
            }

            <span class="c">// Add the Paragraph to the parent</span>
            <span class="c">// If only whitespaces and commens have been encountered,</span>
            <span class="c">// then we have nothing to add in implicit paragraph; forget it.</span>
            <b>if</b> (<span class="r51 r">xamlParagraph</span>.<span class="i property">FirstChild</span> != <b>null</b>)
            {
                <span class="r46 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r51 r">xamlParagraph</span>);
            }

            <span class="c">// Need to return last processed node</span>
            <b>return</b> <span class="r52 r">lastNodeProcessed</span>;
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Inline Elements</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <b>private static void</b> <a id="c8faa7e253ab76a7" href="R/c8faa7e253ab76a7.html" target="n" data-glyph="76,1" class="i method">AddInline</a>(<span class="t t">XmlElement</span> <span id="r54 rd" class="r54 r">xamlParentElement</span>, <span class="t t">XmlNode</span> <span id="r55 rd" class="r55 r">htmlNode</span>, <span class="t t">Hashtable</span> <span id="r56 rd" class="r56 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r57 rd" class="r57 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r58 rd" class="r58 r">sourceContext</span>)
        {
            <b>if</b> (<span class="r55 r">htmlNode</span> <b>is</b> <span class="t t">XmlComment</span>)
            {
                <a href="#e8ab55055ee602ab" class="i method">DefineInlineFragmentParent</a>((<span class="t t">XmlComment</span>) <span class="r55 r">htmlNode</span>, <span class="r54 r">xamlParentElement</span>);
            }
            <b>else</b> <b>if</b> (<span class="r55 r">htmlNode</span> <b>is</b> <span class="t t">XmlText</span>)
            {
                <a href="#64ab587cf24be76e" class="i method">AddTextRun</a>(<span class="r54 r">xamlParentElement</span>, <span class="r55 r">htmlNode</span>.<span class="i property">Value</span>);
            }
            <b>else</b> <b>if</b> (<span class="r55 r">htmlNode</span> <b>is</b> <span class="t t">XmlElement</span>)
            {
                <b>var</b> <span id="r59 rd" class="r59 r">htmlElement</span> = (<span class="t t">XmlElement</span>) <span class="r55 r">htmlNode</span>;

                <span class="c">// Check whether this is an html element</span>
                <b>if</b> (<span class="r59 r">htmlElement</span>.<span class="i property">NamespaceURI</span> != <a href="HtmlParser.cs.html#4266efe2bed168a1" class="t t">HtmlParser</a>.<a href="HtmlParser.cs.html#77eab4c3778cf47c" class="i field">XhtmlNamespace</a>)
                {
                    <b>return</b>; <span class="c">// Skip non-html elements</span>
                }

                <span class="c">// Identify element name</span>
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r60 rd" class="r60 r">htmlElementName</span> = <span class="r59 r">htmlElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

                <span class="c">// Put source element to the stack</span>
                <span class="r58 r">sourceContext</span>.<span class="i method">Add</span>(<span class="r59 r">htmlElement</span>);

                <b>switch</b> (<span class="r60 r">htmlElementName</span>)
                {
                    <b>case</b> <span class="s">&quot;a&quot;</span>:
                        <a href="#5e45a03164ccd550" class="i method">AddHyperlink</a>(<span class="r54 r">xamlParentElement</span>, <span class="r59 r">htmlElement</span>, <span class="r56 r">inheritedProperties</span>, <span class="r57 r">stylesheet</span>, <span class="r58 r">sourceContext</span>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;img&quot;</span>:
                        <a href="#dfab64d1ac1c863f" class="i method">AddImage</a>(<span class="r54 r">xamlParentElement</span>, <span class="r59 r">htmlElement</span>, <span class="r56 r">inheritedProperties</span>, <span class="r57 r">stylesheet</span>, <span class="r58 r">sourceContext</span>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;br&quot;</span>:
                    <b>case</b> <span class="s">&quot;hr&quot;</span>:
                        <a href="#d9e7044cc2b8346a" class="i method">AddBreak</a>(<span class="r54 r">xamlParentElement</span>, <span class="r60 r">htmlElementName</span>);
                        <b>break</b>;
                    <b>default</b>:
                        <b>if</b> (<a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#66af7814be09a83a" class="i method">IsInlineElement</a>(<span class="r60 r">htmlElementName</span>) || <a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#6d31aa47e7b94d04" class="i method">IsBlockElement</a>(<span class="r60 r">htmlElementName</span>))
                        {
                            <span class="c">// Note: actually we do not expect block elements here,</span>
                            <span class="c">// but if it happens to be here, we will treat it as a Span.</span>

                            <a href="#5d3197faf1c6cbb9" class="i method">AddSpanOrRun</a>(<span class="r54 r">xamlParentElement</span>, <span class="r59 r">htmlElement</span>, <span class="r56 r">inheritedProperties</span>, <span class="r57 r">stylesheet</span>, <span class="r58 r">sourceContext</span>);
                        }
                        <b>break</b>;
                }
                <span class="c">// Ignore all other elements non-(block/inline/image)</span>

                <span class="c">// Remove the element from the stack</span>
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r58 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r58 r">sourceContext</span>[<span class="r58 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r59 r">htmlElement</span>);
                <span class="r58 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r58 r">sourceContext</span>.<span class="i property">Count</span> - 1);
            }
        }

        <b>private static void</b> <a id="5d3197faf1c6cbb9" href="R/5d3197faf1c6cbb9.html" target="n" data-glyph="76,1" class="i method">AddSpanOrRun</a>(<span class="t t">XmlElement</span> <span id="r61 rd" class="r61 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r62 rd" class="r62 r">htmlElement</span>,
            <span class="t t">Hashtable</span> <span id="r63 rd" class="r63 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r64 rd" class="r64 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r65 rd" class="r65 r">sourceContext</span>)
        {
            <span class="c">// Decide what XAML element to use for this inline element.</span>
            <span class="c">// Check whether it contains any nested inlines</span>
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r66 rd" class="r66 r">elementHasChildren</span> = <b>false</b>;
            <b>for</b> (<b>var</b> <span id="r67 rd" class="r67 r">htmlNode</span> = <span class="r62 r">htmlElement</span>.<span class="i property">FirstChild</span>; <span class="r67 r">htmlNode</span> != <b>null</b>; <span class="r67 r">htmlNode</span> = <span class="r67 r">htmlNode</span>.<span class="i property">NextSibling</span>)
            {
                <b>if</b> (<span class="r67 r">htmlNode</span> <b>is</b> <span class="t t">XmlElement</span>)
                {
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r68 rd" class="r68 r">htmlChildName</span> = ((<span class="t t">XmlElement</span>) <span class="r67 r">htmlNode</span>).<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                    <b>if</b> (<a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#66af7814be09a83a" class="i method">IsInlineElement</a>(<span class="r68 r">htmlChildName</span>) || <a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#6d31aa47e7b94d04" class="i method">IsBlockElement</a>(<span class="r68 r">htmlChildName</span>) ||
                        <span class="r68 r">htmlChildName</span> == <span class="s">&quot;img&quot;</span> || <span class="r68 r">htmlChildName</span> == <span class="s">&quot;br&quot;</span> || <span class="r68 r">htmlChildName</span> == <span class="s">&quot;hr&quot;</span>)
                    {
                        <span class="r66 r">elementHasChildren</span> = <b>true</b>;
                        <b>break</b>;
                    }
                }
            }

            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r69 rd" class="r69 r">xamlElementName</span> = <span class="r66 r">elementHasChildren</span> ? <a href="#f6bc89e2454da8fc" class="i field">XamlSpan</a> : <a href="#45b3f96115176532" class="i field">XamlRun</a>;

            <span class="c">// Create currentProperties as a compilation of local and inheritedProperties, set localProperties</span>
            <span class="t t">Hashtable</span> <span id="r70 rd" class="r70 r">localProperties</span>;
            <b>var</b> <span id="r71 rd" class="r71 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r62 r">htmlElement</span>, <span class="r63 r">inheritedProperties</span>, <b>out</b> <span class="r70 r">localProperties</span>,
                <span class="r64 r">stylesheet</span>,
                <span class="r65 r">sourceContext</span>);

            <span class="c">// Create a XAML element corresponding to this html element</span>
            <b>var</b> <span id="r72 rd" class="r72 r">xamlElement</span> = <span class="r61 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                <b>null</b>, <span class="c">/*localName:*/</span><span class="r69 r">xamlElementName</span>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
            <a href="#ef2c926ede15198c" class="i method">ApplyLocalProperties</a>(<span class="r72 r">xamlElement</span>, <span class="r70 r">localProperties</span>, <span class="c">/*isBlock:*/</span><b>false</b>);

            <span class="c">// Recurse into element subtree</span>
            <b>for</b> (<b>var</b> <span id="r73 rd" class="r73 r">htmlChildNode</span> = <span class="r62 r">htmlElement</span>.<span class="i property">FirstChild</span>;
                <span class="r73 r">htmlChildNode</span> != <b>null</b>;
                <span class="r73 r">htmlChildNode</span> = <span class="r73 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
            {
                <a href="#c8faa7e253ab76a7" class="i method">AddInline</a>(<span class="r72 r">xamlElement</span>, <span class="r73 r">htmlChildNode</span>, <span class="r71 r">currentProperties</span>, <span class="r64 r">stylesheet</span>, <span class="r65 r">sourceContext</span>);
            }

            <span class="c">// Add the new element to the parent.</span>
            <span class="r61 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r72 r">xamlElement</span>);
        }

        <span class="c">// Adds a text run to a xaml tree</span>
        <b>private static void</b> <a id="64ab587cf24be76e" href="R/64ab587cf24be76e.html" target="n" data-glyph="76,1" class="i method">AddTextRun</a>(<span class="t t">XmlElement</span> <span id="r74 rd" class="r74 r">xamlElement</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r75 rd" class="r75 r">textData</span>)
        {
            <span class="c">// Remove control characters</span>
            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r76 rd" class="r76 r">i</span> = 0; <span class="r76 r">i</span> &lt; <span class="r75 r">textData</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a>; <span class="r76 r">i</span>++)
            {
                <b>if</b> (<b>char</b>.<a href="@1@System.Runtime/A.html#29acbe190c9d859e" class="i method">IsControl</a>(<span class="r75 r">textData</span><a href="@1@System.Runtime/A.html#8307d03426b56fe1">[</a><span class="r76 r">i</span>]))
                {
                    <span class="r75 r">textData</span> = <span class="r75 r">textData</span>.<a href="@1@System.Runtime/A.html#c1d590f287f2c0de" class="i method">Remove</a>(<span class="r76 r">i</span>--, 1); <span class="c">// decrement i to compensate for character removal</span>
                }
            }

            <span class="c">// Replace No-Breaks by spaces (160 is a code of &amp;nbsp; entity in html)</span>
            <span class="c">//  This is a work around since WPF/XAML does not support &amp;nbsp.</span>
            <span class="r75 r">textData</span> = <span class="r75 r">textData</span>.<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>((<b>char</b>) 160, <span class="s">&#39; &#39;</span>);

            <b>if</b> (<span class="r75 r">textData</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
            {
                <span class="r74 r">xamlElement</span>.<span class="i method">AppendChild</span>(<span class="r74 r">xamlElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateTextNode</span>(<span class="r75 r">textData</span>));
            }
        }

        <b>private static void</b> <a id="5e45a03164ccd550" href="R/5e45a03164ccd550.html" target="n" data-glyph="76,1" class="i method">AddHyperlink</a>(<span class="t t">XmlElement</span> <span id="r77 rd" class="r77 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r78 rd" class="r78 r">htmlElement</span>,
            <span class="t t">Hashtable</span> <span id="r79 rd" class="r79 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r80 rd" class="r80 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r81 rd" class="r81 r">sourceContext</span>)
        {
            <span class="c">// Convert href attribute into NavigateUri and TargetName</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r82 rd" class="r82 r">href</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r78 r">htmlElement</span>, <span class="s">&quot;href&quot;</span>);
            <b>if</b> (<span class="r82 r">href</span> == <b>null</b>)
            {
                <span class="c">// When href attribute is missing - ignore the hyperlink</span>
                <a href="#5d3197faf1c6cbb9" class="i method">AddSpanOrRun</a>(<span class="r77 r">xamlParentElement</span>, <span class="r78 r">htmlElement</span>, <span class="r79 r">inheritedProperties</span>, <span class="r80 r">stylesheet</span>, <span class="r81 r">sourceContext</span>);
            }
            <b>else</b>
            {
                <span class="c">// Create currentProperties as a compilation of local and inheritedProperties, set localProperties</span>
                <span class="t t">Hashtable</span> <span id="r83 rd" class="r83 r">localProperties</span>;
                <b>var</b> <span id="r84 rd" class="r84 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r78 r">htmlElement</span>, <span class="r79 r">inheritedProperties</span>, <b>out</b> <span class="r83 r">localProperties</span>,
                    <span class="r80 r">stylesheet</span>,
                    <span class="r81 r">sourceContext</span>);

                <span class="c">// Create a XAML element corresponding to this html element</span>
                <b>var</b> <span id="r85 rd" class="r85 r">xamlElement</span> = <span class="r77 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                    <b>null</b>, <span class="c">/*localName:*/</span><a href="#97ec350cef700711" class="i field">XamlHyperlink</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                <a href="#ef2c926ede15198c" class="i method">ApplyLocalProperties</a>(<span class="r85 r">xamlElement</span>, <span class="r83 r">localProperties</span>, <span class="c">/*isBlock:*/</span><b>false</b>);

                <b>var</b> <span id="r86 rd" class="r86 r">hrefParts</span> = <span class="r82 r">href</span>.<a href="@1@System.Runtime/A.html#b06c6275ef677846" class="i method">Split</a>(<span class="s">&#39;#&#39;</span>);
                <b>if</b> (<span class="r86 r">hrefParts</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a> &gt; 0 &amp;&amp; <span class="r86 r">hrefParts</span>[0].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>().<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
                {
                    <span class="r85 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#62b3bd717dac7281" class="i field">XamlHyperlinkNavigateUri</a>, <span class="r86 r">hrefParts</span>[0].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>());
                }
                <b>if</b> (<span class="r86 r">hrefParts</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a> == 2 &amp;&amp; <span class="r86 r">hrefParts</span>[1].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>().<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0)
                {
                    <span class="r85 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#f566a4d59cb74dd9" class="i field">XamlHyperlinkTargetName</a>, <span class="r86 r">hrefParts</span>[1].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>());
                }

                <span class="c">// Recurse into element subtree</span>
                <b>for</b> (<b>var</b> <span id="r87 rd" class="r87 r">htmlChildNode</span> = <span class="r78 r">htmlElement</span>.<span class="i property">FirstChild</span>;
                    <span class="r87 r">htmlChildNode</span> != <b>null</b>;
                    <span class="r87 r">htmlChildNode</span> = <span class="r87 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
                {
                    <a href="#c8faa7e253ab76a7" class="i method">AddInline</a>(<span class="r85 r">xamlElement</span>, <span class="r87 r">htmlChildNode</span>, <span class="r84 r">currentProperties</span>, <span class="r80 r">stylesheet</span>, <span class="r81 r">sourceContext</span>);
                }

                <span class="c">// Add the new element to the parent.</span>
                <span class="r77 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r85 r">xamlElement</span>);
            }
        }

        <span class="c">// Stores a parent xaml element for the case when selected fragment is inline.</span>
        <b>private static</b> <span class="t t">XmlElement</span> <a id="95729bb023d77c30" href="R/95729bb023d77c30.html" target="n" data-glyph="46,1" class="i field">_inlineFragmentParentElement</a>;

        <span class="c">// Called when html comment is encountered to store a parent element</span>
        <span class="c">// for the case when the fragment is inline - to extract it to a separate</span>
        <span class="c">// Span wrapper after the conversion.</span>
        <b>private static void</b> <a id="e8ab55055ee602ab" href="R/e8ab55055ee602ab.html" target="n" data-glyph="76,1" class="i method">DefineInlineFragmentParent</a>(<span class="t t">XmlComment</span> <span id="r88 rd" class="r88 r">htmlComment</span>, <span class="t t">XmlElement</span> <span id="r89 rd" class="r89 r">xamlParentElement</span>)
        {
            <b>if</b> (<span class="r88 r">htmlComment</span>.<span class="i property">Value</span> == <span class="s">&quot;StartFragment&quot;</span>)
            {
                <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a> = <span class="r89 r">xamlParentElement</span>;
            }
            <b>else</b> <b>if</b> (<span class="r88 r">htmlComment</span>.<span class="i property">Value</span> == <span class="s">&quot;EndFragment&quot;</span>)
            {
                <b>if</b> (<a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a> == <b>null</b> &amp;&amp; <span class="r89 r">xamlParentElement</span> != <b>null</b>)
                {
                    <span class="c">// Normally this cannot happen if comments produced by correct copying code</span>
                    <span class="c">// in Word or IE, but when it is produced manually then fragment boundary</span>
                    <span class="c">// markers can be inconsistent. In this case StartFragment takes precedence,</span>
                    <span class="c">// but if it is not set, then we get the value from EndFragment marker.</span>
                    <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a> = <span class="r89 r">xamlParentElement</span>;
                }
            }
        }

        <span class="c">// Extracts a content of an element stored as InlineFragmentParentElement</span>
        <span class="c">// into a separate Span wrapper.</span>
        <span class="c">// Note: when selected content does not cross paragraph boundaries,</span>
        <span class="c">// the fragment is marked within</span>
        <b>private static</b> <span class="t t">XmlElement</span> <a id="54b55fc75cac372f" href="R/54b55fc75cac372f.html" target="n" data-glyph="76,1" class="i method">ExtractInlineFragment</a>(<span class="t t">XmlElement</span> <span id="r90 rd" class="r90 r">xamlFlowDocumentElement</span>)
        {
            <b>if</b> (<a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a> != <b>null</b>)
            {
                <b>if</b> (<a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a>.<span class="i property">LocalName</span> == <a href="#f6bc89e2454da8fc" class="i field">XamlSpan</a>)
                {
                    <span class="r90 r">xamlFlowDocumentElement</span> = <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a>;
                }
                <b>else</b>
                {
                    <span class="r90 r">xamlFlowDocumentElement</span> = <span class="r90 r">xamlFlowDocumentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>( <span class="c">/*prefix:*/</span>
                        <b>null</b>, <span class="c">/*localName:*/</span><a href="#f6bc89e2454da8fc" class="i field">XamlSpan</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                    <b>while</b> (<a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a>.<span class="i property">FirstChild</span> != <b>null</b>)
                    {
                        <b>var</b> <span id="r91 rd" class="r91 r">copyNode</span> = <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a>.<span class="i property">FirstChild</span>;
                        <a href="#95729bb023d77c30" class="i field">_inlineFragmentParentElement</a>.<span class="i method">RemoveChild</span>(<span class="r91 r">copyNode</span>);
                        <span class="r90 r">xamlFlowDocumentElement</span>.<span class="i method">AppendChild</span>(<span class="r91 r">copyNode</span>);
                    }
                }
            }

            <b>return</b> <span class="r90 r">xamlFlowDocumentElement</span>;
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Images</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <b>private static void</b> <a id="dfab64d1ac1c863f" href="R/dfab64d1ac1c863f.html" target="n" data-glyph="76,1" class="i method">AddImage</a>(<span class="t t">XmlElement</span> <span id="r92 rd" class="r92 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r93 rd" class="r93 r">htmlElement</span>, <span class="t t">Hashtable</span> <span id="r94 rd" class="r94 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r95 rd" class="r95 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r96 rd" class="r96 r">sourceContext</span>)
        {
            <span class="c">//  Implement images</span>
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Lists</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts Html ul or ol element into Xaml list element. During conversion if the ul/ol element has any children</span>
        <span class="c">///</span><span class="c">     that are not li elements, they are ignored and not added to the list element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml parent to which the converted element should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">htmlListElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html ul/ol element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="87a253c2a1f7a1eb" href="R/87a253c2a1f7a1eb.html" target="n" data-glyph="76,1" class="i method">AddList</a>(<span class="t t">XmlElement</span> <span id="r97 rd" class="r97 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r98 rd" class="r98 r">htmlListElement</span>,
            <span class="t t">Hashtable</span> <span id="r99 rd" class="r99 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r100 rd" class="r100 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r101 rd" class="r101 r">sourceContext</span>)
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r102 rd" class="r102 r">htmlListElementName</span> = <span class="r98 r">htmlListElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

            <span class="t t">Hashtable</span> <span id="r103 rd" class="r103 r">localProperties</span>;
            <b>var</b> <span id="r104 rd" class="r104 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r98 r">htmlListElement</span>, <span class="r99 r">inheritedProperties</span>, <b>out</b> <span class="r103 r">localProperties</span>,
                <span class="r100 r">stylesheet</span>, <span class="r101 r">sourceContext</span>);

            <span class="c">// Create Xaml List element</span>
            <b>var</b> <span id="r105 rd" class="r105 r">xamlListElement</span> = <span class="r97 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#3632e9f713eb2c4c" class="i field">XamlList</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

            <span class="c">// Set default list markers</span>
            <span class="r105 r">xamlListElement</span>.<span class="i method">SetAttribute</span>(<a href="#86482d026a420505" class="i field">XamlListMarkerStyle</a>,
                <span class="r102 r">htmlListElementName</span> == <span class="s">&quot;ol&quot;</span> ? <a href="#23fb19148294c867" class="i field">XamlListMarkerStyleDecimal</a> : <a href="#e25282d203a5adf1" class="i field">XamlListMarkerStyleDisc</a>);

            <span class="c">// Apply local properties to list to set marker attribute if specified</span>
            <span class="c">// TODO: Should we have separate list attribute processing function?</span>
            <a href="#ef2c926ede15198c" class="i method">ApplyLocalProperties</a>(<span class="r105 r">xamlListElement</span>, <span class="r103 r">localProperties</span>, <span class="c">/*isBlock:*/</span><b>true</b>);

            <span class="c">// Recurse into list subtree</span>
            <b>for</b> (<b>var</b> <span id="r106 rd" class="r106 r">htmlChildNode</span> = <span class="r98 r">htmlListElement</span>.<span class="i property">FirstChild</span>;
                <span class="r106 r">htmlChildNode</span> != <b>null</b>;
                <span class="r106 r">htmlChildNode</span> = <span class="r106 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
            {
                <b>if</b> (<span class="r106 r">htmlChildNode</span> <b>is</b> <span class="t t">XmlElement</span> &amp;&amp; <span class="r106 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;li&quot;</span>)
                {
                    <span class="r101 r">sourceContext</span>.<span class="i method">Add</span>((<span class="t t">XmlElement</span>) <span class="r106 r">htmlChildNode</span>);
                    <a href="#9d9e393bb459b849" class="i method">AddListItem</a>(<span class="r105 r">xamlListElement</span>, (<span class="t t">XmlElement</span>) <span class="r106 r">htmlChildNode</span>, <span class="r104 r">currentProperties</span>, <span class="r100 r">stylesheet</span>,
                        <span class="r101 r">sourceContext</span>);
                    <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r101 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r101 r">sourceContext</span>[<span class="r101 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r106 r">htmlChildNode</span>);
                    <span class="r101 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r101 r">sourceContext</span>.<span class="i property">Count</span> - 1);
                }
            }

            <span class="c">// Add the List element to xaml tree - if it is not empty</span>
            <b>if</b> (<span class="r105 r">xamlListElement</span>.<span class="i property">HasChildNodes</span>)
            {
                <span class="r97 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r105 r">xamlListElement</span>);
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     If li items are found without a parent ul/ol element in Html string, creates xamlListElement as their parent and</span>
        <span class="c">///</span><span class="c">     adds</span>
        <span class="c">///</span><span class="c">     them to it. If the previously added node to the same xamlParentElement was a List, adds the elements to that list.</span>
        <span class="c">///</span><span class="c">     Otherwise, we create a new xamlListElement and add them to it. Elements are added as long as li elements appear</span>
        <span class="c">///</span><span class="c">     sequentially.</span>
        <span class="c">///</span><span class="c">     The first non-li or text node stops the addition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Parent element for the list</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">htmlLiElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Start Html li element without parent list</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlNode representing the first non-li node in the input after one or more li&#39;s have been processed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">XmlElement</span> <a id="4ef1606030ddcf16" href="R/4ef1606030ddcf16.html" target="n" data-glyph="76,1" class="i method">AddOrphanListItems</a>(<span class="t t">XmlElement</span> <span id="r107 rd" class="r107 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r108 rd" class="r108 r">htmlLiElement</span>,
            <span class="t t">Hashtable</span> <span id="r109 rd" class="r109 r">inheritedProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r110 rd" class="r110 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r111 rd" class="r111 r">sourceContext</span>)
        {
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r108 r">htmlLiElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;li&quot;</span>);

            <span class="t t">XmlElement</span> <span id="r112 rd" class="r112 r">lastProcessedListItemElement</span> = <b>null</b>;

            <span class="c">// Find out the last element attached to the xamlParentElement, which is the previous sibling of this node</span>
            <b>var</b> <span id="r113 rd" class="r113 r">xamlListItemElementPreviousSibling</span> = <span class="r107 r">xamlParentElement</span>.<span class="i property">LastChild</span>;
            <span class="t t">XmlElement</span> <span id="r114 rd" class="r114 r">xamlListElement</span>;
            <b>if</b> (<span class="r113 r">xamlListItemElementPreviousSibling</span> != <b>null</b> &amp;&amp; <span class="r113 r">xamlListItemElementPreviousSibling</span>.<span class="i property">LocalName</span> == <a href="#3632e9f713eb2c4c" class="i field">XamlList</a>)
            {
                <span class="c">// Previously added Xaml element was a list. We will add the new li to it</span>
                <span class="r114 r">xamlListElement</span> = (<span class="t t">XmlElement</span>) <span class="r113 r">xamlListItemElementPreviousSibling</span>;
            }
            <b>else</b>
            {
                <span class="c">// No list element near. Create our own.</span>
                <span class="r114 r">xamlListElement</span> = <span class="r107 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#3632e9f713eb2c4c" class="i field">XamlList</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                <span class="r107 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r114 r">xamlListElement</span>);
            }

            <span class="t t">XmlNode</span> <span id="r115 rd" class="r115 r">htmlChildNode</span> = <span class="r108 r">htmlLiElement</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r116 rd" class="r116 r">htmlChildNodeName</span> = <span class="r115 r">htmlChildNode</span> == <b>null</b> ? <b>null</b> : <span class="r115 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

            <span class="c">//  Current element properties missed here.</span>
            <span class="c">//currentProperties = GetElementProperties(htmlLIElement, inheritedProperties, out localProperties, stylesheet);</span>

            <span class="c">// Add li elements to the parent xamlListElement we created as long as they appear sequentially</span>
            <span class="c">// Use properties inherited from xamlParentElement for context </span>
            <b>while</b> (<span class="r115 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r116 r">htmlChildNodeName</span> == <span class="s">&quot;li&quot;</span>)
            {
                <a href="#9d9e393bb459b849" class="i method">AddListItem</a>(<span class="r114 r">xamlListElement</span>, (<span class="t t">XmlElement</span>) <span class="r115 r">htmlChildNode</span>, <span class="r109 r">inheritedProperties</span>, <span class="r110 r">stylesheet</span>, <span class="r111 r">sourceContext</span>);
                <span class="r112 r">lastProcessedListItemElement</span> = (<span class="t t">XmlElement</span>) <span class="r115 r">htmlChildNode</span>;
                <span class="r115 r">htmlChildNode</span> = <span class="r115 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                <span class="r116 r">htmlChildNodeName</span> = <span class="r115 r">htmlChildNode</span>?.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            }

            <b>return</b> <span class="r112 r">lastProcessedListItemElement</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts htmlLIElement into Xaml ListItem element, and appends it to the parent xamlListElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r">xamlListElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml List element to which the converted td/th should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">htmlLiElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html li element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="9d9e393bb459b849" href="R/9d9e393bb459b849.html" target="n" data-glyph="76,1" class="i method">AddListItem</a>(<span class="t t">XmlElement</span> <span id="r117 rd" class="r117 r">xamlListElement</span>, <span class="t t">XmlElement</span> <span id="r118 rd" class="r118 r">htmlLiElement</span>,
            <span class="t t">Hashtable</span> <span id="r119 rd" class="r119 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r120 rd" class="r120 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r121 rd" class="r121 r">sourceContext</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r117 r">xamlListElement</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r117 r">xamlListElement</span>.<span class="i property">LocalName</span> == <a href="#3632e9f713eb2c4c" class="i field">XamlList</a>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r118 r">htmlLiElement</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r118 r">htmlLiElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;li&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r119 r">inheritedProperties</span> != <b>null</b>);

            <span class="t t">Hashtable</span> <span id="r122 rd" class="r122 r">localProperties</span>;
            <b>var</b> <span id="r123 rd" class="r123 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r118 r">htmlLiElement</span>, <span class="r119 r">inheritedProperties</span>, <b>out</b> <span class="r122 r">localProperties</span>,
                <span class="r120 r">stylesheet</span>, <span class="r121 r">sourceContext</span>);

            <b>var</b> <span id="r124 rd" class="r124 r">xamlListItemElement</span> = <span class="r117 r">xamlListElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#fdd1bca0c23aef50" class="i field">XamlListItem</a>,
                <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

            <span class="c">// TODO: process local properties for li element</span>

            <span class="c">// Process children of the ListItem</span>
            <b>for</b> (<b>var</b> <span id="r125 rd" class="r125 r">htmlChildNode</span> = <span class="r118 r">htmlLiElement</span>.<span class="i property">FirstChild</span>;
                <span class="r125 r">htmlChildNode</span> != <b>null</b>;
                <span class="r125 r">htmlChildNode</span> = <span class="r125 r">htmlChildNode</span>?.<span class="i property">NextSibling</span>)
            {
                <span class="r125 r">htmlChildNode</span> = <a href="#8e1071541426e5e6" class="i method">AddBlock</a>(<span class="r124 r">xamlListItemElement</span>, <span class="r125 r">htmlChildNode</span>, <span class="r123 r">currentProperties</span>, <span class="r120 r">stylesheet</span>,
                    <span class="r121 r">sourceContext</span>);
            }

            <span class="c">// Add resulting ListBoxItem to a xaml parent</span>
            <span class="r117 r">xamlListElement</span>.<span class="i method">AppendChild</span>(<span class="r124 r">xamlListItemElement</span>);
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Tables</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts htmlTableElement to a Xaml Table element. Adds tbody elements if they are missing so</span>
        <span class="c">///</span><span class="c">     that a resulting Xaml Table element is properly formed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">xamlParentElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Parent xaml element to which a converted table must be added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">htmlTableElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement reprsenting the Html table element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Hashtable representing properties inherited from parent context.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="c9eac659b6953f61" href="R/c9eac659b6953f61.html" target="n" data-glyph="76,1" class="i method">AddTable</a>(<span class="t t">XmlElement</span> <span id="r126 rd" class="r126 r">xamlParentElement</span>, <span class="t t">XmlElement</span> <span id="r127 rd" class="r127 r">htmlTableElement</span>,
            <span class="t t">Hashtable</span> <span id="r128 rd" class="r128 r">inheritedProperties</span>,
            <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r129 rd" class="r129 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r130 rd" class="r130 r">sourceContext</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r127 r">htmlTableElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;table&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r126 r">xamlParentElement</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r128 r">inheritedProperties</span> != <b>null</b>);

            <span class="c">// Create current properties to be used by children as inherited properties, set local properties</span>
            <span class="t t">Hashtable</span> <span id="r131 rd" class="r131 r">localProperties</span>;
            <b>var</b> <span id="r132 rd" class="r132 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r127 r">htmlTableElement</span>, <span class="r128 r">inheritedProperties</span>,
                <b>out</b> <span class="r131 r">localProperties</span>,
                <span class="r129 r">stylesheet</span>, <span class="r130 r">sourceContext</span>);

            <span class="c">// TODO: process localProperties for tables to override defaults, decide cell spacing defaults</span>

            <span class="c">// Check if the table contains only one cell - we want to take only its content</span>
            <b>var</b> <span id="r133 rd" class="r133 r">singleCell</span> = <a href="#38a409c71a29fc74" class="i method">GetCellFromSingleCellTable</a>(<span class="r127 r">htmlTableElement</span>);

            <b>if</b> (<span class="r133 r">singleCell</span> != <b>null</b>)
            {
                <span class="c">//  Need to push skipped table elements onto sourceContext</span>
                <span class="r130 r">sourceContext</span>.<span class="i method">Add</span>(<span class="r133 r">singleCell</span>);

                <span class="c">// Add the cell&#39;s content directly to parent</span>
                <b>for</b> (<b>var</b> <span id="r134 rd" class="r134 r">htmlChildNode</span> = <span class="r133 r">singleCell</span>.<span class="i property">FirstChild</span>;
                    <span class="r134 r">htmlChildNode</span> != <b>null</b>;
                    <span class="r134 r">htmlChildNode</span> = <span class="r134 r">htmlChildNode</span>?.<span class="i property">NextSibling</span>)
                {
                    <span class="r134 r">htmlChildNode</span> = <a href="#8e1071541426e5e6" class="i method">AddBlock</a>(<span class="r126 r">xamlParentElement</span>, <span class="r134 r">htmlChildNode</span>, <span class="r132 r">currentProperties</span>, <span class="r129 r">stylesheet</span>,
                        <span class="r130 r">sourceContext</span>);
                }

                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r130 r">sourceContext</span>[<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r133 r">singleCell</span>);
                <span class="r130 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> - 1);
            }
            <b>else</b>
            {
                <span class="c">// Create xamlTableElement</span>
                <b>var</b> <span id="r135 rd" class="r135 r">xamlTableElement</span> = <span class="r126 r">xamlParentElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#3cded5c531fa0c02" class="i field">XamlTable</a>,
                    <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

                <span class="c">// Analyze table structure for column widths and rowspan attributes</span>
                <b>var</b> <span id="r136 rd" class="r136 r">columnStarts</span> = <a href="#892869aaef853249" class="i method">AnalyzeTableStructure</a>(<span class="r127 r">htmlTableElement</span>, <span class="r129 r">stylesheet</span>);

                <span class="c">// Process COLGROUP &amp; COL elements</span>
                <a href="#19e64c6c78c225c7" class="i method">AddColumnInformation</a>(<span class="r127 r">htmlTableElement</span>, <span class="r135 r">xamlTableElement</span>, <span class="r136 r">columnStarts</span>, <span class="r132 r">currentProperties</span>, <span class="r129 r">stylesheet</span>,
                    <span class="r130 r">sourceContext</span>);

                <span class="c">// Process table body - TBODY and TR elements</span>
                <b>var</b> <span id="r137 rd" class="r137 r">htmlChildNode</span> = <span class="r127 r">htmlTableElement</span>.<span class="i property">FirstChild</span>;

                <b>while</b> (<span class="r137 r">htmlChildNode</span> != <b>null</b>)
                {
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r138 rd" class="r138 r">htmlChildName</span> = <span class="r137 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

                    <span class="c">// Process the element</span>
                    <b>if</b> (<span class="r138 r">htmlChildName</span> == <span class="s">&quot;tbody&quot;</span> || <span class="r138 r">htmlChildName</span> == <span class="s">&quot;thead&quot;</span> || <span class="r138 r">htmlChildName</span> == <span class="s">&quot;tfoot&quot;</span>)
                    {
                        <span class="c">//  Add more special processing for TableHeader and TableFooter</span>
                        <b>var</b> <span id="r139 rd" class="r139 r">xamlTableBodyElement</span> = <span class="r135 r">xamlTableElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>,
                            <a href="#91d2ca1889dbfdbf" class="i field">XamlTableRowGroup</a>,
                            <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                        <span class="r135 r">xamlTableElement</span>.<span class="i method">AppendChild</span>(<span class="r139 r">xamlTableBodyElement</span>);

                        <span class="r130 r">sourceContext</span>.<span class="i method">Add</span>((<span class="t t">XmlElement</span>) <span class="r137 r">htmlChildNode</span>);

                        <span class="c">// Get properties of Html tbody element</span>
                        <span class="t t">Hashtable</span> <span id="r140 rd" class="r140 r">tbodyElementLocalProperties</span>;
                        <b>var</b> <span id="r141 rd" class="r141 r">tbodyElementCurrentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>((<span class="t t">XmlElement</span>) <span class="r137 r">htmlChildNode</span>,
                            <span class="r132 r">currentProperties</span>,
                            <b>out</b> <span class="r140 r">tbodyElementLocalProperties</span>, <span class="r129 r">stylesheet</span>, <span class="r130 r">sourceContext</span>);
                        <span class="c">// TODO: apply local properties for tbody</span>

                        <span class="c">// Process children of htmlChildNode, which is tbody, for tr elements</span>
                        <a href="#f92d2dc4f43b4934" class="i method">AddTableRowsToTableBody</a>(<span class="r139 r">xamlTableBodyElement</span>, <span class="r137 r">htmlChildNode</span>.<span class="i property">FirstChild</span>,
                            <span class="r141 r">tbodyElementCurrentProperties</span>,
                            <span class="r136 r">columnStarts</span>, <span class="r129 r">stylesheet</span>, <span class="r130 r">sourceContext</span>);
                        <b>if</b> (<span class="r139 r">xamlTableBodyElement</span>.<span class="i property">HasChildNodes</span>)
                        {
                            <span class="r135 r">xamlTableElement</span>.<span class="i method">AppendChild</span>(<span class="r139 r">xamlTableBodyElement</span>);
                            <span class="c">// else: if there is no TRs in this TBody, we simply ignore it</span>
                        }

                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r130 r">sourceContext</span>[<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r137 r">htmlChildNode</span>);
                        <span class="r130 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r130 r">sourceContext</span>.<span class="i property">Count</span> - 1);

                        <span class="r137 r">htmlChildNode</span> = <span class="r137 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                    }
                    <b>else</b> <b>if</b> (<span class="r138 r">htmlChildName</span> == <span class="s">&quot;tr&quot;</span>)
                    {
                        <span class="c">// Tbody is not present, but tr element is present. Tr is wrapped in tbody</span>
                        <b>var</b> <span id="r142 rd" class="r142 r">xamlTableBodyElement</span> = <span class="r135 r">xamlTableElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>,
                            <a href="#91d2ca1889dbfdbf" class="i field">XamlTableRowGroup</a>,
                            <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

                        <span class="c">// We use currentProperties of xamlTableElement when adding rows since the tbody element is artificially created and has </span>
                        <span class="c">// no properties of its own</span>

                        <span class="r137 r">htmlChildNode</span> = <a href="#f92d2dc4f43b4934" class="i method">AddTableRowsToTableBody</a>(<span class="r142 r">xamlTableBodyElement</span>, <span class="r137 r">htmlChildNode</span>, <span class="r132 r">currentProperties</span>,
                            <span class="r136 r">columnStarts</span>,
                            <span class="r129 r">stylesheet</span>, <span class="r130 r">sourceContext</span>);
                        <b>if</b> (<span class="r142 r">xamlTableBodyElement</span>.<span class="i property">HasChildNodes</span>)
                        {
                            <span class="r135 r">xamlTableElement</span>.<span class="i method">AppendChild</span>(<span class="r142 r">xamlTableBodyElement</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// Element is not tbody or tr. Ignore it.</span>
                        <span class="c">// TODO: add processing for thead, tfoot elements and recovery for td elements</span>
                        <span class="r137 r">htmlChildNode</span> = <span class="r137 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                    }
                }

                <b>if</b> (<span class="r135 r">xamlTableElement</span>.<span class="i property">HasChildNodes</span>)
                {
                    <span class="r126 r">xamlParentElement</span>.<span class="i method">AppendChild</span>(<span class="r135 r">xamlTableElement</span>);
                }
            }
        }

        <b>private static</b> <span class="t t">XmlElement</span> <a id="38a409c71a29fc74" href="R/38a409c71a29fc74.html" target="n" data-glyph="76,1" class="i method">GetCellFromSingleCellTable</a>(<span class="t t">XmlElement</span> <span id="r143 rd" class="r143 r">htmlTableElement</span>)
        {
            <span class="t t">XmlElement</span> <span id="r144 rd" class="r144 r">singleCell</span> = <b>null</b>;

            <b>for</b> (<b>var</b> <span id="r145 rd" class="r145 r">tableChild</span> = <span class="r143 r">htmlTableElement</span>.<span class="i property">FirstChild</span>;
                <span class="r145 r">tableChild</span> != <b>null</b>;
                <span class="r145 r">tableChild</span> = <span class="r145 r">tableChild</span>.<span class="i property">NextSibling</span>)
            {
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r146 rd" class="r146 r">elementName</span> = <span class="r145 r">tableChild</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                <b>if</b> (<span class="r146 r">elementName</span> == <span class="s">&quot;tbody&quot;</span> || <span class="r146 r">elementName</span> == <span class="s">&quot;thead&quot;</span> || <span class="r146 r">elementName</span> == <span class="s">&quot;tfoot&quot;</span>)
                {
                    <b>if</b> (<span class="r144 r">singleCell</span> != <b>null</b>)
                    {
                        <b>return</b> <b>null</b>;
                    }
                    <b>for</b> (<b>var</b> <span id="r147 rd" class="r147 r">tbodyChild</span> = <span class="r145 r">tableChild</span>.<span class="i property">FirstChild</span>;
                        <span class="r147 r">tbodyChild</span> != <b>null</b>;
                        <span class="r147 r">tbodyChild</span> = <span class="r147 r">tbodyChild</span>.<span class="i property">NextSibling</span>)
                    {
                        <b>if</b> (<span class="r147 r">tbodyChild</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;tr&quot;</span>)
                        {
                            <b>if</b> (<span class="r144 r">singleCell</span> != <b>null</b>)
                            {
                                <b>return</b> <b>null</b>;
                            }
                            <b>for</b> (<b>var</b> <span id="r148 rd" class="r148 r">trChild</span> = <span class="r147 r">tbodyChild</span>.<span class="i property">FirstChild</span>;
                                <span class="r148 r">trChild</span> != <b>null</b>;
                                <span class="r148 r">trChild</span> = <span class="r148 r">trChild</span>.<span class="i property">NextSibling</span>)
                            {
                                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r149 rd" class="r149 r">cellName</span> = <span class="r148 r">trChild</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                                <b>if</b> (<span class="r149 r">cellName</span> == <span class="s">&quot;td&quot;</span> || <span class="r149 r">cellName</span> == <span class="s">&quot;th&quot;</span>)
                                {
                                    <b>if</b> (<span class="r144 r">singleCell</span> != <b>null</b>)
                                    {
                                        <b>return</b> <b>null</b>;
                                    }
                                    <span class="r144 r">singleCell</span> = (<span class="t t">XmlElement</span>) <span class="r148 r">trChild</span>;
                                }
                            }
                        }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r145 r">tableChild</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;tr&quot;</span>)
                {
                    <b>if</b> (<span class="r144 r">singleCell</span> != <b>null</b>)
                    {
                        <b>return</b> <b>null</b>;
                    }
                    <b>for</b> (<b>var</b> <span id="r150 rd" class="r150 r">trChild</span> = <span class="r145 r">tableChild</span>.<span class="i property">FirstChild</span>; <span class="r150 r">trChild</span> != <b>null</b>; <span class="r150 r">trChild</span> = <span class="r150 r">trChild</span>.<span class="i property">NextSibling</span>)
                    {
                        <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r151 rd" class="r151 r">cellName</span> = <span class="r150 r">trChild</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                        <b>if</b> (<span class="r151 r">cellName</span> == <span class="s">&quot;td&quot;</span> || <span class="r151 r">cellName</span> == <span class="s">&quot;th&quot;</span>)
                        {
                            <b>if</b> (<span class="r144 r">singleCell</span> != <b>null</b>)
                            {
                                <b>return</b> <b>null</b>;
                            }
                            <span class="r144 r">singleCell</span> = (<span class="t t">XmlElement</span>) <span class="r150 r">trChild</span>;
                        }
                    }
                }
            }

            <b>return</b> <span class="r144 r">singleCell</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Processes the information about table columns - COLGROUP and COL html elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r152 r">htmlTableElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing a source html table.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r153 r">xamlTableElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement repesenting a resulting xaml table.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r154 r">columnStartsAllRows</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Array of doubles - column start coordinates.</span>
        <span class="c">///</span><span class="c">     Can be null, which means that column size information is not available</span>
        <span class="c">///</span><span class="c">     and we must use source colgroup/col information.</span>
        <span class="c">///</span><span class="c">     In case wneh it&#39;s not null, we will ignore source colgroup/col information.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r155 r">currentProperties</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r156 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r157 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="19e64c6c78c225c7" href="R/19e64c6c78c225c7.html" target="n" data-glyph="76,1" class="i method">AddColumnInformation</a>(<span class="t t">XmlElement</span> <span id="r152 rd" class="r152 r">htmlTableElement</span>, <span class="t t">XmlElement</span> <span id="r153 rd" class="r153 r">xamlTableElement</span>,
            <span class="t t">ArrayList</span> <span id="r154 rd" class="r154 r">columnStartsAllRows</span>, <span class="t t">Hashtable</span> <span id="r155 rd" class="r155 r">currentProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r156 rd" class="r156 r">stylesheet</span>,
            <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r157 rd" class="r157 r">sourceContext</span>)
        {
            <span class="c">// Flow document table requires &lt;Table.Columns&gt; element to include &lt;TableColumn/&gt; element as </span>
            <span class="c">// defined in https://docs.microsoft.com/en-us/dotnet/framework/wpf/advanced/how-to-define-a-table-with-xaml</span>
            <span class="c">// Notic: CreateElement(&quot;Table&quot;, &quot;Columns&quot;, XamlNamespace) would add xmlns attribute to &lt;Table.Columns&gt; and lead to XMLReader crash.</span>
            <span class="t t">XmlElement</span> <span id="r158 rd" class="r158 r">xamlTableColumnGroupElement</span> = <span class="r153 r">xamlTableElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#5d5732ec7bb65aa3" class="i field">XamlTableColumnGroup</a>, <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
            <span class="c">// Add column information</span>
            <b>if</b> (<span class="r154 r">columnStartsAllRows</span> != <b>null</b>)
            {
                <span class="c">// We have consistent information derived from table cells; use it</span>
                <span class="c">// The last element in columnStarts represents the end of the table</span>
                <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r159 rd" class="r159 r">columnIndex</span> = 0; <span class="r159 r">columnIndex</span> &lt; <span class="r154 r">columnStartsAllRows</span>.<span class="i property">Count</span> - 1; <span class="r159 r">columnIndex</span>++)
                {
                    <span class="t t">XmlElement</span> <span id="r160 rd" class="r160 r">xamlColumnElement</span>;

                    <span class="r160 r">xamlColumnElement</span> = <span class="r158 r">xamlTableColumnGroupElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#184458ba79237333" class="i field">XamlTableColumn</a>,
                        <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);
                    <span class="r160 r">xamlColumnElement</span>.<span class="i method">SetAttribute</span>(<a href="#67050ea94870f5cc" class="i field">XamlWidth</a>,
                        ((<b>double</b>) <span class="r154 r">columnStartsAllRows</span>[<span class="r159 r">columnIndex</span> + 1] - (<b>double</b>) <span class="r154 r">columnStartsAllRows</span>[<span class="r159 r">columnIndex</span>])
                            .<a href="@1@System.Runtime/A.html#102b12e1c4385406" class="i method">ToString</a>(<a href="@1@System.Runtime/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@System.Runtime/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>));
                    <span class="r158 r">xamlTableColumnGroupElement</span>.<span class="i method">AppendChild</span>(<span class="r160 r">xamlColumnElement</span>);
                }
            }
            <b>else</b>
            {
                <span class="c">// We do not have consistent information from table cells;</span>
                <span class="c">// Translate blindly colgroups from html.                </span>
                <b>for</b> (<b>var</b> <span id="r161 rd" class="r161 r">htmlChildNode</span> = <span class="r152 r">htmlTableElement</span>.<span class="i property">FirstChild</span>;
                    <span class="r161 r">htmlChildNode</span> != <b>null</b>;
                    <span class="r161 r">htmlChildNode</span> = <span class="r161 r">htmlChildNode</span>.<span class="i property">NextSibling</span>)
                {
                    <b>if</b> (<span class="r161 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;colgroup&quot;</span>)
                    {
                        <span class="c">// TODO: add column width information to this function as a parameter and process it</span>
                        <a href="#0bd4c063a3d1c0ad" class="i method">AddTableColumnGroup</a>(<span class="r158 r">xamlTableColumnGroupElement</span>, (<span class="t t">XmlElement</span>) <span class="r161 r">htmlChildNode</span>, <span class="r155 r">currentProperties</span>, <span class="r156 r">stylesheet</span>,
                            <span class="r157 r">sourceContext</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="r161 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;col&quot;</span>)
                    {
                        <a href="#fe264357ecc30c5c" class="i method">AddTableColumn</a>(<span class="r158 r">xamlTableColumnGroupElement</span>, (<span class="t t">XmlElement</span>) <span class="r161 r">htmlChildNode</span>, <span class="r155 r">currentProperties</span>, <span class="r156 r">stylesheet</span>,
                            <span class="r157 r">sourceContext</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="r161 r">htmlChildNode</span> <b>is</b> <span class="t t">XmlElement</span>)
                    {
                        <span class="c">// Some element which belongs to table body. Stop column loop.</span>
                        <b>break</b>;
                    }
                }
            }
            <b>if</b> (<span class="r158 r">xamlTableColumnGroupElement</span>.<span class="i property">HasChildNodes</span>)
            {
                <span class="r153 r">xamlTableElement</span>.<span class="i method">AppendChild</span>(<span class="r158 r">xamlTableColumnGroupElement</span>);
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts htmlColgroupElement into Xaml TableColumnGroup element, and appends it to the parent</span>
        <span class="c">///</span><span class="c">     xamlTableElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r162 r">xamlTableColumnGroupElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml Table element to which the converted column group should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r163 r">htmlColgroupElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html colgroup element to be converted</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r164 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">         Properties inherited from parent context</span>
        <span class="c">///</span><span class="c">     </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="0bd4c063a3d1c0ad" href="R/0bd4c063a3d1c0ad.html" target="n" data-glyph="76,1" class="i method">AddTableColumnGroup</a>(<span class="t t">XmlElement</span> <span id="r162 rd" class="r162 r">xamlTableColumnGroupElement</span>, <span class="t t">XmlElement</span> <span id="r163 rd" class="r163 r">htmlColgroupElement</span>,
            <span class="t t">Hashtable</span> <span id="r164 rd" class="r164 r">inheritedProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r165 rd" class="r165 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r166 rd" class="r166 r">sourceContext</span>)
        {
            <span class="t t">Hashtable</span> <span id="r167 rd" class="r167 r">localProperties</span>;
            <b>var</b> <span id="r168 rd" class="r168 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r163 r">htmlColgroupElement</span>, <span class="r164 r">inheritedProperties</span>,
                <b>out</b> <span class="r167 r">localProperties</span>,
                <span class="r165 r">stylesheet</span>, <span class="r166 r">sourceContext</span>);

            <span class="c">// TODO: process local properties for colgroup</span>

            <span class="c">// Process children of colgroup. Colgroup may contain only col elements.</span>
            <b>for</b> (<b>var</b> <span id="r169 rd" class="r169 r">htmlNode</span> = <span class="r163 r">htmlColgroupElement</span>.<span class="i property">FirstChild</span>; <span class="r169 r">htmlNode</span> != <b>null</b>; <span class="r169 r">htmlNode</span> = <span class="r169 r">htmlNode</span>.<span class="i property">NextSibling</span>)
            {
                <b>if</b> (<span class="r169 r">htmlNode</span> <b>is</b> <span class="t t">XmlElement</span> &amp;&amp; <span class="r169 r">htmlNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;col&quot;</span>)
                {
                    <a href="#fe264357ecc30c5c" class="i method">AddTableColumn</a>(<span class="r162 r">xamlTableColumnGroupElement</span>, (<span class="t t">XmlElement</span>) <span class="r169 r">htmlNode</span>, <span class="r168 r">currentProperties</span>, <span class="r165 r">stylesheet</span>, <span class="r166 r">sourceContext</span>);
                }
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts htmlColElement into Xaml TableColumn element, and appends it to the parent</span>
        <span class="c">///</span><span class="c">     xamlTableColumnGroupElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r">xamlTableColumnGroupElement</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">htmlColElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html col element to be converted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r172 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties inherited from parent context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="fe264357ecc30c5c" href="R/fe264357ecc30c5c.html" target="n" data-glyph="76,1" class="i method">AddTableColumn</a>(<span class="t t">XmlElement</span> <span id="r170 rd" class="r170 r">xamlTableColumnGroupElement</span>, <span class="t t">XmlElement</span> <span id="r171 rd" class="r171 r">htmlColElement</span>,
            <span class="t t">Hashtable</span> <span id="r172 rd" class="r172 r">inheritedProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r173 rd" class="r173 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r174 rd" class="r174 r">sourceContext</span>)
        {
            <span class="t t">Hashtable</span> <span id="r175 rd" class="r175 r">localProperties</span>;
            <b>var</b> <span id="r176 rd" class="r176 r">currentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>(<span class="r171 r">htmlColElement</span>, <span class="r172 r">inheritedProperties</span>, <b>out</b> <span class="r175 r">localProperties</span>,
                <span class="r173 r">stylesheet</span>, <span class="r174 r">sourceContext</span>);

            <b>var</b> <span id="r177 rd" class="r177 r">xamlTableColumnElement</span> = <span class="r170 r">xamlTableColumnGroupElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>, <a href="#184458ba79237333" class="i field">XamlTableColumn</a>,
                <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

            <span class="c">// TODO: process local properties for TableColumn element</span>

            <span class="c">// Col is an empty element, with no subtree </span>
            <span class="r170 r">xamlTableColumnGroupElement</span>.<span class="i method">AppendChild</span>(<span class="r177 r">xamlTableColumnElement</span>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Adds TableRow elements to xamlTableBodyElement. The rows are converted from Html tr elements that</span>
        <span class="c">///</span><span class="c">     may be the children of an Html tbody element or an Html table element with tbody missing</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">xamlTableBodyElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml TableRowGroup element to which the converted rows should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">htmlTrStartNode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing the first tr child of the tbody element to be read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">currentProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Hashtable representing current properties of the tbody element that are generated and applied in the</span>
        <span class="c">///</span><span class="c">     AddTable function; to be used as inheritedProperties when adding tr elements</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r181 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r182 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlNode representing the current position of the iterator among tr elements</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">XmlNode</span> <a id="f92d2dc4f43b4934" href="R/f92d2dc4f43b4934.html" target="n" data-glyph="76,1" class="i method">AddTableRowsToTableBody</a>(<span class="t t">XmlElement</span> <span id="r178 rd" class="r178 r">xamlTableBodyElement</span>, <span class="t t">XmlNode</span> <span id="r179 rd" class="r179 r">htmlTrStartNode</span>,
            <span class="t t">Hashtable</span> <span id="r180 rd" class="r180 r">currentProperties</span>, <span class="t t">ArrayList</span> <span id="r181 rd" class="r181 r">columnStarts</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r182 rd" class="r182 r">stylesheet</span>,
            <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r183 rd" class="r183 r">sourceContext</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r178 r">xamlTableBodyElement</span>.<span class="i property">LocalName</span> == <a href="#91d2ca1889dbfdbf" class="i field">XamlTableRowGroup</a>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r180 r">currentProperties</span> != <b>null</b>);

            <span class="c">// Initialize child node for iteratimg through children to the first tr element</span>
            <b>var</b> <span id="r184 rd" class="r184 r">htmlChildNode</span> = <span class="r179 r">htmlTrStartNode</span>;
            <span class="t t">ArrayList</span> <span id="r185 rd" class="r185 r">activeRowSpans</span> = <b>null</b>;
            <b>if</b> (<span class="r181 r">columnStarts</span> != <b>null</b>)
            {
                <span class="r185 r">activeRowSpans</span> = <b>new</b> <span class="t constructor">ArrayList</span>();
                <a href="#203cde719901588a" class="i method">InitializeActiveRowSpans</a>(<span class="r185 r">activeRowSpans</span>, <span class="r181 r">columnStarts</span>.<span class="i property">Count</span>);
            }

            <b>while</b> (<span class="r184 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r184 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() != <span class="s">&quot;tbody&quot;</span>)
            {
                <b>if</b> (<span class="r184 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;tr&quot;</span>)
                {
                    <b>var</b> <span id="r186 rd" class="r186 r">xamlTableRowElement</span> = <span class="r178 r">xamlTableBodyElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>,
                        <a href="#61de1738883c2769" class="i field">XamlTableRow</a>,
                        <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

                    <span class="r183 r">sourceContext</span>.<span class="i method">Add</span>((<span class="t t">XmlElement</span>) <span class="r184 r">htmlChildNode</span>);

                    <span class="c">// Get tr element properties</span>
                    <span class="t t">Hashtable</span> <span id="r187 rd" class="r187 r">trElementLocalProperties</span>;
                    <b>var</b> <span id="r188 rd" class="r188 r">trElementCurrentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>((<span class="t t">XmlElement</span>) <span class="r184 r">htmlChildNode</span>,
                        <span class="r180 r">currentProperties</span>,
                        <b>out</b> <span class="r187 r">trElementLocalProperties</span>, <span class="r182 r">stylesheet</span>, <span class="r183 r">sourceContext</span>);
                    <span class="c">// TODO: apply local properties to tr element</span>

                    <a href="#02feb8b6e6ab7bee" class="i method">AddTableCellsToTableRow</a>(<span class="r186 r">xamlTableRowElement</span>, <span class="r184 r">htmlChildNode</span>.<span class="i property">FirstChild</span>, <span class="r188 r">trElementCurrentProperties</span>,
                        <span class="r181 r">columnStarts</span>,
                        <span class="r185 r">activeRowSpans</span>, <span class="r182 r">stylesheet</span>, <span class="r183 r">sourceContext</span>);
                    <b>if</b> (<span class="r186 r">xamlTableRowElement</span>.<span class="i property">HasChildNodes</span>)
                    {
                        <span class="r178 r">xamlTableBodyElement</span>.<span class="i method">AppendChild</span>(<span class="r186 r">xamlTableRowElement</span>);
                    }

                    <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r183 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r183 r">sourceContext</span>[<span class="r183 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r184 r">htmlChildNode</span>);
                    <span class="r183 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r183 r">sourceContext</span>.<span class="i property">Count</span> - 1);

                    <span class="c">// Advance</span>
                    <span class="r184 r">htmlChildNode</span> = <span class="r184 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                }
                <b>else</b> <b>if</b> (<span class="r184 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;td&quot;</span>)
                {
                    <span class="c">// Tr element is not present. We create one and add td elements to it</span>
                    <b>var</b> <span id="r189 rd" class="r189 r">xamlTableRowElement</span> = <span class="r178 r">xamlTableBodyElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>,
                        <a href="#61de1738883c2769" class="i field">XamlTableRow</a>,
                        <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

                    <span class="c">// This is incorrect formatting and the column starts should not be set in this case</span>
                    <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r181 r">columnStarts</span> == <b>null</b>);

                    <span class="r184 r">htmlChildNode</span> = <a href="#02feb8b6e6ab7bee" class="i method">AddTableCellsToTableRow</a>(<span class="r189 r">xamlTableRowElement</span>, <span class="r184 r">htmlChildNode</span>, <span class="r180 r">currentProperties</span>,
                        <span class="r181 r">columnStarts</span>,
                        <span class="r185 r">activeRowSpans</span>, <span class="r182 r">stylesheet</span>, <span class="r183 r">sourceContext</span>);
                    <b>if</b> (<span class="r189 r">xamlTableRowElement</span>.<span class="i property">HasChildNodes</span>)
                    {
                        <span class="r178 r">xamlTableBodyElement</span>.<span class="i method">AppendChild</span>(<span class="r189 r">xamlTableRowElement</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Not a tr or td  element. Ignore it.</span>
                    <span class="c">// TODO: consider better recovery here</span>
                    <span class="r184 r">htmlChildNode</span> = <span class="r184 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                }
            }
            <b>return</b> <span class="r184 r">htmlChildNode</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Adds TableCell elements to xamlTableRowElement.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">xamlTableRowElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml TableRow element to which the converted cells should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">htmlTdStartNode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing the child of tr or tbody element from which we should start adding td elements</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r192 r">currentProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     properties of the current html tr element to which cells are to be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing the current position of the iterator among the children of the parent Html tbody/tr element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">XmlNode</span> <a id="02feb8b6e6ab7bee" href="R/02feb8b6e6ab7bee.html" target="n" data-glyph="76,1" class="i method">AddTableCellsToTableRow</a>(<span class="t t">XmlElement</span> <span id="r190 rd" class="r190 r">xamlTableRowElement</span>, <span class="t t">XmlNode</span> <span id="r191 rd" class="r191 r">htmlTdStartNode</span>,
            <span class="t t">Hashtable</span> <span id="r192 rd" class="r192 r">currentProperties</span>, <span class="t t">ArrayList</span> <span id="r193 rd" class="r193 r">columnStarts</span>, <span class="t t">ArrayList</span> <span id="r194 rd" class="r194 r">activeRowSpans</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r195 rd" class="r195 r">stylesheet</span>,
            <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r196 rd" class="r196 r">sourceContext</span>)
        {
            <span class="c">// parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r190 r">xamlTableRowElement</span>.<span class="i property">LocalName</span> == <a href="#61de1738883c2769" class="i field">XamlTableRow</a>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r192 r">currentProperties</span> != <b>null</b>);
            <b>if</b> (<span class="r193 r">columnStarts</span> != <b>null</b>)
            {
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r194 r">activeRowSpans</span>.<span class="i property">Count</span> == <span class="r193 r">columnStarts</span>.<span class="i property">Count</span>);
            }

            <b>var</b> <span id="r197 rd" class="r197 r">htmlChildNode</span> = <span class="r191 r">htmlTdStartNode</span>;
            <b>double</b> <span id="r198 rd" class="r198 r">columnStart</span> = 0;
            <b>double</b> <span id="r199 rd" class="r199 r">columnWidth</span> = 0;
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r200 rd" class="r200 r">columnIndex</span> = 0;
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r201 rd" class="r201 r">columnSpan</span> = 0;

            <b>while</b> (<span class="r197 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() != <span class="s">&quot;tr&quot;</span> &amp;&amp;
                   <span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() != <span class="s">&quot;tbody&quot;</span> &amp;&amp; <span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() != <span class="s">&quot;thead&quot;</span> &amp;&amp;
                   <span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() != <span class="s">&quot;tfoot&quot;</span>)
            {
                <b>if</b> (<span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;td&quot;</span> || <span class="r197 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;th&quot;</span>)
                {
                    <b>var</b> <span id="r202 rd" class="r202 r">xamlTableCellElement</span> = <span class="r190 r">xamlTableRowElement</span>.<span class="i property">OwnerDocument</span>.<span class="i method">CreateElement</span>(<b>null</b>,
                        <a href="#9dfc8ea21aa144d7" class="i field">XamlTableCell</a>,
                        <a href="#82254182bc44cac2" class="i field">XamlNamespace</a>);

                    <span class="r196 r">sourceContext</span>.<span class="i method">Add</span>((<span class="t t">XmlElement</span>) <span class="r197 r">htmlChildNode</span>);

                    <span class="t t">Hashtable</span> <span id="r203 rd" class="r203 r">tdElementLocalProperties</span>;
                    <b>var</b> <span id="r204 rd" class="r204 r">tdElementCurrentProperties</span> = <a href="#f8b14540dce6a2c7" class="i method">GetElementProperties</a>((<span class="t t">XmlElement</span>) <span class="r197 r">htmlChildNode</span>,
                        <span class="r192 r">currentProperties</span>,
                        <b>out</b> <span class="r203 r">tdElementLocalProperties</span>, <span class="r195 r">stylesheet</span>, <span class="r196 r">sourceContext</span>);

                    <span class="c">// TODO: determine if localProperties can be used instead of htmlChildNode in this call, and if they can,</span>
                    <span class="c">// make necessary changes and use them instead.</span>
                    <a href="#dd777f5a2a1b9375" class="i method">ApplyPropertiesToTableCellElement</a>((<span class="t t">XmlElement</span>) <span class="r197 r">htmlChildNode</span>, <span class="r202 r">xamlTableCellElement</span>);

                    <b>if</b> (<span class="r193 r">columnStarts</span> != <b>null</b>)
                    {
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r200 r">columnIndex</span> &lt; <span class="r193 r">columnStarts</span>.<span class="i property">Count</span> - 1);
                        <b>while</b> (<span class="r200 r">columnIndex</span> &lt; <span class="r194 r">activeRowSpans</span>.<span class="i property">Count</span> &amp;&amp; (<b>int</b>) <span class="r194 r">activeRowSpans</span>[<span class="r200 r">columnIndex</span>] &gt; 0)
                        {
                            <span class="r194 r">activeRowSpans</span>[<span class="r200 r">columnIndex</span>] = (<b>int</b>) <span class="r194 r">activeRowSpans</span>[<span class="r200 r">columnIndex</span>] - 1;
                            <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>int</b>) <span class="r194 r">activeRowSpans</span>[<span class="r200 r">columnIndex</span>] &gt;= 0);
                            <span class="r200 r">columnIndex</span>++;
                        }
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r200 r">columnIndex</span> &lt; <span class="r193 r">columnStarts</span>.<span class="i property">Count</span> - 1);
                        <span class="r198 r">columnStart</span> = (<b>double</b>) <span class="r193 r">columnStarts</span>[<span class="r200 r">columnIndex</span>];
                        <span class="r199 r">columnWidth</span> = <a href="#74ea0c47b224ad44" class="i method">GetColumnWidth</a>((<span class="t t">XmlElement</span>) <span class="r197 r">htmlChildNode</span>);
                        <span class="r201 r">columnSpan</span> = <a href="#52d0b9daa7b2289c" class="i method">CalculateColumnSpan</a>(<span class="r200 r">columnIndex</span>, <span class="r199 r">columnWidth</span>, <span class="r193 r">columnStarts</span>);
                        <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r205 rd" class="r205 r">rowSpan</span> = <a href="#d0fdfc4fcb3fe889" class="i method">GetRowSpan</a>((<span class="t t">XmlElement</span>) <span class="r197 r">htmlChildNode</span>);

                        <span class="c">// Column cannot have no span</span>
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r201 r">columnSpan</span> &gt; 0);
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r200 r">columnIndex</span> + <span class="r201 r">columnSpan</span> &lt; <span class="r193 r">columnStarts</span>.<span class="i property">Count</span>);

                        <span class="r202 r">xamlTableCellElement</span>.<span class="i method">SetAttribute</span>(<a href="#475c1b80d24ab33d" class="i field">XamlTableCellColumnSpan</a>, <span class="r201 r">columnSpan</span>.<a href="@1@System.Runtime/A.html#8d6f2d8bc0589463" class="i method">ToString</a>());

                        <span class="c">// Apply row span</span>
                        <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r206 rd" class="r206 r">spannedColumnIndex</span> = <span class="r200 r">columnIndex</span>;
                            <span class="r206 r">spannedColumnIndex</span> &lt; <span class="r200 r">columnIndex</span> + <span class="r201 r">columnSpan</span>;
                            <span class="r206 r">spannedColumnIndex</span>++)
                        {
                            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r206 r">spannedColumnIndex</span> &lt; <span class="r194 r">activeRowSpans</span>.<span class="i property">Count</span>);
                            <span class="r194 r">activeRowSpans</span>[<span class="r206 r">spannedColumnIndex</span>] = (<span class="r205 r">rowSpan</span> - 1);
                            <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>int</b>) <span class="r194 r">activeRowSpans</span>[<span class="r206 r">spannedColumnIndex</span>] &gt;= 0);
                        }

                        <span class="r200 r">columnIndex</span> = <span class="r200 r">columnIndex</span> + <span class="r201 r">columnSpan</span>;
                    }

                    <a href="#4ea5b84b9f79110b" class="i method">AddDataToTableCell</a>(<span class="r202 r">xamlTableCellElement</span>, <span class="r197 r">htmlChildNode</span>.<span class="i property">FirstChild</span>, <span class="r204 r">tdElementCurrentProperties</span>,
                        <span class="r195 r">stylesheet</span>,
                        <span class="r196 r">sourceContext</span>);
                    <b>if</b> (<span class="r202 r">xamlTableCellElement</span>.<span class="i property">HasChildNodes</span>)
                    {
                        <span class="r190 r">xamlTableRowElement</span>.<span class="i method">AppendChild</span>(<span class="r202 r">xamlTableCellElement</span>);
                    }

                    <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r196 r">sourceContext</span>.<span class="i property">Count</span> &gt; 0 &amp;&amp; <span class="r196 r">sourceContext</span>[<span class="r196 r">sourceContext</span>.<span class="i property">Count</span> - 1] == <span class="r197 r">htmlChildNode</span>);
                    <span class="r196 r">sourceContext</span>.<span class="i method">RemoveAt</span>(<span class="r196 r">sourceContext</span>.<span class="i property">Count</span> - 1);

                    <span class="r197 r">htmlChildNode</span> = <span class="r197 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                }
                <b>else</b>
                {
                    <span class="c">// Not td element. Ignore it.</span>
                    <span class="c">// TODO: Consider better recovery</span>
                    <span class="r197 r">htmlChildNode</span> = <span class="r197 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
                }
            }
            <b>return</b> <span class="r197 r">htmlChildNode</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     adds table cell data to xamlTableCellElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r207 r">xamlTableCellElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml TableCell element to which the converted data should be added</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">htmlDataStartNode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing the start element of data to be added to xamlTableCellElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">currentProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Current properties for the html td/th element corresponding to xamlTableCellElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="4ea5b84b9f79110b" href="R/4ea5b84b9f79110b.html" target="n" data-glyph="76,1" class="i method">AddDataToTableCell</a>(<span class="t t">XmlElement</span> <span id="r207 rd" class="r207 r">xamlTableCellElement</span>, <span class="t t">XmlNode</span> <span id="r208 rd" class="r208 r">htmlDataStartNode</span>,
            <span class="t t">Hashtable</span> <span id="r209 rd" class="r209 r">currentProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r210 rd" class="r210 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r211 rd" class="r211 r">sourceContext</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r207 r">xamlTableCellElement</span>.<span class="i property">LocalName</span> == <a href="#9dfc8ea21aa144d7" class="i field">XamlTableCell</a>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r209 r">currentProperties</span> != <b>null</b>);

            <b>for</b> (<b>var</b> <span id="r212 rd" class="r212 r">htmlChildNode</span> = <span class="r208 r">htmlDataStartNode</span>;
                <span class="r212 r">htmlChildNode</span> != <b>null</b>;
                <span class="r212 r">htmlChildNode</span> = <span class="r212 r">htmlChildNode</span>?.<span class="i property">NextSibling</span>)
            {
                <span class="c">// Process a new html element and add it to the td element</span>
                <span class="r212 r">htmlChildNode</span> = <a href="#8e1071541426e5e6" class="i method">AddBlock</a>(<span class="r207 r">xamlTableCellElement</span>, <span class="r212 r">htmlChildNode</span>, <span class="r209 r">currentProperties</span>, <span class="r210 r">stylesheet</span>,
                    <span class="r211 r">sourceContext</span>);
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Performs a parsing pass over a table to read information about column width and rowspan attributes. This</span>
        <span class="c">///</span><span class="c">     information</span>
        <span class="c">///</span><span class="c">     is used to determine the starting point of each column.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r213 r">htmlTableElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html table whose structure is to be analyzed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList of type double which contains the function output. If analysis is successful, this ArrayList contains</span>
        <span class="c">///</span><span class="c">     all the points which are the starting position of any column in the table, ordered from left to right.</span>
        <span class="c">///</span><span class="c">     In case if analisys was impossible we return null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">ArrayList</span> <a id="892869aaef853249" href="R/892869aaef853249.html" target="n" data-glyph="76,1" class="i method">AnalyzeTableStructure</a>(<span class="t t">XmlElement</span> <span id="r213 rd" class="r213 r">htmlTableElement</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r214 rd" class="r214 r">stylesheet</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r213 r">htmlTableElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;table&quot;</span>);
            <b>if</b> (!<span class="r213 r">htmlTableElement</span>.<span class="i property">HasChildNodes</span>)
            {
                <b>return</b> <b>null</b>;
            }

            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r215 rd" class="r215 r">columnWidthsAvailable</span> = <b>true</b>;

            <b>var</b> <span id="r216 rd" class="r216 r">columnStarts</span> = <b>new</b> <span class="t constructor">ArrayList</span>();
            <b>var</b> <span id="r217 rd" class="r217 r">activeRowSpans</span> = <b>new</b> <span class="t constructor">ArrayList</span>();
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r216 r">columnStarts</span>.<span class="i property">Count</span> == <span class="r217 r">activeRowSpans</span>.<span class="i property">Count</span>);

            <b>var</b> <span id="r218 rd" class="r218 r">htmlChildNode</span> = <span class="r213 r">htmlTableElement</span>.<span class="i property">FirstChild</span>;
            <b>double</b> <span id="r219 rd" class="r219 r">tableWidth</span> = 0; <span class="c">// Keep track of table width which is the width of its widest row</span>

            <span class="c">// Analyze tbody and tr elements</span>
            <b>while</b> (<span class="r218 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r215 r">columnWidthsAvailable</span>)
            {
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r216 r">columnStarts</span>.<span class="i property">Count</span> == <span class="r217 r">activeRowSpans</span>.<span class="i property">Count</span>);

                <b>switch</b> (<span class="r218 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>())
                {
                    <b>case</b> <span class="s">&quot;tbody&quot;</span>:
                        <span class="c">// Tbody element, we should analyze its children for trows</span>
                        <a href="@1@System.Runtime/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r220 rd" class="r220 r">tbodyWidth</span> = <a href="#baa5133da775221c" class="i method">AnalyzeTbodyStructure</a>((<span class="t t">XmlElement</span>) <span class="r218 r">htmlChildNode</span>, <span class="r216 r">columnStarts</span>,
                            <span class="r217 r">activeRowSpans</span>, <span class="r219 r">tableWidth</span>,
                            <span class="r214 r">stylesheet</span>);
                        <b>if</b> (<span class="r220 r">tbodyWidth</span> &gt; <span class="r219 r">tableWidth</span>)
                        {
                            <span class="c">// Table width must be increased to supported newly added wide row</span>
                            <span class="r219 r">tableWidth</span> = <span class="r220 r">tbodyWidth</span>;
                        }
                        <b>else</b> <b>if</b> (<span class="r220 r">tbodyWidth</span> == 0)
                        {
                            <span class="c">// Tbody analysis may return 0, probably due to unprocessable format. </span>
                            <span class="c">// We should also fail.</span>
                            <span class="r215 r">columnWidthsAvailable</span> = <b>false</b>; <span class="c">// interrupt the analisys</span>
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;tr&quot;</span>:
                        <span class="c">// Table row. Analyze column structure within row directly</span>
                        <a href="@1@System.Runtime/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r221 rd" class="r221 r">trWidth</span> = <a href="#19770787889e69ad" class="i method">AnalyzeTrStructure</a>((<span class="t t">XmlElement</span>) <span class="r218 r">htmlChildNode</span>, <span class="r216 r">columnStarts</span>, <span class="r217 r">activeRowSpans</span>,
                            <span class="r219 r">tableWidth</span>,
                            <span class="r214 r">stylesheet</span>);
                        <b>if</b> (<span class="r221 r">trWidth</span> &gt; <span class="r219 r">tableWidth</span>)
                        {
                            <span class="r219 r">tableWidth</span> = <span class="r221 r">trWidth</span>;
                        }
                        <b>else</b> <b>if</b> (<span class="r221 r">trWidth</span> == 0)
                        {
                            <span class="r215 r">columnWidthsAvailable</span> = <b>false</b>; <span class="c">// interrupt the analisys</span>
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;td&quot;</span>:
                        <span class="c">// Incorrect formatting, too deep to analyze at this level. Return null.</span>
                        <span class="c">// TODO: implement analysis at this level, possibly by creating a new tr</span>
                        <span class="r215 r">columnWidthsAvailable</span> = <b>false</b>; <span class="c">// interrupt the analisys</span>
                        <b>break</b>;
                    <b>default</b>:
                        <span class="c">// Element should not occur directly in table. Ignore it.</span>
                        <b>break</b>;
                }

                <span class="r218 r">htmlChildNode</span> = <span class="r218 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
            }

            <b>if</b> (<span class="r215 r">columnWidthsAvailable</span>)
            {
                <span class="c">// Add an item for whole table width</span>
                <span class="r216 r">columnStarts</span>.<span class="i method">Add</span>(<span class="r219 r">tableWidth</span>);
                <a href="#39fdd33961652498" class="i method">VerifyColumnStartsAscendingOrder</a>(<span class="r216 r">columnStarts</span>);
            }
            <b>else</b>
            {
                <span class="r216 r">columnStarts</span> = <b>null</b>;
            }

            <b>return</b> <span class="r216 r">columnStarts</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Performs a parsing pass over a tbody to read information about column width and rowspan attributes. Information</span>
        <span class="c">///</span><span class="c">     read about width</span>
        <span class="c">///</span><span class="c">     attributes is stored in the reference ArrayList parameter columnStarts, which contains a list of all starting</span>
        <span class="c">///</span><span class="c">     positions of all columns in the table, ordered from left to right. Row spans are taken into consideration when</span>
        <span class="c">///</span><span class="c">     computing column starts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r222 r">htmlTbodyElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html tbody whose structure is to be analyzed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r223 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList of type double which contains the function output. If analysis fails, this parameter is set to null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">tableWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Current width of the table. This is used to determine if a new column when added to the end of table should</span>
        <span class="c">///</span><span class="c">     come after the last column in the table or is actually splitting the last column in two. If it is only splitting</span>
        <span class="c">///</span><span class="c">     the last column it should inherit row span for that column</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Calculated width of a tbody.</span>
        <span class="c">///</span><span class="c">     In case of non-analizable column width structure return 0;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static double</b> <a id="baa5133da775221c" href="R/baa5133da775221c.html" target="n" data-glyph="76,1" class="i method">AnalyzeTbodyStructure</a>(<span class="t t">XmlElement</span> <span id="r222 rd" class="r222 r">htmlTbodyElement</span>, <span class="t t">ArrayList</span> <span id="r223 rd" class="r223 r">columnStarts</span>,
            <span class="t t">ArrayList</span> <span id="r225 rd" class="r225 r">activeRowSpans</span>, <b>double</b> <span id="r224 rd" class="r224 r">tableWidth</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r226 rd" class="r226 r">stylesheet</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r222 r">htmlTbodyElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;tbody&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r223 r">columnStarts</span> != <b>null</b>);

            <b>double</b> <span id="r227 rd" class="r227 r">tbodyWidth</span> = 0;
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r228 rd" class="r228 r">columnWidthsAvailable</span> = <b>true</b>;

            <b>if</b> (!<span class="r222 r">htmlTbodyElement</span>.<span class="i property">HasChildNodes</span>)
            {
                <b>return</b> <span class="r227 r">tbodyWidth</span>;
            }

            <span class="c">// Set active row spans to 0 - thus ignoring row spans crossing tbody boundaries</span>
            <a href="#82183f421cf4b007" class="i method">ClearActiveRowSpans</a>(<span class="r225 r">activeRowSpans</span>);

            <b>var</b> <span id="r229 rd" class="r229 r">htmlChildNode</span> = <span class="r222 r">htmlTbodyElement</span>.<span class="i property">FirstChild</span>;

            <span class="c">// Analyze tr elements</span>
            <b>while</b> (<span class="r229 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r228 r">columnWidthsAvailable</span>)
            {
                <b>switch</b> (<span class="r229 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>())
                {
                    <b>case</b> <span class="s">&quot;tr&quot;</span>:
                        <a href="@1@System.Runtime/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r230 rd" class="r230 r">trWidth</span> = <a href="#19770787889e69ad" class="i method">AnalyzeTrStructure</a>((<span class="t t">XmlElement</span>) <span class="r229 r">htmlChildNode</span>, <span class="r223 r">columnStarts</span>, <span class="r225 r">activeRowSpans</span>,
                            <span class="r227 r">tbodyWidth</span>,
                            <span class="r226 r">stylesheet</span>);
                        <b>if</b> (<span class="r230 r">trWidth</span> &gt; <span class="r227 r">tbodyWidth</span>)
                        {
                            <span class="r227 r">tbodyWidth</span> = <span class="r230 r">trWidth</span>;
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;td&quot;</span>:
                        <span class="r228 r">columnWidthsAvailable</span> = <b>false</b>; <span class="c">// interrupt the analisys</span>
                        <b>break</b>;
                    <b>default</b>:
                        <b>break</b>;
                }
                <span class="r229 r">htmlChildNode</span> = <span class="r229 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
            }

            <span class="c">// Set active row spans to 0 - thus ignoring row spans crossing tbody boundaries</span>
            <a href="#82183f421cf4b007" class="i method">ClearActiveRowSpans</a>(<span class="r225 r">activeRowSpans</span>);

            <b>return</b> <span class="r228 r">columnWidthsAvailable</span> ? <span class="r227 r">tbodyWidth</span> : 0;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Performs a parsing pass over a tr element to read information about column width and rowspan attributes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r231 r">htmlTrElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html tr element whose structure is to be analyzed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r232 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList of type double which contains the function output. If analysis is successful, this ArrayList contains</span>
        <span class="c">///</span><span class="c">     all the points which are the starting position of any column in the tr, ordered from left to right. If analysis</span>
        <span class="c">///</span><span class="c">     fails,</span>
        <span class="c">///</span><span class="c">     the ArrayList is set to null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">activeRowSpans</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList representing all columns currently spanned by an earlier row span attribute. These columns should</span>
        <span class="c">///</span><span class="c">     not be used for data in this row. The ArrayList actually contains notation for all columns in the table, if the</span>
        <span class="c">///</span><span class="c">     active row span is set to 0 that column is not presently spanned but if it is &gt; 0 the column is presently spanned</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">tableWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Double value representing the current width of the table.</span>
        <span class="c">///</span><span class="c">     Return 0 if analisys was insuccessful.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static double</b> <a id="19770787889e69ad" href="R/19770787889e69ad.html" target="n" data-glyph="76,1" class="i method">AnalyzeTrStructure</a>(<span class="t t">XmlElement</span> <span id="r231 rd" class="r231 r">htmlTrElement</span>, <span class="t t">ArrayList</span> <span id="r232 rd" class="r232 r">columnStarts</span>,
            <span class="t t">ArrayList</span> <span id="r233 rd" class="r233 r">activeRowSpans</span>,
            <b>double</b> <span id="r234 rd" class="r234 r">tableWidth</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r235 rd" class="r235 r">stylesheet</span>)
        {
            <b>double</b> <span id="r236 rd" class="r236 r">columnWidth</span>;

            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r231 r">htmlTrElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;tr&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r232 r">columnStarts</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r233 r">activeRowSpans</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r232 r">columnStarts</span>.<span class="i property">Count</span> == <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span>);

            <b>if</b> (!<span class="r231 r">htmlTrElement</span>.<span class="i property">HasChildNodes</span>)
            {
                <b>return</b> 0;
            }

            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r237 rd" class="r237 r">columnWidthsAvailable</span> = <b>true</b>;

            <b>double</b> <span id="r238 rd" class="r238 r">columnStart</span> = 0; <span class="c">// starting position of current column</span>
            <b>var</b> <span id="r239 rd" class="r239 r">htmlChildNode</span> = <span class="r231 r">htmlTrElement</span>.<span class="i property">FirstChild</span>;
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r240 rd" class="r240 r">columnIndex</span> = 0;
            <b>double</b> <span id="r241 rd" class="r241 r">trWidth</span> = 0;

            <span class="c">// Skip spanned columns to get to real column start</span>
            <b>if</b> (<span class="r240 r">columnIndex</span> &lt; <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span>)
            {
                <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>] &gt;= <span class="r238 r">columnStart</span>);
                <b>if</b> ((<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>] == <span class="r238 r">columnStart</span>)
                {
                    <span class="c">// The new column may be in a spanned area</span>
                    <b>while</b> (<span class="r240 r">columnIndex</span> &lt; <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span> &amp;&amp; (<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] &gt; 0)
                    {
                        <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] = (<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] - 1;
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] &gt;= 0);
                        <span class="r240 r">columnIndex</span>++;
                        <span class="r238 r">columnStart</span> = (<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>];
                    }
                }
            }

            <b>while</b> (<span class="r239 r">htmlChildNode</span> != <b>null</b> &amp;&amp; <span class="r237 r">columnWidthsAvailable</span>)
            {
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r232 r">columnStarts</span>.<span class="i property">Count</span> == <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span>);

                <a href="#39fdd33961652498" class="i method">VerifyColumnStartsAscendingOrder</a>(<span class="r232 r">columnStarts</span>);

                <b>switch</b> (<span class="r239 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>())
                {
                    <b>case</b> <span class="s">&quot;td&quot;</span>:
                        <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r240 r">columnIndex</span> &lt;= <span class="r232 r">columnStarts</span>.<span class="i property">Count</span>);
                        <b>if</b> (<span class="r240 r">columnIndex</span> &lt; <span class="r232 r">columnStarts</span>.<span class="i property">Count</span>)
                        {
                            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r238 r">columnStart</span> &lt;= (<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>]);
                            <b>if</b> (<span class="r238 r">columnStart</span> &lt; (<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>])
                            {
                                <span class="r232 r">columnStarts</span>.<span class="i method">Insert</span>(<span class="r240 r">columnIndex</span>, <span class="r238 r">columnStart</span>);
                                <span class="c">// There can be no row spans now - the column data will appear here</span>
                                <span class="c">// Row spans may appear only during the column analysis</span>
                                <span class="r233 r">activeRowSpans</span>.<span class="i method">Insert</span>(<span class="r240 r">columnIndex</span>, 0);
                            }
                        }
                        <b>else</b>
                        {
                            <span class="c">// Column start is greater than all previous starts. Row span must still be 0 because</span>
                            <span class="c">// we are either adding after another column of the same row, in which case it should not inherit</span>
                            <span class="c">// the previous column&#39;s span. Otherwise we are adding after the last column of some previous</span>
                            <span class="c">// row, and assuming the table widths line up, we should not be spanned by it. If there is</span>
                            <span class="c">// an incorrect tbale structure where a columns starts in the middle of a row span, we do not</span>
                            <span class="c">// guarantee correct output</span>
                            <span class="r232 r">columnStarts</span>.<span class="i method">Add</span>(<span class="r238 r">columnStart</span>);
                            <span class="r233 r">activeRowSpans</span>.<span class="i method">Add</span>(0);
                        }
                        <span class="r236 r">columnWidth</span> = <a href="#74ea0c47b224ad44" class="i method">GetColumnWidth</a>((<span class="t t">XmlElement</span>) <span class="r239 r">htmlChildNode</span>);
                        <b>if</b> (<span class="r236 r">columnWidth</span> != -1)
                        {
                            <b>int</b> <span id="r242 rd" class="r242 r">nextColumnIndex</span>;
                            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r243 rd" class="r243 r">rowSpan</span> = <a href="#d0fdfc4fcb3fe889" class="i method">GetRowSpan</a>((<span class="t t">XmlElement</span>) <span class="r239 r">htmlChildNode</span>);

                            <span class="r242 r">nextColumnIndex</span> = <a href="#5441e093b46b4b20" class="i method">GetNextColumnIndex</a>(<span class="r240 r">columnIndex</span>, <span class="r236 r">columnWidth</span>, <span class="r232 r">columnStarts</span>, <span class="r233 r">activeRowSpans</span>);
                            <b>if</b> (<span class="r242 r">nextColumnIndex</span> != -1)
                            {
                                <span class="c">// Entire column width can be processed without hitting conflicting row span. This means that</span>
                                <span class="c">// column widths line up and we can process them</span>
                                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r242 r">nextColumnIndex</span> &lt;= <span class="r232 r">columnStarts</span>.<span class="i property">Count</span>);

                                <span class="c">// Apply row span to affected columns</span>
                                <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r244 rd" class="r244 r">spannedColumnIndex</span> = <span class="r240 r">columnIndex</span>;
                                    <span class="r244 r">spannedColumnIndex</span> &lt; <span class="r242 r">nextColumnIndex</span>;
                                    <span class="r244 r">spannedColumnIndex</span>++)
                                {
                                    <span class="r233 r">activeRowSpans</span>[<span class="r244 r">spannedColumnIndex</span>] = <span class="r243 r">rowSpan</span> - 1;
                                    <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r244 r">spannedColumnIndex</span>] &gt;= 0);
                                }

                                <span class="r240 r">columnIndex</span> = <span class="r242 r">nextColumnIndex</span>;

                                <span class="c">// Calculate columnsStart for the next cell</span>
                                <span class="r238 r">columnStart</span> = <span class="r238 r">columnStart</span> + <span class="r236 r">columnWidth</span>;

                                <b>if</b> (<span class="r240 r">columnIndex</span> &lt; <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span>)
                                {
                                    <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>] &gt;= <span class="r238 r">columnStart</span>);
                                    <b>if</b> ((<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>] == <span class="r238 r">columnStart</span>)
                                    {
                                        <span class="c">// The new column may be in a spanned area</span>
                                        <b>while</b> (<span class="r240 r">columnIndex</span> &lt; <span class="r233 r">activeRowSpans</span>.<span class="i property">Count</span> &amp;&amp;
                                               (<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] &gt; 0)
                                        {
                                            <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] = (<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] - 1;
                                            <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>int</b>) <span class="r233 r">activeRowSpans</span>[<span class="r240 r">columnIndex</span>] &gt;= 0);
                                            <span class="r240 r">columnIndex</span>++;
                                            <span class="r238 r">columnStart</span> = (<b>double</b>) <span class="r232 r">columnStarts</span>[<span class="r240 r">columnIndex</span>];
                                        }
                                    }
                                    <span class="c">// else: the new column does not start at the same time as a pre existing column</span>
                                    <span class="c">// so we don&#39;t have to check it for active row spans, it starts in the middle</span>
                                    <span class="c">// of another column which has been checked already by the GetNextColumnIndex function</span>
                                }
                            }
                            <b>else</b>
                            {
                                <span class="c">// Full column width cannot be processed without a pre existing row span.</span>
                                <span class="c">// We cannot analyze widths</span>
                                <span class="r237 r">columnWidthsAvailable</span> = <b>false</b>;
                            }
                        }
                        <b>else</b>
                        {
                            <span class="c">// Incorrect column width, stop processing</span>
                            <span class="r237 r">columnWidthsAvailable</span> = <b>false</b>;
                        }
                        <b>break</b>;
                    <b>default</b>:
                        <b>break</b>;
                }

                <span class="r239 r">htmlChildNode</span> = <span class="r239 r">htmlChildNode</span>.<span class="i property">NextSibling</span>;
            }

            <span class="c">// The width of the tr element is the position at which it&#39;s last td element ends, which is calculated in</span>
            <span class="c">// the columnStart value after each td element is processed</span>
            <span class="r241 r">trWidth</span> = <span class="r237 r">columnWidthsAvailable</span> ? <span class="r238 r">columnStart</span> : 0;

            <b>return</b> <span class="r241 r">trWidth</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Gets row span attribute from htmlTDElement. Returns an integer representing the value of the rowspan attribute.</span>
        <span class="c">///</span><span class="c">     Default value if attribute is not specified or if it is invalid is 1</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r245 r">htmlTdElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Html td element to be searched for rowspan attribute</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="d0fdfc4fcb3fe889" href="R/d0fdfc4fcb3fe889.html" target="n" data-glyph="76,1" class="i method">GetRowSpan</a>(<span class="t t">XmlElement</span> <span id="r245 rd" class="r245 r">htmlTdElement</span>)
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r246 rd" class="r246 r">rowSpanAsString</span>;
            <b>int</b> <span id="r247 rd" class="r247 r">rowSpan</span>;

            <span class="r246 r">rowSpanAsString</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r245 r">htmlTdElement</span>, <span class="s">&quot;rowspan&quot;</span>);
            <b>if</b> (<span class="r246 r">rowSpanAsString</span> != <b>null</b>)
            {
                <b>if</b> (!<b>int</b>.<a href="@1@System.Runtime/A.html#325507e509229dbc" class="i method">TryParse</a>(<span class="r246 r">rowSpanAsString</span>, <b>out</b> <span class="r247 r">rowSpan</span>))
                {
                    <span class="c">// Ignore invalid value of rowspan; treat it as 1</span>
                    <span class="r247 r">rowSpan</span> = 1;
                }
            }
            <b>else</b>
            {
                <span class="c">// No row span, default is 1</span>
                <span class="r247 r">rowSpan</span> = 1;
            }
            <b>return</b> <span class="r247 r">rowSpan</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Gets index at which a column should be inseerted into the columnStarts ArrayList. This is</span>
        <span class="c">///</span><span class="c">     decided by the value columnStart. The columnStarts ArrayList is ordered in ascending order.</span>
        <span class="c">///</span><span class="c">     Returns an integer representing the index at which the column should be inserted</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r248 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Array list representing starting coordinates of all columns in the table</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">columnStart</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Starting coordinate of column we wish to insert into columnStart</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r249 r">columnIndex</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Int representing the current column index. This acts as a clue while finding the insertion index.</span>
        <span class="c">///</span><span class="c">     If the value of columnStarts at columnIndex is the same as columnStart, then this position alrady exists</span>
        <span class="c">///</span><span class="c">     in the array and we can jsut return columnIndex.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="5441e093b46b4b20" href="R/5441e093b46b4b20.html" target="n" data-glyph="76,1" class="i method">GetNextColumnIndex</a>(<b>int</b> <span id="r249 rd" class="r249 r">columnIndex</span>, <b>double</b> <span id="r250 rd" class="r250 r">columnWidth</span>, <span class="t t">ArrayList</span> <span id="r248 rd" class="r248 r">columnStarts</span>,
            <span class="t t">ArrayList</span> <span id="r251 rd" class="r251 r">activeRowSpans</span>)
        {
            <b>double</b> <span id="r252 rd" class="r252 r">columnStart</span>;
            <b>int</b> <span id="r253 rd" class="r253 r">spannedColumnIndex</span>;

            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r248 r">columnStarts</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(0 &lt;= <span class="r249 r">columnIndex</span> &amp;&amp; <span class="r249 r">columnIndex</span> &lt;= <span class="r248 r">columnStarts</span>.<span class="i property">Count</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r250 r">columnWidth</span> &gt; 0);

            <span class="r252 r">columnStart</span> = (<b>double</b>) <span class="r248 r">columnStarts</span>[<span class="r249 r">columnIndex</span>];
            <span class="r253 r">spannedColumnIndex</span> = <span class="r249 r">columnIndex</span> + 1;

            <b>while</b> (<span class="r253 r">spannedColumnIndex</span> &lt; <span class="r248 r">columnStarts</span>.<span class="i property">Count</span> &amp;&amp;
                   (<b>double</b>) <span class="r248 r">columnStarts</span>[<span class="r253 r">spannedColumnIndex</span>] &lt; <span class="r252 r">columnStart</span> + <span class="r250 r">columnWidth</span> &amp;&amp; <span class="r253 r">spannedColumnIndex</span> != -1)
            {
                <b>if</b> ((<b>int</b>) <span class="r251 r">activeRowSpans</span>[<span class="r253 r">spannedColumnIndex</span>] &gt; 0)
                {
                    <span class="c">// The current column should span this area, but something else is already spanning it</span>
                    <span class="c">// Not analyzable</span>
                    <span class="r253 r">spannedColumnIndex</span> = -1;
                }
                <b>else</b>
                {
                    <span class="r253 r">spannedColumnIndex</span>++;
                }
            }

            <b>return</b> <span class="r253 r">spannedColumnIndex</span>;
        }


        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Used for clearing activeRowSpans array in the beginning/end of each tbody</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r254 r">activeRowSpans</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList representing currently active row spans</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="82183f421cf4b007" href="R/82183f421cf4b007.html" target="n" data-glyph="76,1" class="i method">ClearActiveRowSpans</a>(<span class="t t">ArrayList</span> <span id="r254 rd" class="r254 r">activeRowSpans</span>)
        {
            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r255 rd" class="r255 r">columnIndex</span> = 0; <span class="r255 r">columnIndex</span> &lt; <span class="r254 r">activeRowSpans</span>.<span class="i property">Count</span>; <span class="r255 r">columnIndex</span>++)
            {
                <span class="r254 r">activeRowSpans</span>[<span class="r255 r">columnIndex</span>] = 0;
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Used for initializing activeRowSpans array in the before adding rows to tbody element</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r256 r">activeRowSpans</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList representing currently active row spans</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r257 r">count</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Size to be give to array list</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="203cde719901588a" href="R/203cde719901588a.html" target="n" data-glyph="76,1" class="i method">InitializeActiveRowSpans</a>(<span class="t t">ArrayList</span> <span id="r256 rd" class="r256 r">activeRowSpans</span>, <b>int</b> <span id="r257 rd" class="r257 r">count</span>)
        {
            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r258 rd" class="r258 r">columnIndex</span> = 0; <span class="r258 r">columnIndex</span> &lt; <span class="r257 r">count</span>; <span class="r258 r">columnIndex</span>++)
            {
                <span class="r256 r">activeRowSpans</span>.<span class="i method">Add</span>(0);
            }
        }


        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Calculates width of next TD element based on starting position of current element and it&#39;s width, which</span>
        <span class="c">///</span><span class="c">     is calculated byt he function</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r259 r">htmlTdElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Html td element whose width is to be read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">columnStart</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Starting position of current column</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static double</b> <a id="a8f04026e5a3acce" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetNextColumnStart</a>(<span class="t t">XmlElement</span> <span id="r259 rd" class="r259 r">htmlTdElement</span>, <b>double</b> <span id="r260 rd" class="r260 r">columnStart</span>)
        {
            <b>double</b> <span id="r261 rd" class="r261 r">columnWidth</span>;
            <b>double</b> <span id="r262 rd" class="r262 r">nextColumnStart</span>;

            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r259 r">htmlTdElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;td&quot;</span> || <span class="r259 r">htmlTdElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;th&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r260 r">columnStart</span> &gt;= 0);

            <span class="r262 r">nextColumnStart</span> = -1; <span class="c">// -1 indicates inability to calculate columnStart width</span>

            <span class="r261 r">columnWidth</span> = <a href="#74ea0c47b224ad44" class="i method">GetColumnWidth</a>(<span class="r259 r">htmlTdElement</span>);

            <b>if</b> (<span class="r261 r">columnWidth</span> == -1)
            {
                <span class="r262 r">nextColumnStart</span> = -1;
            }
            <b>else</b>
            {
                <span class="r262 r">nextColumnStart</span> = <span class="r260 r">columnStart</span> + <span class="r261 r">columnWidth</span>;
            }

            <b>return</b> <span class="r262 r">nextColumnStart</span>;
        }


        <b>private static double</b> <a id="74ea0c47b224ad44" href="R/74ea0c47b224ad44.html" target="n" data-glyph="76,1" class="i method">GetColumnWidth</a>(<span class="t t">XmlElement</span> <span id="r263 rd" class="r263 r">htmlTdElement</span>)
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r264 rd" class="r264 r">columnWidthAsString</span>;
            <b>double</b> <span id="r265 rd" class="r265 r">columnWidth</span>;

            <span class="r264 r">columnWidthAsString</span> = <b>null</b>;
            <span class="r265 r">columnWidth</span> = -1;

            <span class="c">// Get string valkue for the width</span>
            <span class="r264 r">columnWidthAsString</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r263 r">htmlTdElement</span>, <span class="s">&quot;width&quot;</span>) ??
                                  <a href="#8fe9411bfb7b22f4" class="i method">GetCssAttribute</a>(<a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r263 r">htmlTdElement</span>, <span class="s">&quot;style&quot;</span>), <span class="s">&quot;width&quot;</span>);

            <span class="c">// We do not allow column width to be 0, if specified as 0 we will fail to record it</span>
            <b>if</b> (!<a href="#8de5c16bc3b39ad4" class="i method">TryGetLengthValue</a>(<span class="r264 r">columnWidthAsString</span>, <b>out</b> <span class="r265 r">columnWidth</span>) || <span class="r265 r">columnWidth</span> == 0)
            {
                <span class="r265 r">columnWidth</span> = -1;
            }
            <b>return</b> <span class="r265 r">columnWidth</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Calculates column span based the column width and the widths of all other columns. Returns an integer representing</span>
        <span class="c">///</span><span class="c">     the column span</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r266 r">columnIndex</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Index of the current column</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r267 r">columnWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Width of the current column</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r268 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList repsenting starting coordinates of all columns</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="52d0b9daa7b2289c" href="R/52d0b9daa7b2289c.html" target="n" data-glyph="76,1" class="i method">CalculateColumnSpan</a>(<b>int</b> <span id="r266 rd" class="r266 r">columnIndex</span>, <b>double</b> <span id="r267 rd" class="r267 r">columnWidth</span>, <span class="t t">ArrayList</span> <span id="r268 rd" class="r268 r">columnStarts</span>)
        {
            <span class="c">// Current status of column width. Indicates the amount of width that has been scanned already</span>
            <b>double</b> <span id="r269 rd" class="r269 r">columnSpanningValue</span>;
            <b>int</b> <span id="r270 rd" class="r270 r">columnSpanningIndex</span>;
            <b>int</b> <span id="r271 rd" class="r271 r">columnSpan</span>;
            <b>double</b> <span id="r272 rd" class="r272 r">subColumnWidth</span>; <span class="c">// Width of the smallest-grain columns in the table</span>

            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r268 r">columnStarts</span> != <b>null</b>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r266 r">columnIndex</span> &lt; <span class="r268 r">columnStarts</span>.<span class="i property">Count</span> - 1);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>((<b>double</b>) <span class="r268 r">columnStarts</span>[<span class="r266 r">columnIndex</span>] &gt;= 0);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r267 r">columnWidth</span> &gt; 0);

            <span class="r270 r">columnSpanningIndex</span> = <span class="r266 r">columnIndex</span>;
            <span class="r269 r">columnSpanningValue</span> = 0;
            <span class="r271 r">columnSpan</span> = 0;
            <span class="r272 r">subColumnWidth</span> = 0;

            <b>while</b> (<span class="r269 r">columnSpanningValue</span> &lt; <span class="r267 r">columnWidth</span> &amp;&amp; <span class="r270 r">columnSpanningIndex</span> &lt; <span class="r268 r">columnStarts</span>.<span class="i property">Count</span> - 1)
            {
                <span class="r272 r">subColumnWidth</span> = (<b>double</b>) <span class="r268 r">columnStarts</span>[<span class="r270 r">columnSpanningIndex</span> + 1] -
                                 (<b>double</b>) <span class="r268 r">columnStarts</span>[<span class="r270 r">columnSpanningIndex</span>];
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r272 r">subColumnWidth</span> &gt; 0);
                <span class="r269 r">columnSpanningValue</span> += <span class="r272 r">subColumnWidth</span>;
                <span class="r270 r">columnSpanningIndex</span>++;
            }

            <span class="c">// Now, we have either covered the width we needed to cover or reached the end of the table, in which</span>
            <span class="c">// case the column spans all the columns until the end</span>
            <span class="r271 r">columnSpan</span> = <span class="r270 r">columnSpanningIndex</span> - <span class="r266 r">columnIndex</span>;
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r271 r">columnSpan</span> &gt; 0);

            <b>return</b> <span class="r271 r">columnSpan</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Verifies that values in columnStart, which represent starting coordinates of all columns, are arranged</span>
        <span class="c">///</span><span class="c">     in ascending order</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r273 r">columnStarts</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     ArrayList representing starting coordinates of all columns</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="39fdd33961652498" href="R/39fdd33961652498.html" target="n" data-glyph="76,1" class="i method">VerifyColumnStartsAscendingOrder</a>(<span class="t t">ArrayList</span> <span id="r273 rd" class="r273 r">columnStarts</span>)
        {
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r273 r">columnStarts</span> != <b>null</b>);

            <b>double</b> <span id="r274 rd" class="r274 r">columnStart</span>;

            <span class="r274 r">columnStart</span> = -0.01;

            <b>foreach</b> (<b>object</b> <span id="r275 rd" class="r275 r">t</span> <b>in</b> <span class="r273 r">columnStarts</span>)
            {
                <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r274 r">columnStart</span> &lt; (<b>double</b>) <span class="r275 r">t</span>);
                <span class="r274 r">columnStart</span> = (<b>double</b>) <span class="r275 r">t</span>;
            }
        }

        <span class="c">// .............................................................</span>
        <span class="c">//</span>
        <span class="c">// Attributes and Properties</span>
        <span class="c">//</span>
        <span class="c">// .............................................................</span>

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Analyzes local properties of Html element, converts them into Xaml equivalents, and applies them to xamlElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r276 r">xamlElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml element to which properties are to be applied</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r277 r">localProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Hashtable representing local properties of Html element that is converted into xamlElement</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="ef2c926ede15198c" href="R/ef2c926ede15198c.html" target="n" data-glyph="76,1" class="i method">ApplyLocalProperties</a>(<span class="t t">XmlElement</span> <span id="r276 rd" class="r276 r">xamlElement</span>, <span class="t t">Hashtable</span> <span id="r277 rd" class="r277 r">localProperties</span>, <b>bool</b> <span id="r278 rd" class="r278 r">isBlock</span>)
        {
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r279 rd" class="r279 r">marginSet</span> = <b>false</b>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r280 rd" class="r280 r">marginTop</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r281 rd" class="r281 r">marginBottom</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r282 rd" class="r282 r">marginLeft</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r283 rd" class="r283 r">marginRight</span> = <span class="s">&quot;0&quot;</span>;

            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r284 rd" class="r284 r">paddingSet</span> = <b>false</b>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r285 rd" class="r285 r">paddingTop</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r286 rd" class="r286 r">paddingBottom</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r287 rd" class="r287 r">paddingLeft</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r288 rd" class="r288 r">paddingRight</span> = <span class="s">&quot;0&quot;</span>;

            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r289 rd" class="r289 r">borderColor</span> = <b>null</b>;

            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r290 rd" class="r290 r">borderThicknessSet</span> = <b>false</b>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r291 rd" class="r291 r">borderThicknessTop</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r292 rd" class="r292 r">borderThicknessBottom</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r293 rd" class="r293 r">borderThicknessLeft</span> = <span class="s">&quot;0&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r294 rd" class="r294 r">borderThicknessRight</span> = <span class="s">&quot;0&quot;</span>;

            <a href="@1@System.Runtime/A.html#027d3303c68ed300" class="k">var</a> <span id="r295 rd" class="r295 r">propertyEnumerator</span> = <span class="r277 r">localProperties</span>.<span class="i method">GetEnumerator</span>();
            <b>while</b> (<span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#116c28c0f6355e3f" class="i method">MoveNext</a>())
            {
                <b>switch</b> ((<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#42cf145725084ef0" class="i property">Key</a>)
                {
                    <b>case</b> <span class="s">&quot;font-family&quot;</span>:
                        <span class="c">//  Convert from font-family value list into xaml FontFamily value</span>
                        <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#231a77e1e5d11e6c" class="i field">XamlFontFamily</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;font-style&quot;</span>:
                        <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#0f0eb79c0bc53a5d" class="i field">XamlFontStyle</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;font-variant&quot;</span>:
                        <span class="c">//  Convert from font-variant into xaml property</span>
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;font-weight&quot;</span>:
                        <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#a464525191aa2987" class="i field">XamlFontWeight</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;font-size&quot;</span>:
                        <span class="c">//  Convert from css size into FontSize</span>
                        <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#5a4594aa67910492" class="i field">XamlFontSize</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;color&quot;</span>:
                        <a href="#14f0fcaa1365077f" class="i method">SetPropertyValue</a>(<span class="r276 r">xamlElement</span>, <a href="@0@PresentationFramework/A.html#e28640b48d79de57" class="t t">TextElement</a>.<a href="@0@PresentationFramework/A.html#e76b7a3f2b462339" class="i field">ForegroundProperty</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;background-color&quot;</span>:
                        <a href="#14f0fcaa1365077f" class="i method">SetPropertyValue</a>(<span class="r276 r">xamlElement</span>, <a href="@0@PresentationFramework/A.html#e28640b48d79de57" class="t t">TextElement</a>.<a href="@0@PresentationFramework/A.html#49594ce77d97fbd7" class="i field">BackgroundProperty</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;text-decoration-underline&quot;</span>:
                        <b>if</b> (!<span class="r278 r">isBlock</span>)
                        {
                            <b>if</b> ((<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a> == <span class="s">&quot;true&quot;</span>)
                            {
                                <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#a1936a27bf5eaeec" class="i field">XamlTextDecorations</a>, <a href="#ebf557ae47891b92" class="i field">XamlTextDecorationsUnderline</a>);
                            }
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;text-decoration-none&quot;</span>:
                    <b>case</b> <span class="s">&quot;text-decoration-overline&quot;</span>:
                    <b>case</b> <span class="s">&quot;text-decoration-line-through&quot;</span>:
                    <b>case</b> <span class="s">&quot;text-decoration-blink&quot;</span>:
                        <span class="c">//  Convert from all other text-decorations values</span>
                        <b>if</b> (!<span class="r278 r">isBlock</span>)
                        {
                        }
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;text-transform&quot;</span>:
                        <span class="c">//  Convert from text-transform into xaml property</span>
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;text-indent&quot;</span>:
                        <b>if</b> (<span class="r278 r">isBlock</span>)
                        {
                            <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#83f0ccbbca11bdb2" class="i field">XamlTextIndent</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        }
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;text-align&quot;</span>:
                        <b>if</b> (<span class="r278 r">isBlock</span>)
                        {
                            <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#952566b9739cc5f6" class="i field">XamlTextAlignment</a>, (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>);
                        }
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;width&quot;</span>:
                    <b>case</b> <span class="s">&quot;height&quot;</span>:
                        <span class="c">//  Decide what to do with width and height propeties</span>
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;margin-top&quot;</span>:
                        <span class="r279 r">marginSet</span> = <b>true</b>;
                        <span class="r280 r">marginTop</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;margin-right&quot;</span>:
                        <span class="r279 r">marginSet</span> = <b>true</b>;
                        <span class="r283 r">marginRight</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;margin-bottom&quot;</span>:
                        <span class="r279 r">marginSet</span> = <b>true</b>;
                        <span class="r281 r">marginBottom</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;margin-left&quot;</span>:
                        <span class="r279 r">marginSet</span> = <b>true</b>;
                        <span class="r282 r">marginLeft</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;padding-top&quot;</span>:
                        <span class="r284 r">paddingSet</span> = <b>true</b>;
                        <span class="r285 r">paddingTop</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;padding-right&quot;</span>:
                        <span class="r284 r">paddingSet</span> = <b>true</b>;
                        <span class="r288 r">paddingRight</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;padding-bottom&quot;</span>:
                        <span class="r284 r">paddingSet</span> = <b>true</b>;
                        <span class="r286 r">paddingBottom</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;padding-left&quot;</span>:
                        <span class="r284 r">paddingSet</span> = <b>true</b>;
                        <span class="r287 r">paddingLeft</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;

                    <span class="c">// NOTE: css names for elementary border styles have side indications in the middle (top/bottom/left/right)</span>
                    <span class="c">// In our internal notation we intentionally put them at the end - to unify processing in ParseCssRectangleProperty method</span>
                    <b>case</b> <span class="s">&quot;border-color-top&quot;</span>:
                        <span class="r289 r">borderColor</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-color-right&quot;</span>:
                        <span class="r289 r">borderColor</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-color-bottom&quot;</span>:
                        <span class="r289 r">borderColor</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-color-left&quot;</span>:
                        <span class="r289 r">borderColor</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-style-top&quot;</span>:
                    <b>case</b> <span class="s">&quot;border-style-right&quot;</span>:
                    <b>case</b> <span class="s">&quot;border-style-bottom&quot;</span>:
                    <b>case</b> <span class="s">&quot;border-style-left&quot;</span>:
                        <span class="c">//  Implement conversion from border style</span>
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-width-top&quot;</span>:
                        <span class="r290 r">borderThicknessSet</span> = <b>true</b>;
                        <span class="r291 r">borderThicknessTop</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-width-right&quot;</span>:
                        <span class="r290 r">borderThicknessSet</span> = <b>true</b>;
                        <span class="r294 r">borderThicknessRight</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-width-bottom&quot;</span>:
                        <span class="r290 r">borderThicknessSet</span> = <b>true</b>;
                        <span class="r292 r">borderThicknessBottom</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;
                    <b>case</b> <span class="s">&quot;border-width-left&quot;</span>:
                        <span class="r290 r">borderThicknessSet</span> = <b>true</b>;
                        <span class="r293 r">borderThicknessLeft</span> = (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;list-style-type&quot;</span>:
                        <b>if</b> (<span class="r276 r">xamlElement</span>.<span class="i property">LocalName</span> == <a href="#3632e9f713eb2c4c" class="i field">XamlList</a>)
                        {
                            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r296 rd" class="r296 r">markerStyle</span>;
                            <b>switch</b> (((<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>) <span class="r295 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>).<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>())
                            {
                                <b>case</b> <span class="s">&quot;disc&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#e25282d203a5adf1" class="i field">XamlListMarkerStyleDisc</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;circle&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#c5b2a6df070c92ad" class="i field">XamlListMarkerStyleCircle</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;none&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#64ebbf50dbe47391" class="i field">XamlListMarkerStyleNone</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;square&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#f140f82cb5890d71" class="i field">XamlListMarkerStyleSquare</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;box&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#18686ec206261b91" class="i field">XamlListMarkerStyleBox</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;lower-latin&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#3c272f5cc63f5624" class="i field">XamlListMarkerStyleLowerLatin</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;upper-latin&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#fe7b60011564df3f" class="i field">XamlListMarkerStyleUpperLatin</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;lower-roman&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#d87a7989882ba4c8" class="i field">XamlListMarkerStyleLowerRoman</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;upper-roman&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#244013f91ab96161" class="i field">XamlListMarkerStyleUpperRoman</a>;
                                    <b>break</b>;
                                <b>case</b> <span class="s">&quot;decimal&quot;</span>:
                                    <span class="r296 r">markerStyle</span> = <a href="#23fb19148294c867" class="i field">XamlListMarkerStyleDecimal</a>;
                                    <b>break</b>;
                                <b>default</b>:
                                    <span class="r296 r">markerStyle</span> = <a href="#e25282d203a5adf1" class="i field">XamlListMarkerStyleDisc</a>;
                                    <b>break</b>;
                            }
                            <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#86482d026a420505" class="i field">XamlListMarkerStyle</a>, <span class="r296 r">markerStyle</span>);
                        }
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;float&quot;</span>:
                    <b>case</b> <span class="s">&quot;clear&quot;</span>:
                        <b>if</b> (<span class="r278 r">isBlock</span>)
                        {
                            <span class="c">//  Convert float and clear properties</span>
                        }
                        <b>break</b>;

                    <b>case</b> <span class="s">&quot;display&quot;</span>:
                        <b>break</b>;
                }
            }

            <b>if</b> (<span class="r278 r">isBlock</span>)
            {
                <b>if</b> (<span class="r279 r">marginSet</span>)
                {
                    <a href="#762c47235192f5c9" class="i method">ComposeThicknessProperty</a>(<span class="r276 r">xamlElement</span>, <a href="#5d27a30185e27472" class="i field">XamlMargin</a>, <span class="r282 r">marginLeft</span>, <span class="r283 r">marginRight</span>, <span class="r280 r">marginTop</span>, <span class="r281 r">marginBottom</span>);
                }

                <b>if</b> (<span class="r284 r">paddingSet</span>)
                {
                    <a href="#762c47235192f5c9" class="i method">ComposeThicknessProperty</a>(<span class="r276 r">xamlElement</span>, <a href="#f5532f3489f10745" class="i field">XamlPadding</a>, <span class="r287 r">paddingLeft</span>, <span class="r288 r">paddingRight</span>, <span class="r285 r">paddingTop</span>,
                        <span class="r286 r">paddingBottom</span>);
                }

                <b>if</b> (<span class="r289 r">borderColor</span> != <b>null</b>)
                {
                    <span class="c">//  We currently ignore possible difference in brush colors on different border sides. Use the last colored side mentioned</span>
                    <span class="r276 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<a href="#bd000b0488172883" class="i field">XamlBorderBrush</a>, <span class="r289 r">borderColor</span>);
                }

                <b>if</b> (<span class="r290 r">borderThicknessSet</span>)
                {
                    <a href="#762c47235192f5c9" class="i method">ComposeThicknessProperty</a>(<span class="r276 r">xamlElement</span>, <a href="#cf294307a05c23d5" class="i field">XamlBorderThickness</a>, <span class="r293 r">borderThicknessLeft</span>,
                        <span class="r294 r">borderThicknessRight</span>,
                        <span class="r291 r">borderThicknessTop</span>, <span class="r292 r">borderThicknessBottom</span>);
                }
            }
        }

        <span class="c">// Create syntactically optimized four-value Thickness</span>
        <b>private static void</b> <a id="762c47235192f5c9" href="R/762c47235192f5c9.html" target="n" data-glyph="76,1" class="i method">ComposeThicknessProperty</a>(<span class="t t">XmlElement</span> <span id="r297 rd" class="r297 r">xamlElement</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r298 rd" class="r298 r">propertyName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r299 rd" class="r299 r">left</span>,
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r300 rd" class="r300 r">right</span>,
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r301 rd" class="r301 r">top</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r302 rd" class="r302 r">bottom</span>)
        {
            <span class="c">// Xaml syntax:</span>
            <span class="c">// We have a reasonable interpreation for one value (all four edges), two values (horizontal, vertical),</span>
            <span class="c">// and four values (left, top, right, bottom).</span>
            <span class="c">//  switch (i) {</span>
            <span class="c">//    case 1: return new Thickness(lengths[0]);</span>
            <span class="c">//    case 2: return new Thickness(lengths[0], lengths[1], lengths[0], lengths[1]);</span>
            <span class="c">//    case 4: return new Thickness(lengths[0], lengths[1], lengths[2], lengths[3]);</span>
            <span class="c">//  }</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r303 rd" class="r303 r">thickness</span>;

            <span class="c">// We do not accept negative margins</span>
            <b>if</b> (<span class="r299 r">left</span>[0] == <span class="s">&#39;0&#39;</span> || <span class="r299 r">left</span>[0] == <span class="s">&#39;-&#39;</span>) <span class="r299 r">left</span> = <span class="s">&quot;0&quot;</span>;
            <b>if</b> (<span class="r300 r">right</span>[0] == <span class="s">&#39;0&#39;</span> || <span class="r300 r">right</span>[0] == <span class="s">&#39;-&#39;</span>) <span class="r300 r">right</span> = <span class="s">&quot;0&quot;</span>;
            <b>if</b> (<span class="r301 r">top</span>[0] == <span class="s">&#39;0&#39;</span> || <span class="r301 r">top</span>[0] == <span class="s">&#39;-&#39;</span>) <span class="r301 r">top</span> = <span class="s">&quot;0&quot;</span>;
            <b>if</b> (<span class="r302 r">bottom</span>[0] == <span class="s">&#39;0&#39;</span> || <span class="r302 r">bottom</span>[0] == <span class="s">&#39;-&#39;</span>) <span class="r302 r">bottom</span> = <span class="s">&quot;0&quot;</span>;

            <b>if</b> (<span class="r299 r">left</span> == <span class="r300 r">right</span> &amp;&amp; <span class="r301 r">top</span> == <span class="r302 r">bottom</span>)
            {
                <b>if</b> (<span class="r299 r">left</span> == <span class="r301 r">top</span>)
                {
                    <span class="r303 r">thickness</span> = <span class="r299 r">left</span>;
                }
                <b>else</b>
                {
                    <span class="r303 r">thickness</span> = <span class="r299 r">left</span> + <span class="s">&quot;,&quot;</span> + <span class="r301 r">top</span>;
                }
            }
            <b>else</b>
            {
                <span class="r303 r">thickness</span> = <span class="r299 r">left</span> + <span class="s">&quot;,&quot;</span> + <span class="r301 r">top</span> + <span class="s">&quot;,&quot;</span> + <span class="r300 r">right</span> + <span class="s">&quot;,&quot;</span> + <span class="r302 r">bottom</span>;
            }

            <span class="c">//  Need safer processing for a thickness value</span>
            <span class="r297 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<span class="r298 r">propertyName</span>, <span class="r303 r">thickness</span>);
        }

        <b>private static void</b> <a id="14f0fcaa1365077f" href="R/14f0fcaa1365077f.html" target="n" data-glyph="76,1" class="i method">SetPropertyValue</a>(<span class="t t">XmlElement</span> <span id="r304 rd" class="r304 r">xamlElement</span>, <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <span id="r305 rd" class="r305 r">property</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r306 rd" class="r306 r">stringValue</span>)
        {
            <b>var</b> <span id="r307 rd" class="r307 r">typeConverter</span> =
                <span class="t t">TypeDescriptor</span>.<span class="i method">GetConverter</span>(<span class="r305 r">property</span>.<a href="@0@WindowsBase/A.html#125f2e84d643c020" class="i property">PropertyType</a>);
            <b>try</b>
            {
                <a href="@1@System.Runtime/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r308 rd" class="r308 r">convertedValue</span> = <span class="r307 r">typeConverter</span>.<span class="i method">ConvertFromInvariantString</span>(<span class="r306 r">stringValue</span>);
                <b>if</b> (<span class="r308 r">convertedValue</span> != <b>null</b>)
                {
                    <span class="r304 r">xamlElement</span>.<span class="i method">SetAttribute</span>(<span class="r305 r">property</span>.<a href="@0@WindowsBase/A.html#06e1fecd901f2569" class="i property">Name</a>, <span class="r306 r">stringValue</span>);
                }
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a>)
            {
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Analyzes the tag of the htmlElement and infers its associated formatted properties.</span>
        <span class="c">///</span><span class="c">     After that parses style attribute and adds all inline css styles.</span>
        <span class="c">///</span><span class="c">     The resulting style attributes are collected in output parameter localProperties.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r309 r">htmlElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r310 r">inheritedProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     set of properties inherited from ancestor elements. Currently not used in the code. Reserved for the future</span>
        <span class="c">///</span><span class="c">     development.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r311 r">localProperties</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     returns all formatting properties defined by this element - implied by its tag, its attributes, or its css inline</span>
        <span class="c">///</span><span class="c">     style</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r312 r">stylesheet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r313 r">sourceContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     returns a combination of previous context with local set of properties.</span>
        <span class="c">///</span><span class="c">     This value is not used in the current code - inntended for the future development.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="t t">Hashtable</span> <a id="f8b14540dce6a2c7" href="R/f8b14540dce6a2c7.html" target="n" data-glyph="76,1" class="i method">GetElementProperties</a>(<span class="t t">XmlElement</span> <span id="r309 rd" class="r309 r">htmlElement</span>, <span class="t t">Hashtable</span> <span id="r310 rd" class="r310 r">inheritedProperties</span>,
            <b>out</b> <span class="t t">Hashtable</span> <span id="r311 rd" class="r311 r">localProperties</span>, <a href="CssStylesheet.cs.html#1b57443e12b375e7" class="t t">CssStylesheet</a> <span id="r312 rd" class="r312 r">stylesheet</span>, <span class="t t">List</span>&lt;<span class="t t">XmlElement</span>&gt; <span id="r313 rd" class="r313 r">sourceContext</span>)
        {
            <span class="c">// Start with context formatting properties</span>
            <b>var</b> <span id="r314 rd" class="r314 r">currentProperties</span> = <b>new</b> <span class="t constructor">Hashtable</span>();
            <a href="@1@System.Runtime/A.html#027d3303c68ed300" class="k">var</a> <span id="r315 rd" class="r315 r">propertyEnumerator</span> = <span class="r310 r">inheritedProperties</span>.<span class="i method">GetEnumerator</span>();
            <b>while</b> (<span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#116c28c0f6355e3f" class="i method">MoveNext</a>())
            {
                <span class="r314 r">currentProperties</span>[<span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#42cf145725084ef0" class="i property">Key</a>] = <span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
            }

            <span class="c">// Identify element name</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r316 rd" class="r316 r">elementName</span> = <span class="r309 r">htmlElement</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r317 rd" class="r317 r">elementNamespace</span> = <span class="r309 r">htmlElement</span>.<span class="i property">NamespaceURI</span>;

            <span class="c">// update current formatting properties depending on element tag</span>

            <span class="r311 r">localProperties</span> = <b>new</b> <span class="t constructor">Hashtable</span>();
            <b>switch</b> (<span class="r316 r">elementName</span>)
            {
                <span class="c">// Character formatting</span>
                <b>case</b> <span class="s">&quot;i&quot;</span>:
                <b>case</b> <span class="s">&quot;italic&quot;</span>:
                <b>case</b> <span class="s">&quot;em&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-style&quot;</span>] = <span class="s">&quot;italic&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;b&quot;</span>:
                <b>case</b> <span class="s">&quot;bold&quot;</span>:
                <b>case</b> <span class="s">&quot;strong&quot;</span>:
                <b>case</b> <span class="s">&quot;dfn&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-weight&quot;</span>] = <span class="s">&quot;bold&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;u&quot;</span>:
                <b>case</b> <span class="s">&quot;underline&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;text-decoration-underline&quot;</span>] = <span class="s">&quot;true&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;font&quot;</span>:
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r318 rd" class="r318 r">attributeValue</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r309 r">htmlElement</span>, <span class="s">&quot;face&quot;</span>);
                    <b>if</b> (<span class="r318 r">attributeValue</span> != <b>null</b>)
                    {
                        <span class="r311 r">localProperties</span>[<span class="s">&quot;font-family&quot;</span>] = <span class="r318 r">attributeValue</span>;
                    }
                    <span class="r318 r">attributeValue</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r309 r">htmlElement</span>, <span class="s">&quot;size&quot;</span>);
                    <b>if</b> (<span class="r318 r">attributeValue</span> != <b>null</b>)
                    {
                        <a href="@1@System.Runtime/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r319 rd" class="r319 r">fontSize</span> = <b>double</b>.<a href="@1@System.Runtime/A.html#cfd0570a5fce9b48" class="i method">Parse</a>(<span class="r318 r">attributeValue</span>)*(12.0/3.0);
                        <b>if</b> (<span class="r319 r">fontSize</span> &lt; 1.0)
                        {
                            <span class="r319 r">fontSize</span> = 1.0;
                        }
                        <b>else</b> <b>if</b> (<span class="r319 r">fontSize</span> &gt; 1000.0)
                        {
                            <span class="r319 r">fontSize</span> = 1000.0;
                        }
                        <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <span class="r319 r">fontSize</span>.<a href="@1@System.Runtime/A.html#102b12e1c4385406" class="i method">ToString</a>(<a href="@1@System.Runtime/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@System.Runtime/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>);
                    }
                    <span class="r318 r">attributeValue</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r309 r">htmlElement</span>, <span class="s">&quot;color&quot;</span>);
                    <b>if</b> (<span class="r318 r">attributeValue</span> != <b>null</b>)
                    {
                        <span class="r311 r">localProperties</span>[<span class="s">&quot;color&quot;</span>] = <span class="r318 r">attributeValue</span>;
                    }
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;samp&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-family&quot;</span>] = <span class="s">&quot;Courier New&quot;</span>; <span class="c">// code sample</span>
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#61011c17d978d181" class="i field">XamlFontSizeXxSmall</a>;
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;text-align&quot;</span>] = <span class="s">&quot;Left&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;sub&quot;</span>:
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;sup&quot;</span>:
                    <b>break</b>;

                <span class="c">// Hyperlinks</span>
                <b>case</b> <span class="s">&quot;a&quot;</span>: <span class="c">// href, hreflang, urn, methods, rel, rev, title</span>
                    <span class="c">//  Set default hyperlink properties</span>
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;acronym&quot;</span>:
                    <b>break</b>;

                <span class="c">// Paragraph formatting:</span>
                <b>case</b> <span class="s">&quot;p&quot;</span>:
                    <span class="c">//  Set default paragraph properties</span>
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;div&quot;</span>:
                    <span class="c">//  Set default div properties</span>
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;pre&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-family&quot;</span>] = <span class="s">&quot;Courier New&quot;</span>; <span class="c">// renders text in a fixed-width font</span>
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#61011c17d978d181" class="i field">XamlFontSizeXxSmall</a>;
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;text-align&quot;</span>] = <span class="s">&quot;Left&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;blockquote&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;margin-left&quot;</span>] = <span class="s">&quot;16&quot;</span>;
                    <b>break</b>;

                <b>case</b> <span class="s">&quot;h1&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#e1d3c3803fda3d0c" class="i field">XamlFontSizeXxLarge</a>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;h2&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#9ebf95e395e8b545" class="i field">XamlFontSizeXLarge</a>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;h3&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#961cc0caf394e50f" class="i field">XamlFontSizeLarge</a>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;h4&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#2ba3437774c22f2c" class="i field">XamlFontSizeMedium</a>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;h5&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#eed6b23e89941ed8" class="i field">XamlFontSizeSmall</a>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;h6&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;font-size&quot;</span>] = <a href="#6d8cedd8262e9b28" class="i field">XamlFontSizeXSmall</a>;
                    <b>break</b>;
                <span class="c">// List properties</span>
                <b>case</b> <span class="s">&quot;ul&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;list-style-type&quot;</span>] = <span class="s">&quot;disc&quot;</span>;
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;ol&quot;</span>:
                    <span class="r311 r">localProperties</span>[<span class="s">&quot;list-style-type&quot;</span>] = <span class="s">&quot;decimal&quot;</span>;
                    <b>break</b>;

                <b>case</b> <span class="s">&quot;table&quot;</span>:
                <b>case</b> <span class="s">&quot;body&quot;</span>:
                <b>case</b> <span class="s">&quot;html&quot;</span>:
                    <b>break</b>;
            }

            <span class="c">// Override html defaults by css attributes - from stylesheets and inline settings</span>
            <a href="HtmlCSSParser.cs.html#cb2345eee090584a" class="t t">HtmlCssParser</a>.<a href="HtmlCSSParser.cs.html#579bda81512cb031" class="i method">GetElementPropertiesFromCssAttributes</a>(<span class="r309 r">htmlElement</span>, <span class="r316 r">elementName</span>, <span class="r312 r">stylesheet</span>, <span class="r311 r">localProperties</span>,
                <span class="r313 r">sourceContext</span>);

            <span class="c">// Combine local properties with context to create new current properties</span>
            <span class="r315 r">propertyEnumerator</span> = <span class="r311 r">localProperties</span>.<span class="i method">GetEnumerator</span>();
            <b>while</b> (<span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#116c28c0f6355e3f" class="i method">MoveNext</a>())
            {
                <span class="r314 r">currentProperties</span>[<span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#42cf145725084ef0" class="i property">Key</a>] = <span class="r315 r">propertyEnumerator</span>.<a href="@1@System.Runtime/A.html#10c920dd02dfab19" class="i property">Value</a>;
            }

            <b>return</b> <span class="r314 r">currentProperties</span>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Extracts a value of css attribute from css style definition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r320 r">cssStyle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Source csll style definition</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r321 r">attributeName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     A name of css attribute to extract</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     A string rrepresentation of an attribute value if found;</span>
        <span class="c">///</span><span class="c">     null if there is no such attribute in a given string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="8fe9411bfb7b22f4" href="R/8fe9411bfb7b22f4.html" target="n" data-glyph="76,1" class="i method">GetCssAttribute</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r320 rd" class="r320 r">cssStyle</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r321 rd" class="r321 r">attributeName</span>)
        {
            <span class="c">//  This is poor man&#39;s attribute parsing. Replace it by real css parsing</span>
            <b>if</b> (<span class="r320 r">cssStyle</span> != <b>null</b>)
            {
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r322 rd" class="r322 r">styleValues</span>;

                <span class="r321 r">attributeName</span> = <span class="r321 r">attributeName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

                <span class="c">// Check for width specification in style string</span>
                <span class="r322 r">styleValues</span> = <span class="r320 r">cssStyle</span>.<a href="@1@System.Runtime/A.html#b06c6275ef677846" class="i method">Split</a>(<span class="s">&#39;;&#39;</span>);

                <b>foreach</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r323 rd" class="r323 r">t</span> <b>in</b> <span class="r322 r">styleValues</span>)
                {
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r324 rd" class="r324 r">styleNameValue</span>;

                    <span class="r324 r">styleNameValue</span> = <span class="r323 r">t</span>.<a href="@1@System.Runtime/A.html#b06c6275ef677846" class="i method">Split</a>(<span class="s">&#39;:&#39;</span>);
                    <b>if</b> (<span class="r324 r">styleNameValue</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a> == 2)
                    {
                        <b>if</b> (<span class="r324 r">styleNameValue</span>[0].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>().<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="r321 r">attributeName</span>)
                        {
                            <b>return</b> <span class="r324 r">styleNameValue</span>[1].<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>();
                        }
                    }
                }
            }

            <b>return</b> <b>null</b>;
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Converts a length value from string representation to a double.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r325 r">lengthAsString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Source string value of a length.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r326 r">length</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="8de5c16bc3b39ad4" href="R/8de5c16bc3b39ad4.html" target="n" data-glyph="76,1" class="i method">TryGetLengthValue</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r325 rd" class="r325 r">lengthAsString</span>, <b>out double</b> <span id="r326 rd" class="r326 r">length</span>)
        {
            <span class="r326 r">length</span> = <b>double</b>.<a href="@1@System.Runtime/A.html#dcd7a869fad1e6bb" class="i field">NaN</a>;

            <b>if</b> (<span class="r325 r">lengthAsString</span> != <b>null</b>)
            {
                <span class="r325 r">lengthAsString</span> = <span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#06a5f7c688e69307" class="i method">Trim</a>().<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();

                <span class="c">// We try to convert currentColumnWidthAsString into a double. This will eliminate widths of type &quot;50%&quot;, etc.</span>
                <b>if</b> (<span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;pt&quot;</span>))
                {
                    <span class="r325 r">lengthAsString</span> = <span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> - 2);
                    <b>if</b> (<b>double</b>.<a href="@1@System.Runtime/A.html#4ac3250276256193" class="i method">TryParse</a>(<span class="r325 r">lengthAsString</span>, <b>out</b> <span class="r326 r">length</span>))
                    {
                        <span class="r326 r">length</span> = (<span class="r326 r">length</span>*96.0)/72.0; <span class="c">// convert from points to pixels</span>
                    }
                    <b>else</b>
                    {
                        <span class="r326 r">length</span> = <b>double</b>.<a href="@1@System.Runtime/A.html#dcd7a869fad1e6bb" class="i field">NaN</a>;
                    }
                }
                <b>else</b> <b>if</b> (<span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;px&quot;</span>))
                {
                    <span class="r325 r">lengthAsString</span> = <span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r325 r">lengthAsString</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> - 2);
                    <b>if</b> (!<b>double</b>.<a href="@1@System.Runtime/A.html#4ac3250276256193" class="i method">TryParse</a>(<span class="r325 r">lengthAsString</span>, <b>out</b> <span class="r326 r">length</span>))
                    {
                        <span class="r326 r">length</span> = <b>double</b>.<a href="@1@System.Runtime/A.html#dcd7a869fad1e6bb" class="i field">NaN</a>;
                    }
                }
                <b>else</b>
                {
                    <b>if</b> (!<b>double</b>.<a href="@1@System.Runtime/A.html#4ac3250276256193" class="i method">TryParse</a>(<span class="r325 r">lengthAsString</span>, <b>out</b> <span class="r326 r">length</span>)) <span class="c">// Assuming pixels</span>
                    {
                        <span class="r326 r">length</span> = <b>double</b>.<a href="@1@System.Runtime/A.html#dcd7a869fad1e6bb" class="i field">NaN</a>;
                    }
                }
            }

            <b>return</b> !<b>double</b>.<a href="@1@System.Runtime/A.html#b3843db5f359a0fd" class="i method">IsNaN</a>(<span class="r326 r">length</span>);
        }

        <span class="c">// .................................................................</span>
        <span class="c">//</span>
        <span class="c">// Pasring Color Attribute</span>
        <span class="c">//</span>
        <span class="c">// .................................................................</span>

        <b>private static string</b> <a id="4fb579a9d73444b1" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetColorValue</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r327 rd" class="r327 r">colorValue</span>) =&gt; <span class="r327 r">colorValue</span>;

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Applies properties to xamlTableCellElement based on the html td element it is converted from.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r328 r">htmlChildNode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Html td/th element to be converted to xaml</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r329 r">xamlTableCellElement</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     XmlElement representing Xaml element for which properties are to be processed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     TODO: Use the processed properties for htmlChildNode instead of using the node itself</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="dd777f5a2a1b9375" href="R/dd777f5a2a1b9375.html" target="n" data-glyph="76,1" class="i method">ApplyPropertiesToTableCellElement</a>(<span class="t t">XmlElement</span> <span id="r328 rd" class="r328 r">htmlChildNode</span>, <span class="t t">XmlElement</span> <span id="r329 rd" class="r329 r">xamlTableCellElement</span>)
        {
            <span class="c">// Parameter validation</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r328 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;td&quot;</span> || <span class="r328 r">htmlChildNode</span>.<span class="i property">LocalName</span>.<a href="@1@System.Runtime/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>() == <span class="s">&quot;th&quot;</span>);
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<span class="r329 r">xamlTableCellElement</span>.<span class="i property">LocalName</span> == <a href="#9dfc8ea21aa144d7" class="i field">XamlTableCell</a>);

            <span class="c">// set default border thickness for xamlTableCellElement to enable gridlines</span>
            <span class="r329 r">xamlTableCellElement</span>.<span class="i method">SetAttribute</span>(<a href="#3ffa97f5188ca693" class="i field">XamlTableCellBorderThickness</a>, <span class="s">&quot;1,1,1,1&quot;</span>);
            <span class="r329 r">xamlTableCellElement</span>.<span class="i method">SetAttribute</span>(<a href="#7ad1964877cef6c2" class="i field">XamlTableCellBorderBrush</a>, <a href="#fa95d15ff3865c4e" class="i field">XamlBrushesBlack</a>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r330 rd" class="r330 r">rowSpanString</span> = <a href="#b08ffeae8f65e4a8" class="i method">GetAttribute</a>(<span class="r328 r">htmlChildNode</span>, <span class="s">&quot;rowspan&quot;</span>);
            <b>if</b> (<span class="r330 r">rowSpanString</span> != <b>null</b>)
            {
                <span class="r329 r">xamlTableCellElement</span>.<span class="i method">SetAttribute</span>(<a href="#f1317ab3d3189059" class="i field">XamlTableCellRowSpan</a>, <span class="r330 r">rowSpanString</span>);
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods
    }
}</pre></td></tr></table></div></body></html>
