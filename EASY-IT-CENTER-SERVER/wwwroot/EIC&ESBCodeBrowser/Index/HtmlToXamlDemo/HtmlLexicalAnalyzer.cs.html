<!DOCTYPE html>
<html><head><title>HtmlLexicalAnalyzer.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(745);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#HtmlToXamlDemo/HtmlLexicalAnalyzer.cs" target="_top">HtmlLexicalAnalyzer.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#HtmlToXamlDemo" target="_top">HelpProjects\WPF-MORE\Sample Applications\HtmlToXamlDemo\HtmlToXamlDemo.csproj</a> (HtmlToXamlDemo)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// // Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// // Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;

<b>namespace</b> <span class="i n">HtmlToXamlDemo</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">     lexical analyzer class</span>
    <span class="c">///</span><span class="c">     recognizes tokens as groups of characters separated by arbitrary amounts of whitespace</span>
    <span class="c">///</span><span class="c">     also classifies tokens according to type</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="1a857bac1d90f4aa" href="R/1a857bac1d90f4aa.html" target="n" data-glyph="2,0" class="t t">HtmlLexicalAnalyzer</a>
    {
        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Constructors</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     initializes the _inputStringReader member with the string to be read</span>
        <span class="c">///</span><span class="c">     also sets initial values for _nextCharacterCode and _nextTokenType</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">inputTextString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     text string to be parsed for xml content</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="950f6db5d11be37b" href="R/950f6db5d11be37b.html" target="n" data-glyph="74,1" class="t constructor">HtmlLexicalAnalyzer</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">inputTextString</span>)
        {
            <a href="#0e001bd67c34f203" class="i field">_inputStringReader</a> = <b>new</b> <span class="t constructor">StringReader</span>(<span class="r0 r">inputTextString</span>);
            <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = 0;
            <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <span class="s">&#39; &#39;</span>;
            <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a> = <a href="#0e001bd67c34f203" class="i field">_inputStringReader</a>.<span class="i method">Read</span>();
            <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> = (<b>char</b>) <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a>;
            <a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> = <span class="s">&#39; &#39;</span>;
            <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>true</b>;
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a> = <b>new</b> <a href="@1@System.Runtime/A.html#ec674e2123a44860" class="t constructor">StringBuilder</a>(100);
            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#cabe124dfa22d82f" class="i field">Text</a>;
            <span class="c">// read the first character so we have some value for the NextCharacter property</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Internal methods</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     retrieves next recognizable token from input string</span>
        <span class="c">///</span><span class="c">     and identifies its type</span>
        <span class="c">///</span><span class="c">     if no valid token is found, the output parameters are set to null</span>
        <span class="c">///</span><span class="c">     if end of stream is reached without matching any token, token type</span>
        <span class="c">///</span><span class="c">     paramter is set to EOF</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="61b1fb96dfa18c03" href="R/61b1fb96dfa18c03.html" target="n" data-glyph="74,1" class="i method">GetNextContentToken</a>()
        {
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> != <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#929d1b7d5450303b" class="i field">Eof</a>);
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;
            <b>if</b> (<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#929d1b7d5450303b" class="i field">Eof</a>;
                <b>return</b>;
            }

            <b>if</b> (<a href="#3fc83297558a73b4" class="i property">IsAtTagStart</a>)
            {
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

                <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;/&#39;</span>)
                {
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;&lt;/&quot;</span>);
                    <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#84f765d19a0ff476" class="i field">ClosingTagStart</a>;

                    <span class="c">// advance</span>
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                    <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>false</b>; <span class="c">// Whitespaces after closing tags are significant</span>
                }
                <b>else</b>
                {
                    <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#7e6677e222fa8666" class="i field">OpeningTagStart</a>;
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;&lt;&quot;</span>);
                    <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>true</b>; <span class="c">// Whitespaces after opening tags are insignificant</span>
                }
            }
            <b>else</b> <b>if</b> (<a href="#2069454df2a74010" class="i property">IsAtDirectiveStart</a>)
            {
                <span class="c">// either a comment or CDATA</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;[&#39;</span>)
                {
                    <span class="c">// cdata</span>
                    <a href="#760a83cef94bd339" class="i method">ReadDynamicContent</a>();
                }
                <b>else</b> <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;-&#39;</span>)
                {
                    <a href="#8f78a6155f05cfc9" class="i method">ReadComment</a>();
                }
                <b>else</b>
                {
                    <span class="c">// neither a comment nor cdata, should be something like DOCTYPE</span>
                    <span class="c">// skip till the next tag ender</span>
                    <a href="#8410862ccb6f97dc" class="i method">ReadUnknownDirective</a>();
                }
            }
            <b>else</b>
            {
                <span class="c">// read text content, unless you encounter a tag</span>
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#cabe124dfa22d82f" class="i field">Text</a>;
                <b>while</b> (!<a href="#3fc83297558a73b4" class="i property">IsAtTagStart</a> &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a> &amp;&amp; !<a href="#2069454df2a74010" class="i property">IsAtDirectiveStart</a>)
                {
                    <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;?&#39;</span>)
                    {
                        <span class="c">// ignore processing directive</span>
                        <a href="#686da0eae0355bcb" class="i method">SkipProcessingDirective</a>();
                    }
                    <b>else</b>
                    {
                        <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> &lt;= <span class="s">&#39; &#39;</span>)
                        {
                            <span class="c">//  Respect xml:preserve or its equivalents for whitespace processing</span>
                            <b>if</b> (<a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a>)
                            {
                                <span class="c">// Ignore repeated whitespaces</span>
                            }
                            <b>else</b>
                            {
                                <span class="c">// Treat any control character sequence as one whitespace</span>
                                <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39; &#39;</span>);
                            }
                            <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>true</b>; <span class="c">// and keep ignoring the following whitespaces</span>
                        }
                        <b>else</b>
                        {
                            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                            <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>false</b>;
                        }
                        <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                    }
                }
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Unconditionally returns a token which is one of: TagEnd, EmptyTagEnd, Name, Atom or EndOfStream</span>
        <span class="c">///</span><span class="c">     Does not guarantee token reader advancing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="bd57ecd2b002840b" href="R/bd57ecd2b002840b.html" target="n" data-glyph="74,1" class="i method">GetNextTagToken</a>()
        {
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;
            <b>if</b> (<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#929d1b7d5450303b" class="i field">Eof</a>;
                <b>return</b>;
            }

            <a href="#f1bf7e94df05fd10" class="i method">SkipWhiteSpace</a>();

            <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span> &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>)
            {
                <span class="c">// &amp;gt; should not end a tag, so make sure it&#39;s not an entity</span>
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#d4b67e69e6c5a721" class="i field">TagEnd</a>;
                <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;&gt;&#39;</span>);
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                <span class="c">// Note: _ignoreNextWhitespace must be set appropriately on tag start processing</span>
            }
            <b>else</b> <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;/&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
            {
                <span class="c">// could be start of closing of empty tag</span>
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#de97da5767e89e87" class="i field">EmptyTagEnd</a>;
                <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;/&gt;&quot;</span>);
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                <a href="#278f9d59ec490702" class="i field">_ignoreNextWhitespace</a> = <b>false</b>; <span class="c">// Whitespace after no-scope tags are sifnificant</span>
            }
            <b>else</b> <b>if</b> (<a href="#62dc0b4ff0ead49d" class="i method">IsGoodForNameStart</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>))
            {
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#dad1c1b65f1185cf" class="i field">Name</a>;

                <span class="c">// starts a name</span>
                <span class="c">// we allow character entities here</span>
                <span class="c">// we do not throw exceptions here if end of stream is encountered</span>
                <span class="c">// just stop and return whatever is in the token</span>
                <span class="c">// if the parser is not expecting end of file after this it will call</span>
                <span class="c">// the get next token function and throw an exception</span>
                <b>while</b> (<a href="#bf899e7d604f8105" class="i method">IsGoodForName</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>) &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
                {
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                }
            }
            <b>else</b>
            {
                <span class="c">// Unexpected type of token for a tag. Reprot one character as Atom, expecting that HtmlParser will ignore it.</span>
                <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#323a66a8a7411ea9" class="i field">Atom</a>;
                <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Unconditionally returns equal sign token. Even if there is no</span>
        <span class="c">///</span><span class="c">     real equal sign in the stream, it behaves as if it were there.</span>
        <span class="c">///</span><span class="c">     Does not guarantee token reader advancing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="620ae4f8a7a6d7a1" href="R/620ae4f8a7a6d7a1.html" target="n" data-glyph="74,1" class="i method">GetNextEqualSignToken</a>()
        {
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> != <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#929d1b7d5450303b" class="i field">Eof</a>);
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;

            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;=&#39;</span>);
            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#267ad876d0e73b82" class="i field">EqualSign</a>;

            <a href="#f1bf7e94df05fd10" class="i method">SkipWhiteSpace</a>();

            <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;=&#39;</span>)
            {
                <span class="c">// &#39;=&#39; is not in the list of entities, so no need to check for entities here</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Unconditionally returns an atomic value for an attribute</span>
        <span class="c">///</span><span class="c">     Even if there is no appropriate token it returns Atom value</span>
        <span class="c">///</span><span class="c">     Does not guarantee token reader advancing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="7dc4cba8be6edd96" href="R/7dc4cba8be6edd96.html" target="n" data-glyph="74,1" class="i method">GetNextAtomToken</a>()
        {
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> != <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#929d1b7d5450303b" class="i field">Eof</a>);
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;

            <a href="#f1bf7e94df05fd10" class="i method">SkipWhiteSpace</a>();

            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#323a66a8a7411ea9" class="i field">Atom</a>;

            <b>if</b> ((<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;\&#39;&#39;</span> || <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&quot;&#39;</span>) &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>)
            {
                <a href="@1@System.Runtime/A.html#02f2b1a33b09362d" class="k">var</a> <span id="r1 rd" class="r1 r">startingQuote</span> = <a href="#1407cf58ac87517a" class="i property">NextCharacter</a>;
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

                <span class="c">// Consume all characters between quotes</span>
                <b>while</b> (!(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="r1 r">startingQuote</span> &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>) &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
                {
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                }
                <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="r1 r">startingQuote</span>)
                {
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                }

                <span class="c">// complete the quoted value</span>
                <span class="c">// NOTE: our recovery here is different from IE&#39;s</span>
                <span class="c">// IE keeps reading until it finds a closing quote or end of file</span>
                <span class="c">// if end of file, it treats current value as text</span>
                <span class="c">// if it finds a closing quote at any point within the text, it eats everything between the quotes</span>
                <span class="c">// TODO: Suggestion:</span>
                <span class="c">// however, we could stop when we encounter end of file or an angle bracket of any kind</span>
                <span class="c">// and assume there was a quote there</span>
                <span class="c">// so the attribute value may be meaningless but it is never treated as text</span>
            }
            <b>else</b>
            {
                <b>while</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a> &amp;&amp; !<b>char</b>.<a href="@1@System.Runtime/A.html#cda2cc9b76535970" class="i method">IsWhiteSpace</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>) &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> != <span class="s">&#39;&gt;&#39;</span>)
                {
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                }
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Methods

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Internal Properties</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Properties

        <b>internal</b> <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a> <a id="1d0c0a853fbd0488" href="R/1d0c0a853fbd0488.html" target="n" data-glyph="104,1" class="i property">NextTokenType</a> { <b>get</b>; <b>private set</b>; }

        <b>internal string</b> <a id="c9340dc296c154d5" href="R/c9340dc296c154d5.html" target="n" data-glyph="104,1" class="i property">NextToken</a> =&gt; <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#5a97da49a158a3c9" class="i method">ToString</a>();

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Properties

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Private methods</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Advances a reading position by one character code</span>
        <span class="c">///</span><span class="c">     and reads the next availbale character from a stream.</span>
        <span class="c">///</span><span class="c">     This character becomes available as NextCharacter property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Throws InvalidOperationException if attempted to be called on EndOfStream</span>
        <span class="c">///</span><span class="c">     condition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private void</b> <a id="147796fa77aef655" href="R/147796fa77aef655.html" target="n" data-glyph="76,1" class="i method">GetNextCharacter</a>()
        {
            <b>if</b> (<a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> == -1)
            {
                <b>throw</b> <b>new</b> <a href="@1@System.Runtime/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(<span class="s">&quot;GetNextCharacter method called at the end of a stream&quot;</span>);
            }

            <a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> = <a href="#1407cf58ac87517a" class="i property">NextCharacter</a>;

            <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>;
            <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a>;
            <span class="c">// next character not an entity as of now</span>
            <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>false</b>;

            <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();

            <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&amp;&#39;</span>)
            {
                <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;#&#39;</span>)
                {
                    <span class="c">// numeric entity - parse digits - &amp;#DDDDD;</span>
                    <b>int</b> <span id="r2 rd" class="r2 r">entityCode</span>;
                    <span class="r2 r">entityCode</span> = 0;
                    <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();

                    <span class="c">// largest numeric entity is 7 characters</span>
                    <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r3 rd" class="r3 r">i</span> = 0; <span class="r3 r">i</span> &lt; 7 &amp;&amp; <b>char</b>.<a href="@1@System.Runtime/A.html#041e77a953545d16" class="i method">IsDigit</a>(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>); <span class="r3 r">i</span>++)
                    {
                        <span class="r2 r">entityCode</span> = 10*<span class="r2 r">entityCode</span> + (<a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a> - <span class="s">&#39;0&#39;</span>);
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();
                    }
                    <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;;&#39;</span>)
                    {
                        <span class="c">// correct format - advance</span>
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();
                        <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = <span class="r2 r">entityCode</span>;

                        <span class="c">// if this is out of range it will set the character to &#39;?&#39;</span>
                        <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = (<b>char</b>) <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a>;

                        <span class="c">// as far as we are concerned, this is an entity</span>
                        <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>true</b>;
                    }
                    <b>else</b>
                    {
                        <span class="c">// not an entity, set next character to the current lookahread character</span>
                        <span class="c">// we would have eaten up some digits</span>
                        <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>;
                        <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a>;
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();
                        <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>false</b>;
                    }
                }
                <b>else</b> <b>if</b> (<b>char</b>.<a href="@1@System.Runtime/A.html#b8204f6ff0a505a2" class="i method">IsLetter</a>(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>))
                {
                    <span class="c">// entity is written as a string</span>
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r4 rd" class="r4 r">entity</span> = <span class="s">&quot;&quot;</span>;

                    <span class="c">// maximum length of string entities is 10 characters</span>
                    <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r5 rd" class="r5 r">i</span> = 0;
                        <span class="r5 r">i</span> &lt; 10 &amp;&amp; (<b>char</b>.<a href="@1@System.Runtime/A.html#b8204f6ff0a505a2" class="i method">IsLetter</a>(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>) || <b>char</b>.<a href="@1@System.Runtime/A.html#041e77a953545d16" class="i method">IsDigit</a>(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>));
                        <span class="r5 r">i</span>++)
                    {
                        <span class="r4 r">entity</span> += <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>;
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();
                    }
                    <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;;&#39;</span>)
                    {
                        <span class="c">// advance</span>
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();

                        <b>if</b> (<a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#01b2bd02bdd86c3d" class="i method">IsEntity</a>(<span class="r4 r">entity</span>))
                        {
                            <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <a href="HtmlSchema.cs.html#41ad703b42e0f15f" class="t t">HtmlSchema</a>.<a href="HtmlSchema.cs.html#0cfecdbd64368fcc" class="i method">EntityCharacterValue</a>(<span class="r4 r">entity</span>);
                            <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = <a href="#1407cf58ac87517a" class="i property">NextCharacter</a>;
                            <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>true</b>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// just skip the whole thing - invalid entity</span>
                            <span class="c">// move on to the next character</span>
                            <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>;
                            <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> = <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a>;
                            <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();

                            <span class="c">// not an entity</span>
                            <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>false</b>;
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// skip whatever we read after the ampersand</span>
                        <span class="c">// set next character and move on</span>
                        <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> = <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>;
                        <a href="#1024abe6e4b50be6" class="i method">ReadLookAheadCharacter</a>();
                        <a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a> = <b>false</b>;
                    }
                }
            }
        }

        <b>private void</b> <a id="1024abe6e4b50be6" href="R/1024abe6e4b50be6.html" target="n" data-glyph="76,1" class="i method">ReadLookAheadCharacter</a>()
        {
            <b>if</b> (<a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a> != -1)
            {
                <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a> = <a href="#0e001bd67c34f203" class="i field">_inputStringReader</a>.<span class="i method">Read</span>();
                <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> = (<b>char</b>) <a href="#2716a40347ecc213" class="i field">_lookAheadCharacterCode</a>;
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     skips whitespace in the input string</span>
        <span class="c">///</span><span class="c">     leaves the first non-whitespace character available in the NextCharacter property</span>
        <span class="c">///</span><span class="c">     this may be the end-of-file character, it performs no checking</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="f1bf7e94df05fd10" href="R/f1bf7e94df05fd10.html" target="n" data-glyph="76,1" class="i method">SkipWhiteSpace</a>()
        {
            <span class="c">// TODO: handle character entities while processing comments, cdata, and directives</span>
            <span class="c">// TODO: SUGGESTION: we could check if lookahead and previous characters are entities also</span>
            <b>while</b> (<b>true</b>)
            {
                <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;?&#39;</span> || <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;!&#39;</span>))
                {
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

                    <b>if</b> (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;[&#39;</span>)
                    {
                        <span class="c">// Skip CDATA block and DTDs(?)</span>
                        <b>while</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a> &amp;&amp;
                               !(<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;]&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;]&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>))
                        {
                            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                        }
                        <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
                        {
                            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// Skip processing instruction, comments</span>
                        <b>while</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> != <span class="s">&#39;&gt;&#39;</span>)
                        {
                            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                        }
                        <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
                        {
                            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                        }
                    }
                }


                <b>if</b> (!<b>char</b>.<a href="@1@System.Runtime/A.html#cda2cc9b76535970" class="i method">IsWhiteSpace</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>))
                {
                    <b>break</b>;
                }

                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     checks if a character can be used to start a name</span>
        <span class="c">///</span><span class="c">     if this check is true then the rest of the name can be read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">character</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     character value to be checked</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     true if the character can be the first character in a name</span>
        <span class="c">///</span><span class="c">     false otherwise</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="62dc0b4ff0ead49d" href="R/62dc0b4ff0ead49d.html" target="n" data-glyph="76,1" class="i method">IsGoodForNameStart</a>(<b>char</b> <span id="r6 rd" class="r6 r">character</span>) =&gt; <span class="r6 r">character</span> == <span class="s">&#39;_&#39;</span> || <b>char</b>.<a href="@1@System.Runtime/A.html#b8204f6ff0a505a2" class="i method">IsLetter</a>(<span class="r6 r">character</span>);

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     checks if a character can be used as a non-starting character in a name</span>
        <span class="c">///</span><span class="c">     uses the IsExtender and IsCombiningCharacter predicates to see</span>
        <span class="c">///</span><span class="c">     if a character is an extender or a combining character</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">character</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     character to be checked for validity in a name</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     true if the character can be a valid part of a name</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="bf899e7d604f8105" href="R/bf899e7d604f8105.html" target="n" data-glyph="76,1" class="i method">IsGoodForName</a>(<b>char</b> <span id="r7 rd" class="r7 r">character</span>) =&gt; <a href="#62dc0b4ff0ead49d" class="i method">IsGoodForNameStart</a>(<span class="r7 r">character</span>) ||
                <span class="r7 r">character</span> == <span class="s">&#39;.&#39;</span> ||
                <span class="r7 r">character</span> == <span class="s">&#39;-&#39;</span> ||
                <span class="r7 r">character</span> == <span class="s">&#39;:&#39;</span> ||
                <b>char</b>.<a href="@1@System.Runtime/A.html#041e77a953545d16" class="i method">IsDigit</a>(<span class="r7 r">character</span>) ||
                <a href="#6bafa33324211f67" class="i method">IsCombiningCharacter</a>(<span class="r7 r">character</span>) ||
                <a href="#a216a6ea7b4f1390" class="i method">IsExtender</a>(<span class="r7 r">character</span>);

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     identifies a character as being a combining character, permitted in a name</span>
        <span class="c">///</span><span class="c">     TODO: only a placeholder for now but later to be replaced with comparisons against</span>
        <span class="c">///</span><span class="c">     the list of combining characters in the XML documentation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">character</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     character to be checked</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     true if the character is a combining character, false otherwise</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="6bafa33324211f67" href="R/6bafa33324211f67.html" target="n" data-glyph="76,1" class="i method">IsCombiningCharacter</a>(<b>char</b> <span id="r8 rd" class="r8 r">character</span>) =&gt; <b>false</b>;

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     identifies a character as being an extender, permitted in a name</span>
        <span class="c">///</span><span class="c">     TODO: only a placeholder for now but later to be replaced with comparisons against</span>
        <span class="c">///</span><span class="c">     the list of extenders in the XML documentation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">character</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     character to be checked</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     true if the character is an extender, false otherwise</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="a216a6ea7b4f1390" href="R/a216a6ea7b4f1390.html" target="n" data-glyph="76,1" class="i method">IsExtender</a>(<b>char</b> <span id="r9 rd" class="r9 r">character</span>) =&gt; <b>false</b>;

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     skips dynamic content starting with &#39;</span><span class="c">&lt;</span><span class="c">!</span><span class="c">[</span><span class="c">&#39;</span> <span class="c">and</span> <span class="c">ending</span> <span class="c">with</span> <span class="c">&#39;</span><span class="c">]</span><span class="c">&gt;</span><span class="c">&#39;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="760a83cef94bd339" href="R/760a83cef94bd339.html" target="n" data-glyph="76,1" class="i method">ReadDynamicContent</a>()
        {
            <span class="c">// verify that we are at dynamic content, which may include CDATA</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;[&#39;</span>);

            <span class="c">// Let&#39;s treat this as empty text</span>
            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#cabe124dfa22d82f" class="i field">Text</a>;
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;

            <span class="c">// advance twice, once to get the lookahead character and then to reach the start of the cdata</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

            <span class="c">// NOTE: 10/12/2004: modified this function to check when called if&#39;s reading CDATA or something else</span>
            <span class="c">// some directives may start with a &lt;![ and then have some data and they will just end with a ]&gt;</span>
            <span class="c">// this function is modified to stop at the sequence ]&gt; and not ]]&gt;</span>
            <span class="c">// this means that CDATA and anything else expressed in their own set of [] within the &lt;! [...]&gt;</span>
            <span class="c">// directive cannot contain a ]&gt; sequence. However it is doubtful that cdata could contain such</span>
            <span class="c">// sequence anyway, it probably stops at the first ]</span>
            <b>while</b> (!(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;]&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>) &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <span class="c">// advance</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }

            <b>if</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <span class="c">// advance, first to the last &gt;</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

                <span class="c">// then advance past it to the next character after processing directive</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     skips comments starting with &#39;</span><span class="c">&lt;</span><span class="c">!</span><span class="c">-</span><span class="c">&#39;</span> <span class="c">and</span> <span class="c">ending</span> <span class="c">with</span> <span class="c">&#39;</span><span class="c">-</span><span class="c">-</span><span class="c">&gt;</span><span class="c">&#39;</span>
        <span class="c">///</span><span class="c">     NOTE: 10/06/2004: processing changed, will now skip anything starting with</span>
        <span class="c">///</span><span class="c">     the &quot;</span><span class="c">&lt;</span><span class="c">!</span><span class="c">-</span><span class="c">&quot;</span>  <span class="c">sequence</span> <span class="c">and</span> <span class="c">ending</span> <span class="c">in</span> <span class="c">&quot;</span><span class="c">!</span><span class="c">&gt;</span><span class="c">&quot; or &quot;-&gt;&quot;, because in practice many html pages do not</span>
        <span class="c">///</span><span class="c">     use the full comment specifying conventions</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8f78a6155f05cfc9" href="R/8f78a6155f05cfc9.html" target="n" data-glyph="76,1" class="i method">ReadComment</a>()
        {
            <span class="c">// verify that we are at a comment</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;-&#39;</span>);

            <span class="c">// Initialize a token</span>
            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#4f366d4e7b88b980" class="i field">Comment</a>;
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;

            <span class="c">// advance to the next character, so that to be at the start of comment value</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>(); <span class="c">// get first &#39;-&#39;</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>(); <span class="c">// get second &#39;-&#39;</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>(); <span class="c">// get first character of comment content</span>

            <b>while</b> (<b>true</b>)
            {
                <span class="c">// Read text until end of comment</span>
                <span class="c">// Note that in many actual html pages comments end with &quot;!&gt;&quot; (while xml standard is &quot;--&gt;&quot;)</span>
                <b>while</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a> &amp;&amp;
                       !(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;-&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;-&#39;</span> ||
                         <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>))
                {
                    <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a>);
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                }

                <span class="c">// Finish comment reading</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
                <b>if</b> (<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;-&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;-&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
                {
                    <span class="c">// Standard comment end. Eat it and exit the loop</span>
                    <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>(); <span class="c">// get &#39;&gt;&#39;</span>
                    <b>break</b>;
                }
                <b>if</b> (<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
                {
                    <span class="c">// Nonstandard but possible comment end - &#39;!&gt;&#39;. Exit the loop</span>
                    <b>break</b>;
                }
                <span class="c">// Not an end. Save character and continue continue reading</span>
                <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a>);
            }

            <span class="c">// Read end of comment combination</span>
            <b>if</b> (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)
            {
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     skips past unknown directives that start with &quot;</span><span class="c">&lt;</span><span class="c">!</span><span class="c">&quot;</span> <span class="c">but</span> <span class="c">are</span> <span class="c">not</span> <span class="c">comments</span> <span class="c">or</span> <span class="c">Cdata</span>
        <span class="c">///</span> <span class="c">ignores</span> <span class="c">content</span> <span class="c">of</span> <span class="c">such</span> <span class="c">directives</span> <span class="c">until</span> <span class="c">the</span> <span class="c">next</span> <span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&quot;</span>
        <span class="c">///</span><span class="c">     character</span>
        <span class="c">///</span><span class="c">     applies to directives such as DOCTYPE, etc that we do not presently support</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8410862ccb6f97dc" href="R/8410862ccb6f97dc.html" target="n" data-glyph="76,1" class="i method">ReadUnknownDirective</a>()
        {
            <span class="c">// verify that we are at an unknown directive</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#ee7761ae495fd15e" class="i field">_previousCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp;
                         !(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;-&#39;</span> || <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;[&#39;</span>));

            <span class="c">// Let&#39;s treat this as empty text</span>
            <a href="#1d0c0a853fbd0488" class="i property">NextTokenType</a> = <a href="HtmlTokenType.cs.html#944cc32beb6ea00c" class="t t">HtmlTokenType</a>.<a href="HtmlTokenType.cs.html#cabe124dfa22d82f" class="i field">Text</a>;
            <a href="#00a6b002828f33ac" class="i field">_nextToken</a>.<a href="@1@System.Runtime/A.html#7d7729bd88adac53" class="i property">Length</a> = 0;

            <span class="c">// advance to the next character</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

            <span class="c">// skip to the first tag end we find</span>
            <b>while</b> (!(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span> &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>) &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }

            <b>if</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <span class="c">// advance past the tag end</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     skips processing directives starting with the characters &#39;</span><span class="unknownClassification">&lt;?</span><span class="unknownClassification">&#39; and ending with &#39;</span><span class="unknownClassification">?&gt;</span><span class="c">&#39;</span>
        <span class="c">///</span><span class="c">     NOTE: 10/14/2004: IE also ends processing directives with a /&gt;, so this function is</span>
        <span class="c">///</span><span class="c">     being modified to recognize that condition as well</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="686da0eae0355bcb" href="R/686da0eae0355bcb.html" target="n" data-glyph="76,1" class="i method">SkipProcessingDirective</a>()
        {
            <span class="c">// verify that we are at a processing directive</span>
            <span class="t t">Debug</span>.<span class="i method">Assert</span>(<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;?&#39;</span>);

            <span class="c">// advance twice, once to get the lookahead character and then to reach the start of the drective</span>
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

            <b>while</b> (!((<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;?&#39;</span> || <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;/&#39;</span>) &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>) &amp;&amp; !<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <span class="c">// advance</span>
                <span class="c">// we don&#39;t need to check for entities here because &#39;?&#39; is not an entity</span>
                <span class="c">// and even though &gt; is an entity there is no entity processing when reading lookahead character</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }

            <b>if</b> (!<a href="#0d26e542261e0c39" class="i property">IsAtEndOfStream</a>)
            {
                <span class="c">// advance, first to the last &gt;</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();

                <span class="c">// then advance past it to the next character after processing directive</span>
                <a href="#147796fa77aef655" class="i method">GetNextCharacter</a>();
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Private Properties</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Properties

        <b>private char</b> <a id="1407cf58ac87517a" href="R/1407cf58ac87517a.html" target="n" data-glyph="106,1" class="i property">NextCharacter</a> { <b>get</b>; <b>set</b>; }

        <b>private bool</b> <a id="0d26e542261e0c39" href="R/0d26e542261e0c39.html" target="n" data-glyph="106,1" class="i property">IsAtEndOfStream</a> =&gt; <a href="#575e5f91d6e0d0c5" class="i field">_nextCharacterCode</a> == -1;

        <b>private bool</b> <a id="3fc83297558a73b4" href="R/3fc83297558a73b4.html" target="n" data-glyph="106,1" class="i property">IsAtTagStart</a>
            =&gt; <a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; (<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;/&#39;</span> || <a href="#62dc0b4ff0ead49d" class="i method">IsGoodForNameStart</a>(<a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a>)) &amp;&amp;
               !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>;

        <b>private bool</b> <a id="6d41b4d00790fede" href="R/../../0000000000.html" target="n" data-glyph="106,1" class="i property">IsAtTagEnd</a> =&gt; (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&gt;&#39;</span> || (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;/&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;&gt;&#39;</span>)) &amp;&amp;
                                   !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>;

        <b>private bool</b> <a id="2069454df2a74010" href="R/2069454df2a74010.html" target="n" data-glyph="106,1" class="i property">IsAtDirectiveStart</a>
            =&gt; (<a href="#1407cf58ac87517a" class="i property">NextCharacter</a> == <span class="s">&#39;&lt;&#39;</span> &amp;&amp; <a href="#d609da93463723a4" class="i field">_lookAheadCharacter</a> == <span class="s">&#39;!&#39;</span> &amp;&amp; !<a href="#5a83637355063606" class="i property">IsNextCharacterEntity</a>);

        <b>private bool</b> <a id="5a83637355063606" href="R/5a83637355063606.html" target="n" data-glyph="106,1" class="i property">IsNextCharacterEntity</a> { <span class="c">// check if next character is an entity</span>
            <b>get</b>; <b>set</b>; }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Properties

        <span class="c">// ---------------------------------------------------------------------</span>
        <span class="c">//</span>
        <span class="c">// Private Fields</span>
        <span class="c">//</span>
        <span class="c">// ---------------------------------------------------------------------</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Fields

        <span class="c">// string reader which will move over input text</span>
        <b>private readonly</b> <span class="t t">StringReader</span> <a id="0e001bd67c34f203" href="R/0e001bd67c34f203.html" target="n" data-glyph="46,1" class="i field">_inputStringReader</a>;
        <span class="c">// next character code read from input that is not yet part of any token</span>
        <span class="c">// and the character it represents</span>
        <b>private int</b> <a id="575e5f91d6e0d0c5" href="R/575e5f91d6e0d0c5.html" target="n" data-glyph="46,1" class="i field">_nextCharacterCode</a>;
        <b>private int</b> <a id="2716a40347ecc213" href="R/2716a40347ecc213.html" target="n" data-glyph="46,1" class="i field">_lookAheadCharacterCode</a>;
        <b>private char</b> <a id="d609da93463723a4" href="R/d609da93463723a4.html" target="n" data-glyph="46,1" class="i field">_lookAheadCharacter</a>;
        <b>private char</b> <a id="ee7761ae495fd15e" href="R/ee7761ae495fd15e.html" target="n" data-glyph="46,1" class="i field">_previousCharacter</a>;
        <b>private bool</b> <a id="278f9d59ec490702" href="R/278f9d59ec490702.html" target="n" data-glyph="46,1" class="i field">_ignoreNextWhitespace</a>;

        <span class="c">// store token and type in local variables before copying them to output parameters</span>
        <b>private readonly</b> <a href="@1@System.Runtime/A.html#adf60ee46ebd299f" class="t t">StringBuilder</a> <a id="00a6b002828f33ac" href="R/00a6b002828f33ac.html" target="n" data-glyph="46,1" class="i field">_nextToken</a>;

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Fields
    }
}</pre></td></tr></table></div></body></html>
