(function(){var C=YAHOO.util.Dom,B=YAHOO.util.Event,D=YAHOO.lang;var A=function(F){this.xml=F;this._rawXML=F};A.prototype={rawJSON:null,xmlDOM:null,_cleanXML:function(){this.xml=D.trim(this.xml);this.xml=this.xml.replace(/>\s*\</g,"><");this.xml=this.xml.replace(/\s*\/>/g,"/>");this.xml=this.xml.replace(/<\?[^>]*>/g,"").replace(/<\![^>]*>/g,"");this._fixEndTags()},_fixEndTags:function(){var H=this.xml.split("/>");for(var G=1;G<H.length;G++){var F=H[G-1].substring(H[G-1].lastIndexOf("<")+1).split(" ")[0];H[G]="></"+F+">"+H[G]}H=H.join("");this.xml=H},_convertToXMLObject:function(){var G=null;if(window.DOMParser){try{G=(new DOMParser()).parseFromString(this.xml,"text/xml")}catch(F){G=null}}else{if(window.ActiveXObject){try{G=new ActiveXObject("Microsoft.XMLDOM");G.async=false;if(!G.loadXML(this.xml)){window.alert(G.parseError.reason+G.parseError.srcText)}}catch(F){G=null}}else{alert("cannot parse xml string!")}}this.xmlDOM=G},escape:function(F){return F.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},_getInnerData:function(H){var G="";if("innerHTML" in H){G=H.innerHTML}else{var F=function(M){var K="";if(M.nodeType==1){K+="<"+M.nodeName;for(var J=0;J<M.attributes.length;J++){K+=" "+M.attributes[J].nodeName+"='"+(M.attributes[J].nodeValue||"").toString()+"'"}if(M.firstChild){K+=">";for(var L=M.firstChild;L;L=L.nextSibling){K+=F(L)}K+="</"+M.nodeName+">"}else{K+="/>"}}else{if(M.nodeType==3){K+=M.nodeValue}else{if(M.nodeType==4){K+="<![CDATA["+M.nodeValue+"]]>"}}}return K};for(var I=H.firstChild;I;I=I.nextSibling){G+=F(I)}}return G},parse:function(){this._cleanXML();this._convertToXMLObject();if(this.xmlDOM){this.rawJSON=this._parse(this.xmlDOM);return this.rawJSON}},_parse:function(G){var K={};if(G.nodeType==1){if(G.attributes.length){for(var H=0;H<G.attributes.length;H++){if(!K._attrs){K._attrs={}}K._attrs[G.attributes[H].nodeName]=(G.attributes[H].nodeValue||"").toString()}}if(G.firstChild){var J=0,F=0,I=false;for(var L=G.firstChild;L;L=L.nextSibling){if(L.nodeType==1){I=true}else{if((L.nodeType==3)&&L.nodeValue.match(/[^ \f\n\r\t\v]/)){J++}else{if(L.nodeType==4){F++}}}}if(I){if(J<2&&F<2){for(var L=G.firstChild;L;L=L.nextSibling){if(L.nodeType==3){K._text=this.escape(L.nodeValue)}else{if(L.nodeType==4){K._cdata=this.escape(L.nodeValue)}else{if(K[L.nodeName]){if(K[L.nodeName] instanceof Array){K[L.nodeName][K[L.nodeName].length]=this._parse(L)}else{K[L.nodeName]=[K[L.nodeName],this._parse(L)]}}else{K[L.nodeName]=this._parse(L)}}}}}else{if(!G.attributes.length){K=this.escape(this._getInnerData(G))}else{K._text=this.escape(this._getInnerData(G))}}}else{if(J){if(!G.attributes.length){K=this.escape(this._getInnerData(G))}else{K._text=this.escape(this._getInnerData(G))}}else{if(F){if(F>1){K=this.escape(this._getInnerData(G))}else{for(var L=G.firstChild;L;L=L.nextSibling){K._cdata=this.escape(L.nodeValue)}}}}}if(!G.attributes.length&&!G.firstChild){K=null}}}else{if(G.nodeType==9){K=this._parse(G.documentElement)}}return K}};var E=function(F){if(D.isString(F)){F=YAHOO.lang.JSON.parse(F)}this.json=F};E.prototype={_lineEnding:null,_parse:function(H,J){var I="";if(H instanceof Array){for(var K=0,M=H.length;K<M;K++){I+=this._parse(H[K],J)+this._lineEnding}}else{if(typeof (H)=="object"){var L=false;if(J!="_attrs"){I+="<"+J;for(var F in H){if(F=="_attrs"){for(var G in H[F]){I+=" "+G+'="'+H[F][G].toString()+'"'}}else{L=true}}I+=((L)?">":"/>"+this._lineEnding);if(L){for(var F in H){if(F=="_attrs"){}else{if(F=="_text"){I+=H[F]}else{if(F=="_cdata"){I+="<![CDATA["+H[F]+"]]>"}else{if(F.charAt(0)!="@"){I+=this._parse(H[F],F)}}}}}I+="</"+J+">"+this._lineEnding}}}else{I+="<"+J+">"+H.toString()+"</"+J+">"+this._lineEnding}}return I},parse:function(H){H=H||{};rootTag="json";if(H.rootTag){rootTag=H.rootTag}if(D.isValue(H.lineEnding)){if(H.lineEnding===false){this._lineEnding=""}else{this._lineEnding=H.lineEnding}}else{this._lineEnding="\n"}var G="<"+rootTag;if(this.json._attrs){for(var F in this.json._attrs){G+=" "+F+'="'+this.json._attrs[F].toString()+'"'}}G+=">"+this._lineEnding;for(var I in this.json){G+=this._parse(this.json[I],I)}G+="</"+rootTag+">";return G}};YAHOO.util.XML2JSON=A;YAHOO.util.JSON2XML=E})()