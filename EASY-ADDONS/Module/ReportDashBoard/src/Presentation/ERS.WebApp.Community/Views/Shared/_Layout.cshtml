@using System.Security.Claims;
@using Microsoft.AspNetCore.Identity
@using ERS.Models

@inject             SignInManager<ERS.Models.ApplicationUser> SignInManager
@inject             UserManager<ERS.Models.ApplicationUser> UserManger
@{
    string UserName = "";
    var minimizedClass = Context.Request.Cookies.TryGetValue("sidebar-minimized", out var value)
        && bool.TryParse(value, out var boolValue) && boolValue
        ? "sidebar-minimized"
        : "";

    string bodyClass = "app header-fixed sidebar-fixed aside-menu-fixed " + minimizedClass;
    string footerClass = "";

    if (User != null) {
        UserName = (!string.IsNullOrEmpty(User.GetContactName())) ? User.GetContactName() : UserManger.GetUserName(User);
    }

    bool isSignedIn = SignInManager.IsSignedIn(User);
    if (isSignedIn && !User.IsInRole(Constants.Roles.Guest)) {
        footerClass = "container-fluid";
        bodyClass += " sidebar-show sidebar-lg-show";
    }
    else {
        footerClass = "container";
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="@ViewBag.Description" />
    <meta name="author" content="Korzh.com" />


    <title>EasyReport | @ViewBag.Title</title>


    <link rel="stylesheet" href="https://unpkg.com/@@coreui/coreui@2.1.16/dist/css/coreui.min.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.css" type="text/css">

    <link href="~/css/common.css" rel="stylesheet">
   

    @RenderSection("styles", required: false)
</head>

<body class="@bodyClass">
    <header class="app-header navbar">
        <div class="navbar-brand">
            <a href="/">EasyReport Starter Kit</a>
            <div class="navbar-divider"></div>
            <div class="navbar-title">@(string.IsNullOrEmpty(ViewBag.BrandTitle) ? ViewBag.Title : ViewBag.BrandTitle)</div>
        </div>
        @if (isSignedIn)
        {
            <button class="navbar-toggler sidebar-toggler d-lg-none mr-auto" type="button" title="Toggle sidebar" data-toggle="sidebar-show">
                <span class="navbar-toggler-icon"></span>
            </button>

            <ul class="nav navbar-nav ml-auto">
                <li class="nav-item"><i class="fa fa-user-circle-o fa-2x"></i></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                        @UserName
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="dropdown-header text-center">
                            <strong>Account</strong>
                        </div>
                        @if (!User.IsInRole(Constants.Roles.Guest))
                        {
                            <a asp-controller="Manage" asp-action="Index" class="dropdown-item"><i class="fa fa-user"></i>Profile</a>
                        }

                        <form asp-controller="Account" asp-action="Logout" method="post">
                            <button type="submit" class="btn btn-link dropdown-item"><i class="fa fa-lock"></i> Logout</button>
                        </form>
                    </div>
                </li>
            </ul>
        }
    </header>

    <div class="app-body">
        @if (isSignedIn && !User.IsInRole(Constants.Roles.Guest))
        {
            <div class="sidebar">
                <nav class="sidebar-nav">
                    <ul class="nav">
                        <li class="nav-item">
                            <a asp-controller="Reports" asp-action="Index" class="nav-link"><i class="nav-icon fa fa-files-o"></i>Reports</a>
                        </li>
                        @if (User.IsInRole(Constants.Roles.Admin))
                        {
                            <li class="nav-title">
                                ADMINISTRATING
                            </li>
                            <li class="nav-item">
                                <a asp-controller="Connection" asp-action="EditConnection" class="nav-link"><i class="nav-icon fa fa-database"></i>Connection</a>
                            </li>
                            <li class="nav-item">
                                <a asp-controller="Team" asp-action="Index" class="nav-link"><i class="nav-icon fa fa-users"></i>Team</a>
                            </li>
                        }

                    </ul>
                </nav>
                <button class="sidebar-minimizer brand-minimizer" type="button"></button>
            </div>
        }
        <!-- Main content -->
        <main class="main">
            <partial name="_FlashStatusPartial" />

            <partial name="_CookieConsentPartial" />
            @RenderBody()
        </main>

    </div>

    <footer class="app-footer navbar" style="min-height:50px;">
        <div class="d-flex flex-column @footerClass">
            @if (!isSignedIn)
            {
                <div class="d-flex flex-row">
                    <ul class="nav navbar-nav">
                        <li class="nav-item p-2">
                            <a class="nav-link" href="/">Home</a>
                        </li>
                        <li class="nav-item p-2">
                            <a class="nav-link" href="/Account/Login">Login</a>
                        </li>
                        <li class="nav-item p-2">
                            <a class="nav-link" href="/Home/Privacy">Privacy</a>
                        </li>
                        <li class="nav-item p-2">
                            <a class="nav-link" href="https://korzh.com/support" target="_blank">Support</a>
                        </li>
                    </ul>
                </div>

            }
            <div class="d-flex flex-row">
                <div class="p-2"><a href="https://korzh.com" target="_blank">Korzh.com</a> © 2017 - @DateTime.Now.Year</div>
                <div class="p-2 ml-auto">Powered by <a href="https://korzh.com/easyquery" target="_blank">EasyQuery</a></div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap and necessary plugins -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/@@coreui/coreui@2.0.4/dist/js/coreui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    @if (isSignedIn)
    {
        <script>
            $(".sidebar-minimizer.brand-minimizer").click(() => {
                document.cookie = `sidebar-minimized=${!$("body").hasClass("sidebar-minimized")}`
            });
        </script>
    }


    <script>
        $(window).on('load', function () {
            if ($('#statusModal').length) {
                $('#statusModal').modal('show');
            }

        });

    </script>

    @RenderSection("scripts", required: false)

</body>
</html>

